<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project id="8bc84407-5c65-4012-843b-6b83f5633ee6" activeEnvironment="Default" name="PromotionEngine" soapui-version="5.5.0" abortOnError="false" runType="SEQUENTIAL" resourceRoot="${projectDir}" xmlns:con="http://eviware.com/soapui/config">
  <con:settings>
    <con:setting id="com.eviware.soapui.impl.wsdl.actions.iface.tools.soapui.TestRunnerAction@values-local"><![CDATA[<xml-fragment xmlns:con="http://eviware.com/soapui/config">
  <con:entry key="Report Format(s)" value=""/>
  <con:entry key="Host:Port" value=""/>
  <con:entry key="Export JUnit Results" value="false"/>
  <con:entry key="Export All" value="false"/>
  <con:entry key="Save After" value="false"/>
  <con:entry key="Add Settings" value="false"/>
  <con:entry key="WSS Password Type" value=""/>
  <con:entry key="TestSuite" value="Generic promotion TestSuite"/>
  <con:entry key="Endpoint" value=""/>
  <con:entry key="Select Report Type" value=""/>
  <con:entry key="System Properties" value=""/>
  <con:entry key="Password" value=""/>
  <con:entry key="Print Report" value="false"/>
  <con:entry key="Open Report" value="false"/>
  <con:entry key="Export JUnit Results with test properties" value="false"/>
  <con:entry key="Global Properties" value=""/>
  <con:entry key="Project Properties" value=""/>
  <con:entry key="Project Password" value=""/>
  <con:entry key="TestCase" value="Generic TestCase"/>
  <con:entry key="Username" value=""/>
  <con:entry key="user-settings.xml Password" value=""/>
  <con:entry key="TestRunner Path" value=""/>
  <con:entry key="Environment" value="Default"/>
  <con:entry key="Coverage Report" value="false"/>
  <con:entry key="Enable UI" value="false"/>
  <con:entry key="Root Folder" value=""/>
  <con:entry key="Ignore Errors" value="false"/>
  <con:entry key="Domain" value=""/>
  <con:entry key="Tool Args" value=""/>
  <con:entry key="Save Project" value="false"/>
</xml-fragment>]]></con:setting>
  </con:settings>
  <con:interface xsi:type="con:RestService" id="156d7df1-1c76-43b7-83a9-95f01ac7c3cd" wadlVersion="http://wadl.dev.java.net/2009/02" name="getAllPosPromotions" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT" rootPart=""/>
    <con:endpoints>
      <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
    </con:endpoints>
    <con:resource name="Generic" path="/internal/v1/promotions/" id="eb055986-0d18-49be-adf4-bd8b46779854">
      <con:settings/>
      <con:parameters/>
      <con:method name="getAllPosPromotions" id="a27ff447-4834-4595-a408-3ca291639dfc" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:representation type="RESPONSE">
          <con:mediaType>application/json</con:mediaType>
          <con:status>200</con:status>
          <con:params/>
          <con:element>Response</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType>application/json</con:mediaType>
          <con:status>404 500</con:status>
          <con:params/>
          <con:element xmlns:gen="https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic">gen:Fault</con:element>
        </con:representation>
        <con:request name="Request 1" id="4fef0ebb-b900-4c8f-8bba-f78075aea246" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-ORG" value=" ${#Project#orgid}"/>
  &lt;con:entry key="" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
          <con:request/>
          <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic</con:originalUri>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="f4d0fbef-d160-409a-bbad-2057fe717805" wadlVersion="http://wadl.dev.java.net/2009/02" name="createPosPromotion" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT" rootPart=""/>
    <con:endpoints>
      <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
    </con:endpoints>
    <con:resource name="Generic" path="/internal/v1/promotions" id="a2d9af25-a5b7-4aac-8d84-65343878a4ce">
      <con:settings/>
      <con:parameters/>
      <con:method name="createPosPromotion" id="4e1cbe9e-805f-467a-93f1-d48ec8056a74" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:representation type="REQUEST">
          <con:mediaType>application/json</con:mediaType>
          <con:params/>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType>application/json</con:mediaType>
          <con:status>500 404 400 401</con:status>
          <con:params/>
          <con:element xmlns:gen="https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic">gen:Fault</con:element>
        </con:representation>
        <con:representation type="RESPONSE">
          <con:mediaType>application/json</con:mediaType>
          <con:status>200 201</con:status>
          <con:params/>
          <con:element xmlns:gen="https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic">gen:Response</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:request name="Request 1" id="0022cbf4-6c96-4073-a4d7-0ea694808616" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
&lt;/xml-fragment></con:setting>
            <con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting>
          </con:settings>
          <con:endpoint>${#Project#endpoint}</con:endpoint>
          <con:request>{
    "name": "test promotion_${#Project#rnd}",
    "orgId":  ${#Project#orgid},
    "priority": 1000,
    "active": true,
    "messageLabel": "test!!",
    "type": "POS",
    "condition": {
        "type": "CART",
        "cartCondition": {
            "type": "ITEMCOUNT",
            "operator": "EQUALS",
            "value": 2.0
        }
    },
    "action": {
        "type": "CART_BASED",
        "cartBasedAction": {
            "type": "ABSOLUTE",
            "value": 100.0
        }
    },
    "createdBy": 100,
    "createdOn": 0,
    "lastUpdatedBy": 100,
    "startDate": 1611046526349,
    "endDate": 1611219326349,
    "campaignId": 2013,
    "maxRedemptionRestriction": {
        "repeatFrequency": "DAYS",
        "minTimeBetweenRedemption": 1,
        "maxRedemptionAllowed": 1
    }
}</con:request>
          <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic</con:originalUri>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
          <con:parameterOrder/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="cd897dbd-bd6a-49f5-9bae-e6b1dde101ce" wadlVersion="http://wadl.dev.java.net/2009/02" name="updateAPosPromotion" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT" rootPart=""/>
    <con:endpoints>
      <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
    </con:endpoints>
    <con:resource name="Generic" path="/internal/v1/promotions/{id}" id="abd4c88f-c8c6-49f2-b9c3-86333c30e47d">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>id</con:name>
          <con:value/>
          <con:style>TEMPLATE</con:style>
          <con:default/>
          <con:description xsi:nil="true"/>
        </con:parameter>
      </con:parameters>
      <con:method name="updateAPosPromotion" id="60d6458c-a656-448c-ad3e-0c5995f0138b" method="PUT">
        <con:settings/>
        <con:parameters/>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>405</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="REQUEST">
          <con:mediaType>application/json</con:mediaType>
          <con:params/>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>405</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>405</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="RESPONSE">
          <con:mediaType>application/json</con:mediaType>
          <con:status>200</con:status>
          <con:params/>
          <con:element xmlns:fed="https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic/5fed87a8d72a841c67a1a46a">fed:Response</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>405</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType>application/json</con:mediaType>
          <con:status>500 404</con:status>
          <con:params/>
          <con:element xmlns:fed="https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic/5fed87a8d72a841c67a1a46a">fed:Fault</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>405</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>405</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>405</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>405</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>405</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:request name="Request 1" id="6e045065-b147-4f2f-9b42-0de2af36835c" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-ORG" value=" ${#Project#orgid}"/>
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>${#Project#endpoint}</con:endpoint>
          <con:request>{
    "name": "test promotion",
    "orgId":  ${#Project#orgid},
    "priority": 5,
    "active": true,
    "messageLabel": "test!!",
    "type": "POS",
    "condition": {
        "type": "CART",
        "cartCondition": {
            "type": "ITEMCOUNT",
            "operator": "EQUALS",
            "value": 2.0
        }
    },
    "action": {
        "type": "CART_BASED",
        "cartBasedAction": {
            "type": "ABSOLUTE",
            "value": 100.0
        }
    },
    "createdBy": 100,
    "createdOn": 0,
    "lastUpdatedBy": 100,
    "startDate": 1611046526349,
    "endDate": 1611219326349,
    "campaignId": 2013,
    "maxRedemptionRestriction": {
        "repeatFrequency": "DAYS",
        "minTimeBetweenRedemption": 1,
        "maxRedemptionAllowed": 1
    }
}</con:request>
          <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic/5fed87a8d72a841c67a1a46a</con:originalUri>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <entry key="id" value="${#TestCase#id}" xmlns="http://eviware.com/soapui/config"/>
          </con:parameters>
          <con:parameterOrder>
            <con:entry>id</con:entry>
          </con:parameterOrder>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="d54507c7-c82b-4033-a075-9c133c1abbff" wadlVersion="http://wadl.dev.java.net/2009/02" name="getSinglePosPromotion" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT" rootPart=""/>
    <con:endpoints>
      <con:endpoint>https://${#Project#endpoint}</con:endpoint>
      <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
    </con:endpoints>
    <con:resource name="$" path="/internal/v1/promotions/{id}" id="1d9dd1d7-5ead-4d3e-abbd-6b67f4f4cdce">
      <con:settings/>
      <con:parameters>
        <con:parameter required="true">
          <con:name>id</con:name>
          <con:value/>
          <con:style>TEMPLATE</con:style>
          <con:default/>
          <con:description xsi:nil="true"/>
        </con:parameter>
      </con:parameters>
      <con:method name="getPosPromotionById" id="9e164510-51d0-4694-ad6d-af204ff9a62b" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:representation type="FAULT">
          <con:mediaType>application/json</con:mediaType>
          <con:status>404 500</con:status>
          <con:params/>
          <con:element xmlns:prom="https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/">prom:Fault</con:element>
        </con:representation>
        <con:representation type="RESPONSE">
          <con:mediaType>application/json</con:mediaType>
          <con:status>200</con:status>
          <con:params/>
          <con:element>Response</con:element>
        </con:representation>
        <con:representation type="RESPONSE">
          <con:mediaType xsi:nil="true"/>
          <con:status>0</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="RESPONSE">
          <con:mediaType xsi:nil="true"/>
          <con:status>0</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:request name="Request 1" id="2b5c0f97-69fe-4ea5-ad39-d9c0e4a4d839" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-ORG" value=" ${#Project#orgid}"/>
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>${#Project#endpoint}</con:endpoint>
          <con:request/>
          <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic/</con:originalUri>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <entry key="id" value="${#TestCase#id}" xmlns="http://eviware.com/soapui/config"/>
          </con:parameters>
          <con:parameterOrder>
            <con:entry>id</con:entry>
          </con:parameterOrder>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="5f781dc4-8721-436a-ba87-4623784188f7" wadlVersion="http://wadl.dev.java.net/2009/02" name="Evaluate" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT" rootPart=""/>
    <con:endpoints>
      <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
    </con:endpoints>
    <con:resource name="Evaluate" path="/v1/promotions/evaluate" id="9fab5574-7fda-46a8-814e-d4192b982071">
      <con:settings/>
      <con:parameters/>
      <con:method name="Evaluate 1" id="bb5e8142-0a24-4bde-8dec-824950c23f33" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:representation type="RESPONSE">
          <con:mediaType>application/json</con:mediaType>
          <con:status>200</con:status>
          <con:params/>
          <con:element xmlns:eval="https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/evaluate">eval:Response</con:element>
        </con:representation>
        <con:representation type="REQUEST">
          <con:mediaType>application/json</con:mediaType>
          <con:params/>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType>application/json</con:mediaType>
          <con:status>500 404</con:status>
          <con:params/>
          <con:element xmlns:eval="https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/evaluate">eval:Fault</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>400</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>401</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>401</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>401</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>401</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>401</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>401</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>401</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>401</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>401</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>401</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>401</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>401</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType xsi:nil="true"/>
          <con:status>401</con:status>
          <con:params/>
          <con:element>data</con:element>
        </con:representation>
        <con:request name="Request 1" id="76ec8db7-d854-4d98-a590-3b20231743f0" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="X-CAP-API-AUTH-ENTITY-ID" value="${#Project#tillid}" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>${#Project#externalEndpoint}</con:endpoint>
          <con:request>{
  "amount": 500,
  "customerId": 100,
  "cartItems": [
    {
      "referenceId": "fdc78567-bf4a-494b-9386-83045a910dcb",
      "sku": "6676557b-a2ee-4334-aa6e-7a64ba15be37",
      "amount": 200,
      "qty": 2,
      "discount": null,
      "appliedPromotions": null
    },
    {
      "referenceId": "7caa090c-9278-4f25-b587-575a6f1f1405",
      "sku": "d5a5ef5f-1f96-4180-9f31-81940469fbce",
      "amount": 800,
      "qty": 2,
      "discount": null,
      "appliedPromotions": null
    }
  ],
  "appliedPromotions": null
}</con:request>
          <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/evaluate</con:originalUri>
          <con:credentials>
            <con:username>${#Project#tillusername}</con:username>
            <con:password>202cb962ac59075b964b07152d234b70</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="1b0ea5c2-4b9a-4799-b78d-f7d34d5228df" wadlVersion="http://wadl.dev.java.net/2009/02" name="PromotionEngine" type="rest" definitionUrl="6024c1d90d93ed13c0ea1bb1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache/>
    <con:endpoints/>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="9a4657da-86a9-4ff5-abba-927d5cbf247b" wadlVersion="http://wadl.dev.java.net/2009/02" name="DeactivatePromotion" type="rest" basePath="" definitionUrl="/home/srinivas/Documents/test wadl/DeactivatePromotion_1.wadl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT" rootPart="file:/home/srinivas/Documents/test%20wadl/DeactivatePromotion_1.wadl">
      <con:part>
        <con:url>file:/home/srinivas/Documents/test%20wadl/DeactivatePromotion_1.wadl</con:url>
        <con:content><![CDATA[<application xmlns="http://wadl.dev.java.net/2009/02">
  <doc xml:lang="en" title="DeactivatePromotion"/>
  <resources base="https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com">
    <resource path="internal/v1/promotions/{promotionid}/deactivate" id="Deactivate">
      <doc xml:lang="en" title="Deactivate"/>
      <param name="promotionid" type="xs:string" required="false" default="" style="template" xmlns:xs="http://www.w3.org/2001/XMLSchema"/>
      <method name="GET" id="Deactivate 1">
        <doc xml:lang="en" title="Deactivate 1"/>
        <request/>
      </method>
    </resource>
  </resources>
</application>]]></con:content>
        <con:type>http://wadl.dev.java.net/2009/02</con:type>
      </con:part>
    </con:definitionCache>
    <con:endpoints>
      <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
    </con:endpoints>
    <con:resource name="Deactivate" path="/internal/v1/promotions/{promotionid}/deactivate" id="5e6be19b-46b7-4de1-870f-ce78b6300272">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>promotionid</con:name>
          <con:value/>
          <con:style>TEMPLATE</con:style>
          <con:default/>
        </con:parameter>
      </con:parameters>
      <con:method name="Deactivate 1" id="2d939943-dc8a-4e57-9086-8c98692c7eb4" method="PUT">
        <con:settings/>
        <con:parameters>
          <con:parameter>
            <con:name>X-CAP-API-AUTH-ORG-ID</con:name>
            <con:value/>
            <con:style>HEADER</con:style>
            <con:default/>
            <con:description xsi:nil="true"/>
          </con:parameter>
          <con:parameter>
            <con:name>AUTH-COOKIE</con:name>
            <con:value>${#Project#tillid}</con:value>
            <con:style>HEADER</con:style>
            <con:default>${#Project#tillid}</con:default>
            <con:description xsi:nil="true"/>
          </con:parameter>
        </con:parameters>
        <con:request name="Request 1" id="82128d68-6af6-4042-83e9-4d9233a29bfa" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#endpoint}</con:endpoint>
          <con:request/>
          <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions//deactivate</con:originalUri>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
            <con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
            <con:entry key="promotionid" value="${#TestCase#promotionId}"/>
          </con:parameters>
          <con:parameterOrder>
            <con:entry>promotionid</con:entry>
            <con:entry>X-CAP-API-AUTH-ORG-ID</con:entry>
            <con:entry>AUTH-COOKIE</con:entry>
          </con:parameterOrder>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="146df2e7-58e0-48e8-8f97-1820a54a2307" wadlVersion="http://wadl.dev.java.net/2009/02" name="Filter:searchPromobyCampaignid" type="rest" basePath="" definitionUrl="/home/srinivas/Documents/test wadl/Filter:searchPromobyCampaignid_1.wadl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache/>
    <con:endpoints>
      <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
    </con:endpoints>
    <con:resource name="Filters" path="/internal/v1/promotions/filters" id="41d12d87-dd58-403a-bf4c-b744087f405b">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>campaignId</con:name>
          <con:value>2013</con:value>
          <con:style>QUERY</con:style>
          <con:default>2013</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Filters 1" id="968823b4-c242-4b5e-a9eb-ac9dd21a6f96" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:representation type="RESPONSE" id="">
          <con:mediaType>application/json</con:mediaType>
          <con:status>200</con:status>
          <con:params/>
          <con:element xsi:nil="true"/>
          <con:description xsi:nil="true"/>
        </con:representation>
        <con:request name="Request 1" id="32910ca5-bad9-4930-b44e-73b00090454a" mediaType="application/json">
          <con:settings/>
          <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
          <con:request/>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="a21da619-6b0d-4de1-8552-c57dbc0e6ed9" wadlVersion="http://wadl.dev.java.net/2009/02" name="Filter:searchPromobyTillid" type="rest" basePath="" definitionUrl="/home/srinivas/Documents/test wadl/Filter:searchPromobyTillid_1.wadl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache/>
    <con:endpoints>
      <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
    </con:endpoints>
    <con:resource name="Filters" path="internal/v1/promotions/filters" id="5dc11faf-68d4-49d1-a6a2-d56753e96851">
      <con:settings/>
      <con:parameters/>
      <con:method name="FilterPromobyTillid" id="a77f41be-f38a-4baa-92d7-27b5d0b4500f" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:representation type="RESPONSE" id="">
          <con:mediaType>application/json</con:mediaType>
          <con:status>200</con:status>
          <con:params/>
          <con:element xsi:nil="true"/>
          <con:description xsi:nil="true"/>
        </con:representation>
        <con:request name="Request 1" id="c34a1a87-cf3e-421b-b658-fb971a490969" mediaType="application/json">
          <con:settings/>
          <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
          <con:request/>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="7470f1b9-682b-4307-b08b-d9832f2019d9" wadlVersion="http://wadl.dev.java.net/2009/02" name="Get promotion Strategy" type="rest" basePath="" definitionUrl="/home/srinivas/Documents/test wadl/Get promotion Strategy_1.wadl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT" rootPart="file:/home/srinivas/Documents/test%20wadl/Get%20promotion%20Strategy_1.wadl">
      <con:part>
        <con:url>file:/home/srinivas/Documents/test%20wadl/Get%20promotion%20Strategy_1.wadl</con:url>
        <con:content><![CDATA[<application xmlns="http://wadl.dev.java.net/2009/02">
  <doc xml:lang="en" title="Get promotion Strategy"/>
  <resources base="https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com">
    <resource path="internal/v1/promotions/settings/strategy" id="Strategy">
      <doc xml:lang="en" title="Strategy"/>
      <method name="GET" id="Strategy 1">
        <doc xml:lang="en" title="Strategy 1"/>
        <request/>
        <response status="503">
          <representation mediaType="text/html"/>
        </response>
        <response status="0">
          <representation mediaType=""/>
        </response>
        <response status="200">
          <representation mediaType="application/json"/>
        </response>
      </method>
    </resource>
  </resources>
</application>]]></con:content>
        <con:type>http://wadl.dev.java.net/2009/02</con:type>
      </con:part>
    </con:definitionCache>
    <con:endpoints>
      <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
    </con:endpoints>
    <con:resource name="Strategy" path="internal/v1/promotions/settings/strategy" id="8bc405df-caa0-4151-b99f-14a2e12d2d95">
      <con:settings/>
      <con:parameters/>
      <con:method name="Strategy 1" id="1769a45b-d200-401f-9399-5db0d6139881" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:representation type="FAULT" id="">
          <con:mediaType>text/html</con:mediaType>
          <con:status>503</con:status>
          <con:params/>
          <con:element xsi:nil="true"/>
          <con:description xsi:nil="true"/>
        </con:representation>
        <con:representation type="RESPONSE" id="">
          <con:mediaType/>
          <con:status>0</con:status>
          <con:params/>
          <con:element xsi:nil="true"/>
          <con:description xsi:nil="true"/>
        </con:representation>
        <con:representation type="RESPONSE" id="">
          <con:mediaType>application/json</con:mediaType>
          <con:status>200</con:status>
          <con:params/>
          <con:element xsi:nil="true"/>
          <con:description xsi:nil="true"/>
        </con:representation>
        <con:request name="Request 1" id="d5d3313d-9241-4d2b-8d09-79490b580cd8" mediaType="application/json">
          <con:settings/>
          <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
          <con:request/>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="a360019c-3fad-4491-80a4-32e18301e716" wadlVersion="http://wadl.dev.java.net/2009/02" name="Set promotion Strategy" type="rest" basePath="" definitionUrl="/home/srinivas/Documents/test wadl/Set promotion Strategy_1.wadl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT" rootPart="file:/home/srinivas/Documents/test%20wadl/Set%20promotion%20Strategy_1.wadl">
      <con:part>
        <con:url>file:/home/srinivas/Documents/test%20wadl/Set%20promotion%20Strategy_1.wadl</con:url>
        <con:content><![CDATA[<application xmlns="http://wadl.dev.java.net/2009/02">
  <doc xml:lang="en" title="Set promotion Strategy"/>
  <resources base="https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com">
    <resource path="internal/v1/promotions/settings/strategy" id="Strategy">
      <doc xml:lang="en" title="Strategy"/>
      <method name="POST" id="Strategy 1">
        <doc xml:lang="en" title="Strategy 1"/>
        <request>
          <representation mediaType="application/json"/>
        </request>
        <response status="">
          <representation mediaType="application/json"/>
        </response>
        <response status="200">
          <representation mediaType="application/json"/>
        </response>
        <response status="400">
          <representation mediaType=""/>
          <representation mediaType=""/>
        </response>
      </method>
    </resource>
  </resources>
</application>]]></con:content>
        <con:type>http://wadl.dev.java.net/2009/02</con:type>
      </con:part>
    </con:definitionCache>
    <con:endpoints>
      <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
    </con:endpoints>
    <con:resource name="Strategy" path="internal/v1/promotions/settings/strategy" id="ffb31485-f97b-4567-bd9c-6948aaab61c9">
      <con:settings/>
      <con:parameters/>
      <con:method name="Strategy 1" id="0c11e7fb-ee4b-4f48-976b-05eb0ca550f4" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:representation type="REQUEST" id="">
          <con:mediaType>application/json</con:mediaType>
          <con:params/>
          <con:element xsi:nil="true"/>
          <con:description xsi:nil="true"/>
        </con:representation>
        <con:representation type="RESPONSE" id="">
          <con:mediaType>application/json</con:mediaType>
          <con:status/>
          <con:params/>
          <con:element xsi:nil="true"/>
          <con:description xsi:nil="true"/>
        </con:representation>
        <con:representation type="RESPONSE" id="">
          <con:mediaType>application/json</con:mediaType>
          <con:status>200</con:status>
          <con:params/>
          <con:element xsi:nil="true"/>
          <con:description xsi:nil="true"/>
        </con:representation>
        <con:representation type="FAULT" id="">
          <con:mediaType/>
          <con:status>400</con:status>
          <con:params/>
          <con:element xsi:nil="true"/>
          <con:description xsi:nil="true"/>
        </con:representation>
        <con:representation type="FAULT" id="">
          <con:mediaType/>
          <con:status>400</con:status>
          <con:params/>
          <con:element xsi:nil="true"/>
          <con:description xsi:nil="true"/>
        </con:representation>
        <con:request name="Request 1" id="3ef482cf-b20b-4f71-ac17-8d05e46e1680" mediaType="application/json">
          <con:settings/>
          <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
          <con:request/>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="e69b80b6-8b70-453f-858b-12d5bacca583" wadlVersion="http://wadl.dev.java.net/2009/02" name="Arya Auth Api" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT" rootPart=""/>
    <con:endpoints>
      <con:endpoint>https://crm-nightly-new.cc.capillarytech.com</con:endpoint>
    </con:endpoints>
    <con:resource name="Login" path="/arya/api/v1/auth/login" id="0e0a043e-0c05-41a6-b160-30500b054666">
      <con:settings/>
      <con:parameters/>
      <con:method name="Login 1" id="8bef519c-f8d5-4b21-be7a-09e232f6f977" method="POST">
        <con:settings/>
        <con:parameters>
          <con:parameter>
            <con:name>Accept</con:name>
            <con:value>*/*</con:value>
            <con:style>HEADER</con:style>
            <con:default>*/*</con:default>
          </con:parameter>
          <con:parameter>
            <con:name>Content-Type</con:name>
            <con:value>application/json</con:value>
            <con:style>HEADER</con:style>
            <con:default>application/json</con:default>
          </con:parameter>
        </con:parameters>
        <con:representation type="RESPONSE">
          <con:mediaType>application/json; charset=utf-8</con:mediaType>
          <con:status>200</con:status>
          <con:params/>
          <con:element xmlns:log="https://crm-nightly-new.cc.capillarytech.com/arya/api/v1/auth/login">log:Response</con:element>
        </con:representation>
        <con:representation type="REQUEST">
          <con:mediaType>application/json</con:mediaType>
          <con:params/>
        </con:representation>
        <con:request name="" id="9a39b489-1b3a-4950-ba1c-555c994bf1b8" mediaType="application/json">
          <con:settings/>
          <con:endpoint>https://crm-nightly-new.cc.capillarytech.com</con:endpoint>
          <con:request>{"username":"ashish", "password": "123"
}</con:request>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:parameters>
            <con:entry key="Accept" value="*/*"/>
            <con:entry key="Content-Type" value="application/json"/>
          </con:parameters>
          <con:parameterOrder>
            <con:entry>Accept</con:entry>
            <con:entry>Content-Type</con:entry>
          </con:parameterOrder>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:testSuite id="ed9ab839-1d80-402b-b084-5cfb2be1f1dc" name="ReUsableTestSuits" disabled="true">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:properties/>
  </con:testSuite>
  <con:testSuite id="de558d39-3385-4245-9b31-98b3da168dd6" name="GenericPromotions_Scenarios">
    <con:description>TestSuite generated for REST Service [Create generic promotion]</con:description>
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase id="7023455f-d6c7-48d3-a5c4-c8dfddc03360" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Create, Edit, Verify and Disable a POS Promotion" searchProperties="true">
      <con:description>TestCase generated for REST Resource [Generic] located at [/internal/v1/promotion/generic]</con:description>
      <con:settings/>
      <con:testStep type="restrequest" name="Adding Token" id="0ff4eb59-940e-4217-8259-f428f202c875">
        <con:settings/>
        <con:config service="Arya Auth Api" resourcePath="/arya/api/v1/auth/login" methodName="Login 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Adding Token" id="9a39b489-1b3a-4950-ba1c-555c994bf1b8" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://crm-nightly-new.cc.capillarytech.com</con:endpoint>
            <con:request>{"username":"ashish", "password": "123"
}</con:request>
            <con:originalUri>https://crm-nightly-new.cc.capillarytech.com/arya/api/v1/auth/login</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="f3989af3-6bdd-41c9-b97f-25c62c5e8cbf" name="Script Assertion">
              <con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
log.info(json)
def token= json.token

messageExchange.modelItem.project.setPropertyValue("token","Bearer "+token);

newToken = context.expand('${#Project#token}')
assert (("Bearer "+token).equalsIgnoreCase(newToken))</scriptText></con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="Accept" value="*/*"/>
              <con:entry key="Content-Type" value="application/json"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>Accept</con:entry>
              <con:entry>Content-Type</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Given script creates a pre-requisites" id="446a1d74-05bf-4af5-b4df-83be2c7e939e">
        <con:settings/>
        <con:config>
          <script>String requestId = UUID.randomUUID().toString()
String randomId = new Random().with {(1..10).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()}
String starttime = System.currentTimeMillis().toString()
String endtime = (System.currentTimeMillis()+86400000).toString()

//storing ids to test case level.
testRunner.testCase.setPropertyValue("starttime", starttime);
testRunner.testCase.setPropertyValue("endtime", endtime);
testRunner.testCase.setPropertyValue("randomId", randomId);
testRunner.testCase.setPropertyValue("requestid",requestId);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="When promotion manager create a generic promotion" id="006254db-fb9a-4031-84d3-30bc1e87debc">
        <con:settings/>
        <con:config service="createPosPromotion" resourcePath="/internal/v1/promotions" methodName="createPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="When promotion manager create a generic promotion" id="0022cbf4-6c96-4073-a4d7-0ea694808616" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
              <con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
    "name": "test promotion_${#TestCase#randomId}",
    "orgId": ${#Project#orgid},
    "priority": 0,
    "active": true,
    "messageLabel": "test!!",
    "type": "POS",
    "condition": {
        "type": "CART",
        "cartCondition": {
            "kpi": "SUBTOTAL",
            "operator": "EQUALS",
            "value": 250.0
        }
    },
    "action": {
        "type": "CART_BASED",
        "cartBasedAction": {
            "type": "ABSOLUTE",
            "value": 250.0
        }
    },
    "createdBy": 100,
    "createdOn": 0,
    "lastUpdatedBy": 100,
    "startDate": ${#TestCase#starttime},
    "endDate": ${#TestCase#endtime},
    "campaignId": ${#TestSuite#rnd}
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic</con:originalUri>
            <con:assertion type="Response SLA Assertion" id="f6ec4498-8cca-4707-94fa-980cc2d05782" name="Response SLA">
              <con:configuration>
                <SLA>${#Project#responseSLA}</SLA>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="951478e9-763f-4b2d-a4b2-acf1fe980609" name="Save promotion related details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;


String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);




// getting and saving promotion name and ID to test case level.
def promotionId = json.data.id
def promotionName = json.data.name
messageExchange.modelItem.testCase.setPropertyValue("promotionId",promotionId);
messageExchange.modelItem.testCase.setPropertyValue("promotionName",promotionName);

orgIdInResponse = json.data.orgId.toString()
orgIdExpected = context.expand('${#Project#orgid}')

assert(orgIdInResponse == orgIdExpected):"Org Id is not expected"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Valid HTTP Status Codes" id="090462b5-2d5c-41fd-9736-d0613077d4e1" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>201</codes>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Then generic promotion is created successfully" id="e52e7dcd-da77-4948-8920-5985bc664b92">
        <con:settings/>
        <con:config service="getSinglePosPromotion" resourcePath="/internal/v1/promotions/{id}" methodName="getPosPromotionById" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Then generic promotion is created successfully" id="2b5c0f97-69fe-4ea5-ad39-d9c0e4a4d839" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value="123"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="4a9da00c-d3e5-4e4a-86c8-b0ca732b480a" name="Asserting the promotion details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



def promotionNameInResponse = json.data.name;
def promotionIdInResponse = json.data.id;

promotionNameExpected = context.expand('${#TestCase#promotionName}')
promotionIdExpected = context.expand('${#TestCase#promotionId}')

assert(promotionNameInResponse == promotionNameExpected):"Promotion names are not expected. Expected = " + promotionNameExpected + " Actual = " + promotionNameInResponse
assert(promotionIdInResponse == promotionIdExpected):"Promotion Ids are not expected. Expected = " + promotionIdExpected + " Actual = " + promotionIdInResponse</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="id" value="${#TestCase#promotionId}" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Given script creates a random name for promotion" id="0f096d9b-118f-4759-ab58-6751bde4ef98">
        <con:settings/>
        <con:config>
          <script>def newName = new Random().with {(1..10).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()}
def updatedName = "test promotion_"+newName

// save the new name at test case level.
testRunner.testCase.setPropertyValue('newPromotionName', updatedName)</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="When promotion manager update the promotion name" id="a039819e-f52e-4d1e-8f77-45232dc001eb">
        <con:settings/>
        <con:config service="updateAPosPromotion" resourcePath="/internal/v1/promotions/{id}" methodName="updateAPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="When promotion manager update the promotion name" id="6e045065-b147-4f2f-9b42-0de2af36835c" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
    "name": "${#TestCase#newPromotionName}",
    "orgId": ${#Project#orgid},
    "priority": 0,
    "active": true,
    "messageLabel": "test!!",
    "type": "POS",
    "condition": {
        "type": "CART",
        "cartCondition": {
            "kpi": "SUBTOTAL",
            "operator": "EQUALS",
            "value": 250.0
        }
    },
    "action": {
        "type": "CART_BASED",
        "cartBasedAction": {
            "type": "ABSOLUTE",
            "value": 250.0
        }
    },
    "createdBy": 100,
    "createdOn": 0,
    "lastUpdatedBy": 100,
    "startDate": ${#TestCase#starttime},
    "endDate": ${#TestCase#endtime},
    "campaignId": ${#TestSuite#rnd}
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic/5fed87a8d72a841c67a1a46a</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="e4d17674-dc0f-496b-922a-dd8b7633a98a" name="assert promotion details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;


String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);




promotionIdInResponse = json.data.id
promotionNameInResponse = json.data.name

promotionNameExpected = context.expand('${#TestCase#newPromotionName}')
promotionIdExpected = context.expand('${#TestCase#promotionId}')

assert(promotionNameInResponse == promotionNameExpected):"Promotion names are not expected. Expected = " + promotionNameExpected + " Actual = " + promotionNameInResponse
assert(promotionIdInResponse == promotionIdExpected):"Promotion Ids are not expected. Expected = " + promotionIdExpected + " Actual = " + promotionIdInResponse</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Valid HTTP Status Codes" id="fb00a1e0-6a92-4d65-9f69-dbab3736f1d6" name="Status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Response SLA Assertion" id="e9e1d31d-c3cd-4823-9b78-8ea2cc8163ae" name="Response SLA">
              <con:configuration>
                <SLA>${#Project#responseSLA}</SLA>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="id" value="${#TestCase#promotionId}" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Then promotion name is updated successfully" id="cde3eef0-b00a-4858-ba5d-9d99cc2cb6f8">
        <con:settings/>
        <con:config service="getSinglePosPromotion" resourcePath="/internal/v1/promotions/{id}" methodName="getPosPromotionById" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Then promotion name is updated successfully" id="2b5c0f97-69fe-4ea5-ad39-d9c0e4a4d839" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value="123"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="4a9da00c-d3e5-4e4a-86c8-b0ca732b480a" name="Asserting the promotion details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;



String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



def promotionNameInResponse = json.data.name;
def promotionIdInResponse = json.data.id;

promotionNameExpected = context.expand('${#TestCase#newPromotionName}')
promotionIdExpected = context.expand('${#TestCase#promotionId}')

assert(promotionNameInResponse == promotionNameExpected):"Promotion names are not expected. Expected = " + promotionNameExpected + " Actual = " + promotionNameInResponse
assert(promotionIdInResponse == promotionIdExpected):"Promotion Ids are not expected. Expected = " + promotionIdExpected + " Actual = " + promotionIdInResponse</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="id" value="${#TestCase#promotionId}" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="When promotion manager updates the cart condtions" id="6bf3b055-35da-467f-96f4-9d30314fdb96">
        <con:settings/>
        <con:config service="updateAPosPromotion" resourcePath="/internal/v1/promotions/{id}" methodName="updateAPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="When promotion manager updates the cart condtions" id="6e045065-b147-4f2f-9b42-0de2af36835c" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
    "name": "${#TestCase#newPromotionName}",
    "orgId": ${#Project#orgid},
    "priority": 0,
    "active": true,
    "messageLabel": "test!!",
    "type": "POS",
    "condition": {
        "type": "CART",
        "cartCondition": {
            "kpi": "ITEMCOUNT",
            "operator": "LESS_THAN",
            "value": 3
        }
    },
    "action": {
        "type": "CART_BASED",
        "cartBasedAction": {
            "type": "ABSOLUTE",
            "value": 250.0
        }
    },
    "createdBy": 100,
    "createdOn": 0,
    "lastUpdatedBy": 100,
    "startDate": ${#TestCase#starttime},
    "endDate": ${#TestCase#endtime},
    "campaignId": ${#TestSuite#rnd}
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic/5fed87a8d72a841c67a1a46a</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="73ea8b69-252d-442d-b3d8-a2b8ac830417" name="assert the promotion details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;



String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



promotionNameInResponse = json.data.name
promotionIdInResponse = json.data.id

promotionNameExpected = context.expand('${#TestCase#newPromotionName}')
promotionIdExpected = context.expand('${#TestCase#promotionId}')

assert(promotionNameInResponse == promotionNameExpected):"Promotion names are not expected. Expected = " + promotionNameExpected + " Actual = " + promotionNameInResponse
assert(promotionIdInResponse == promotionIdExpected):"Promotion Ids are not expected. Expected = " + promotionIdExpected + " Actual = " + promotionIdInResponse


cartConditionDic = json.data.condition
expectedCartConditions = [
        "type": "CART",
        "cartCondition": [
            "kpi": "ITEMCOUNT",
            "operator": "LESS_THAN",
            "value": "3.000000"],
            "productCondition": null
        ]

assert cartConditionDic.equals(expectedCartConditions) : "Cart conditions are not expected";</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="id" value="${#TestCase#promotionId}" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Then the promotion cart condition updated successfully" id="51ba352f-8983-4116-bb60-9c3d09efdfb3">
        <con:settings/>
        <con:config service="getSinglePosPromotion" resourcePath="/internal/v1/promotions/{id}" methodName="getPosPromotionById" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Then the promotion cart condition updated successfully" id="2b5c0f97-69fe-4ea5-ad39-d9c0e4a4d839" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value="123"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="4a9da00c-d3e5-4e4a-86c8-b0ca732b480a" name="Asserting the cart condition details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;



String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



promotionNameInResponse = json.data.name
promotionIdInResponse = json.data.id

promotionNameExpected = context.expand('${#TestCase#newPromotionName}')
promotionIdExpected = context.expand('${#TestCase#promotionId}')

assert(promotionNameInResponse == promotionNameExpected):"Promotion names are not expected. Expected = " + promotionNameExpected + " Actual = " + promotionNameInResponse
assert(promotionIdInResponse == promotionIdExpected):"Promotion Ids are not expected. Expected = " + promotionIdExpected + " Actual = " + promotionIdInResponse


cartConditionDic = json.data.condition
expectedCartConditions = [
        "type": "CART",
        "cartCondition": [
            "kpi": "ITEMCOUNT",
            "operator": "LESS_THAN",
            "value": "3.000000"],
            "productCondition": null
        ]

assert cartConditionDic.equals(expectedCartConditions) : "Cart conditions are not expected";</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="id" value="${#TestCase#promotionId}" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Given script create the updated start/end time for promotion" id="365c5adb-491a-46ae-8409-685a2cb8949e">
        <con:settings/>
        <con:config>
          <script>def starttime = testRunner.testCase.getPropertyValue("starttime");
def updatedStartTime = Long.parseLong(starttime)-86400000;

def endtime = testRunner.testCase.getPropertyValue("endtime");
def updatedEndTime = Long.parseLong(endtime)+96400000;

//Setting the range from yesterday with current time to tommorrow current time
testRunner.testCase.setPropertyValue("updatedStartTime", String.valueOf(updatedStartTime));
testRunner.testCase.setPropertyValue("updatedEndTime", String.valueOf(updatedEndTime));</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="When promotion manager updates the start/end dates" id="867b9d68-a932-464e-8a92-fdcf7d4fb567">
        <con:settings/>
        <con:config service="updateAPosPromotion" resourcePath="/internal/v1/promotions/{id}" methodName="updateAPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="When promotion manager updates the start/end dates" id="6e045065-b147-4f2f-9b42-0de2af36835c" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
    "name": "${#TestCase#newPromotionName}",
    "orgId": ${#Project#orgid},
    "priority": 0,
    "active": true,
    "messageLabel": "test!!",
    "type": "POS",
    "condition": {
        "type": "CART",
        "cartCondition": {
            "kpi": "ITEMCOUNT",
            "operator": "LESS_THAN",
            "value": 3
        }
    },
    "action": {
        "type": "CART_BASED",
        "cartBasedAction": {
            "type": "ABSOLUTE",
            "value": 250.0
        }
    },
    "createdBy": 100,
    "createdOn": 0,
    "lastUpdatedBy": 100,
    "startDate": ${#TestCase#updatedStartTime},
    "endDate": ${#TestCase#updatedEndTime},
    "campaignId": ${#TestSuite#rnd}
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic/5fed87a8d72a841c67a1a46a</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="51ea1ba9-7e2b-466a-897d-54cd46194fbb" name="assert the promotion details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;




String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


promotionNameInResponse = json.data.name
promotionIdInResponse = json.data.id

promotionNameExpected = context.expand('${#TestCase#newPromotionName}')
promotionIdExpected = context.expand('${#TestCase#promotionId}')

startDateInResponse = json.data.startDate.toString()
endDateInResponse = json.data.endDate.toString()

expectedStartDate = context.expand('${#TestCase#updatedStartTime}')
expectedEndDate = context.expand('${#TestCase#updatedEndTime}')

assert(promotionNameInResponse == promotionNameExpected):"Promotion names are not expected. Expected = " + promotionNameExpected + " Actual = " + promotionNameInResponse
assert(promotionIdInResponse == promotionIdExpected):"Promotion Ids are not expected. Expected = " + promotionIdExpected + " Actual = " + promotionIdInResponse
assert(startDateInResponse == expectedStartDate):"Start date is not as expected."
assert(endDateInResponse == expectedEndDate) : "End date is not expected."</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Valid HTTP Status Codes" id="2cf9cc94-0c81-47ca-928d-ea0b4ecf31bd" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="id" value="${#TestCase#promotionId}" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Then the promotion start/end dates updated successfully" id="070a61ae-c1c4-49e2-9981-c8164762eef3">
        <con:settings/>
        <con:config service="getSinglePosPromotion" resourcePath="/internal/v1/promotions/{id}" methodName="getPosPromotionById" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Then the promotion start/end dates updated successfully" id="2b5c0f97-69fe-4ea5-ad39-d9c0e4a4d839" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value="123"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="4a9da00c-d3e5-4e4a-86c8-b0ca732b480a" name="assert the start/end date">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;



String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



promotionNameInResponse = json.data.name
promotionIdInResponse = json.data.id

promotionNameExpected = context.expand('${#TestCase#newPromotionName}')
promotionIdExpected = context.expand('${#TestCase#promotionId}')

startDateInResponse = json.data.startDate.toString()
endDateInResponse = json.data.endDate.toString()

expectedStartDate = context.expand('${#TestCase#updatedStartTime}')
expectedEndDate = context.expand('${#TestCase#updatedEndTime}')

assert(promotionNameInResponse == promotionNameExpected):"Promotion names are not expected. Expected = " + promotionNameExpected + " Actual = " + promotionNameInResponse
assert(promotionIdInResponse == promotionIdExpected):"Promotion Ids are not expected. Expected = " + promotionIdExpected + " Actual = " + promotionIdInResponse
assert(startDateInResponse == expectedStartDate):"Start date is not as expected."
assert(endDateInResponse == expectedEndDate) : "End date is not expected."</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Valid HTTP Status Codes" id="befc64c9-e3d0-4c48-9978-b2b91a8d0bd0" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="id" value="${#TestCase#promotionId}" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Disable the promotion" id="26d8e22e-15dc-49e0-abb1-1823fa704d7e">
        <con:settings/>
        <con:config service="DeactivatePromotion" resourcePath="/internal/v1/promotions/{promotionid}/deactivate" methodName="Deactivate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Disable the promotion" id="82128d68-6af6-4042-83e9-4d9233a29bfa" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions//deactivate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="d3df132c-09de-4b16-bed5-5796e9dd068e" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


log.info(json)
responseData = json.data
log.info(responseData)
assert(responseData):"Promotion disable failed"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
              <con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
              <con:entry key="promotionid" value="${#TestCase#promotionId}"/>
              <con:entry key="X-CAP-USER-ID" value="${#Project#tillid}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>promotionid</con:entry>
              <con:entry>X-CAP-USER-ID</con:entry>
              <con:entry>AUTH-COOKIE</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:setupScript/>
      <con:tearDownScript/>
      <con:properties>
        <con:property>
          <con:name>starttime</con:name>
          <con:value>1616065429416</con:value>
        </con:property>
        <con:property>
          <con:name>endtime</con:name>
          <con:value>1616151829418</con:value>
        </con:property>
        <con:property>
          <con:name>randomId</con:name>
          <con:value>9OHTKDQ1UR</con:value>
        </con:property>
        <con:property>
          <con:name>promotionId</con:name>
          <con:value>60533397b814490e3935c550</con:value>
        </con:property>
        <con:property>
          <con:name>promotionName</con:name>
          <con:value>test promotion_9OHTKDQ1UR</con:value>
        </con:property>
        <con:property>
          <con:name>newPromotionName</con:name>
          <con:value>test promotion_BSUDKBWF5M</con:value>
        </con:property>
        <con:property>
          <con:name>updatedStartTime</con:name>
          <con:value>1615979029416</con:value>
        </con:property>
        <con:property>
          <con:name>updatedEndTime</con:name>
          <con:value>1616248229418</con:value>
        </con:property>
        <con:property>
          <con:name>token</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>requestid</con:name>
          <con:value>cbb219fb-db61-4382-b002-ffcf6b51cd31</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="74567e05-576c-4b30-9166-36ba0e4f428e" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Create a POS promotion, Evaluate to check" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Given script creates a pre-requisites" id="eb9b3c30-b533-47e4-96b7-78b7c5300190">
        <con:settings/>
        <con:config>
          <script>def promotionName = new Random().with {(1..10).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()}
String starttime = System.currentTimeMillis().toString()
String endtime = (System.currentTimeMillis()+86400000).toString()

//storing ids to test case level.
testRunner.testCase.setPropertyValue("starttime", starttime);
testRunner.testCase.setPropertyValue("endtime", endtime);
testRunner.testCase.setPropertyValue('promotionName', "auto_promotion_"+promotionName)</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Then promotion manager creates a generic promotion" id="dc8db42a-7945-47f3-bc1e-7668758b8321">
        <con:settings/>
        <con:config service="createPosPromotion" resourcePath="/internal/v1/promotions" methodName="createPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Then promotion manager creates a generic promotion" id="0022cbf4-6c96-4073-a4d7-0ea694808616" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value="${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
              <con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
    "name": "test promotion_${#TestCase#promotionName}",
    "orgId": ${#Project#orgid},
    "priority": 0,
    "active": true,
    "messageLabel": "test!!",
    "type": "POS",
    "condition": {
        "type": "CART",
        "cartCondition": {
            "kpi": "SUBTOTAL",
            "operator": "EQUALS",
            "value": 25000.0
        }
    },
    "action": {
        "type": "CART_BASED",
        "cartBasedAction": {
            "type": "ABSOLUTE",
            "value": 250.0
        }
    },
    "createdBy": 100,
    "createdOn": 0,
    "lastUpdatedBy": 100,
    "startDate": ${#TestCase#starttime},
    "endDate": ${#TestCase#endtime},
    "campaignId": ${#TestSuite#rnd}
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic</con:originalUri>
            <con:assertion type="Response SLA Assertion" id="f6ec4498-8cca-4707-94fa-980cc2d05782" name="Response SLA" disabled="true">
              <con:configuration>
                <SLA>300</SLA>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="fc484aac-700e-4a86-b678-32221180ff2e" name="save promotion details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;


String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



// getting and saving promotion name and ID to test case level.
def promotionId = json.data.id
def promotionName = json.data.name
messageExchange.modelItem.testCase.setPropertyValue("promotionId",promotionId);
messageExchange.modelItem.testCase.setPropertyValue("promotionName",promotionName);

orgIdInResponse = json.data.orgId.toString()
orgIdExpected = context.expand('${#Project#orgid}')

assert(orgIdInResponse == orgIdExpected):"Org Id is not expected"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Valid HTTP Status Codes" id="40fa3494-84e9-49ec-b6d8-9120b653e218" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>201</codes>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="And evaluate a promotion against a transaction" id="8f8d1aae-44b0-4b26-865b-f87d649991e8">
        <con:settings/>
        <con:config service="Evaluate" resourcePath="/v1/promotions/evaluate" methodName="Evaluate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="And evaluate a promotion against a transaction" id="76ec8db7-d854-4d98-a590-3b20231743f0" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Authorization" value="${#Project#authorization}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ENTITY-ID" value="${#Project#tillid}"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#externalEndpoint}</con:endpoint>
            <con:request>{
  "amount": 25000,
  "customerId": "${#Project#customerid}",
  "cartItems": [
    {
      "referenceId": "${#TestCase#referenceId}",
      "sku": "${#TestCase#sku}",
      "amount": 25000,
      "qty": 1,
      "discount": null,
      "appliedPromotions": null
    }],
    "appliedPromotions": null
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/evaluate</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="0f2cf3c0-ee6a-44eb-9274-4981e0e1388c" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="29579e1b-af29-4b59-82a3-b3c70bb36c7f" name="Script Assertion" disabled="true">
              <con:configuration>
                <scriptText>//imports
import groovy.json.JsonSlurper
//grab the response
def ResponseMessage = messageExchange.response.responseContent
// replace "(starting&amp;ending), [](starting&amp;ending) and \ with space from response
def TrimResponse =ResponseMessage.replaceAll('^\"|\"$','').replaceAll('^\\[|\\]$','')replaceAll('\\\\','')
//define a JsonSlurper
def response = new JsonSlurper().parseText(TrimResponse)
//verify the slurper isn't empty
assert !(response.isEmpty())
def totalAppPromo= response.data.appliedPromotions.size()

log.info(totalAppPromo)
def createdPromotionId = messageExchange.modelItem.testStep.testCase.testSuite.getPropertyValue( "promotionid" )
boolean flag = false;

for(int i=0;i&lt;totalAppPromo;i++){
	def appliedPromotionId = response.data.appliedPromotions[i].id
	if( createdPromotionId == appliedPromotionId){
		flag = true;
		break;
		}
	}
assert flag == true</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="3f66b6bc-2d51-44eb-8adb-2271b6aba827" name="assert the transaction details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;



String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



// Get and verify the transaction details.

tnxAmountInResponse = json.data.amount
customerIdInResponse = json.data.customerId.toString()
tnxReferenceIdInResponse = json.data.cartItems[0].referenceId
skuInResponse = json.data.cartItems[0].sku

expectedTnxId = context.expand('${#TestCase#tnxId}')
expectedTnxNumber = context.expand('${#TestCase#tnxNumber}')
expectedSku = context.expand('${#TestCase#sku}')
expectedRefId = context.expand('${#TestCase#referenceId}')
expectedUserId = context.expand('${#Project#customerid}')

assert(tnxAmountInResponse == "25000.000000")
assert(customerIdInResponse == expectedUserId): "Customer Id is not as expected";
//assert(tnxReferenceIdInResponse == expectedRefId):"Reference Id is not as expected";
//assert(skuInResponse == expectedSku): "SKU is not as expected";</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="dfe46d0e-0ab3-4d5f-818e-0ac2bc3e55a2" name="assert the applied promotion details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

lstOfAppliedPromotions = json.data.appliedPromotions

promotionId = context.expand('${#TestCase#promotionId}')
promotionName = context.expand('${#TestCase#promotionName}')
expectedPromotion = [
            "id": "${promotionId}",
            "name": "${promotionName}",
            "messageLabel": "test!!",
            "discount": "250.000000",
            "discountAppliedOnQuantity": null,
            "promotionAppliedOnQuantity": null,
            "type": "POS"
         ]
isCreatedPromotionInAppliedPromotions = false;
for(promotion in lstOfAppliedPromotions){
	if(promotion.id.equalsIgnoreCase("${promotionId}")){
		assert(promotion.name.equalsIgnoreCase("${promotionName}")):"Created Promotion name mismatch"
		assert(promotion.messageLabel.equalsIgnoreCase("test!!")):"Created Promotion messageLabel mismatch"
		assert(promotion.discount.equalsIgnoreCase("250.000000")):"Created Promotion discount mismatch"
		assert(promotion.type.equalsIgnoreCase("POS")):"Created Promotion type mismatch"

		assert(promotion.redemptionIdentifier != null):"Created Promotion redemptionIdentifier mismatch"
		isCreatedPromotionInAppliedPromotions = true;
		break;
	}
}

log.info isCreatedPromotionInAppliedPromotions
assert(isCreatedPromotionInAppliedPromotions == true) : "Created promotion is not in list of applied promotions";</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>luciauto_till_10</con:username>
              <con:password>202cb962ac59075b964b07152d234b70</con:password>
              <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:preemptive>false</con:preemptive>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="disable the created Promotion" id="2ce63632-2152-4040-b52c-8140b26a5924">
        <con:settings/>
        <con:config service="DeactivatePromotion" resourcePath="/internal/v1/promotions/{promotionid}/deactivate" methodName="Deactivate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="disable the created Promotion" id="82128d68-6af6-4042-83e9-4d9233a29bfa" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions//deactivate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="18155b33-e3f2-4899-a1ad-112880b3aa45" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


log.info(json)
responseData = json.data
log.info(responseData)
assert(responseData):"Promotion disable failed"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
              <con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
              <con:entry key="promotionid" value="${#TestCase#promotionId}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>promotionid</con:entry>
              <con:entry>X-CAP-USER-ID</con:entry>
              <con:entry>AUTH-COOKIE</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:setupScript/>
      <con:properties>
        <con:property>
          <con:name>starttime</con:name>
          <con:value>1616065950077</con:value>
        </con:property>
        <con:property>
          <con:name>endtime</con:name>
          <con:value>1616152350077</con:value>
        </con:property>
        <con:property>
          <con:name>promotionName</con:name>
          <con:value>test promotion_auto_promotion_XIV0OE6MPF</con:value>
        </con:property>
        <con:property>
          <con:name>promotionId</con:name>
          <con:value>6053359fb814490e3935c564</con:value>
        </con:property>
        <con:property>
          <con:name>tnxId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>tnxNumber</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>sku</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>referenceId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>userId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="18c68673-3a12-45a2-9cdc-794ed3daf18f" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="EndUser apply on cart based on pos promo expiry date" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Given script sets the start/end times" id="8a1cf9ac-4cc3-4b0b-8aaa-718fa26a5d45">
        <con:settings/>
        <con:config>
          <script>String starttime = System.currentTimeMillis().toString()
String randomId = new Random().with {(1..10).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()}
// set expiry time as after 5 mins
String time1 = (System.currentTimeMillis()+300000).toString()
// set expiry time as after 10 mins
String time2 = (System.currentTimeMillis()+600000).toString()
// set expiry time as after 15 mins
String time3 = (System.currentTimeMillis()+900000).toString()
//storing ids to test case level.
testRunner.testCase.setPropertyValue("starttime", starttime);
testRunner.testCase.setPropertyValue("time1", time1);
testRunner.testCase.setPropertyValue("time2", time2);
testRunner.testCase.setPropertyValue("time3", time3);
testRunner.testCase.setPropertyValue("randomId", randomId)</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="And promotion is created with the expiry of 5 mins from now" id="f48d653e-4326-4dca-8526-9b2d1229d19b">
        <con:settings/>
        <con:config service="createPosPromotion" resourcePath="/internal/v1/promotions" methodName="createPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="And promotion is created with the expiry of 5 mins from now" id="0022cbf4-6c96-4073-a4d7-0ea694808616" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value="${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
              <con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
    "name": "test promotion_${=org.apache.commons.lang.RandomStringUtils.randomNumeric(8)}",
    "orgId": ${#Project#orgid},
    "priority": 1,
    "active": true,
    "messageLabel": "test!!",
    "type": "POS",
    "condition": {
        "type": "CART",
        "cartCondition": {
            "kpi": "SUBTOTAL",
            "operator": "GREATER_THAN_OR_EQUAL",
            "value": 250.0
        }
    },
    "action": {
        "type": "CART_BASED",
        "cartBasedAction": {
            "type": "ABSOLUTE",
            "value": 250.0
        }
    },
    "createdBy": 100,
    "createdOn": 0,
    "lastUpdatedBy": 100,
    "startDate": ${#TestCase#starttime},
    "endDate": ${#TestCase#time1},
    "campaignId": ${#TestSuite#rnd}
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="0a8c97be-4333-4cbb-a4ea-b1e439fab4ff" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>201</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="65663dc1-56c0-42f9-873a-77e2b45566b0" name="assert/save the promotion details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;



String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


// getting and saving promotion name and ID to test case level.
def promotionId = json.data.id
def promotionName = json.data.name
messageExchange.modelItem.testCase.setPropertyValue("promotionId5min",promotionId);
messageExchange.modelItem.testCase.setPropertyValue("promotionName5min",promotionName);

orgIdInResponse = json.data.orgId.toString()
orgIdExpected = context.expand('${#Project#orgid}')

assert(orgIdInResponse == orgIdExpected):"Org Id is not expected"

promotionDetail_5min = [
            "id": promotionId,
            "name": promotionName,
            "messageLabel": "test!!",
            "discount": "250.000000",
            "discountAppliedOnQuantity": null,
            "promotionAppliedOnQuantity": null,
            "type":"POS"
         ]

messageExchange.modelItem.testCase.setPropertyValue("promotionDetailsMap_5min",promotionDetail_5min.inspect())</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="And promotion is created with the expiry of 10 mins from now" id="150a842c-0bdc-496a-bdd3-03388c6530da">
        <con:settings/>
        <con:config service="createPosPromotion" resourcePath="/internal/v1/promotions" methodName="createPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="And promotion is created with the expiry of 10 mins from now" id="0022cbf4-6c96-4073-a4d7-0ea694808616" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value="${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
              <con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
    "name": "test promotion_${=org.apache.commons.lang.RandomStringUtils.randomNumeric(8)}",
    "orgId": ${#Project#orgid},
    "priority": 1,
    "active": true,
    "messageLabel": "test!!",
    "type": "POS",
    "condition": {
        "type": "CART",
        "cartCondition": {
            "kpi": "SUBTOTAL",
            "operator": "GREATER_THAN_OR_EQUAL",
            "value": 250.0
        }
    },
    "action": {
        "type": "CART_BASED",
        "cartBasedAction": {
            "type": "ABSOLUTE",
            "value": 250.0
        }
    },
    "createdBy": 100,
    "createdOn": 0,
    "lastUpdatedBy": 100,
    "startDate": ${#TestCase#starttime},
    "endDate": ${#TestCase#time2},
    "campaignId": ${#TestSuite#rnd}
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="b8c1c7cc-177d-445a-8b19-aea057ff34c2" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>201</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="0a6857eb-0cfa-4984-935e-463faf2aa98a" name="save/assert the promotion details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;



String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



// getting and saving promotion name and ID to test case level.
def promotionId = json.data.id
def promotionName = json.data.name
messageExchange.modelItem.testCase.setPropertyValue("promotionId10min",promotionId);
messageExchange.modelItem.testCase.setPropertyValue("promotionName10min",promotionName);

orgIdInResponse = json.data.orgId.toString()
orgIdExpected = context.expand('${#Project#orgid}')

assert(orgIdInResponse == orgIdExpected):"Org Id is not expected"

promotionDetails_10min = [
            "id": promotionId,
            "name": promotionName,
            "messageLabel": "test!!",
            "discount": "250.000000",
            "discountAppliedOnQuantity": null,
            "promotionAppliedOnQuantity": null,
            "type": "POS"
         ]
messageExchange.modelItem.testCase.setPropertyValue("promotionDetailsMap_10min",promotionDetails_10min.inspect())</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="And promotion is created with the expiry of 15 mins from now" id="ee174273-a40f-4dbd-9c75-16b58b402f42">
        <con:settings/>
        <con:config service="createPosPromotion" resourcePath="/internal/v1/promotions" methodName="createPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="And promotion is created with the expiry of 15 mins from now" id="0022cbf4-6c96-4073-a4d7-0ea694808616" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value="${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
              <con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
    "name": "test promotion_${=org.apache.commons.lang.RandomStringUtils.randomNumeric(8)}",
    "orgId": ${#Project#orgid},
    "priority": 1,
    "active": true,
    "messageLabel": "test!!",
    "type": "POS",
    "condition": {
        "type": "CART",
        "cartCondition": {
            "kpi": "SUBTOTAL",
            "operator": "GREATER_THAN_OR_EQUAL",
            "value": 250.0
        }
    },
    "action": {
        "type": "CART_BASED",
        "cartBasedAction": {
            "type": "ABSOLUTE",
            "value": 250.0
        }
    },
    "createdBy": 100,
    "createdOn": 0,
    "lastUpdatedBy": 100,
    "startDate": ${#TestCase#starttime},
    "endDate": ${#TestCase#time3},
    "campaignId": ${#TestSuite#rnd}
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="bd0383a2-9323-4430-90f8-5cba36d338d4" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>201</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="77b1eb22-c4e3-467c-8ea5-fd89b2e0d16a" name="save/assert the promotion details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;


String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


// getting and saving promotion name and ID to test case level.
def promotionId = json.data.id
def promotionName = json.data.name
messageExchange.modelItem.testCase.setPropertyValue("promotionId15min",promotionId);
messageExchange.modelItem.testCase.setPropertyValue("promotionName15min",promotionName);

orgIdInResponse = json.data.orgId.toString()
orgIdExpected = context.expand('${#Project#orgid}')

assert(orgIdInResponse == orgIdExpected):"Org Id is not expected"

promotionDetails_15min = [
            "id": promotionId,
            "name": promotionName,
            "messageLabel": "test!!",
            "discount": "250.000000",
            "discountAppliedOnQuantity": null,
            "promotionAppliedOnQuantity": null,
            "type":"POS"
         ]
messageExchange.modelItem.testCase.setPropertyValue("promotionDetailsMap_15min",promotionDetails_15min.inspect())</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="When promotion evaluation happened for a transaction more than 250 Then applied promotions are based on expiry" id="ff236aef-dfd8-4076-9c40-7ed619c2293e">
        <con:settings/>
        <con:config service="Evaluate" resourcePath="/v1/promotions/evaluate" methodName="Evaluate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="When promotion evaluation happened for a transaction more than 250 Then applied promotions are based on expiry" id="76ec8db7-d854-4d98-a590-3b20231743f0" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="${#Project#authorization}" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#externalEndpoint}</con:endpoint>
            <con:request>{

  "amount": 500,
  "customerId": "${#Project#customerid}",
  "cartItems": [
    {
      "referenceId": "${#TestCase#referenceId}",
      "sku": "${#TestCase#sku}",
      "amount": 500,
      "qty": 1,
      "discount": null,
      "appliedPromotions": null
    }
  ],
  "appliedPromotions": null
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/evaluate</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="0f2cf3c0-ee6a-44eb-9274-4981e0e1388c" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="4a4861e2-2f42-4a56-865c-a2795cc2d505" name="assert the applied promotions based on expiry">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;



String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



lstOfAppliedPromotions = json.data.appliedPromotions
//log.info(lstOfAppliedPromotions)
numOfPromotions = lstOfAppliedPromotions.size()


//get and assert th elast promotion applied.
lastAppliedPromotion = lstOfAppliedPromotions[numOfPromotions-1].id
secondLastAppliedPromotion = lstOfAppliedPromotions[numOfPromotions-2].id
thirdLastAppliedPromotion = lstOfAppliedPromotions[numOfPromotions-3].id

expectedLastAppliedPromotion = Eval.me(context.expand('${#TestCase#promotionDetailsMap_15min}'))
expectedSecondLastPromotion = Eval.me(context.expand('${#TestCase#promotionDetailsMap_10min}'))
expectedThirdLastPromotion = Eval.me(context.expand('${#TestCase#promotionDetailsMap_5min}'))


assert(expectedLastAppliedPromotion.id.equalsIgnoreCase(lastAppliedPromotion))
assert(expectedSecondLastPromotion.id.equalsIgnoreCase(secondLastAppliedPromotion))
assert(expectedThirdLastPromotion.id.equalsIgnoreCase(thirdLastAppliedPromotion))</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Deactivate Promotion 1" id="a386d9a5-ddf0-4d1a-9ad3-3e5bb1ddb4b1">
        <con:settings/>
        <con:config service="DeactivatePromotion" resourcePath="/internal/v1/promotions/{promotionid}/deactivate" methodName="Deactivate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Deactivate Promotion 1" id="82128d68-6af6-4042-83e9-4d9233a29bfa" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions//deactivate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="243d0116-2e2b-4e0a-a291-0076af5017b9" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


log.info(json)
responseData = json.data
log.info(responseData)
assert(responseData):"Promotion disable failed"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
              <con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
              <con:entry key="promotionid" value="${#TestCase#promotionId5min}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>promotionid</con:entry>
              <con:entry>X-CAP-USER-ID</con:entry>
              <con:entry>AUTH-COOKIE</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Deactivate Promotion 2" id="dd30a0cd-ba8f-4535-a98e-552a81718997">
        <con:settings/>
        <con:config service="DeactivatePromotion" resourcePath="/internal/v1/promotions/{promotionid}/deactivate" methodName="Deactivate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Deactivate Promotion 2" id="82128d68-6af6-4042-83e9-4d9233a29bfa" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions//deactivate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="27998339-bf52-4fb1-a232-6fed372591ce" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


log.info(json)
responseData = json.data
log.info(responseData)
assert(responseData):"Promotion disable failed"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
              <con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
              <con:entry key="promotionid" value="${#TestCase#promotionId10min}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>promotionid</con:entry>
              <con:entry>X-CAP-USER-ID</con:entry>
              <con:entry>AUTH-COOKIE</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Deactivate Promotion 3" id="ef7395e9-eed3-45ae-bc1d-125f46aad415">
        <con:settings/>
        <con:config service="DeactivatePromotion" resourcePath="/internal/v1/promotions/{promotionid}/deactivate" methodName="Deactivate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Deactivate Promotion 3" id="82128d68-6af6-4042-83e9-4d9233a29bfa" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions//deactivate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="25f6df3f-008a-4990-8016-14876d0e1fe2" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


log.info(json)
responseData = json.data
log.info(responseData)
assert(responseData):"Promotion disable failed"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
              <con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
              <con:entry key="promotionid" value="${#TestCase#promotionId15min}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>promotionid</con:entry>
              <con:entry>X-CAP-USER-ID</con:entry>
              <con:entry>AUTH-COOKIE</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:setupScript/>
      <con:properties>
        <con:property>
          <con:name>starttime</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>time1</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>time2</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>time3</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionId5min</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionName5min</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>randomId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionId10min</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionName10min</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionId15min</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionName15min</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>tnxId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>tnxNumber</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>sku</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>referenceId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>userId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionDetailsMap_5min</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionDetailsMap_10min</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionDetailsMap_15min</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="e16d56bf-4a30-4b70-a797-d84cd972cfa2" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Search promotions by till id and Campaign id filters" searchProperties="true">
      <con:description>TestCase generated for REST Resource [Filters] located at [/internal/v1/promotions/filters]</con:description>
      <con:settings/>
      <con:testStep type="groovy" name="Given script creates a pre-requisites" id="4019ebb3-d06d-47bf-ac09-d0940dbdd719">
        <con:settings/>
        <con:config>
          <script>//String requestId = UUID.randomUUID().toString()
String randomId = new Random().with {(1..10).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()}
String starttime = System.currentTimeMillis().toString()
String endtime = (System.currentTimeMillis()+86400000).toString()

//storing ids to test case level.
testRunner.testCase.setPropertyValue("starttime", starttime);
testRunner.testCase.setPropertyValue("endtime", endtime);
testRunner.testCase.setPropertyValue("randomId", randomId);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Promo manager will create a promotion with perticular till id and Campaign id" id="5e93e91b-942d-4efe-843e-37f8ed0d60d8">
        <con:settings/>
        <con:config service="createPosPromotion" resourcePath="/internal/v1/promotions" methodName="createPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Promo manager will create a promotion with perticular till id and Campaign id" id="0022cbf4-6c96-4073-a4d7-0ea694808616" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
              <con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
    "name": "test promotion_${#TestCase#randomId}",
    "orgId": ${#Project#orgid},
    "priority": 0,
    "active": true,
    "messageLabel": "test!!",
    "type": "POS",
    "condition": {
        "type": "CART",
        "cartCondition": {
            "kpi": "SUBTOTAL",
            "operator": "EQUALS",
            "value": 250.0
        }
    },
    "action": {
        "type": "CART_BASED",
        "cartBasedAction": {
            "type": "ABSOLUTE",
            "value": 250.0
        }
    },
    "createdBy": 100,
    "createdOn": 0,
    "lastUpdatedBy": 100,
    "startDate": ${#TestCase#starttime},
    "endDate": ${#TestCase#endtime},
    "campaignId": 999888
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="89a27dc1-b6d8-4ca9-92f2-311247b94da8" name="Storing Promotion details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;


String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);




// getting and saving promotion name and ID to test case level.
def promotionId = json.data.id
def campaignId = json.campaignId
messageExchange.modelItem.testCase.setPropertyValue("promotionId",promotionId);
messageExchange.modelItem.testCase.setPropertyValue("campaignId",campaignId);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Promo manager will get the list of promos by searching with Till id" id="0fe4efc7-7dfa-4380-8957-d0b4b62ad97f">
        <con:settings/>
        <con:config service="Filter:searchPromobyTillid" resourcePath="/internal/v1/promotions/filters" methodName="FilterPromobyTillid" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Promo manager will get the list of promos by searching with Till id" id="c40b6559-8bfd-48bf-aa4a-4d6fb92f4340" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions/filters</con:originalUri>
            <con:assertion type="Response SLA Assertion" id="20c66451-0e07-4c2c-8296-742515deaf78" name="Response SLA">
              <con:configuration>
                <SLA>${#Project#responseSLA}</SLA>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="2ed8f0cc-d89c-4d84-9bae-e5dc915b8e29" name="Asserting promoion details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);




def promotionIdInResponse = json.data[0].promotionId;


promotionIdExpected = context.expand('${#TestCase#promotionId}')

assert(promotionIdInResponse == promotionIdExpected):"Promotion Ids are not expected. Expected = " + promotionIdExpected + " Actual = " + promotionIdInResponse</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Promo manager will get the list of promos by searching with Campaign id" id="9eac5c39-5fd9-40a6-9c51-0c93b8d8fdaf">
        <con:settings/>
        <con:config service="Filter:searchPromobyCampaignid" resourcePath="/internal/v1/promotions/filters" methodName="Filters 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Promo manager will get the list of promos by searching with Campaign id" id="e917a5ac-83a4-4027-9f85-81763af20ac2" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions/filters</con:originalUri>
            <con:assertion type="Response SLA Assertion" id="9981cb1e-bebf-4a12-889d-07f57b4d9cf4" name="Response SLA">
              <con:configuration>
                <SLA>2500</SLA>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="6de04bf3-8dd6-4866-8161-21e2705f27df" name="Asserting promoion id and Campaignid">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


def promotionIdInResponse = json.data[0].promotionId;

promotionIdExpected = context.expand('${#TestCase#promotionId}')

assert(promotionIdInResponse == promotionIdExpected):"Promotion Ids are not expected. Expected = " + promotionIdExpected + " Actual = " + promotionIdInResponse</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="campaignId" value="999888" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>campaignId</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Deactivate Promotion" id="0da361f4-ef84-4865-96bc-633f0764209b">
        <con:settings/>
        <con:config service="DeactivatePromotion" resourcePath="/internal/v1/promotions/{promotionid}/deactivate" methodName="Deactivate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Deactivate Promotion" id="82128d68-6af6-4042-83e9-4d9233a29bfa" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions//deactivate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="7f362b32-1845-403c-8d78-5ae5df08673b" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


log.info(json)
responseData = json.data
log.info(responseData)
assert(responseData):"Promotion disable failed"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
              <con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
              <con:entry key="promotionid" value="${#TestCase#promotionId}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>promotionid</con:entry>
              <con:entry>X-CAP-USER-ID</con:entry>
              <con:entry>AUTH-COOKIE</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>starttime</con:name>
          <con:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">1616065437793</con:value>
        </con:property>
        <con:property>
          <con:name>endtime</con:name>
          <con:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">1616151837793</con:value>
        </con:property>
        <con:property>
          <con:name>randomId</con:name>
          <con:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">Z8CKAVTEV0</con:value>
        </con:property>
        <con:property>
          <con:name>promotionId</con:name>
          <con:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">6053339eb814490e3935c555</con:value>
        </con:property>
        <con:property>
          <con:name>campaignId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="c09fab1e-5150-4951-b26d-f8ab149c77a9" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Set and get promo &quot;PRIORITY&quot; strategy &amp; evaluate based on strategy" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Given script creates a pre-requisites" id="5248dc91-fe9d-4a63-89a2-f61187cf2468">
        <con:settings/>
        <con:config>
          <script>def promotionName = new Random().with {(1..10).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()}
String starttime = System.currentTimeMillis().toString()
String endtime = (System.currentTimeMillis()+86400000).toString()

//storing ids to test case level.
testRunner.testCase.setPropertyValue("starttime", starttime);
testRunner.testCase.setPropertyValue("endtime", endtime);
testRunner.testCase.setPropertyValue('promotionName', promotionName)</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="The Promo manager will set a promo strtegy as 'PRIORITY'" id="a153f366-a3ae-4ccf-94b3-5545fd3cda02">
        <con:settings/>
        <con:config service="Set promotion Strategy" resourcePath="/internal/v1/promotions/settings/strategy" methodName="Strategy 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="The Promo manager will set a promo strtegy as 'PRIORITY'" id="e1c2a11c-96c8-4e07-a117-a13176739156" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
  "isActive": true,
  "promotionRankingStrategy": "PRIORITY",
  "rewardStrategy": "NO_STRATEGY"
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/strategy</con:originalUri>
            <con:assertion type="Response SLA Assertion" id="bfb345d4-07f7-4694-9db3-76aa88ffea20" name="Response SLA">
              <con:configuration>
                <SLA>3000</SLA>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="0ab7b2aa-a9bd-4b09-93a6-e1ded2f414ec" name="saving strategy details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;


String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);




// getting and saving promotion name and ID to test case level.
def promotionRankingStrategy = json.data.promotionRankingStrategy
def rewardStrategy = json.data.rewardStrategy
messageExchange.modelItem.testCase.setPropertyValue("promotionRankingStrategy",promotionRankingStrategy);
messageExchange.modelItem.testCase.setPropertyValue("rewardStrategy",rewardStrategy);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="The promo manger will get the details of configured strategy" id="4f628998-3ad3-4e63-bbb1-2ff1e3b22b3a">
        <con:settings/>
        <con:config service="Get promotion Strategy" resourcePath="/internal/v1/promotions/settings/strategy" methodName="Strategy 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="The promo manger will get the details of configured strategy" id="ed7f7671-207c-4342-8ec9-52f06338ec51" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/strategy</con:originalUri>
            <con:assertion type="Response SLA Assertion" id="87d6335a-f23d-4d85-ac69-2f09f6eeff09" name="Response SLA">
              <con:configuration>
                <SLA>2000</SLA>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="e266b5b7-c30d-4052-a860-5eb27dbbc2b7" name="Asserting strategy details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



def promotionRankingStrategyInResponse = json.data.promotionRankingStrategy;
def rewardStrategyInResponse = json.data.rewardStrategy;

promotionRankingStrategyExpected = context.expand('${#TestCase#promotionRankingStrategy}')
rewardStrategyExpected = context.expand('${#TestCase#rewardStrategy}')

assert(promotionRankingStrategyInResponse == promotionRankingStrategyExpected):"promotionRankingStrategy are not expected. Expected = " + promotionRankingStrategyExpected + " Actual = " + promotionRankingStrategyInResponse
assert(rewardStrategyInResponse == rewardStrategyExpected):"rewardStrategy are not expected. Expected = " + rewardStrategyExpected + " Actual = " + rewardStrategyInResponse</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Then promotion manager creates a generic promotion" id="c9899d16-80ca-4a83-9ba4-d018d3accec7">
        <con:settings/>
        <con:config service="createPosPromotion" resourcePath="/internal/v1/promotions" methodName="createPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Then promotion manager creates a generic promotion" id="0022cbf4-6c96-4073-a4d7-0ea694808616" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value="${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
              <con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
    "name": "test promotion_${#TestCase#promotionName}",
    "orgId": ${#Project#orgid},
    "priority": 0,
    "active": true,
    "messageLabel": "test!!",
    "type": "POS",
    "condition": {
        "type": "CART",
        "cartCondition": {
            "kpi": "SUBTOTAL",
            "operator": "EQUALS",
            "value": 25000.0
        }
    },
    "action": {
        "type": "CART_BASED",
        "cartBasedAction": {
            "type": "ABSOLUTE",
            "value": 25000.0
        }
    },
    "createdBy": 100,
    "createdOn": 0,
    "lastUpdatedBy": 100,
    "startDate": ${#TestCase#starttime},
    "endDate": ${#TestCase#endtime},
    "campaignId": ${#TestSuite#rnd}
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic</con:originalUri>
            <con:assertion type="Response SLA Assertion" id="f6ec4498-8cca-4707-94fa-980cc2d05782" name="Response SLA" disabled="true">
              <con:configuration>
                <SLA>300</SLA>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="fc484aac-700e-4a86-b678-32221180ff2e" name="save promotion details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;


String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



// getting and saving promotion name and ID to test case level.
def promotionId = json.data.id
def promotionName = json.data.name
messageExchange.modelItem.testCase.setPropertyValue("promotionId1",promotionId);
messageExchange.modelItem.testCase.setPropertyValue("promotionName1",promotionName);

orgIdInResponse = json.data.orgId.toString()
orgIdExpected = context.expand('${#Project#orgid}')

assert(orgIdInResponse == orgIdExpected):"Org Id is not expected"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Valid HTTP Status Codes" id="40fa3494-84e9-49ec-b6d8-9120b653e218" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>201</codes>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Then promotion manager creates a generic promotion with Priority 2" id="f268f0e8-9a23-486e-997d-e3061f1f659b">
        <con:settings/>
        <con:config service="createPosPromotion" resourcePath="/internal/v1/promotions" methodName="createPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Then promotion manager creates a generic promotion with Priority 2" id="0022cbf4-6c96-4073-a4d7-0ea694808616" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value="${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
              <con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
    "name": "test promotion_${#TestCase#promotionName}",
    "orgId": ${#Project#orgid},
    "priority": 1,
    "active": true,
    "messageLabel": "test!!",
    "type": "POS",
    "condition": {
        "type": "CART",
        "cartCondition": {
            "kpi": "SUBTOTAL",
            "operator": "EQUALS",
            "value": 25000.0
        }
    },
    "action": {
        "type": "CART_BASED",
        "cartBasedAction": {
            "type": "ABSOLUTE",
            "value": 25000.0
        }
    },
    "createdBy": 100,
    "createdOn": 0,
    "lastUpdatedBy": 100,
    "startDate": ${#TestCase#starttime},
    "endDate": ${#TestCase#endtime},
    "campaignId": ${#TestSuite#rnd}
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic</con:originalUri>
            <con:assertion type="Response SLA Assertion" id="f6ec4498-8cca-4707-94fa-980cc2d05782" name="Response SLA" disabled="true">
              <con:configuration>
                <SLA>300</SLA>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="fc484aac-700e-4a86-b678-32221180ff2e" name="save promotion details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;


String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



// getting and saving promotion name and ID to test case level.
def promotionId = json.data.id
def promotionName = json.data.name
messageExchange.modelItem.testCase.setPropertyValue("promotionId",promotionId);
messageExchange.modelItem.testCase.setPropertyValue("promotionName",promotionName);

orgIdInResponse = json.data.orgId.toString()
orgIdExpected = context.expand('${#Project#orgid}')

assert(orgIdInResponse == orgIdExpected):"Org Id is not expected"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Valid HTTP Status Codes" id="40fa3494-84e9-49ec-b6d8-9120b653e218" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>201</codes>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="End user tries to apply promo on cart" id="34532ed0-0fba-47f1-b1e1-4e3697ec5952">
        <con:settings/>
        <con:config service="Evaluate" resourcePath="/v1/promotions/evaluate" methodName="Evaluate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="End user tries to apply promo on cart" id="76ec8db7-d854-4d98-a590-3b20231743f0" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="${#Project#authorization}" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#externalEndpoint}</con:endpoint>
            <con:request>{
  "amount": 25000,
  "customerId": "${#Project#customerid}",
  "cartItems": [
    {
      "referenceId": "${#TestCase#referenceId}",
      "sku": "${#TestCase#sku}",
      "amount": 25000,
      "qty": 1,
      "discount": null,
      "appliedPromotions": null
    }
  ],
      "appliedPromotions": null
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/evaluate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="da0d5ca6-508a-44e8-96fd-7cc2db746f60" name="Asserting applied promo details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

lstOfAppliedPromotions = json.data.appliedPromotions

promotionId = context.expand('${#TestCase#promotionId}')
promotionId1 = context.expand('${#TestCase#promotionId1}')
promotionName = context.expand('${#TestCase#promotionName}')
promotionName1 = context.expand('${#TestCase#promotionName1}')
expectedPromotion = [
            "id": "${promotionId}",
            "name": "${promotionName}",
            "messageLabel": "test!!",
            "discount": "25000.000000",
            "discountAppliedOnQuantity": null,
            "promotionAppliedOnQuantity": null,
            "type": "POS"
         ]
isCreatedPromotionInAppliedPromotions = false;
isCreatedPromotionInAppliedPromotions2 = false;
for(int i=0;i&lt;lstOfAppliedPromotions.size;i++){
	if(lstOfAppliedPromotions[i].id.equalsIgnoreCase("${promotionId}")){
		assert(lstOfAppliedPromotions[i].name.equalsIgnoreCase("${promotionName}"))
		assert(lstOfAppliedPromotions[i].messageLabel.equalsIgnoreCase("test!!"))
		assert(lstOfAppliedPromotions[i].discount.equalsIgnoreCase("25000.000000"))
		assert(lstOfAppliedPromotions[i].type.equalsIgnoreCase("POS"))
		isCreatedPromotionInAppliedPromotions = true;
		promotionIndex = i;
		break;
	}
}

for(int i=0;i&lt;lstOfAppliedPromotions.size;i++){
	if(lstOfAppliedPromotions[i].id.equalsIgnoreCase("${promotionId1}")){
		assert(lstOfAppliedPromotions[i].name.equalsIgnoreCase("${promotionName1}"))
		assert(lstOfAppliedPromotions[i].messageLabel.equalsIgnoreCase("test!!"))
		assert(lstOfAppliedPromotions[i].discount.equalsIgnoreCase("25000.000000"))
		assert(lstOfAppliedPromotions[i].type.equalsIgnoreCase("POS"))
		isCreatedPromotionInAppliedPromotions2 = true;
		promotionIndex2 = i;
		break;
	}
}
assert(isCreatedPromotionInAppliedPromotions)
assert(isCreatedPromotionInAppliedPromotions2)
assert(promotionIndex2&lt;promotionIndex)
log.info (isCreatedPromotionInAppliedPromotions)
assert(isCreatedPromotionInAppliedPromotions == true) : "Created promotion is not in list of applied promotions";</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="De-activate Promotion" id="78a5ecb5-f791-4bfc-8e0e-63045cd5b4af">
        <con:settings/>
        <con:config service="DeactivatePromotion" resourcePath="/internal/v1/promotions/{promotionid}/deactivate" methodName="Deactivate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="De-activate Promotion" id="82128d68-6af6-4042-83e9-4d9233a29bfa" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions//deactivate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="707c30d9-f6cb-4801-9af7-af089fe5efcf" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


log.info(json)
responseData = json.data
log.info(responseData)
assert(responseData):"Promotion disable failed"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
              <con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
              <con:entry key="promotionid" value="${#TestCase#promotionId}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>promotionid</con:entry>
              <con:entry>X-CAP-USER-ID</con:entry>
              <con:entry>AUTH-COOKIE</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="De-activate Promotion2" id="3d8c4e42-fed6-49ce-bbeb-49a96ebf444d">
        <con:settings/>
        <con:config service="DeactivatePromotion" resourcePath="/internal/v1/promotions/{promotionid}/deactivate" methodName="Deactivate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="De-activate Promotion2" id="82128d68-6af6-4042-83e9-4d9233a29bfa" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions//deactivate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="707c30d9-f6cb-4801-9af7-af089fe5efcf" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


log.info(json)
responseData = json.data
log.info(responseData)
assert(responseData):"Promotion disable failed"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
              <con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
              <con:entry key="promotionid" value="${#TestCase#promotionId1}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>promotionid</con:entry>
              <con:entry>X-CAP-USER-ID</con:entry>
              <con:entry>AUTH-COOKIE</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>starttime</con:name>
          <con:value>1616065439168</con:value>
        </con:property>
        <con:property>
          <con:name>endtime</con:name>
          <con:value>1616151839168</con:value>
        </con:property>
        <con:property>
          <con:name>promotionName</con:name>
          <con:value>test promotion_I84DC5CR32</con:value>
        </con:property>
        <con:property>
          <con:name>tnxId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>tnxNumber</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>sku</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>referenceId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>userId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionId</con:name>
          <con:value>605333a1b814490e3935c557</con:value>
        </con:property>
        <con:property>
          <con:name>promoationName</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionRankingStrategy</con:name>
          <con:value>PRIORITY</con:value>
        </con:property>
        <con:property>
          <con:name>rewardStrategy</con:name>
          <con:value>NO_STRATEGY</con:value>
        </con:property>
        <con:property>
          <con:name>promotionId1</con:name>
          <con:value>605333a1b814490e3935c556</con:value>
        </con:property>
        <con:property>
          <con:name>promotionName1</con:name>
          <con:value>test promotion_I84DC5CR32</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="bdafbd77-549f-402c-917a-afd644412acb" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Set and get promo &quot;EXPIRY_BASED&quot; strategy &amp; evaluate based on strategy" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Given script creates a pre-requisites" id="6f604853-d225-465e-9171-61667310dcc9">
        <con:settings/>
        <con:config>
          <script>def promotionName = new Random().with {(1..10).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()}



String starttime = System.currentTimeMillis().toString()
String endtime = (System.currentTimeMillis()+86400000).toString()

//storing ids to test case level.
testRunner.testCase.setPropertyValue("starttime", starttime);
testRunner.testCase.setPropertyValue("endtime", endtime);
testRunner.testCase.setPropertyValue('promotionName', promotionName)</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="The Promo manager will set a promo strtegy as 'EXPIRY_BASED" id="d31b9f28-62d2-4623-9c93-0629f07be5ad">
        <con:settings/>
        <con:config service="Set promotion Strategy" resourcePath="/internal/v1/promotions/settings/strategy" methodName="Strategy 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="The Promo manager will set a promo strtegy as 'EXPIRY_BASED" id="e1c2a11c-96c8-4e07-a117-a13176739156" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
  "isActive": true,
  "promotionRankingStrategy": "EXPIRY_BASED",
  "rewardStrategy": "NO_STRATEGY"
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/strategy</con:originalUri>
            <con:assertion type="Response SLA Assertion" id="a9abe31c-871e-44fc-862a-df1ccce2943a" name="Response SLA" disabled="true">
              <con:configuration>
                <SLA>${#Project#responseSLA}</SLA>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="7f6e0407-c1ab-4155-ab8b-5a20481c004f" name="Saving strategy details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;


String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);




// getting and saving promotion name and ID to test case level.
def promotionRankingStrategy = json.data.promotionRankingStrategy
def rewardStrategy = json.data.rewardStrategy
messageExchange.modelItem.testCase.setPropertyValue("promotionRankingStrategy",promotionRankingStrategy);
messageExchange.modelItem.testCase.setPropertyValue("rewardStrategy",rewardStrategy);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="The promo manger will get the details of configured strategy" id="90135d52-be12-43a3-a04c-254ca112226a">
        <con:settings/>
        <con:config service="Get promotion Strategy" resourcePath="/internal/v1/promotions/settings/strategy" methodName="Strategy 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="The promo manger will get the details of configured strategy" id="ed7f7671-207c-4342-8ec9-52f06338ec51" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/strategy</con:originalUri>
            <con:assertion type="Response SLA Assertion" id="2e408a98-6719-45f8-8ec3-75fa8364b938" name="Response SLA">
              <con:configuration>
                <SLA>${#Project#responseSLA}</SLA>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="b8b5fdee-22f1-4d8c-9010-a3e959b13d9c" name="Asserting strategy details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



def promotionRankingStrategyInResponse = json.data.promotionRankingStrategy;
def rewardStrategyInResponse = json.data.rewardStrategy;

promotionRankingStrategyExpected = context.expand('${#TestCase#promotionRankingStrategy}')
rewardStrategyExpected = context.expand('${#TestCase#rewardStrategy}')

assert(promotionRankingStrategyInResponse == promotionRankingStrategyExpected):"promotionRankingStrategy are not expected. Expected = " + promotionRankingStrategyExpected + " Actual = " + promotionRankingStrategyInResponse
assert(rewardStrategyInResponse == rewardStrategyExpected):"rewardStrategy are not expected. Expected = " + rewardStrategyExpected + " Actual = " + rewardStrategyInResponse</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Then promotion manager creates a generic promotion" id="010bac59-3445-43c9-b1fe-b6061e033d2e">
        <con:settings/>
        <con:config service="createPosPromotion" resourcePath="/internal/v1/promotions" methodName="createPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Then promotion manager creates a generic promotion" id="0022cbf4-6c96-4073-a4d7-0ea694808616" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value="${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
              <con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
    "name": "test promotion_${#TestCase#promotionName}",
    "orgId": ${#Project#orgid},
    "priority": 0,
    "active": true,
    "messageLabel": "test!!",
    "type": "POS",
    "condition": {
        "type": "CART",
        "cartCondition": {
            "kpi": "SUBTOTAL",
            "operator": "EQUALS",
            "value": 25000.0
        }
    },
    "action": {
        "type": "CART_BASED",
        "cartBasedAction": {
            "type": "ABSOLUTE",
            "value": 25000.0
        }
    },
    "createdBy": 100,
    "createdOn": 0,
    "lastUpdatedBy": 100,
    "startDate": ${#TestCase#starttime},
    "endDate": ${#TestCase#endtime},
    "campaignId": ${#TestSuite#rnd}
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic</con:originalUri>
            <con:assertion type="Response SLA Assertion" id="f6ec4498-8cca-4707-94fa-980cc2d05782" name="Response SLA" disabled="true">
              <con:configuration>
                <SLA>300</SLA>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="fc484aac-700e-4a86-b678-32221180ff2e" name="save promotion details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;


String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



// getting and saving promotion name and ID to test case level.
def promotionId = json.data.id
def promotionName = json.data.name
messageExchange.modelItem.testCase.setPropertyValue("promotionId",promotionId);
messageExchange.modelItem.testCase.setPropertyValue("promotionName",promotionName);

orgIdInResponse = json.data.orgId.toString()
orgIdExpected = context.expand('${#Project#orgid}')

assert(orgIdInResponse == orgIdExpected):"Org Id is not expected"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Valid HTTP Status Codes" id="40fa3494-84e9-49ec-b6d8-9120b653e218" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>201</codes>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="End user tries to apply promo on cart" id="1d33cc7e-5229-4faf-a1da-8a13c3a0efbd">
        <con:settings/>
        <con:config service="Evaluate" resourcePath="/v1/promotions/evaluate" methodName="Evaluate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="End user tries to apply promo on cart" id="76ec8db7-d854-4d98-a590-3b20231743f0" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="${#Project#authorization}" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#externalEndpoint}</con:endpoint>
            <con:request>{
  "amount": 25000,
  "customerId": "${#Project#customerid}",
  "cartItems": [
    {
      "referenceId": "${#TestCase#referenceId}",
      "sku": "${#TestCase#sku}",
      "amount": 25000,
      "qty": 1,
      "discount": null,
      "appliedPromotions": null
    }
  ],
      "appliedPromotions": null
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/evaluate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="fcf97ba7-e345-4588-a234-b50807333848" name="Asserting applied promo details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

lstOfAppliedPromotions = json.data.appliedPromotions

promotionId = context.expand('${#TestCase#promotionId}')
promotionName = context.expand('${#TestCase#promotionName}')
expectedPromotion = [
            "id": "${promotionId}",
            "name": "${promotionName}",
            "messageLabel": "test!!",
            "discount": "25000.000000",
            "discountAppliedOnQuantity": null,
            "promotionAppliedOnQuantity": null,
            "type": "POS"
         ]
isCreatedPromotionInAppliedPromotions = false;
for(promotion in lstOfAppliedPromotions){
	if(promotion.id.equalsIgnoreCase("${promotionId}")){
		assert(promotion.name.equalsIgnoreCase("${promotionName}"))
		assert(promotion.messageLabel.equalsIgnoreCase("test!!"))
		assert(promotion.discount.equalsIgnoreCase("25000.000000"))
		assert(promotion.type.equalsIgnoreCase("POS"))
		isCreatedPromotionInAppliedPromotions = true;
		break;
	}
}

log.info isCreatedPromotionInAppliedPromotions
assert(isCreatedPromotionInAppliedPromotions == true) : "Created promotion is not in list of applied promotions";</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="De-activate Promotion" id="0f9f88b2-3b95-4ea2-93ee-00da4cd50eae">
        <con:settings/>
        <con:config service="DeactivatePromotion" resourcePath="/internal/v1/promotions/{promotionid}/deactivate" methodName="Deactivate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="De-activate Promotion" id="82128d68-6af6-4042-83e9-4d9233a29bfa" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions//deactivate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="dbb74661-d10e-466c-9b75-29009d31201c" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


log.info(json)
responseData = json.data
log.info(responseData)
assert(responseData):"Promotion disable failed"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
              <con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
              <con:entry key="promotionid" value="${#TestCase#promotionId}"/>
              <con:entry key="X-CAP-USER-ID" value="${#Project#tillid}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>promotionid</con:entry>
              <con:entry>X-CAP-USER-ID</con:entry>
              <con:entry>AUTH-COOKIE</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>starttime</con:name>
          <con:value>1616065441624</con:value>
        </con:property>
        <con:property>
          <con:name>endtime</con:name>
          <con:value>1616151841624</con:value>
        </con:property>
        <con:property>
          <con:name>promotionName</con:name>
          <con:value>test promotion_TB41KF3PMK</con:value>
        </con:property>
        <con:property>
          <con:name>tnxId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>tnxNumber</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>sku</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>referenceId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>userId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionRankingStrategy</con:name>
          <con:value>EXPIRY_BASED</con:value>
        </con:property>
        <con:property>
          <con:name>rewardStrategy</con:name>
          <con:value>NO_STRATEGY</con:value>
        </con:property>
        <con:property>
          <con:name>promotionId</con:name>
          <con:value>605333a3b814490e3935c558</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="deee78f5-7462-4867-920f-f84b3c37ebf3" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Set and get promo &quot;MAX_DISCOUNT&quot; strategy &amp; evaluate based on strategy" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Given script creates a pre-requisites" id="75fbc234-54c5-40a3-bdbc-2e74b1433e50">
        <con:settings/>
        <con:config>
          <script>def promotionName = new Random().with {(1..10).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()}
String starttime = System.currentTimeMillis().toString()
String endtime = (System.currentTimeMillis()+86400000).toString()

//storing ids to test case level.
testRunner.testCase.setPropertyValue("starttime", starttime);
testRunner.testCase.setPropertyValue("endtime", endtime);
testRunner.testCase.setPropertyValue('promotionName', promotionName)</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="The Promo manager will set a promo strtegy as 'MAX_discount'" id="45489279-21b5-42b4-8ab5-bb18084c145f">
        <con:settings/>
        <con:config service="Set promotion Strategy" resourcePath="/internal/v1/promotions/settings/strategy" methodName="Strategy 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="The Promo manager will set a promo strtegy as 'MAX_discount'" id="e1c2a11c-96c8-4e07-a117-a13176739156" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
  "isActive": true,
  "promotionRankingStrategy": "MAX_DISCOUNT",
  "rewardStrategy": "NO_STRATEGY"
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/strategy</con:originalUri>
            <con:assertion type="Response SLA Assertion" id="0eb434a8-9877-46d9-8c3b-a2abff621c5c" name="Response SLA">
              <con:configuration>
                <SLA>3000</SLA>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="2f2651b9-9773-46a4-929b-1c09686eba98" name="Saving strategy details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;


String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);




// getting and saving promotion name and ID to test case level.
def promotionRankingStrategy = json.data.promotionRankingStrategy
def rewardStrategy = json.data.rewardStrategy
messageExchange.modelItem.testCase.setPropertyValue("promotionRankingStrategy",promotionRankingStrategy);
messageExchange.modelItem.testCase.setPropertyValue("rewardStrategy",rewardStrategy);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="The promo manger will get the details of configured strategy" id="0ad3df14-ba65-4ab8-87a2-60a4e5b74bc4">
        <con:settings/>
        <con:config service="Get promotion Strategy" resourcePath="/internal/v1/promotions/settings/strategy" methodName="Strategy 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="The promo manger will get the details of configured strategy" id="ed7f7671-207c-4342-8ec9-52f06338ec51" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/strategy</con:originalUri>
            <con:assertion type="Response SLA Assertion" id="83e853b9-3896-4fc9-a978-a5ccb9ec3fea" name="Response SLA">
              <con:configuration>
                <SLA>${#Project#responseSLA}</SLA>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="7c39f029-7f5c-4a8e-b8cb-33ec8bb052af" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



def promotionRankingStrategyInResponse = json.data.promotionRankingStrategy;
def rewardStrategyInResponse = json.data.rewardStrategy;

promotionRankingStrategyExpected = context.expand('${#TestCase#promotionRankingStrategy}')
rewardStrategyExpected = context.expand('${#TestCase#rewardStrategy}')

assert(promotionRankingStrategyInResponse == promotionRankingStrategyExpected):"promotionRankingStrategy are not expected. Expected = " + promotionRankingStrategyExpected + " Actual = " + promotionRankingStrategyInResponse
assert(rewardStrategyInResponse == rewardStrategyExpected):"rewardStrategy are not expected. Expected = " + rewardStrategyExpected + " Actual = " + rewardStrategyInResponse</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Then promotion manager creates a generic promotion" id="7ecfb368-ff9a-4918-a294-7de8b2273c23">
        <con:settings/>
        <con:config service="createPosPromotion" resourcePath="/internal/v1/promotions" methodName="createPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Then promotion manager creates a generic promotion" id="0022cbf4-6c96-4073-a4d7-0ea694808616" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value="${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
              <con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
    "name": "test promotion_${#TestCase#promotionName}",
    "orgId": ${#Project#orgid},
    "priority": 0,
    "active": true,
    "messageLabel": "test!!",
    "type": "POS",
    "condition": {
        "type": "CART",
        "cartCondition": {
            "kpi": "SUBTOTAL",
            "operator": "EQUALS",
            "value": 25000.0
        }
    },
    "action": {
        "type": "CART_BASED",
        "cartBasedAction": {
            "type": "ABSOLUTE",
            "value": 250.0
        }
    },
    "createdBy": 100,
    "createdOn": 0,
    "lastUpdatedBy": 100,
    "startDate": ${#TestCase#starttime},
    "endDate": ${#TestCase#endtime},
    "campaignId": ${#TestSuite#rnd}
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic</con:originalUri>
            <con:assertion type="Response SLA Assertion" id="f6ec4498-8cca-4707-94fa-980cc2d05782" name="Response SLA" disabled="true">
              <con:configuration>
                <SLA>300</SLA>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="fc484aac-700e-4a86-b678-32221180ff2e" name="save promotion details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;


String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



// getting and saving promotion name and ID to test case level.
def promotionId = json.data.id
def promotionName = json.data.name
messageExchange.modelItem.testCase.setPropertyValue("promotionId",promotionId);
messageExchange.modelItem.testCase.setPropertyValue("promotionName",promotionName);

orgIdInResponse = json.data.orgId.toString()
orgIdExpected = context.expand('${#Project#orgid}')

assert(orgIdInResponse == orgIdExpected):"Org Id is not expected"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Valid HTTP Status Codes" id="40fa3494-84e9-49ec-b6d8-9120b653e218" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>201</codes>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="End user tries to apply promo on cart" id="05c912cd-582d-487f-b420-e6b23006691a">
        <con:settings/>
        <con:config service="Evaluate" resourcePath="/v1/promotions/evaluate" methodName="Evaluate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="End user tries to apply promo on cart" id="76ec8db7-d854-4d98-a590-3b20231743f0" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="${#Project#authorization}" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#externalEndpoint}</con:endpoint>
            <con:request>{
  "amount": 25000,
  "customerId": "${#Project#customerid}",
  "cartItems": [
    {
      "referenceId": "${#TestCase#referenceId}",
      "sku": "${#TestCase#sku}",
      "amount": 25000,
      "qty": 1,
      "discount": null,
      "appliedPromotions": null
    }
  ],
      "appliedPromotions": null
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/evaluate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="7997a049-eddd-406b-92af-8b2221972dcc" name="Asserting applied promo details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

lstOfAppliedPromotions = json.data.appliedPromotions

promotionId = context.expand('${#TestCase#promotionId}')
promotionName = context.expand('${#TestCase#promotionName}')
expectedPromotion = [
            "id": "${promotionId}",
            "name": "${promotionName}",
            "messageLabel": "test!!",
            "discount": "250.000000",
            "discountAppliedOnQuantity": null,
            "promotionAppliedOnQuantity": null,
            "type": "POS"
         ]
isCreatedPromotionInAppliedPromotions = false;
for(promotion in lstOfAppliedPromotions){
	if(promotion.id.equalsIgnoreCase("${promotionId}")){
		assert(promotion.name.equalsIgnoreCase("${promotionName}"))
		assert(promotion.messageLabel.equalsIgnoreCase("test!!"))
		assert(promotion.discount.equalsIgnoreCase("250.000000"))
		assert(promotion.type.equalsIgnoreCase("POS"))
		isCreatedPromotionInAppliedPromotions = true;
		break;
	}
}

log.info isCreatedPromotionInAppliedPromotions
assert(isCreatedPromotionInAppliedPromotions == true) : "Created promotion is not in list of applied promotions";</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Updating promo strtegy to default value" id="183cc7a2-242e-4a5d-ab95-6da97f49bfb9">
        <con:settings/>
        <con:config service="Set promotion Strategy" resourcePath="/internal/v1/promotions/settings/strategy" methodName="Strategy 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Updating promo strtegy to default value" id="e1c2a11c-96c8-4e07-a117-a13176739156" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
  "isActive": true,
  "promotionRankingStrategy": "PRIORITY",
  "rewardStrategy": "NO_STRATEGY"
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/strategy</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="2e910897-3147-4668-973f-df27620eb84f" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>201,200</codes>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="De-activate Promotion" id="ab4b0f80-c413-4b5d-8986-597d5cca2818">
        <con:settings/>
        <con:config service="DeactivatePromotion" resourcePath="/internal/v1/promotions/{promotionid}/deactivate" methodName="Deactivate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="De-activate Promotion" id="82128d68-6af6-4042-83e9-4d9233a29bfa" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions//deactivate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="51d2df5c-f261-466e-a684-387e104f2a37" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


log.info(json)
responseData = json.data
log.info(responseData)
assert(responseData):"Promotion disable failed"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
              <con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
              <con:entry key="promotionid" value="${#TestCase#promotionId}"/>
              <con:entry key="X-CAP-USER-ID" value="${#Project#tillid}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>promotionid</con:entry>
              <con:entry>X-CAP-USER-ID</con:entry>
              <con:entry>AUTH-COOKIE</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>promotionRankingStrategy</con:name>
          <con:value>MAX_DISCOUNT</con:value>
        </con:property>
        <con:property>
          <con:name>rewardStrategy</con:name>
          <con:value>NO_STRATEGY</con:value>
        </con:property>
        <con:property>
          <con:name>starttime</con:name>
          <con:value>1616065443368</con:value>
        </con:property>
        <con:property>
          <con:name>endtime</con:name>
          <con:value>1616151843369</con:value>
        </con:property>
        <con:property>
          <con:name>promotionName</con:name>
          <con:value>test promotion_FDYXGL4TIC</con:value>
        </con:property>
        <con:property>
          <con:name>tnxId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>tnxNumber</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>sku</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>referenceId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>userId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionId</con:name>
          <con:value>605333a5b814490e3935c559</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="380c5b6b-7c6d-4562-a8ff-5c28bade2a24" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Create promo with with store criteria &amp; evaluate it with valid store/till" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Given script creates a pre-requisites" id="97a0f277-90e7-412a-ba49-36acc7a81d21">
        <con:settings/>
        <con:config>
          <script>def promotionName = new Random().with {(1..10).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()}
log.info(promotionName)
String starttime = System.currentTimeMillis().toString()
String endtime = (System.currentTimeMillis()+86400000).toString()

//storing ids to test case level.
testRunner.testCase.setPropertyValue("starttime", starttime);
testRunner.testCase.setPropertyValue("endtime", endtime);
testRunner.testCase.setPropertyValue("promotionName", promotionName);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="The promo manager will create the promo with operator IN store scriteria" id="fdd13fdd-99ef-4d43-b2e6-7efde19ee208">
        <con:settings/>
        <con:config service="createPosPromotion" resourcePath="/internal/v1/promotions" methodName="createPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="The promo manager will create the promo with operator IN store scriteria" id="0022cbf4-6c96-4073-a4d7-0ea694808616" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
              <con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
    "name": "${#TestCase#promotionName}",
    "orgId": ${#Project#orgid},
    "priority": 0,
    "active": true,
    "messageLabel": "test!!",
    "type": "POS",
    "storeCriteria": {
	"type": "STORE",
	"operator" : "IN",
	"values": [${#Project#store}]
	},
    "condition": {
        "type": "CART",
        "cartCondition": {
            "kpi": "SUBTOTAL",
            "operator": "EQUALS",
            "value": 25000.0
        }
    },
    "action": {
        "type": "CART_BASED",
        "cartBasedAction": {
            "type": "ABSOLUTE",
            "value": 250.0
        }
    },
    "createdBy": 100,
    "createdOn": 0,
    "lastUpdatedBy": 100,
    "startDate": ${#TestCase#starttime},
    "endDate": ${#TestCase#endtime},
    "campaignId": ${#TestSuite#rnd}

}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="37cdf72c-8a2d-469f-bf5f-d12a20d43e3c" name="Saving promo details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;


String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);




// getting and saving promotion name and ID to test case level.
def promotionId = json.data.id
def promotionName = json.data.name
messageExchange.modelItem.testCase.setPropertyValue("promotionId",promotionId);
messageExchange.modelItem.testCase.setPropertyValue("promotionName",promotionName);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Response SLA Assertion" id="654f2da5-f85a-4ca3-a2c4-02a2903f8114" name="Response SLA" disabled="true">
              <con:configuration>
                <SLA>1500</SLA>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Evaluate the promo against operator IN store criteria" id="88309c14-e088-4301-910d-7131870def69">
        <con:settings/>
        <con:config service="Evaluate" resourcePath="/v1/promotions/evaluate" methodName="Evaluate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Evaluate the promo against operator IN store criteria" id="76ec8db7-d854-4d98-a590-3b20231743f0" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="${#Project#authorization}" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#externalEndpoint}</con:endpoint>
            <con:request>{
  "amount": 25000,
  "customerId": 100,
  "cartItems": [
    {
      "referenceId": "fdc78567-bf4a-494b-9386-83045a910dcb",
      "sku": "6676557b-a2ee-4334-aa6e-7a64ba15be37",
      "amount": 25000,
      "qty": 1,
      "discount": null,
      "appliedPromotions": null
    }
  ],
      "appliedPromotions": null
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/evaluate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="40ded90a-f939-44df-bf99-fbeee694138e" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

lstOfAppliedPromotions = json.data.appliedPromotions

promotionId = context.expand('${#TestCase#promotionId}')
promotionName = context.expand('${#TestCase#promotionName}')
expectedPromotion = [
            "id": "${promotionId}",
            "name": "${promotionName}",
            "messageLabel": "test!!",
            "discount": "250.000000",
            "discountAppliedOnQuantity": null,
            "promotionAppliedOnQuantity": null,
            "type": "POS"
         ]
isCreatedPromotionInAppliedPromotions = false;
for(promotion in lstOfAppliedPromotions){
	if(promotion.id.equalsIgnoreCase("${promotionId}")){
		assert(promotion.name.equalsIgnoreCase("${promotionName}"))
		assert(promotion.messageLabel.equalsIgnoreCase("test!!"))
		assert(promotion.discount.equalsIgnoreCase("250.000000"))
		assert(promotion.type.equalsIgnoreCase("POS"))
		isCreatedPromotionInAppliedPromotions = true;
		break;
	}
}

log.info isCreatedPromotionInAppliedPromotions
log.info ("${promotionId}")
assert(isCreatedPromotionInAppliedPromotions == true) : "Created promotion is not in list of applied promotions";</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Response SLA Assertion" id="ef273703-79fb-475e-a77c-ffe9f218ae85" name="Response SLA" disabled="true">
              <con:configuration>
                <SLA>1500</SLA>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="De-activate Promotion" id="dc35cca1-9d00-4851-9f91-69106ba8e911">
        <con:settings/>
        <con:config service="DeactivatePromotion" resourcePath="/internal/v1/promotions/{promotionid}/deactivate" methodName="Deactivate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="De-activate Promotion" id="82128d68-6af6-4042-83e9-4d9233a29bfa" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions//deactivate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="b7650b92-a089-4fb4-8317-7e8136167aff" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


log.info(json)
responseData = json.data
log.info(responseData)
assert(responseData):"Promotion disable failed"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
              <con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
              <con:entry key="promotionid" value="${#TestCase#promotionId}"/>
              <con:entry key="X-CAP-USER-ID" value="${#Project#tillid}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>promotionid</con:entry>
              <con:entry>X-CAP-USER-ID</con:entry>
              <con:entry>AUTH-COOKIE</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>starttime</con:name>
          <con:value>1616065893344</con:value>
        </con:property>
        <con:property>
          <con:name>endtime</con:name>
          <con:value>1616152293344</con:value>
        </con:property>
        <con:property>
          <con:name>randomId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>tnxId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>tnxNumber</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>sku</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>referenceId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>userId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionName</con:name>
          <con:value>8YXNHARGAC</con:value>
        </con:property>
        <con:property>
          <con:name>promotionId</con:name>
          <con:value>60533566b814490e3935c562</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="c112126c-cae0-4fe2-834b-154691d3882f" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Create promo with product criteria as CATEGORY with IN operator &amp; evaluate it" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Given script creates a pre-requisites" id="9d1d3301-48a4-42b3-8a3f-f4c5d1ce5e58">
        <con:settings/>
        <con:config>
          <script>def promotionName = new Random().with {(1..10).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()}
String starttime = System.currentTimeMillis().toString()
String endtime = (System.currentTimeMillis()+86400000).toString()

//storing ids to test case level.
testRunner.testCase.setPropertyValue("starttime", starttime);
testRunner.testCase.setPropertyValue("endtime", endtime);
testRunner.testCase.setPropertyValue('promotionName', promotionName)</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="The promo manager will create the promo with product criteria as CATEGORY operator IN" id="1f1b406e-2063-4a5e-9288-2f0c2e35aa03">
        <con:settings/>
        <con:config service="createPosPromotion" resourcePath="/internal/v1/promotions" methodName="createPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="The promo manager will create the promo with product criteria as CATEGORY operator IN" id="0022cbf4-6c96-4073-a4d7-0ea694808616" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
              <con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
  "name": "test promotion_${#TestCase#randomId}",
  "orgId": ${#Project#orgid},
  "priority": 0,
  "active": true,
  "id": null,
  "messageLabel": "test!!",
  "type": "POS",
  "timeCriteria": null,
  "storeCriteria": null,
  "condition": {
    "type": "PRODUCT",
    "cartCondition": null,
    "productCondition": {
      "criteriaList": [
        {
          "entity": "CATEGORY",
          "operator": "IN",
          "values": [
            "${#Project#category}"
          ],
          "attributeName": null
        }
      ],
      "kpi": "AMOUNT",
      "value": "100.000000",
      "operator": "GREATER_THAN_OR_EQUAL"
    }
  },
  "action": {
    "type": "PRODUCT_BASED",
    "cartBasedAction": null,
    "productBasedAction": {
      "type": "PERCENTAGE",
      "value": "50.000000"
    },
    "fixedPriceAction": null,
    "freeProductAction": null
  },
  "createdBy": 100,
  "createdOn": 0,
  "lastUpdatedBy": 100,
  "lastUpdatedOn": null,
  "startDate": ${#TestCase#starttime},
  "endDate": ${#TestCase#endtime},
  "campaignId": ${#TestSuite#rnd},
  "loyaltyEarningExpiryDays": null,
  "maxEarningPerCustomer": null,
  "earningCriteria": null,
  "promotionRestrictions": null,
  "earnLimitedToSpecificAudience": false,
  "customFieldValues": {
    "f1": "v1",
    "f2": "v2"
  }
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="bda2a045-d95b-474b-b5ca-bb9c920f123d" name="Save promo details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;


String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



// getting and saving promotion name and ID to test case level.
def promotionId = json.data.id
def promotionName = json.data.name
messageExchange.modelItem.testCase.setPropertyValue("promotionId",promotionId);
messageExchange.modelItem.testCase.setPropertyValue("promotionName",promotionName);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Evaluate the promo against product criteria as CATEGORY operator IN" id="0cad115b-6c1e-406f-a905-d97cc9625da7">
        <con:settings/>
        <con:config service="Evaluate" resourcePath="/v1/promotions/evaluate" methodName="Evaluate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Evaluate the promo against product criteria as CATEGORY operator IN" id="76ec8db7-d854-4d98-a590-3b20231743f0" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="${#Project#authorization}" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#externalEndpoint}</con:endpoint>
            <con:request>{
  "amount": 150,
  "customerId": "${#Project#customerid}",
  "cartItems": [
    {
      "referenceId": "${#TestCase#referenceId}",
      "sku": "${#Project#sku}",
      "amount": "150.000000",
      "qty": "1.000000",
      "discount": null,
      "appliedPromotions": null
    }
  ],
      "appliedPromotions": null
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/evaluate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="2e8d1096-5387-4d82-b8b0-d0108607fff1" name="Assert appied promo details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

lstOfAppliedPromotions = json.data.cartItems[0].appliedPromotions
log.info(lstOfAppliedPromotions)

promotionId = context.expand('${#TestCase#promotionId}')
promotionName = context.expand('${#TestCase#promotionName}')
isCreatedPromotionInAppliedPromotions = false;
log.info("${promotionId}")
for(promotion in lstOfAppliedPromotions){
	log.info(promotion.id)
	if(promotion.id.equalsIgnoreCase("${promotionId}")){
		isCreatedPromotionInAppliedPromotions = true;
		break;
	}
}

log.info isCreatedPromotionInAppliedPromotions
assert(isCreatedPromotionInAppliedPromotions == true) : "Created promotion is not in list of applied promotions";</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Response SLA Assertion" id="6f398ed1-1134-41e7-b97d-9fa2dc71469f" name="Response SLA" disabled="true">
              <con:configuration>
                <SLA>1500</SLA>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="De-activate promotion" id="d4d7ff2b-0130-4b94-b071-ca0e978c98b0">
        <con:settings/>
        <con:config service="DeactivatePromotion" resourcePath="/internal/v1/promotions/{promotionid}/deactivate" methodName="Deactivate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="De-activate promotion" id="82128d68-6af6-4042-83e9-4d9233a29bfa" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions//deactivate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="c6b8437c-f7c7-449e-a875-5e774ae8ad44" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


log.info(json)
responseData = json.data
log.info(responseData)
assert(responseData):"Promotion disable failed"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
              <con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
              <con:entry key="promotionid" value="${#TestCase#promotionId}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>promotionid</con:entry>
              <con:entry>X-CAP-API-AUTH-ORG-ID</con:entry>
              <con:entry>AUTH-COOKIE</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>starttime</con:name>
          <con:value>1616066265490</con:value>
        </con:property>
        <con:property>
          <con:name>endtime</con:name>
          <con:value>1616152665490</con:value>
        </con:property>
        <con:property>
          <con:name>randomId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionRankingStrategy</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>rewardStrategy</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionId</con:name>
          <con:value>605336dab814490e3935c568</con:value>
        </con:property>
        <con:property>
          <con:name>promotionName</con:name>
          <con:value>test promotion_</con:value>
        </con:property>
        <con:property>
          <con:name>tnxId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>tnxNumber</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>sku</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>referenceId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>userId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>category</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="a886ff05-8623-44fc-af67-a0b8280636eb" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Create promo with product criteria as CATEGORY with NOT_IN operator &amp; evaluate it" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Given script creates a pre-requisites" id="ce864d24-716f-4f2e-8d3b-5c1d2583b25e">
        <con:settings/>
        <con:config>
          <script>def promotionName = new Random().with {(1..10).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()}
String starttime = System.currentTimeMillis().toString()
String endtime = (System.currentTimeMillis()+86400000).toString()

//storing ids to test case level.
testRunner.testCase.setPropertyValue("starttime", starttime);
testRunner.testCase.setPropertyValue("endtime", endtime);
testRunner.testCase.setPropertyValue('promotionName', promotionName)</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="The promo manager will create the promo with product criteria as CATEGORY operator NOT_IN" id="bf1a2030-6b66-41cb-ab04-05103706c788">
        <con:settings/>
        <con:config service="createPosPromotion" resourcePath="/internal/v1/promotions" methodName="createPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="The promo manager will create the promo with product criteria as CATEGORY operator NOT_IN" id="0022cbf4-6c96-4073-a4d7-0ea694808616" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
              <con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
  "name": "test promotion_${#TestCase#randomId}",
  "orgId": ${#Project#orgid},
  "priority": 0,
  "active": true,
  "id": null,
  "messageLabel": "test!!",
  "type": "POS",
  "timeCriteria": null,
  "storeCriteria": null,
  "condition": {
    "type": "PRODUCT",
    "cartCondition": null,
    "productCondition": {
      "criteriaList": [
        {
          "entity": "CATEGORY",
          "operator": "NOT_IN",
          "values": [
            "${#TestCase#category}"
          ],
          "attributeName": null
        }
      ],
      "kpi": "AMOUNT",
      "value": "100.000000",
      "operator": "EQUALS"
    }
  },
  "action": {
    "type": "PRODUCT_BASED",
    "cartBasedAction": null,
    "productBasedAction": {
      "type": "PERCENTAGE",
      "value": "50.000000"
    },
    "fixedPriceAction": null,
    "freeProductAction": null
  },
  "createdBy": 100,
  "createdOn": 0,
  "lastUpdatedBy": 100,
  "lastUpdatedOn": null,
  "startDate": ${#TestCase#starttime},
  "endDate": ${#TestCase#endtime},
  "campaignId": ${#TestSuite#rnd},
  "loyaltyEarningExpiryDays": null,
  "maxEarningPerCustomer": null,
  "earningCriteria": null,
  "promotionRestrictions": null,
  "earnLimitedToSpecificAudience": false,
  "customFieldValues": {
    "f1": "v1",
    "f2": "v2"
  }
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="970e7c29-d9a3-4386-8852-fb47d394cc7a" name="Save promo details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



// getting and saving promotion name and ID to test case level.
def promotionId = json.data.id
def promotionName = json.data.name
messageExchange.modelItem.testCase.setPropertyValue("promotionId",promotionId);
messageExchange.modelItem.testCase.setPropertyValue("promotionName",promotionName);

orgIdInResponse = json.data.orgId.toString()
orgIdExpected = context.expand('${#Project#orgid}')

assert(orgIdInResponse == orgIdExpected):"Org Id is not expected"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Response SLA Assertion" id="172d4cd2-261f-4e20-91a5-a86f424d3eca" name="Response SLA" disabled="true">
              <con:configuration>
                <SLA>1500</SLA>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Evaluate the promo against product criteria as CATEGORY operator NOT_IN" id="e1ffd9d8-ed15-4c6d-b549-927daac7f1cc">
        <con:settings/>
        <con:config service="Evaluate" resourcePath="/v1/promotions/evaluate" methodName="Evaluate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Evaluate the promo against product criteria as CATEGORY operator NOT_IN" id="76ec8db7-d854-4d98-a590-3b20231743f0" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="${#Project#authorization}" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#externalEndpoint}</con:endpoint>
            <con:request>{
  "amount": 100,
  "customerId": "${#Project#customerid}",
  "cartItems": [
    {
      "referenceId": "${#TestCase#referenceId}",
      "sku": "${#TestCase#sku}",
      "amount": "100.000000",
      "qty": "1.000000",
      "discount": null,
      "appliedPromotions": null
    }
  ],
      "appliedPromotions": null
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/evaluate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="d06a2726-14df-4b84-bf73-6ebbbf813b8f" name="Asserting applied promo">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

lstOfAppliedPromotions = json.data.cartItems[0].appliedPromotions
assert (lstOfAppliedPromotions == null)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Response SLA Assertion" id="2df59aec-0d37-412a-b9ae-db60a576c979" name="Response SLA">
              <con:configuration>
                <SLA>1500</SLA>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="De-activate Promotion" id="dcfaab81-f0c1-4568-a584-b92d333dce77">
        <con:settings/>
        <con:config service="DeactivatePromotion" resourcePath="/internal/v1/promotions/{promotionid}/deactivate" methodName="Deactivate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="De-activate Promotion" id="82128d68-6af6-4042-83e9-4d9233a29bfa" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions//deactivate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="935de802-dde1-46a9-9833-cf5247287e8a" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


log.info(json)
responseData = json.data
log.info(responseData)
assert(responseData):"Promotion disable failed"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
              <con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
              <con:entry key="promotionid" value="${#TestCase#promotionId}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>promotionid</con:entry>
              <con:entry>X-CAP-API-AUTH-ORG-ID</con:entry>
              <con:entry>AUTH-COOKIE</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>starttime</con:name>
          <con:value>1616065446200</con:value>
        </con:property>
        <con:property>
          <con:name>endtime</con:name>
          <con:value>1616151846200</con:value>
        </con:property>
        <con:property>
          <con:name>randomId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionId</con:name>
          <con:value>605333a7b814490e3935c55b</con:value>
        </con:property>
        <con:property>
          <con:name>promotionName</con:name>
          <con:value>test promotion_</con:value>
        </con:property>
        <con:property>
          <con:name>sku</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>referenceId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>userId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>category</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>brand</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="545bc502-57dd-46ee-bf0c-ad5e1ca4e037" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Create promo with product criteria as BRAND with IN operator &amp; evaluate it" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Given script creates a pre-requisites" id="b6f68194-8f10-4709-9c37-03ed3a767f91">
        <con:settings/>
        <con:config>
          <script>def promotionName = new Random().with {(1..10).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()}
String starttime = System.currentTimeMillis().toString()
String endtime = (System.currentTimeMillis()+86400000).toString()

//storing ids to test case level.
testRunner.testCase.setPropertyValue("starttime", starttime);
testRunner.testCase.setPropertyValue("endtime", endtime);
testRunner.testCase.setPropertyValue('promotionName', promotionName)</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="The promo manager will create the promo with product criteria as BRAND operator IN" id="363ec1fd-958e-4235-92d0-a606c071aeba">
        <con:settings/>
        <con:config service="createPosPromotion" resourcePath="/internal/v1/promotions" methodName="createPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="The promo manager will create the promo with product criteria as BRAND operator IN" id="0022cbf4-6c96-4073-a4d7-0ea694808616" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
              <con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
  "name": "test promotion_${#TestCase#randomId}",
  "orgId": ${#Project#orgid},
  "priority": 0,
  "active": true,
  "id": null,
  "messageLabel": "test!!",
  "type": "POS",
  "timeCriteria": null,
  "storeCriteria": null,
  "condition": {
    "type": "PRODUCT",
    "cartCondition": null,
    "productCondition": {
      "criteriaList": [
        {
          "entity": "BRAND",
          "operator": "IN",
          "values": [
            "${#Project#brand}"
          ],
          "attributeName": null
        }
      ],
      "kpi": "AMOUNT",
      "value": "100.000000",
      "operator": "GREATER_THAN_OR_EQUAL"
    }
  },
  "action": {
    "type": "PRODUCT_BASED",
    "cartBasedAction": null,
    "productBasedAction": {
      "type": "PERCENTAGE",
      "value": "50.000000"
    },
    "fixedPriceAction": null,
    "freeProductAction": null
  },
  "createdBy": 100,
  "createdOn": 0,
  "lastUpdatedBy": 100,
  "lastUpdatedOn": null,
  "startDate": ${#TestCase#starttime},
  "endDate": ${#TestCase#endtime},
  "campaignId": ${#TestSuite#rnd},
  "loyaltyEarningExpiryDays": null,
  "maxEarningPerCustomer": null,
  "earningCriteria": null,
  "promotionRestrictions": null,
  "earnLimitedToSpecificAudience": false,
  "customFieldValues": {
    "f1": "v1",
    "f2": "v2"
  }
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="b01658cd-9a7d-4e3d-8ab8-47a11db50784" name="Save promo details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;


String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



// getting and saving promotion name and ID to test case level.
def promotionId = json.data.id
def promotionName = json.data.name
messageExchange.modelItem.testCase.setPropertyValue("promotionId",promotionId);
messageExchange.modelItem.testCase.setPropertyValue("promotionName",promotionName);

orgIdInResponse = json.data.orgId.toString()
orgIdExpected = context.expand('${#Project#orgid}')

assert(orgIdInResponse == orgIdExpected):"Org Id is not expected"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Response SLA Assertion" id="ee76985b-3c15-4c84-b1b0-78ee3ccb4462" name="Response SLA" disabled="true">
              <con:configuration>
                <SLA>1500</SLA>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Valid HTTP Status Codes" id="f0d13469-bb56-483d-bc2d-bd44112dbd68" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>201</codes>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Evaluate the promo against product criteria as BRAND operator IN" id="d23480cf-f0a9-4541-8302-d2ac86bf2ec7">
        <con:settings/>
        <con:config service="Evaluate" resourcePath="/v1/promotions/evaluate" methodName="Evaluate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Evaluate the promo against product criteria as BRAND operator IN" id="76ec8db7-d854-4d98-a590-3b20231743f0" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="${#Project#authorization}" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#externalEndpoint}</con:endpoint>
            <con:request>{
  "amount": 100,
  "customerId": "${#Project#customerid}",
  "cartItems": [
    {
      "referenceId": "${#TestCase#referenceId}",
      "sku": "${#Project#sku}",
      "amount": "100.000000",
      "qty": "1.000000",
      "discount": null,
      "appliedPromotions": null
    }
  ],
      "appliedPromotions": null
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/evaluate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="8d5953c2-75df-480e-a5b0-ecb65da3527e" name="Assert applied promo details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

lstOfAppliedPromotions = json.data.cartItems[0].appliedPromotions

promotionId = context.expand('${#TestCase#promotionId}')
promotionName = context.expand('${#TestCase#promotionName}')
expectedPromotion = [
            "id": "${promotionId}",
            "name": "${promotionName}",
            "messageLabel": "test!!",
            "discount": "75.000000",
            "discountAppliedOnQuantity": "1.000000",
            "promotionAppliedOnQuantity": "1.000000",
            "type": null
         ]
isCreatedPromotionInAppliedPromotions = false;
for(promotion in lstOfAppliedPromotions){
	if(promotion.id.equalsIgnoreCase("${promotionId}")){
		isCreatedPromotionInAppliedPromotions = true;
		break;
	}
}

log.info isCreatedPromotionInAppliedPromotions
assert(isCreatedPromotionInAppliedPromotions == true) : "Created promotion is not in list of applied promotions";</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Response SLA Assertion" id="d6dad4b2-b6c6-4c60-985d-595f59857261" name="Response SLA">
              <con:configuration>
                <SLA>1500</SLA>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Valid HTTP Status Codes" id="fb467710-6e25-4619-b292-7b42346762a4" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="De-activate Promotion" id="69cbe5f9-0b7b-4a49-a592-650302c8aad6">
        <con:settings/>
        <con:config service="DeactivatePromotion" resourcePath="/internal/v1/promotions/{promotionid}/deactivate" methodName="Deactivate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="De-activate Promotion" id="82128d68-6af6-4042-83e9-4d9233a29bfa" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions//deactivate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="01db65d0-2396-4932-9867-1cbd238cce3d" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


log.info(json)
responseData = json.data
log.info(responseData)
assert(responseData):"Promotion disable failed"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
              <con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
              <con:entry key="promotionid" value="${#TestCase#promotionId}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>promotionid</con:entry>
              <con:entry>X-CAP-API-AUTH-ORG-ID</con:entry>
              <con:entry>AUTH-COOKIE</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>starttime</con:name>
          <con:value>1616066373538</con:value>
        </con:property>
        <con:property>
          <con:name>endtime</con:name>
          <con:value>1616152773538</con:value>
        </con:property>
        <con:property>
          <con:name>randomId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionId</con:name>
          <con:value>60533746b814490e3935c56c</con:value>
        </con:property>
        <con:property>
          <con:name>promotionName</con:name>
          <con:value>test promotion_</con:value>
        </con:property>
        <con:property>
          <con:name>tnxId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>tnxNumber</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>sku</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>referenceId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>userId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>category</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>brand</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="02003efa-5dbc-42b5-a0da-56773f3d23de" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Create promo with product criteria as BRAND with NOT_IN operator &amp; evaluate it" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Given script creates a pre-requisites" id="1afa33df-70cf-4e7e-82ce-e2d19552b5f6">
        <con:settings/>
        <con:config>
          <script>def promotionName = new Random().with {(1..10).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()}
String starttime = System.currentTimeMillis().toString()
String endtime = (System.currentTimeMillis()+86400000).toString()

//storing ids to test case level.
testRunner.testCase.setPropertyValue("starttime", starttime);
testRunner.testCase.setPropertyValue("endtime", endtime);
testRunner.testCase.setPropertyValue('promotionName', promotionName)</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="The promo manager will create the promo with product criteria as BRAND operator NOT_IN" id="20adda61-a0b2-4919-84fe-4a75d8d9adf0">
        <con:settings/>
        <con:config service="createPosPromotion" resourcePath="/internal/v1/promotions" methodName="createPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="The promo manager will create the promo with product criteria as BRAND operator NOT_IN" id="0022cbf4-6c96-4073-a4d7-0ea694808616" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
              <con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
  "name": "test promotion_${#TestCase#randomId}",
  "orgId": ${#Project#orgid},
  "priority": 0,
  "active": true,
  "id": null,
  "messageLabel": "test!!",
  "type": "POS",
  "timeCriteria": null,
  "storeCriteria": null,
  "condition": {
    "type": "PRODUCT",
    "cartCondition": null,
    "productCondition": {
      "criteriaList": [
        {
          "entity": "BRAND",
          "operator": "NOT_IN",
          "values": [
            "${#Project#brand}"
          ],
          "attributeName": null
        }
      ],
      "kpi": "AMOUNT",
      "value": "100.000000",
      "operator": "GREATER_THAN_OR_EQUAL"
    }
  },
  "action": {
    "type": "PRODUCT_BASED",
    "cartBasedAction": null,
    "productBasedAction": {
      "type": "PERCENTAGE",
      "value": "50.000000"
    },
    "fixedPriceAction": null,
    "freeProductAction": null
  },
  "createdBy": 100,
  "createdOn": 0,
  "lastUpdatedBy": 100,
  "lastUpdatedOn": null,
  "startDate": ${#TestCase#starttime},
  "endDate": ${#TestCase#endtime},
  "campaignId": ${#TestSuite#rnd},
  "loyaltyEarningExpiryDays": null,
  "maxEarningPerCustomer": null,
  "earningCriteria": null,
  "promotionRestrictions": null,
  "earnLimitedToSpecificAudience": false,
  "customFieldValues": {
    "f1": "v1",
    "f2": "v2"
  }
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="18c48e13-a5c9-4c17-8786-6a0abff324ca" name="Save promo details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;


String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



// getting and saving promotion name and ID to test case level.
def promotionId = json.data.id
def promotionName = json.data.name
messageExchange.modelItem.testCase.setPropertyValue("promotionId",promotionId);
messageExchange.modelItem.testCase.setPropertyValue("promotionName",promotionName);

orgIdInResponse = json.data.orgId.toString()
orgIdExpected = context.expand('${#Project#orgid}')

assert(orgIdInResponse == orgIdExpected):"Org Id is not expected"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Response SLA Assertion" id="ef15b5f2-fd3c-4bdb-8fca-2f5caac3e480" name="Response SLA" disabled="true">
              <con:configuration>
                <SLA>1500</SLA>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Evaluate the promo against product criteria as CATEGORY operator NOT_IN" id="879bd183-c3ac-482d-9998-9d1b99765110">
        <con:settings/>
        <con:config service="Evaluate" resourcePath="/v1/promotions/evaluate" methodName="Evaluate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Evaluate the promo against product criteria as CATEGORY operator NOT_IN" id="76ec8db7-d854-4d98-a590-3b20231743f0" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="${#Project#authorization}" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#externalEndpoint}</con:endpoint>
            <con:request>{
  "amount": 100,
  "customerId": "${#Project#customerid}",
  "cartItems": [
    {
      "referenceId": "${#TestCase#referenceId}",
      "sku": "${#Project#sku}",
      "amount": "100.000000",
      "qty": "1.000000",
      "discount": null,
      "appliedPromotions": null
    }
  ],
      "appliedPromotions": null
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/evaluate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="c915aba9-c941-4304-8012-cc68d73f0187" name="Assert applied promo details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

lstOfAppliedPromotions = json.data.cartItems[0].appliedPromotions

promotionId = context.expand('${#TestCase#promotionId}')
promotionName = context.expand('${#TestCase#promotionName}')

assert lstOfAppliedPromotions==null</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="De-activate Promotion" id="7e275add-7820-445f-9641-07af7400b664">
        <con:settings/>
        <con:config service="DeactivatePromotion" resourcePath="/internal/v1/promotions/{promotionid}/deactivate" methodName="Deactivate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="De-activate Promotion" id="82128d68-6af6-4042-83e9-4d9233a29bfa" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions//deactivate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="3c43a3d4-a430-4f59-8e08-45f2e3ad8f28" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


log.info(json)
responseData = json.data
log.info(responseData)
assert(responseData):"Promotion disable failed"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
              <con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
              <con:entry key="promotionid" value="${#TestCase#promotionId}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>promotionid</con:entry>
              <con:entry>X-CAP-API-AUTH-ORG-ID</con:entry>
              <con:entry>AUTH-COOKIE</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>starttime</con:name>
          <con:value>1616066506702</con:value>
        </con:property>
        <con:property>
          <con:name>endtime</con:name>
          <con:value>1616152906703</con:value>
        </con:property>
        <con:property>
          <con:name>randomId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionName</con:name>
          <con:value>test promotion_</con:value>
        </con:property>
        <con:property>
          <con:name>tnxId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>tnxNumber</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>sku</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>referenceId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>userId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>category</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>brand</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionId</con:name>
          <con:value>605337cbb814490e3935c56e</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="dfc978d5-9844-44d4-a897-fe54cac371df" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Create promo with product criteria as SKU with IN operator &amp; evaluate it" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Given script creates a pre-requisites" id="24cb5414-6db7-47e0-81d4-821148b884b2">
        <con:settings/>
        <con:config>
          <script>def promotionName = new Random().with {(1..10).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()}
String starttime = System.currentTimeMillis().toString()
String endtime = (System.currentTimeMillis()+86400000).toString()

//storing ids to test case level.
testRunner.testCase.setPropertyValue("starttime", starttime);
testRunner.testCase.setPropertyValue("endtime", endtime);
testRunner.testCase.setPropertyValue('promotionName', promotionName)</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="The promo manager will create the promo with product criteria as SKU operator IN" id="49c2c927-1e19-4540-b62e-0aff2e5f7386">
        <con:settings/>
        <con:config service="createPosPromotion" resourcePath="/internal/v1/promotions" methodName="createPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="The promo manager will create the promo with product criteria as SKU operator IN" id="0022cbf4-6c96-4073-a4d7-0ea694808616" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
              <con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
  "name": "test promotion_${#TestCase#randomId}",
  "orgId": ${#Project#orgid},
  "priority": 0,
  "active": true,
  "id": null,
  "messageLabel": "test!!",
  "type": "POS",
  "timeCriteria": null,
  "storeCriteria": null,
  "condition": {
    "type": "PRODUCT",
    "cartCondition": null,
    "productCondition": {
      "criteriaList": [
        {
          "entity": "SKU",
          "operator": "IN",
          "values": [
            "${#TestCase#sku}"
          ],
          "attributeName": null
        }
      ],
      "kpi": "AMOUNT",
      "value": "100.000000",
      "operator": "GREATER_THAN_OR_EQUAL"
    }
  },
  "action": {
    "type": "PRODUCT_BASED",
    "cartBasedAction": null,
    "productBasedAction": {
      "type": "PERCENTAGE",
      "value": "50.000000"
    },
    "fixedPriceAction": null,
    "freeProductAction": null
  },
  "createdBy": 100,
  "createdOn": 0,
  "lastUpdatedBy": 100,
  "lastUpdatedOn": null,
  "startDate": ${#TestCase#starttime},
  "endDate": ${#TestCase#endtime},
  "campaignId": ${#TestSuite#rnd},
  "loyaltyEarningExpiryDays": null,
  "maxEarningPerCustomer": null,
  "earningCriteria": null,
  "promotionRestrictions": null,
  "earnLimitedToSpecificAudience": false,
  "customFieldValues": {
    "f1": "v1",
    "f2": "v2"
  }
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="18c48e13-a5c9-4c17-8786-6a0abff324ca" name="Save promo details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;


String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



// getting and saving promotion name and ID to test case level.
def promotionId = json.data.id
def promotionName = json.data.name
messageExchange.modelItem.testCase.setPropertyValue("promotionId",promotionId);
messageExchange.modelItem.testCase.setPropertyValue("promotionName",promotionName);

orgIdInResponse = json.data.orgId.toString()
orgIdExpected = context.expand('${#Project#orgid}')

assert(orgIdInResponse == orgIdExpected):"Org Id is not expected"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Response SLA Assertion" id="ef15b5f2-fd3c-4bdb-8fca-2f5caac3e480" name="Response SLA" disabled="true">
              <con:configuration>
                <SLA>1500</SLA>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Evaluate the promo against product criteria as SKU operator IN" id="23513536-1b8f-4d69-92c0-93fc7a4adb6a">
        <con:settings/>
        <con:config service="Evaluate" resourcePath="/v1/promotions/evaluate" methodName="Evaluate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Evaluate the promo against product criteria as SKU operator IN" id="76ec8db7-d854-4d98-a590-3b20231743f0" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value=" ${#Project#authorization}" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#externalEndpoint}</con:endpoint>
            <con:request>{
  "amount": 100,
  "customerId": "${#Project#customerid}",
  "cartItems": [
    {
      "referenceId": "${#TestCase#referenceId}",
      "sku": "${#TestCase#sku}",
      "amount": "100.000000",
      "qty": "1.000000",
      "discount": null,
      "appliedPromotions": null
    }
  ],
      "appliedPromotions": null
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/evaluate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="c915aba9-c941-4304-8012-cc68d73f0187" name="Assert applied promo details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

lstOfAppliedPromotions = json.data.cartItems[0].appliedPromotions

promotionId = context.expand('${#TestCase#promotionId}')
promotionName = context.expand('${#TestCase#promotionName}')

isCreatedPromotionInAppliedPromotions = false;
for(promotion in lstOfAppliedPromotions){
	if(promotion.id.equalsIgnoreCase("${promotionId}")){
		isCreatedPromotionInAppliedPromotions = true;
		break;
	}
}

log.info isCreatedPromotionInAppliedPromotions
assert(isCreatedPromotionInAppliedPromotions == true) : "Created promotion is not in list of applied promotions";</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="De-activate promotion" id="d5d6b24e-d5dc-4df4-b82a-cb7898a8fd01">
        <con:settings/>
        <con:config service="DeactivatePromotion" resourcePath="/internal/v1/promotions/{promotionid}/deactivate" methodName="Deactivate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="De-activate promotion" id="82128d68-6af6-4042-83e9-4d9233a29bfa" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions//deactivate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="00fb8087-f9f0-4053-bcfb-ccc845396698" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


log.info(json)
responseData = json.data
log.info(responseData)
assert(responseData):"Promotion disable failed"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
              <con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
              <con:entry key="promotionid" value="${#TestCase#promotionId}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>promotionid</con:entry>
              <con:entry>X-CAP-API-AUTH-ORG-ID</con:entry>
              <con:entry>AUTH-COOKIE</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>starttime</con:name>
          <con:value>1616065448613</con:value>
        </con:property>
        <con:property>
          <con:name>endtime</con:name>
          <con:value>1616151848613</con:value>
        </con:property>
        <con:property>
          <con:name>randomId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionName</con:name>
          <con:value>test promotion_</con:value>
        </con:property>
        <con:property>
          <con:name>tnxId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>tnxNumber</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>sku</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>referenceId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>userId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionId</con:name>
          <con:value>605333a9b814490e3935c55e</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="240bf689-4c8c-4490-bd58-b56e109500e4" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Create promo with with store criteria &amp; evaluate it with invalid store/till" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Given script creates a pre-requisites" id="85448a7d-6492-4067-844c-06e2150685ea">
        <con:settings/>
        <con:config>
          <script>def promotionName = new Random().with {(1..10).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()}
String starttime = System.currentTimeMillis().toString()
String endtime = (System.currentTimeMillis()+86400000).toString()

//storing ids to test case level.
testRunner.testCase.setPropertyValue("starttime", starttime);
testRunner.testCase.setPropertyValue("endtime", endtime);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="The promo manager will create the promo with operator NOT_IN store scriteria" id="32158364-e3ee-4b88-b199-26f86c744423">
        <con:settings/>
        <con:config service="createPosPromotion" resourcePath="/internal/v1/promotions" methodName="createPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="The promo manager will create the promo with operator NOT_IN store scriteria" id="0022cbf4-6c96-4073-a4d7-0ea694808616" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
              <con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
    "name": "{#TestCase#promotionName}",
    "orgId": ${#Project#orgid},
    "priority": 0,
    "active": true,
    "messageLabel": "test!!",
    "type": "POS",
    "storeCriteria": {
	"type": "STORE",
	"operator" : "IN",
	"values": [${#Project#store}]
	},
    "condition": {
        "type": "CART",
        "cartCondition": {
            "kpi": "SUBTOTAL",
            "operator": "EQUALS",
            "value": 25000.0
        }
    },
    "action": {
        "type": "CART_BASED",
        "cartBasedAction": {
            "type": "ABSOLUTE",
            "value": 250.0
        }
    },
    "createdBy": 100,
    "createdOn": 0,
    "lastUpdatedBy": 100,
    "startDate": ${#TestCase#starttime},
    "endDate": ${#TestCase#endtime},
    "campaignId": ${#TestSuite#rnd}

}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="4b07cc8a-05b0-4dba-80ff-ed0a4529c629" name="Saving promo details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;


String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);




// getting and saving promotion name and ID to test case level.
def promotionId = json.data.id
def promotionName = json.data.name
messageExchange.modelItem.testCase.setPropertyValue("promotionId",promotionId);
messageExchange.modelItem.testCase.setPropertyValue("promotionName",promotionName);

orgIdInResponse = json.data.orgId.toString()
orgIdExpected = context.expand('${#Project#orgid}')

assert(orgIdInResponse == orgIdExpected):"Org Id is not expected"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Response SLA Assertion" id="2f2ac1de-1c6d-4ccd-9a9f-676ac5f9379b" name="Response SLA" disabled="true">
              <con:configuration>
                <SLA>1700</SLA>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Evaluate the promo against operator invalid store criteria" id="a3bda674-1301-4644-80af-0d8c32e94d4c">
        <con:settings/>
        <con:config service="Evaluate" resourcePath="/v1/promotions/evaluate" methodName="Evaluate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Evaluate the promo against operator invalid store criteria" id="76ec8db7-d854-4d98-a590-3b20231743f0" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="${#Project#authorization}" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#externalEndpoint}</con:endpoint>
            <con:request>{
  "amount": 100,
  "customerId": 100,
  "cartItems": [
    {
      "referenceId": "fdc78567-bf4a-494b-9386-83045a910dcb",
      "sku": "6676557b-a2ee-4334-aa6e-7a64ba15be37",
      "amount": 100,
      "qty": 1,
      "discount": null,
      "appliedPromotions": null
    }
  ],
      "appliedPromotions": null
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/evaluate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="661f19e4-ddfa-494a-8c2c-ab779c4efd85" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

lstOfAppliedPromotions = json.data.appliedPromotions

promotionId = context.expand('${#TestCase#promotionId}')
promotionName = context.expand('${#TestCase#promotionName}')
expectedPromotion = [
            "id": "${promotionId}",
            "name": "${promotionName}",
            "messageLabel": "test!!",
            "discount": "100.000000",
            "discountAppliedOnQuantity": null,
            "promotionAppliedOnQuantity": null,
            "type": "POS"
         ]
isCreatedPromotionInAppliedPromotions = true;
for(promotion in lstOfAppliedPromotions){
	if(promotion.equals(expectedPromotion)){
		isCreatedPromotionInAppliedPromotions = false;
		break;
	}
}

log.info isCreatedPromotionInAppliedPromotions
assert(isCreatedPromotionInAppliedPromotions == true) : "Created promotion is not in list of applied promotions";</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Response SLA Assertion" id="51be60a3-ce77-4315-b558-4c410ef0516d" name="Response SLA">
              <con:configuration>
                <SLA>1500</SLA>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="De-activate Promotion" id="906c4ac1-83dd-4fda-a49b-9337183a637f">
        <con:settings/>
        <con:config service="DeactivatePromotion" resourcePath="/internal/v1/promotions/{promotionid}/deactivate" methodName="Deactivate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="De-activate Promotion" id="82128d68-6af6-4042-83e9-4d9233a29bfa" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions//deactivate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="54049dc6-1c2c-46ee-a941-fa1f735abcc0" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


log.info(json)
responseData = json.data
log.info(responseData)
assert(responseData):"Promotion disable failed"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
              <con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
              <con:entry key="promotionid" value="${#TestCase#promotionId}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>promotionid</con:entry>
              <con:entry>X-CAP-API-AUTH-ORG-ID</con:entry>
              <con:entry>AUTH-COOKIE</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>endtime</con:name>
          <con:value>1616151849619</con:value>
        </con:property>
        <con:property>
          <con:name>randomId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionId</con:name>
          <con:value>605333aab814490e3935c55f</con:value>
        </con:property>
        <con:property>
          <con:name>promoationName</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>promotionName</con:name>
          <con:value>{#TestCase#promotionName}</con:value>
        </con:property>
        <con:property>
          <con:name>userId</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>starttime</con:name>
          <con:value>1616065449619</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="5121ee93-792d-4968-8393-93669b8141b7" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Create promo with product criteria as SKU with NOT_IN operator &amp; evaluate it" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="Given script creates a pre-requisites" id="869278b5-8db7-4fee-9f09-be26297b6dd7">
        <con:settings/>
        <con:config>
          <script>def promotionName = new Random().with {(1..10).collect { (('A'..'Z')+('0'..'9')).join()[ nextInt( (('A'..'Z')+('0'..'9')).join().length() ) ] }.join()}
String starttime = System.currentTimeMillis().toString()
String endtime = (System.currentTimeMillis()+86400000).toString()

//storing ids to test case level.
testRunner.testCase.setPropertyValue("starttime", starttime);
testRunner.testCase.setPropertyValue("endtime", endtime);
testRunner.testCase.setPropertyValue('promotionName', promotionName)</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="The promo manager will create the promo with product criteria as SKU operator NOT_IN" id="2a546d73-e7c5-4e1e-a63a-f879e6262925">
        <con:settings/>
        <con:config service="createPosPromotion" resourcePath="/internal/v1/promotions" methodName="createPosPromotion" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="The promo manager will create the promo with product criteria as SKU operator NOT_IN" id="0022cbf4-6c96-4073-a4d7-0ea694808616" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ORG-ID" value=" ${#Project#orgid}"/>
  &lt;con:entry key="X-CAP-USER-ID" value=" ${#Project#orgid}"/>
&lt;/xml-fragment></con:setting>
              <con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request>{
  "name": "test promotion_${#TestCase#randomId}",
  "orgId": ${#Project#orgid},
  "priority": 0,
  "active": true,
  "id": null,
  "messageLabel": "test!!",
  "type": "POS",
  "timeCriteria": null,
  "storeCriteria": null,
  "condition": {
    "type": "PRODUCT",
    "cartCondition": null,
    "productCondition": {
      "criteriaList": [
        {
          "entity": "SKU",
          "operator": "NOT_IN",
          "values": [
            "${#Project#sku}"
          ],
          "attributeName": null
        }
      ],
      "kpi": "AMOUNT",
      "value": "100.000000",
      "operator": "GREATER_THAN_OR_EQUAL"
    }
  },
  "action": {
    "type": "PRODUCT_BASED",
    "cartBasedAction": null,
    "productBasedAction": {
      "type": "PERCENTAGE",
      "value": "50.000000"
    },
    "fixedPriceAction": null,
    "freeProductAction": null
  },
  "createdBy": 100,
  "createdOn": 0,
  "lastUpdatedBy": 100,
  "lastUpdatedOn": null,
  "startDate": ${#TestCase#starttime},
  "endDate": ${#TestCase#endtime},
  "campaignId": ${#TestSuite#rnd},
  "loyaltyEarningExpiryDays": null,
  "maxEarningPerCustomer": null,
  "earningCriteria": null,
  "promotionRestrictions": null,
  "earnLimitedToSpecificAudience": false,
  "customFieldValues": {
    "f1": "v1",
    "f2": "v2"
  }
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotion/generic</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="18c48e13-a5c9-4c17-8786-6a0abff324ca" name="Save promo details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;


String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);



// getting and saving promotion name and ID to test case level.
def promotionId = json.data.id
def promotionName = json.data.name
messageExchange.modelItem.testCase.setPropertyValue("promotionId",promotionId);
messageExchange.modelItem.testCase.setPropertyValue("promotionName",promotionName);

orgIdInResponse = json.data.orgId.toString()
orgIdExpected = context.expand('${#Project#orgid}')

assert(orgIdInResponse == orgIdExpected):"Org Id is not expected"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Response SLA Assertion" id="ef15b5f2-fd3c-4bdb-8fca-2f5caac3e480" name="Response SLA" disabled="true">
              <con:configuration>
                <SLA>1500</SLA>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
            <con:parameterOrder/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Evaluate the promo against product criteria as SKU operator NOT_IN" id="5164bf04-6b90-49e8-a026-aa43021bd2bc">
        <con:settings/>
        <con:config service="Evaluate" resourcePath="/v1/promotions/evaluate" methodName="Evaluate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Evaluate the promo against product criteria as SKU operator NOT_IN" id="76ec8db7-d854-4d98-a590-3b20231743f0" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="${#Project#authorization}" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#externalEndpoint}</con:endpoint>
            <con:request>{
  "amount": 100,
  "customerId": "${#Project#customerid}",
  "cartItems": [
    {
      "referenceId": "TestCasereferenceId",
      "sku": "${#Project#sku}",
      "amount": "100.000000",
      "qty": "1.000000",
      "discount": null,
      "appliedPromotions": null
    }
  ],
      "appliedPromotions": null
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/evaluate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="c915aba9-c941-4304-8012-cc68d73f0187" name="Assert applied promo details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

lstOfAppliedPromotions = json.data.cartItems[0].appliedPromotions
assert (lstOfAppliedPromotions == null)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="De-activate Promotion" id="ece10818-6946-4778-9891-ae5aeb5a7011">
        <con:settings/>
        <con:config service="DeactivatePromotion" resourcePath="/internal/v1/promotions/{promotionid}/deactivate" methodName="Deactivate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="De-activate Promotion" id="82128d68-6af6-4042-83e9-4d9233a29bfa" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/internal/v1/promotions//deactivate</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="fde6296a-4c71-4d0b-8b83-89daa06f3c38" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


log.info(json)
responseData = json.data
log.info(responseData)
assert(responseData):"Promotion disable failed"</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="X-CAP-API-AUTH-ORG-ID" value="${#Project#orgid}"/>
              <con:entry key="AUTH-COOKIE" value="${#Project#token}"/>
              <con:entry key="promotionid" value="${#TestCase#promotionId}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>promotionid</con:entry>
              <con:entry>X-CAP-API-AUTH-ORG-ID</con:entry>
              <con:entry>AUTH-COOKIE</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>starttime</con:name>
          <con:value>1616066564978</con:value>
        </con:property>
        <con:property>
          <con:name>endtime</con:name>
          <con:value>1616152964978</con:value>
        </con:property>
        <con:property>
          <con:name>promotionName</con:name>
          <con:value>test promotion_</con:value>
        </con:property>
        <con:property>
          <con:name>promotionId</con:name>
          <con:value>60533806b814490e3935c570</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:properties>
      <con:property>
        <con:name>rnd</con:name>
        <con:value>39077</con:value>
      </con:property>
    </con:properties>
    <con:setupScript/>
    <con:tearDownScript/>
  </con:testSuite>
  <con:testSuite id="b592181d-40df-4619-bee1-292bf09b55e1" name="PromotionAPIFuzzTest" disabled="true">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase id="1939f894-fd28-4c6d-b3cf-9f9808258504" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="evaluatePromotionTest" searchProperties="true">
      <con:settings/>
      <con:testStep type="restrequest" name="evaluatePromotion" id="30c8ec1b-9844-4535-950e-16e71bba7bc5">
        <con:settings/>
        <con:config service="Evaluate" resourcePath="/v1/promotions/evaluate" methodName="Evaluate 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="evaluatePromotion" id="76ec8db7-d854-4d98-a590-3b20231743f0" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Authorization" value="${#Project#authorization}"/>
  &lt;con:entry key="X-CAP-API-AUTH-ENTITY-ID" value="${#Project#tillid}"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#externalEndpoint}</con:endpoint>
            <con:request>{
  "amount": "25000",
  "customerId": "10",
  "cartItems": [
    {
      "referenceId": "reference-id",
      "sku": "sku",
      "amount": 25000,
      "qty": "1",
      "discount": "10",
      "appliedPromotions": null
    }],
    "appliedPromotions": null
}</con:request>
            <con:originalUri>https://promotion-engine-api.crm-nightly-new.cc.capillarytech.com/v1/promotion/evaluate</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="0f2cf3c0-ee6a-44eb-9274-4981e0e1388c" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="803a88f6-2b26-4644-a8f4-3023f37459a3" name="Script Assertion" disabled="true">
              <con:configuration>
                <scriptText>def status = messageExchange.getResponseHeaders().get('#status#');
String code = (status =~ "[1-5]\\d\\d")[0];
requestStatus = "UNKNOWN";
if(code != '200' &amp;&amp; code != '201'){
	requestStatus = "OK";
}
else{
	requestStatus = "FAILED"
}
log.info requestStatus</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>luciauto_till_10</con:username>
              <con:password>202cb962ac59075b964b07152d234b70</con:password>
              <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:preemptive>false</con:preemptive>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>promotionId</con:name>
          <con:value>605341d3b814490e3935c586</con:value>
        </con:property>
        <con:property>
          <con:name>promotionName</con:name>
          <con:value>cbdwhvguev</con:value>
        </con:property>
      </con:properties>
      <con:securityTest id="2d53631a-953f-4fba-910c-22d1c0259944" name="evaluatePromotionAPIFuzzTest" failOnError="true">
        <con:settings/>
        <con:setupScript>import com.eviware.soapui.model.testsuite.TestStepResult.TestStepStatus;
import groovy.json.JsonSlurper;

context.JsonContent = [];
context.lstOfStatus = []

//Accessing the fuzz data for tests.
String project_dir = context.expand('${projectDir}');
fuzzDBLocation = project_dir + File.separator + "test_data" + File.separator + "fuzzdb";
filepath = fuzzDBLocation + File.separator + "evaluatePromotionAPIFuzzData.json";
def reader = new BufferedReader(new InputStreamReader(new FileInputStream(filepath),"UTF-8"))
def json = new JsonSlurper().parse(reader);


def lstOfInvalidJsons = [];
new File(fuzzDBLocation + File.separator + "JSON_fuzzing.txt").withReader('UTF-8') { readerfile ->
def line
    while ((line = readerfile.readLine()) != null) {
        lstOfInvalidJsons.add(line);
    }
}

def lstOfFuzzForAmountField = json.amount;
def lstOfFuzzForCustomerIdField = json.customerId;
def lstOfFuzzForCartItemsAmountField = json.cartItemsAmount;
def lstOfFuzzForCartItemsQtyField = json.cartItemsQty;

context.lstOfFuzzForAmountField = lstOfFuzzForAmountField;
context.lstOfFuzzForCustomerIdField = lstOfFuzzForCustomerIdField;
context.lstOfFuzzForCartItemsAmountField = lstOfFuzzForCartItemsAmountField;
context.lstOfFuzzForCartItemsQtyField = lstOfFuzzForCartItemsQtyField;
context.lstOfInvalidJsons = lstOfInvalidJsons;</con:setupScript>
        <con:tearDownScript>import groovy.json.JsonOutput;
import com.eviware.soapui.security.*;

String project_dir = context.expand('${projectDir}');

def newJsonStr = JsonOutput.toJson(context.JsonContent)

def newPrettyJson = JsonOutput.prettyPrint(newJsonStr)

String outputFolder = context.testCase.testSuite.project.getPropertyValue("outputFolder");

String reportFileName = context.testCase.getSecurityTestAt(0).getName();

File reportFileObj = new File(outputFolder + File.separator + reportFileName + ".json");

saveToFile(reportFileObj, newPrettyJson)

log.info("Status details == " + context.lstOfStatus)

//Save the contents to a file
def saveToFile(file, content) {
    if (!file.parentFile.exists()) {
         file.parentFile.mkdirs()
         log.info "Directory did not exist, created"
    }
    file.write(content)
    assert file.exists(), "${file.name} not created"
}</con:tearDownScript>
        <con:testStepSecurityTest>
          <con:testStepId>30c8ec1b-9844-4535-950e-16e71bba7bc5</con:testStepId>
          <con:testStepSecurityScan type="GroovySecurityScan" name="Custom Script" id="4ed66603-0830-4a9c-895f-03f313b21fbd" applyForFailedStep="false" disabled="false" runOnlyOnce="true">
            <con:settings/>
            <con:config xsi:type="con:GroovySecurityScan" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:executeScript>import groovy.json.JsonSlurper;
import groovy.json.JsonBuilder;

//create a builder for each request created.
def req = testStep.getPropertyValue("Request");
def requestJson = new JsonSlurper().parseText(req);
JsonBuilder builder = new JsonBuilder(requestJson);

int amountFieldFuzzDataSize = context.lstOfFuzzForAmountField.size -1;
int customerIdFieldFuzzDataSize = context.lstOfFuzzForCustomerIdField.size -1;
int cartItemsAmountFieldFuzzDataSize = context.lstOfFuzzForCartItemsAmountField.size -1;
int cartItemsQtyFieldFuzzDataSize = context.lstOfFuzzForCartItemsQtyField.size -1;
int invalidFuzzJsonDataSize = context.lstOfInvalidJsons.size - 1;

//initializing the index variable to iterate.
if(context.amountFieldFuzzDataIndex == null){
  context.amountFieldFuzzDataIndex = 0;
}
if(context.customerIdFieldFuzzDataIndex == null){
  context.customerIdFieldFuzzDataIndex = 0;
}
if(context.cartItemsAmountFieldFuzzDataIndex == null){
  context.cartItemsAmountFieldFuzzDataIndex = 0;
}
if(context.cartItemsQtyFieldFuzzDataIndex == null){
  context.cartItemsQtyFieldFuzzDataIndex = 0;
}
if(context.invalidFuzzJsonDataIndex == null){
  context.invalidFuzzJsonDataIndex = 0;
}

if(context.invalidFuzzJsonDataIndex &lt;= invalidFuzzJsonDataSize){
  log.info("Content at index - " + context.invalidFuzzJsonDataIndex + "==> " + context.lstOfInvalidJsons.get(context.invalidFuzzJsonDataIndex));
  builder.content = context.lstOfInvalidJsons.get(context.invalidFuzzJsonDataIndex);
  parameters.payload = builder.toString();
  context.changedParamsField = "json body";
  context.changedParamsValue = context.lstOfInvalidJsons.get(context.invalidFuzzJsonDataIndex);
  context.status = securityScan.getSecurityScanResult().getStatusString();
  context.invalidFuzzJsonDataIndex++;
  return true;
}
//modify the "amount" field in request body using fuzz data captured.
if(context.amountFieldFuzzDataIndex &lt;= amountFieldFuzzDataSize){
  log.info("Content at index - " + context.amountFieldFuzzDataIndex + "==> " + context.lstOfFuzzForAmountField.get(context.amountFieldFuzzDataIndex));
  builder.content.amount = context.lstOfFuzzForAmountField.get(context.amountFieldFuzzDataIndex);
  parameters.payload = builder.toString();
  context.changedParamsField = "amount";
  context.changedParamsValue = context.lstOfFuzzForAmountField.get(context.amountFieldFuzzDataIndex);
  context.status = securityScan.getSecurityScanResult().getStatusString();
  context.amountFieldFuzzDataIndex++;
  return true;
}
if(context.customerIdFieldFuzzDataIndex &lt;= customerIdFieldFuzzDataSize){
  log.info("Content at index - " + context.customerIdFieldFuzzDataIndex + "==> " + context.lstOfFuzzForCustomerIdField.get(context.customerIdFieldFuzzDataIndex));
  builder.content.customerId = context.lstOfFuzzForCustomerIdField.get(context.customerIdFieldFuzzDataIndex);
  parameters.payload = builder.toString();
  context.changedParamsField = "customerId";
  context.changedParamsValue = context.lstOfFuzzForCustomerIdField.get(context.customerIdFieldFuzzDataIndex);
  context.status = securityScan.getSecurityScanResult().getStatusString();
  context.customerIdFieldFuzzDataIndex++;
  return true;
}
if(context.cartItemsAmountFieldFuzzDataIndex &lt;= cartItemsAmountFieldFuzzDataSize){
  log.info("Content at index - " + context.cartItemsAmountFieldFuzzDataIndex + "==> " + context.lstOfFuzzForCartItemsAmountField.get(context.cartItemsAmountFieldFuzzDataIndex));
  builder.content.cartItems[0].amount = context.lstOfFuzzForCartItemsAmountField.get(context.cartItemsAmountFieldFuzzDataIndex)
  parameters.payload = builder.toString();
  context.changedParamsField = "cartItems.amount";
  context.changedParamsValue = context.lstOfFuzzForCartItemsAmountField.get(context.cartItemsAmountFieldFuzzDataIndex);
  context.status = securityScan.getSecurityScanResult().getStatusString();
  context.cartItemsAmountFieldFuzzDataIndex++;
  return true;
}
if(context.cartItemsQtyFieldFuzzDataIndex &lt;= cartItemsQtyFieldFuzzDataSize){
  log.info("Content at index - " + context.cartItemsQtyFieldFuzzDataIndex + "==> " + context.lstOfFuzzForCartItemsQtyField.get(context.cartItemsQtyFieldFuzzDataIndex));
  builder.content.cartItems[0].qty = context.lstOfFuzzForCartItemsQtyField.get(context.cartItemsQtyFieldFuzzDataIndex);
  parameters.payload = builder.toString();
  context.changedParamsField = "cartItems.qty";
  context.changedParamsValue = context.lstOfFuzzForCartItemsQtyField.get(context.cartItemsQtyFieldFuzzDataIndex);
  context.status = securityScan.getSecurityScanResult().getStatusString();
  context.cartItemsQtyFieldFuzzDataIndex++;
  return true;
}
else{
  def lstOfStatus = securityScan.getSecurityScanResult().getSecurityRequestResultList();
  for(def statusObj : lstOfStatus){
    context.lstOfStatus.add(statusObj.getStatus());
  }
  return false;
}</con:executeScript>
            </con:config>
            <con:assertion type="Sensitive Information Exposure" id="0f71c508-bab3-478d-933c-adbfb42e2869" name="Sensitive Information Exposure">
              <con:configuration>
                <IncludeProjectSpecific>true</IncludeProjectSpecific>
                <IncludeGlobal>true</IncludeGlobal>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Invalid HTTP Status Codes" id="3976242f-5689-4cd3-8fdf-d465d1fe8515" name="Invalid HTTP Status Codes">
              <con:configuration>
                <codes>201,200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="e16dce6e-f764-4f6f-952b-237dd99b51a9" name="capture request data.">
              <con:configuration>
                <scriptText>String response = messageExchange.getResponseContent();
String reqBody = messageExchange.getRequestContent();
String endPoint = messageExchange.getEndpoint()

def status = messageExchange.getResponseHeaders().get('#status#');
String code = (status =~ "[1-5]\\d\\d")[0];
requestStatus = "UNKNOWN";
if(code != '200' &amp;&amp; code != '201'){
	requestStatus = "OK";
}
else{
	requestStatus = "FAILED"
}
// get request call information to log.
HashMap&lt;String,String> properties = messageExchange.getProperties();
def parameterJson = [:];
properties.each{ key,value ->
  parameterJson[(key)] = value;
  }
parameterString = parameterJson.toMapString()
def timeTaken = messageExchange.getTimeTaken();
def testStepName = context.testCase.getTestStepAt(context.getCurrentStepIndex()).getLabel();
def securityTestName = context.getCurrentScan().getParent().getName();
def scan = context.getCurrentScan().getName();

if(context.INDEX == null){
	context.INDEX = 0;
}
context.INDEX = context.INDEX + 1;
KEY = securityTestName + "_" + testStepName + "_" + scan;
context.JsonContent &lt;&lt; [(KEY): [(context.INDEX): ["request": reqBody, "response": response, "timeTaken": timeTaken.toString(), "parameters": parameterString, "changedFieldKey": context.changedParamsField, "changedFieldValue": context.changedParamsValue, "status": requestStatus]]]</scriptText>
              </con:configuration>
            </con:assertion>
            <con:testStep xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
            <con:checkedParameters xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:parameters label="payload" parameterName="Request" xpath="" checked="true"/>
            </con:checkedParameters>
            <con:executionStrategy xsi:nil="true" immutable="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:strategy>ONE_BY_ONE</con:strategy>
              <con:delay>100</con:delay>
            </con:executionStrategy>
          </con:testStepSecurityScan>
        </con:testStepSecurityTest>
        <con:properties/>
      </con:securityTest>
    </con:testCase>
    <con:properties/>
  </con:testSuite>
  <con:properties>
    <con:property>
      <con:name>environment</con:name>
      <con:value>nightly</con:value>
    </con:property>
    <con:property>
      <con:name>execution_group</con:name>
      <con:value>regression</con:value>
    </con:property>
    <con:property>
      <con:name>responseSLA</con:name>
      <con:value>3000</con:value>
    </con:property>
    <con:property>
      <con:name>endpoint</con:name>
      <con:value>promotion-engine-api.crm-nightly-new.cc.capillarytech.com</con:value>
    </con:property>
    <con:property>
      <con:name>orgid</con:name>
      <con:value>50371</con:value>
    </con:property>
    <con:property>
      <con:name>tillid</con:name>
      <con:value>50022820</con:value>
    </con:property>
    <con:property>
      <con:name>store</con:name>
      <con:value>50022813</con:value>
    </con:property>
    <con:property>
      <con:name>token</con:name>
      <con:value>Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpZCI6WyIxNDc4MyJdLCJvcmdJRCI6MCwiZXhwIjoxNjE2MTUxODI4LCJpYXQiOjE2MTYwNjU0MzAsImlzcyI6ImNhcGlsbGFyeXRlY2guY29tIiwiYXVkIjoiY2FwaWxsYXJ5LGludG91Y2gsYXJ5YSxyZW9uLGFwcHMiLCJzb3VyY2UiOiJXRUJBUFAifQ.qT9sKH48-sJ2XRbhreay6nkF-CnNVIf-H6WJxO6fpbo</con:value>
    </con:property>
    <con:property>
      <con:name>externalEndpoint</con:name>
      <con:value>crm-nightly-new.cc.capillarytech.com/api_gateway</con:value>
    </con:property>
    <con:property>
      <con:name>authorization</con:name>
      <con:value>Basic bHVjaWF1dG9fdGlsbF8xMDoyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==</con:value>
    </con:property>
    <con:property>
      <con:name>sku</con:name>
      <con:value>Red1</con:value>
    </con:property>
    <con:property>
      <con:name>brand</con:name>
      <con:value>Brand1</con:value>
    </con:property>
    <con:property>
      <con:name>category</con:name>
      <con:value>category_1</con:value>
    </con:property>
    <con:property>
      <con:name>customerid</con:name>
      <con:value>10</con:value>
    </con:property>
  </con:properties>
  <con:wssContainer/>
  <con:oAuth2ProfileContainer/>
  <con:oAuth1ProfileContainer/>
  <con:beforeRunScript>import groovy.json.JsonSlurper
import java.io.FileInputStream;

////////////////////// Functions /////////////////////////

def filterList(commaSperatedListContent){
	def list = commaSperatedListContent.split(",");
	def filteredList = [];
	list.each(){
	def entry = it.toLowerCase().replaceAll("^\\s+", "");
	entry = entry.trim();
	if(entry != ""){
	filteredList.add(entry);}
	}
	return filteredList;
}

def customListCompare(list1,list2){
	//list1 is the list of tags that are given by user to execute.
	//list2 is the list of tags for specific test suite.
	boolean isRunnable = false;
	for(int l1 in 0 .. list1.size()-1)
	{
		def inputTag = list1.get(l1);
		for(int l2 in 0 .. list2.size()-1){

			if(inputTag.toString() == list2.get(l2).toString()){
				isRunnable =  true;
				break;
			}
		}
		if(isRunnable){
			break;
		}
	}
	return isRunnable;
}
///////////////////// Function //////////////////////////////////////////////


// connect to json data file based on environment specified.
String environment = context.expand('${#Project#environment}');

String project_dir = context.expand('${projectDir}');
String filepath = project_dir + File.separator + "test_data" + File.separator + project.name + File.separator + environment + ".json";
log.info environment
try{
//File data_file = new File(filepath);
def reader = new BufferedReader(new InputStreamReader(new FileInputStream(filepath),"UTF-8"))

def json = new JsonSlurper().parse(reader);

def endpoint = json.endpoint;
def orgId = json.orgId;
def externalEndpoint = json.externalEndpoint;
def responseSLA = json.responseSLA;
def store = json.store;
def authorization = json.authorization;
def tillid = json.tillid;
def sku = json.sku;
def brand = json.brand;
def category = json.category;

project.setPropertyValue("endpoint",endpoint);
project.setPropertyValue("orgid",orgId);
project.setPropertyValue("externalEndpoint",externalEndpoint);
project.setPropertyValue("tillid",tillid);
project.setPropertyValue("responseSLA",responseSLA);
project.setPropertyValue("store",store);
project.setPropertyValue("authorization",authorization);
project.setPropertyValue("sku",sku);
project.setPropertyValue("brand",brand);
project.setPropertyValue("category",category);
}
catch(Exception e){
	log.info("Could not find the data file " + filepath + " Please check the data file. error == " + e.getMessage());
	assert(false)
}


// Selecting the test suites to run based on the group.

String executionGroups = project.getPropertyValue("execution_group")
def filteredTags = filterList(executionGroups) ;

def Conf_input = "";

log.info "Reading the Configuration file.....";

try{

Conf_input = new File(project_dir + "/test_data/" + project.getName() + "/TestData.xml");

def parser = new XmlParser(); //Get XML Parser.

def Configuration = parser.parse(Conf_input);//Point parser to configration file.

context.Configuration = Configuration;

}
catch(Exception e){
		assert false : "Error in reading configuration file -- " + e.getMessage();
}

def testSuiteListToExecute = [];

log.info "Fetching Test-Scenarios to execute....";

def testSuites = project.getTestSuiteList();

//Enable all TestSuites.
for(j in 0 .. testSuites.size()-1){
	//log.info testSuites.get(j).getName();
	testSuites.get(j).setDisabled(false);
}
//Decide which test suites to execute and eventually disabled the non-relevant test suites.
		for(i in 0 .. testSuites.size()-1) {
   			def testSuiteName = testSuites.get(i).getName();
   			def tags = context.Configuration.TestSuite."${testSuiteName}".tags.text()
   			def testSuiteTags = filterList(tags);

   			if(filteredTags == null || filteredTags.empty){
   				break;
   			}
   			else{
   				if(testSuiteTags == null || testSuiteTags.empty){
   					testSuites.get(i).setDisabled(true);
   				}
   				else{
   					def isRunnable = customListCompare(filteredTags,testSuiteTags);
   					log.info testSuiteName+":::"+isRunnable
   					if(!isRunnable){
   						testSuites.get(i).setDisabled(true);
   					}
   				}
   			}

		}</con:beforeRunScript>
  <con:sensitiveInformation/>
</con:soapui-project>