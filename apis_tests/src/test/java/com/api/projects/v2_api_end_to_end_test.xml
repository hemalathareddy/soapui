<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project id="cb40d130-0486-4f5f-8093-9bd80b5e44b6" activeEnvironment="Default" name="v2_api_end_to_end_test" resourceRoot="" soapui-version="5.6.0" abortOnError="false" runType="SEQUENTIAL" defaultScriptLanguage="Groovy" xmlns:con="http://eviware.com/soapui/config">
  <con:settings/>
  <con:interface xsi:type="con:RestService" id="f83c5208-a573-4edc-b9ee-e1dbc68b757a" wadlVersion="http://wadl.dev.java.net/2009/02" name="customer_add" type="rest" definitionUrl="http" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    
    <con:definitionCache type="TEXT"/><con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
      <con:endpoint>https://nightly.capillary.in</con:endpoint>
    </con:endpoints>
    <con:resource name="add" path="/{version}/customer/add" id="962fdae1-7460-4dac-92cd-004cf38d476e">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>version</con:name>
          <con:value>version</con:value>
          <con:style>TEMPLATE</con:style>
          <con:default>version</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>{format}</con:value>
          <con:style>QUERY</con:style>
          <con:default>{format}</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="4b908cfb-b824-41e5-bec9-c1a7718b59d8" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "6706295457",
        "email": "6706295457@gmail.com",

        "firstname": "ng_test",
        "lastname": "g_test",
        "gender": "F",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			},
        "custom_fields": {
          "field": [
            {
              "name": "Hobbies",
              "value": "[“Fitness”]"
            },
            {
              "name": "a",
              "value": "[“b”]"
            }
          ]
        }

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="e04fff62-3e0e-4387-8dfd-0b7ac5b37a3c" wadlVersion="http://wadl.dev.java.net/2009/02" name="getEventLogs" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT" rootPart=""/>
    <con:endpoints>
      <con:endpoint>http://nightly.capillary.in</con:endpoint>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="{req_id}" path="/{version}/webHooks/eventLog/requestId/{request_id}" id="f75ff369-9710-4e54-b790-297750bfb3bd">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>version</con:name>
          <con:value>v3</con:value>
          <con:style>TEMPLATE</con:style>
          <con:default>v3</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>request_id</con:name>
          <con:value/>
          <con:style>TEMPLATE</con:style>
          <con:default/>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="f9db9900-9406-472a-8d8c-0eaf603590c1" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:representation type="FAULT">
          <con:mediaType>application/json;charset=ISO-8859-1</con:mediaType>
          <con:status>401</con:status>
          <con:params/>
          <con:element xmlns:d0b="https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa">d0b:Fault</con:element>
        </con:representation>
        <con:representation type="RESPONSE">
          <con:mediaType>application/json;charset=UTF-8</con:mediaType>
          <con:status>200</con:status>
          <con:params/>
          <con:element xmlns:d0b="https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa">d0b:Response</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType>application/json</con:mediaType>
          <con:status>404</con:status>
          <con:params/>
          <con:element xmlns:d0b="https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa">d0b:Fault</con:element>
        </con:representation>
        <con:request name="Request 1" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request/>
          <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="version" value="v3"/>
            <con:entry key="request_id" value=""/>
          </con:parameters>
          <con:parameterOrder>
            <con:entry>version</con:entry>
            <con:entry>request_id</con:entry>
          </con:parameterOrder>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="356e75ca-0be2-4ebd-b5dd-fd47a09c8647" wadlVersion="http://wadl.dev.java.net/2009/02" name="webhook" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache/>
    <con:endpoints>
      <con:endpoint>http://${#Project#webhook_workspace}</con:endpoint>
      <con:endpoint>http://enqovte5kgmv6a1.m.pipedream.net/</con:endpoint>
    </con:endpoints>
    <con:resource name="events" path="/api/events" id="016d33c5-439b-45fa-a767-71ab5a57370b">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>request_id</con:name>
          <con:value>9f54fb7a-aa1d-430d-a1b3-d5dca350fd29</con:value>
          <con:style>QUERY</con:style>
          <con:default>9f54fb7a-aa1d-430d-a1b3-d5dca350fd29</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="74e87b38-4211-4367-8ebf-50a19028d74b" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="34ead1d1-1594-4ef4-9ce9-40c691346b9e" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"/>
  &lt;con:entry key="User-Agent" value="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>http://${#Project#webhook_workspace}</con:endpoint>
          <con:request/>
          <con:originalUri>https://enlvdydwm08ks.x.pipedream.net/api/events</con:originalUri>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="3212de9c-e2cb-49ed-9b76-075cbc718ca7" wadlVersion="http://wadl.dev.java.net/2009/02" name="getWebhooks" type="rest" definitionUrl="http" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="webHooks" path="/{version}/webHooks" id="0e2aa914-1d7d-478d-a249-2ce7557bf37d">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>version</con:name>
          <con:value>version</con:value>
          <con:style>TEMPLATE</con:style>
          <con:default>version</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="c466a5b3-508f-4df5-9b1a-100b5435fc49" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="e34c812d-806e-498b-adbd-323081eda9a6" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request/>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="3d786918-f43a-4f2b-bc6e-f1345cc7752c" wadlVersion="http://wadl.dev.java.net/2009/02" name="getCustomerV2" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="{user_id}" path="/v2/customers/{user_id}" id="2e7ea798-f565-4a0e-956f-4f6b84ee913a">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>user_id</con:name>
          <con:value>user_id</con:value>
          <con:style>TEMPLATE</con:style>
          <con:default>user_id</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>source</con:name>
          <con:value>ALL</con:value>
          <con:style>QUERY</con:style>
          <con:default>ALL</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>accountId</con:name>
          <con:value/>
          <con:style>QUERY</con:style>
          <con:default/>
        </con:parameter>
        <con:parameter>
          <con:name>embed</con:name>
          <con:value>mlp</con:value>
          <con:style>QUERY</con:style>
          <con:default>mlp</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="8d8691dc-6a53-48c4-8c2c-bcaf4d7bf7ee" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="35a353eb-1756-4e37-83f8-d8c4a290f0aa" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request/>
          <con:originalUri>https://nightly.capillary.in/v2/customers/376790377</con:originalUri>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <entry key="user_id" value="376790377" xmlns="http://eviware.com/soapui/config"/>
          </con:parameters>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="0568445a-36d0-42b5-9933-89df50b53456" wadlVersion="http://wadl.dev.java.net/2009/02" name="addRegularTransaction" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="add" path="/v1.1/transaction/add" id="dee9310e-99b0-48cf-acb7-ec04400c84c4">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="7d818094-4183-4839-b179-0eab76edf758" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="30d7b033-bada-4cf6-abdf-781b858869dc" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
	"root": {
		"transaction": {
			"bill_client_id": "1121888",
			"type": "regular",
			"number": "BILL_6935391507",
			"notes": "2 lin1e items",
			"amount" : 50000,
			"gross_amount": "100",
			"discount": "10",
			"customer": {
				"mobile": "6935391507",
				"email": "6935391507@gmail.com",
				"external_id": "x6935391507",
				"firstname": "Nayan",
				"lastname": "Gaur"
			},
			"extended_fields": {
				"field": [{
						"name": "ship_first_name",
						"value": "Nayan"
					},
					{
						"name": "ship_last_name",
						"value": "Gaur"
					}
				]
			},
			"payment_details": {
				"payment": [{
						"mode": "CASH",
						"value": "100"
					},
					{
						"mode": [
							"CREDIT",
							"CHECKAPI"
						],
						"value": [
							"4000",
							"500"
						],
						"attributes": {
							"attribute": [{
									"name": "BankNameAPI",
									"value": "value_602656"
								},
								{
									"name": "branch_nameAPI",
									"value": "value_602656"
								}
							]
						},
						"notes": "notes_602656"
					}
				]
			},
			"custom_fields": {

				"field": [{
						"name": "bankdetails",
						"value": "SBI"
					},
					{
						"name": "bankdetails",
						"value": "SBI"
					}
				]

			},
			"line_items": {
				"line_item": [{
						"extended_fields": {
							"field": [{
									"name": "MetalRate",
									"value": 23
								},
								{
									"name": "service_tax_amount",
									"value": 100
								}
							]
						},
						"serial": "1",
						"amount": "500",
						"description": "soap",
						"item_code": "item-001",
						"qty": "50",
						"rate": "10",
						"value": "500",
						"attributes": {
							"attribute": {
								"name": "brand",
								"value": "Levis"
							}
						}
					},
					{
						"extended_fields": {
							"field": [{
									"name": "DesignCode",
									"value": "jmh6677"
								},
								{
									"name": "SupplierCode",
									"value": "hgjy111"
								}
							]
						},
						"serial": "2",
						"amount": "500",
						"description": "soap",
						"item_code": "item-001",
						"qty": "50",
						"rate": "10",
						"value": "500",
						"transaction_number": "niBill1",
						"attributes": {
							"attribute": {
								"name": "brand",
								"value": "Levis"
							}
						}
					},
					{
						"extended_fields": {
							"field": [{
									"name": "StoneCharge",
									"value": 22
								},
								{
									"name": "MakingCharge",
									"value": 11
								}
							]
						},
						"serial": "3",
						"item_code": "t122",
						"description": "afvdfvd",
						"qty": "3",
						"rate": "1000",
						"value": "3000",
						"discount_value": "100",
						"amount": "2900",
						"cashier_id": "cash1233",
						"type": "return",
						"return_type": "LINE_ITEM",
						"transaction_number": "previousBill1"
					}
				]
			},
			"associate_details": {
				"code": "hiraxdhara",
				"name": "Tom Sawyer"
			}
		}
	}
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/transaction/add</con:originalUri>
          <con:credentials>
            <con:username>cm.1</con:username>
            <con:password>202cb962ac59075b964b07152d234b70</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="9188fa72-d4ca-4799-b0ec-81d98303a349" wadlVersion="http://wadl.dev.java.net/2009/02" name="isRedeemable" type="rest" definitionUrl="http" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="isredeemable" path="/{version}/points/isredeemable" id="fd2cf47e-cfde-48da-8593-244b9da11944">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>version</con:name>
          <con:value>version</con:value>
          <con:style>TEMPLATE</con:style>
          <con:default>version</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>points</con:name>
          <con:value>{points}</con:value>
          <con:style>QUERY</con:style>
          <con:default>{points}</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>skip_validation</con:name>
          <con:value>true</con:value>
          <con:style>QUERY</con:style>
          <con:default>true</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>mobile</con:name>
          <con:value>{mobile}</con:value>
          <con:style>QUERY</con:style>
          <con:default>{mobile}</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>program_id</con:name>
          <con:style>QUERY</con:style>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="d951de00-4eb0-48cb-b9c6-a53e5d8c10d2" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="7324ca5d-555c-46eb-892f-02a744545f27" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request/>
          <con:originalUri>https://nightly.capillary.in/version/points/isredeemable</con:originalUri>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="mobile" value="7456470100"/>
            <con:entry key="version" value="v1.1"/>
            <con:entry key="points" value="50"/>
          </con:parameters>
          <con:parameterOrder>
            <con:entry>version</con:entry>
            <con:entry>format</con:entry>
            <con:entry>points</con:entry>
            <con:entry>skip_validation</con:entry>
            <con:entry>mobile</con:entry>
            <con:entry>program_id</con:entry>
          </con:parameterOrder>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="01393347-1433-435e-8d4d-c02b4f1ad97c" wadlVersion="http://wadl.dev.java.net/2009/02" name="RedeemPoints" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="redeem" path="/{version}/points/redeem" id="8778912a-bb63-423f-abdb-89c51359fb8a">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>version</con:name>
          <con:value>version</con:value>
          <con:style>TEMPLATE</con:style>
          <con:default>version</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>program_id</con:name>
          <con:value>{program_id}</con:value>
          <con:style>QUERY</con:style>
          <con:default>{program_id}</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="68dcceb8-9b58-4693-aee2-f6c101bb4f24" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="0c6d7d87-8bdb-450b-b683-a4bcddcec72c" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "redeem": {
      "points_redeemed": "50",
      "transaction_number": "1234r743",
      "customer": { "mobile": "91712292522" },
      "notes": "Sample notes",
      "validation_code": "7S8VH7"
    }
  }
}</con:request>
          <con:credentials>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="program_id" value="1231"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="1486e61e-cd35-4606-b74b-5c6406abb01d" wadlVersion="http://wadl.dev.java.net/2009/02" name="getCustomerV1" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="get" path="/v1.1/customer/get" id="5e983fb5-e4dc-456e-bead-4a470764829c">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>id</con:name>
          <con:value>{user_id}</con:value>
          <con:style>QUERY</con:style>
          <con:default>{user_id}</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>mlp</con:name>
          <con:value>true</con:value>
          <con:style>QUERY</con:style>
          <con:default>true</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="700e2ddf-a659-4042-8dd9-8df792a13bc5" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="fffb4960-10e1-4ff0-982b-f7255dbe25c3" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="X-CAP-CLIENT-COUNTRYCODE" value="1" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request/>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/get</con:originalUri>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <entry key="id" value="378087418" xmlns="http://eviware.com/soapui/config"/>
          </con:parameters>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="fcc704d4-06ce-4de6-a1d4-738180ea26c5" wadlVersion="http://wadl.dev.java.net/2009/02" name="issueCoupon" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="issue" path="/v1.1/coupon/issue" id="9f92e04a-5c5b-45d0-9712-e7ddabfa844a">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>user_id</con:name>
          <con:value>true</con:value>
          <con:style>QUERY</con:style>
          <con:default>true</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="e262157b-ca9f-474a-989a-793e74b49680" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="757eb83a-f2f8-4b87-82bf-8545223dbbc2" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
   "root":{
      "coupon":[
         {
            "series_id":87618,
            "customer":{
               "mobile":"919090080344",
               "external_id":null,
               "email":null
            }
         }
      ]
   }
}</con:request>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="f5fc346f-3e9a-4165-8448-f6ce2cb69fdc" wadlVersion="http://wadl.dev.java.net/2009/02" name="RedeemCoupon" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="redeem" path="/v1.1/coupon/redeem" id="3c7e403a-9272-4ba1-8b24-5b3368163cea">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="84d1ca8a-673f-4398-becf-64469fbc920f" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="ff5fa5db-d484-4866-bf48-2ed0a1b8e3c1" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "coupon": [{
      "code": "{{code}}",
      "redemption_time": "2017-09-17",
      "customer": {
        "mobile": "{{mobile1}}"
      },
      "custom_fields": {
        "field": {
          "name": "Sport",
          "value": "[“Soccer”]"
        }
      },
      "transaction": {
        "number":"{{billNumber}}",
        "amount": "1000"
      }
    }]
  }
}</con:request>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="7bd5e296-824e-4279-98ff-8dada1ff92fa" wadlVersion="http://wadl.dev.java.net/2009/02" name="isCouponRedeemable" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="isredeemable" path="/v1.1/coupon/isredeemable" id="de8547f9-9386-4efc-9c1b-dfd3166e43ed">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>details</con:name>
          <con:value>true</con:value>
          <con:style>QUERY</con:style>
          <con:default>true</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>code</con:name>
          <con:value>{coupon_code}</con:value>
          <con:style>QUERY</con:style>
          <con:default>{coupon_code}</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>mobile</con:name>
          <con:value>{mobile}</con:value>
          <con:style>QUERY</con:style>
          <con:default>{mobile}</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="b60256fa-2b15-4f09-b4ae-5879f86d7367" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="2065919b-04a9-42cd-b6be-b621d97e53d4" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request/>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="216dc5d8-4532-4e16-8aeb-831bca39e6a2" wadlVersion="http://wadl.dev.java.net/2009/02" name="getCouponSeries" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="series" path="/v1.1/coupon/series" id="e058e844-1c81-4c0a-a43e-9b09bc11e8b9">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="ace9d9a8-eb6f-4a05-93c9-aeab31251bb9" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="4f9fddd5-ff27-468f-9305-ddb2ae83c9ed" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request/>
          <con:originalUri>https://nightly.capillary.in/v1.1/coupon/series</con:originalUri>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="2f59ebc7-7862-4705-9aa4-5f205643a0a9" wadlVersion="http://wadl.dev.java.net/2009/02" name="getCustomerCoupons" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="coupons" path="/v1.1/customer/coupons" id="cc3aad53-0998-4733-8201-36512ac5b31d">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>mobile</con:name>
          <con:value>{mobile}</con:value>
          <con:style>QUERY</con:style>
          <con:default>{mobile}</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="d2677551-7e84-4275-919c-5a8d19151251" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="a83c3c0e-7af3-4d6d-b7d5-76c317dee5b5" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request/>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="1d167895-41a8-4013-9475-73ed873bd3c3" wadlVersion="http://wadl.dev.java.net/2009/02" name="getCouponDetails" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    
    <con:definitionCache type="TEXT"/><con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="get" path="/v1.1/coupon/get" id="d32d3221-3fbb-4a67-b286-63f03fe45387">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>code</con:name>
          <con:value>{code}</con:value>
          <con:style>QUERY</con:style>
          <con:default>{code}</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="52be3e16-8714-40c2-9998-1f35b6bdea81" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="b20f21c7-d621-4e58-b18d-b146a4c66139" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="content-type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request/>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="79c18da1-2f79-4030-afc0-ed75ca661831" wadlVersion="http://wadl.dev.java.net/2009/02" name="PointsTransfer" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    
    <con:definitionCache type="TEXT"/><con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="transfer" path="/v2/points/transfer" id="1b7a9c33-0ba0-4701-bc78-0a9dc67059f4">
      <con:settings/>
      <con:parameters/>
      <con:method name="Method 1" id="8289658d-5f36-41be-b41d-11faa4c89d19" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="66016c4b-99ca-4eff-8f1e-3c10187c0c22" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "transferredAtStoreCode": "string",
  "transferredAtStoreID": 0,
  "pointsTobeTransferred": 0,
  "fromCustomerIdentifier": {
    "type": "MOBILE",
    "value": "string"
  },
  "toCustomerIdentifier": {
    "type": "MOBILE",
    "value": "string"
  },
  "notes": "string",
  "code": "string",
  "groupProgramTransfer": false
}</con:request>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="5d90c9b2-daf9-4655-a09e-994747cdb1f8" wadlVersion="http://wadl.dev.java.net/2009/02" name="isPointsTransferable" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="isTransferrable" path="/v2/points/isTransferrable" id="3ca0226e-f428-4441-a805-a91854c831dd">
      <con:settings/>
      <con:parameters/>
      <con:method name="Method 1" id="dfeed04d-66e9-4cc3-9eb9-d4a7141b8e6e" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="0dcc0e21-afd7-4862-838c-ca8bcaeadc75" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
    "issueOtp": true,
    "pointsTobeTransferred": 1.1,
    "toCustomerIdentifier": {
        "type": "MOBILE",
        "value": "917709142209"
    },
    "fromCustomerIdentifier": {
        "type": "MOBILE",
        "value": "917332628259"
    }
}</con:request>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="f9e0c80e-598d-49ef-98ac-f19bbcb4f1fd" wadlVersion="http://wadl.dev.java.net/2009/02" name="returnRegularTransaction" type="rest" definitionUrl="htts" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="add" path="/v1.1/transaction/add" id="1121e52b-c3e8-463f-b2c2-471c7de88da4">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="fb853c35-7bdf-448a-ab98-231c2b4a0fcf" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="77cded7f-7736-4732-bd83-29e42c30f628" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="content-type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
	"root": {
		"transaction": {
			"type": "return",
			"bill_client_id": "wd221123333",
			"customer": {
				"firstname": "Rati",
				"lastname": "Ranjan",
				"email": "{{mobile1}}@mil.com",
				"mobile": "{{mobile1}}",
				"external_id": "X{{mobile1}}"
			},
			"transaction_number": "7u78118",
			"amount": "1000",
			"notes": "bill with note",
			"line_items": {
				"line_item": {
					"extended_fields": {
						"field": [{
								"name": "MetalRate",
								"value": 23
							},
							{
								"name": "MetalWeight",
								"value": 200
							}
						]
					},
					"serial": "0",
					"item_code": "t122",
					"description": "afvdfvd",
					"qty": "3",
					"rate": "1000",
					"value": "3000",
					"discount_value": "100",
					"amount": "8888",
					"cashier_id": "cash1233"
				}
			},
			"extended_fields": {
				"field": [{
						"name": "CentralGST",
						"value": 6
					},
					{
						"name": "StateGST",
						"value": 6
					}
				]
			},
			"payment_details": {
				"payment": {
					"mode": "CASH",
					"value": "100"
				}
			},
			"custom_fields": {
				"field": {
					"-name": "paymentmode",
					"value": "现金"
				}
			},
			"associate_details": {
				"code": "223232",
				"name": "afdf4r3"
			},
			"referral_code": "efef34343",
			"return_type": "FULL"
		}
	}
}</con:request>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="a2f3d0d0-8309-4edf-a0bd-969e38e4bb55" wadlVersion="http://wadl.dev.java.net/2009/02" name="updateOrgConfig" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="configs" path="/{version}/organization/configs" id="72004983-e818-4dff-9903-7a8ef1da5c14">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>version</con:name>
          <con:value>version</con:value>
          <con:style>TEMPLATE</con:style>
          <con:default>version</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>xml</con:value>
          <con:style>QUERY</con:style>
          <con:default>xml</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="3828eaaf-55d7-41c7-9c90-8277cd469974" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="9ae77cbf-a340-43f2-9a3b-e6cd9213c773" mediaType="application/xml" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>- no endpoint set -</con:endpoint>
          <con:request><![CDATA[<root>
     <organization>
             <configs>
                     <config>
                             <name>CONF_LOYALTY_POINTS_REDEMPTION_LIFETIME_PURCHASE_MIN</name>
                             <scope>ORG</scope>
                             <value>0</value>
                            <entity_id>null</entity_id>
                     </config>
             </configs>
     </organization>
</root>]]></con:request>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <entry key="version" value="v1.1" xmlns="http://eviware.com/soapui/config"/>
          </con:parameters>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="58906dd6-573e-4ca1-97d8-6660624d4ecd" wadlVersion="http://wadl.dev.java.net/2009/02" name="triggerCustomEvent" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#custom_events_webhook}</con:endpoint>
    </con:endpoints>
    <con:resource name="1b35496e-4126-4242-be3e-20f624766b67" path="" id="298f4f66-d3fe-4f25-bbf4-b8bbcf2e3706">
      <con:settings/>
      <con:parameters/>
      <con:method name="Method 1" id="bc2ab0db-9295-4bdf-ae1e-788c2302c95b" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="f773dd65-36e5-4368-91df-2c4c620e83d1" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="content-type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#custom_events_webhook}</con:endpoint>
          <con:request>{"Mobile":"918733645468",
"Name":"stringxxx",
"Till":"alpha_endtoend_test",
"event_name":"AlphaEndToEnd"}</con:request>
          <con:originalUri>https://8mo7zxjtj0.execute-api.us-east-1.amazonaws.com/onenightly/webhooks/1b35496e-4126-4242-be3e-20f624766b67</con:originalUri>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="a691791f-99a2-4ace-9f16-fb0574a1ef08" wadlVersion="http://wadl.dev.java.net/2009/02" name="rp" type="rest" definitionUrl="reportPortal" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache/>
    <con:endpoints/>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="3186c19b-6360-4b1c-8f2f-4cfff7c274a8" wadlVersion="http://wadl.dev.java.net/2009/02" name="transactionV2" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart=""/><con:endpoints/><con:resource name="TransactionV2" path="/v2/transactions" id="187b6fa6-1ac5-4ba0-bb45-b58f077ab189"><con:settings/><con:parameters><con:parameter><con:name>source</con:name><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>accountId</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>identifierName</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>identifierValue</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:description xsi:nil="true"/></con:parameter></con:parameters><con:method name="RegularTransactionV2" id="4747df0e-d20d-47ef-b051-a3bd997f6a57" method="POST"><con:settings/><con:parameters/><con:representation type="RESPONSE"><con:mediaType>application/json; charset=UTF-8</con:mediaType><con:status>201</con:status><con:params/><con:element xmlns:tran="https://crm-nightly-new.cc.capillarytech.com/v2/transactions">tran:Response</con:element></con:representation><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="FAULT"><con:mediaType>application/json; charset=UTF-8</con:mediaType><con:status>500</con:status><con:params/><con:element xmlns:tran="https://crm-nightly-new.cc.capillarytech.com/v2/transactions">tran:Fault</con:element></con:representation><con:request name="Request 1" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
   },
  "customFields": {
    "paymentmode": "abc"
  },
  "lineItemsV2": [
    {
      "itemCode": "sku_1",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="${#TestCase#identifierName}"/>
  <con:entry key="accountId" value="${#TestCase#accountId}"/>
  <con:entry key="identifierValue" value="${#TestCase#identifierName}"/>
  <con:entry key="source" value="${#TestCase#source}"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:request></con:method></con:resource></con:interface><con:interface xsi:type="con:RestService" id="a4193412-f71d-4db9-89ce-516efb2e8e5e" wadlVersion="http://wadl.dev.java.net/2009/02" name="transactionV2Get" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart=""/><con:endpoints/><con:resource name="TransactionV2Get" path="/v2/transactions/${#TestCase#transactionId}/" id="313611d2-0dec-4684-a312-da6f4d337ea0"><con:settings/><con:parameters><con:parameter><con:name>type</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>tender</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:description xsi:nil="true"/></con:parameter></con:parameters><con:method name="RegularTransactionV2Get" id="6c661f8a-21c1-402f-8e1d-1b571060bab0" method="GET"><con:settings/><con:parameters/><con:representation type="RESPONSE"><con:mediaType>application/json; charset=UTF-8</con:mediaType><con:status>200</con:status><con:params/></con:representation><con:representation type="FAULT"><con:mediaType>application/xml; charset=UTF-8</con:mediaType><con:status>400</con:status><con:params/><con:element>data</con:element></con:representation><con:request name="Request 1" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:request></con:method></con:resource></con:interface><con:interface xsi:type="con:RestService" id="76fc71c9-f1ed-42da-ba71-0769dd585fb3" wadlVersion="http://wadl.dev.java.net/2009/02" name="configUpdateV2" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache/><con:endpoints/><con:resource name="ConfigUpdateV2" path="/v2/organization/configs" id="318bd976-6e31-457d-8fb7-c18d832fda73"><con:settings/><con:parameters/><con:method name="ConfigUpdateV2 1" id="b3ec708b-ee6c-4607-9973-9993a34e169a" method="POST"><con:settings/><con:parameters/><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json; charset=UTF-8</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:con1="https://crm-nightly-new.cc.capillarytech.com/v2/organization/configs">con1:Response</con:element></con:representation><con:request name="Request 1" id="e3cefe23-84eb-48b5-831b-51768ec2fb4d" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "keyName": "CONF_LOYALTY_IS_BILL_NUMBER_UNIQUE",
  "scope": "ORG",
  "value": "1"
}</con:request><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:request></con:method></con:resource></con:interface><con:interface xsi:type="con:RestService" id="59abda01-d73e-4ff3-87ce-37975cfde2bc" wadlVersion="http://wadl.dev.java.net/2009/02" name="customerV2" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart=""/><con:endpoints/><con:resource name="CustomerV2" path="/v2/customers" id="cffcbe56-117f-4f3a-8ab4-aaf3638c7738"><con:settings/><con:parameters/><con:method name="CustomerV2Add" id="44da5fcb-4e38-4cdf-a456-fdcf7c548da7" method="POST"><con:settings/><con:parameters/><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json; charset=UTF-8</con:mediaType><con:status>201</con:status><con:params/><con:element xmlns:cus="https://crm-nightly-new.cc.capillarytech.com/v2/customers">cus:Response</con:element></con:representation><con:request name="Request 1" id="8758edb4-9fcb-467d-8a7b-16d3c4685745" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint} ${#Project#auth_username}</con:endpoint><con:request>{
  "profiles": [{
    "firstName": "Capillary",
    "lastName": "Customer",
    "identifiers": [{
      "type": "mobile",
      "value": "${#TestCase#mobile}"
    },
{
      "type": "email",
      "value": "${#TestCase#mobile}@email.com"
    },
{
      "type": "externalId",
      "value": "x${#TestCase#mobile}"
    },
{
      "type": "cuid",
      "value": "cuid_${#TestCase#mobile}"
    },
    {
      "type": "unionId",
      "value": "unionId_${#TestCase#mobile}"
    }
   ],
    "commChannels": [{
      "type": "mobile",
      "value": "${#TestCase#mobile}",
      "primary": true,
      "verified": true
    }, {
      "type": "email",
      "value": "${#TestCase#mobile}@mail.com",
      "primary": true,
      "verified": true
    }],
    "source": "${#TestCase#source}",
    "accountId": "${#TestCase#accountId}"
  }],
  "loyaltyInfo": {
    "loyaltyType": "loyalty"
  },
  "referralCode": ""
}</con:request><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method></con:resource></con:interface><con:interface xsi:type="con:RestService" id="3c23b037-2bb0-4e14-94ee-3c9da2355aaa" wadlVersion="http://wadl.dev.java.net/2009/02" name="getOrgSourceV2" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart=""/><con:endpoints/><con:resource name="GetOrgSourceV2" path="/v2/org/${#Project#orgId}/sources" id="e9056708-b127-4619-a537-3250c18ee0de"><con:settings/><con:parameters><con:parameter><con:name>details</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>source_name</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:description xsi:nil="true"/></con:parameter></con:parameters><con:method name="GetOrgSourceV2 1" id="bf71346b-99d3-4519-b524-c4a267b6c455" method="GET"><con:settings/><con:parameters/><con:representation type="FAULT"><con:mediaType>application/json; charset=UTF-8</con:mediaType><con:status>404</con:status><con:params/><con:element xmlns:sour="https://crm-nightly-new.cc.capillarytech.com/v2/50660/sources">sour:Fault</con:element></con:representation><con:request name="Request 1" id="618dc494-e15e-4021-84c4-6c1df0be8d08" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Accept" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="details" value="true"/>
  <con:entry key="source_name" value="${#TestCase#source}"/>
</con:parameters><con:parameterOrder><con:entry>details</con:entry><con:entry>source_name</con:entry></con:parameterOrder></con:request></con:method></con:resource></con:interface><con:interface xsi:type="con:RestService" id="8f4e2b58-e0ea-48a2-9500-4ead4d282970" wadlVersion="http://wadl.dev.java.net/2009/02" name="addProductAttribute" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache/><con:endpoints/><con:resource name="AddProductAttribute" path="/v1.1/product/attributes" id="ae4d008e-eb2a-4eda-abd2-3bc5d1a0aa80"><con:settings/><con:parameters><con:parameter><con:name>format</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:description xsi:nil="true"/></con:parameter></con:parameters><con:method name="AddProductAttribute 1" id="5bd3cd1f-d138-4472-b430-fd34810bb890" method="POST"><con:settings/><con:parameters/><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json;charset=UTF-8</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:att="https://crm-nightly-new.cc.capillarytech.com/v1.1/product/attributes">att:Response</con:element></con:representation><con:request name="Request 1" id="ff509996-e17f-4d67-b646-f33359fd8bbd" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "root": {
    "product": [
      {
        "attributes": {
          "attribute": {
            "default_attribute_value_name": "",
            "extraction_rule_data": "",
            "type": "String",
            "is_enum": "0",
            "label": "${#TestCase#attribute_lable}",
            "name": "${#TestCase#attribute_name}",
            "use_in_dump": "1",
            "extraction_rule_type": "POS",
            "is_soft_enum": "0"
          }
        }
      }
    ]
  }
}</con:request><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="format" value="json" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>format</con:entry></con:parameterOrder></con:request></con:method></con:resource></con:interface><con:interface xsi:type="con:RestService" id="a64bec28-0af7-49a3-84f5-6135df31a19f" wadlVersion="http://wadl.dev.java.net/2009/02" name="addProductV1,1" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache/><con:endpoints/><con:resource name="AddProduct" path="/v1.1/product/add?" id="d71e25c2-c151-4e93-928b-8df131b29064"><con:settings/><con:parameters><con:parameter><con:name>format</con:name><con:value/><con:style>QUERY</con:style><con:default/><con:description xsi:nil="true"/></con:parameter></con:parameters><con:method name="AddProductWithSampleAttribute" id="abb231b0-80b4-4dc9-9267-dd5549c2a6e3" method="POST"><con:settings/><con:parameters/><con:request name="AddProductWithSampleAttribute" id="496f7dba-befe-4bf3-81ff-9fc42df683b8" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "root": {
    "product": [
      {
        "price": "1000",
        "description": "description_${#TestCase#sku}",
        "img_url": "",
        "sku": "${#TestCase#sku}",
        "attributes": {
          "attribute": [
            {
              "name": "color",
              "value": "black"
            },
            {
              "name": "size",
              "value": "small"
            }
          ]
        },
        "ean":  "${#TestCase#sku}"
      }
    ]
  }
}</con:request><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="format" value="json" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>format</con:entry></con:parameterOrder></con:request></con:method><con:method name="AddProductWithoutAttribute" id="abb231b0-80b4-4dc9-9267-dd5549c2a6e3" method="POST"><con:settings/><con:parameters/><con:representation type="RESPONSE"><con:mediaType>application/json; charset=utf-8</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:add="https://crm-nightly-new.cc.capillarytech.com/v1.1/product/add">add:Response</con:element></con:representation><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:request name="AddProductWithSampleAttribute" id="496f7dba-befe-4bf3-81ff-9fc42df683b8" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "root": {
    "product": [
      {
        "price": "1000",
        "description": "description_${#TestCase#sku}",
        "img_url": "",
        "sku": "${#TestCase#sku}",
        "ean":  "${#TestCase#sku}"
      }
    ]
  }
}</con:request><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="format" value="json" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>format</con:entry></con:parameterOrder></con:request></con:method></con:resource></con:interface><con:testSuite id="617b1441-f979-4855-baef-f5bc9610b80c" name="Reusable API">
    <con:settings>
      <con:setting id="com.eviware.soapui.impl.wsdl.panels.testcase.JTestRunLog$OptionsForm@max_rows">1000</con:setting>
      <con:setting id="com.eviware.soapui.impl.wsdl.panels.testcase.JTestRunLog$OptionsForm@errors_only">false</con:setting>
    </con:settings>
    <con:runType>PARALLELL</con:runType>
    <con:testCase id="a6919450-66f2-417f-9891-60d4219922a2" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TransactionAdd" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="get txn numer" id="ebafad87-9920-45df-a6d0-64a324a881a2">
        <con:settings/>
        <con:config>
          <script>String timestamp = System.currentTimeMillis().toString()
log.info timestamp
testRunner.testCase.setPropertyValue("tnx_number",timestamp);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="get current date and time" id="022d35e4-b48a-4ff3-afa8-fdccd2adeb35">
        <con:settings/>
        <con:config>
          <script>def getcurrent = Calendar.getInstance()
String current_time = getcurrent.format("yyyy-MM-dd HH:mm:ss");
testRunner.testCase.testSuite.setPropertyValue("current_time",current_time);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="get phone number" id="e2d7ab90-5188-4717-be44-f6c409db964c">
        <con:settings/>
        <con:config>
          <script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
testRunner.testCase.setPropertyValue("mobile","919" + mobile);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="addTransaction" id="dc6dd2e1-ece2-4167-9d0e-390ca93e8be6">
        <con:settings/>
        <con:config service="addRegularTransaction" resourcePath="/v1.1/transaction/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="addTransaction" id="30d7b033-bada-4cf6-abdf-781b858869dc" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "transaction": {
      "type": "regular",
      "number": "${#TestCase#tnx_number}",
      "amount": "1200",
      "billing_time": "${#TestSuite#current_time}",
      "gross_amount": "101",
      "redemptions": {
        "points_redemptions": {

        },
        "coupon_redemptions": {

        }
      },
      "customer": {
        "mobile": "${#TestCase#mobile}",
        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",
        "type": "loyalty"
      },
      "custom_fields": {
        "field": {
          "name": "testcustom",
          "value": "test"
        }
      },
      "extended_fields": {
        "field": {
          "name": "CentralGST",
          "value": "98"
        }
      },
      "line_items": {
        "line_item": [
          {
            "attributes": {
              "attribute": {
                "name": "jeans",
                "value": "jeans"
              }
            },
            "serial": "1",
            "amount": "500",
            "description": "White",
            "item_code": "Pearls",
            "qty": "20",
            "rate": "50",
            "value": "1000",
            "discount": "0",
            "notes": "Return type of a line item with full"
          },
          {
            "attributes": {
              "attribute": {
                "name": "jeans",
                "value": "jeans"
              }
            },
            "serial": "2",
            "amount": "500",
            "description": "Extra",
            "item_code": "Extra",
            "qty": "10",
            "rate": "50",
            "value": "500",
            "discount": "0",
            "notes": "Return type of a line item with full"
          },
          {
            "attributes": {
              "attribute": {
                "name": "jeans",
                "value": "jeans"
              }
            },
            "serial": "3",
            "amount": "700",
            "description": "Extra",
            "item_code": "Extra",
            "qty": "1",
            "rate": "700",
            "value": "700",
            "discount": "0",
            "notes": "Return type of a line item with full"
          }
        ]
      }
    }
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/transaction/add</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="e6f1b9ef-b7b8-4fc0-b402-4192ca816b85" name="Verfiy add transaction response">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


String mob = context.expand('${#TestCase#mobile}')
String tnxNumber = context.expand('${#TestCase#tnx_number}')

// Get customer point info before the tnx.


//get transaction details
String tnxID = json.response.transactions.transaction.id[0].toString();
String billNumber = json.response.transactions.transaction.number[0].toString();
String type = json.response.transactions.transaction.type[0].toString();

assert(billNumber == tnxNumber);
messageExchange.modelItem.testCase.setPropertyValue("tnxID",tnxID);


//get customer details.

String user_id = json.response.transactions.transaction.customer[0].user_id.toString();
messageExchange.modelItem.testCase.setPropertyValue("user_id",user_id);
String mobile = json.response.transactions.transaction.customer[0].mobile.toString();
assert(mobile == mob);
messageExchange.modelItem.testCase.setPropertyValue("tnx_mobile",mobile);
String fname = json.response.transactions.transaction.customer[0].firstname.toString();
assert(fname == "fname_" + mob);
String lname = json.response.transactions.transaction.customer[0].lastname.toString();
assert(lname == "lname_" + mob);
String email = json.response.transactions.transaction.customer[0].email.toString();
assert(email == mob + "@gmail.com")

String awarded_points = json.response.transactions.transaction.side_effects[0].effect.awarded_points[0].toString();
String totalPoints = json.response.transactions.transaction.side_effects[0].effect.total_points[0].toString();

messageExchange.modelItem.testCase.setPropertyValue("awarded_points_afterTnx",awarded_points);

messageExchange.modelItem.testCase.setPropertyValue("totalPoints_afterTnx",totalPoints);



//Item status.
assert(json.response.transactions.transaction.item_status[0].success == "true")
assert(json.response.transactions.transaction.item_status[0].code == 600)
String msg = json.response.transactions.transaction.item_status[0].message;
if(msg.toLowerCase() == "transaction added successfully"){
	assert true;
}
else{
	assert false : "Getting message as - " + msg;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Valid HTTP Status Codes" id="190ad7c6-4b58-4bce-a46d-8f3e1521b68c" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:preemptive>false</con:preemptive>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>tnx_number</con:name>
          <con:value>1591618396257</con:value>
        </con:property>
        <con:property>
          <con:name>tnxID</con:name>
          <con:value>38261500</con:value>
        </con:property>
        <con:property>
          <con:name>user_id</con:name>
          <con:value>379085721</con:value>
        </con:property>
        <con:property>
          <con:name>mobile</con:name>
          <con:value>919618396262</con:value>
        </con:property>
        <con:property>
          <con:name>awarded_points_afterTnx</con:name>
          <con:value>500</con:value>
        </con:property>
        <con:property>
          <con:name>totalPoints_afterTnx</con:name>
          <con:value>500</con:value>
        </con:property>
        <con:property>
          <con:name>pointBalance_afterTnx</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>tnx_mobile</con:name>
          <con:value>919618396262</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="e2f222e7-9e9d-4be0-926a-e697dbefc4f6" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TransactionAddForNonDefaultProgram" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="get txn number" id="3256e6ff-bbd0-4566-bd53-e8f859eab140">
        <con:settings/>
        <con:config>
          <script>String timestamp = System.currentTimeMillis().toString()
testRunner.testCase.setPropertyValue("tnx_number",timestamp);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="get current date and time" id="a0053fb7-9bd0-42a4-96cc-bc04b2057922">
        <con:settings/>
        <con:config>
          <script>def getcurrent = Calendar.getInstance()
String current_time = getcurrent.format("yyyy-MM-dd HH:mm:ss");
testRunner.testCase.setPropertyValue("current_time",current_time);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="addTransactionFromNonDefaultTill" id="af3b04be-ed8e-4f6e-ad7c-d003098990cc">
        <con:settings/>
        <con:config service="addRegularTransaction" resourcePath="/v1.1/transaction/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="addTransactionFromNonDefaultTill" id="30d7b033-bada-4cf6-abdf-781b858869dc" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "transaction": {
      "type": "regular",
      "number": "${#TestCase#tnx_number}",
      "amount": "1200",
      "billing_time": "${#TestCase#current_time}",
      "gross_amount": "101",
      "redemptions": {
        "points_redemptions": {
          
        },
        "coupon_redemptions": {
          
        }
      },
      "customer": {
        "mobile": "${#TestCase#mobilNuberFromCalledFunction}",
        "firstname": "fname_${#TestCase#mobilNuberFromCalledFunction}",
        "lastname": "lname_${#TestCase#mobilNuberFromCalledFunction}",
        "email": "${#TestCase#mobilNuberFromCalledFunction}@gmail.com",
        "type": "loyalty"
      },
      "custom_fields": {
        "field": {
          "name": "testcustom",
          "value": "test"
        }
      },
      "extended_fields": {
        "field": {
          "name": "CentralGST",
          "value": "98"
        }
      },
      "line_items": {
        "line_item": [
          {
            "attributes": {
              "attribute": {
                "name": "jeans",
                "value": "jeans"
              }
            },
            "serial": "1",
            "amount": "500",
            "description": "White",
            "item_code": "Pearls",
            "qty": "20",
            "rate": "50",
            "value": "1000",
            "discount": "0",
            "notes": "Return type of a line item with full"
          },
          {
            "attributes": {
              "attribute": {
                "name": "jeans",
                "value": "jeans"
              }
            },
            "serial": "2",
            "amount": "500",
            "description": "Extra",
            "item_code": "Extra",
            "qty": "10",
            "rate": "50",
            "value": "500",
            "discount": "0",
            "notes": "Return type of a line item with full"
          },
          {
            "attributes": {
              "attribute": {
                "name": "jeans",
                "value": "jeans"
              }
            },
            "serial": "3",
            "amount": "700",
            "description": "Extra",
            "item_code": "Extra",
            "qty": "1",
            "rate": "700",
            "value": "700",
            "discount": "0",
            "notes": "Return type of a line item with full"
          }
        ]
      }
    }
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/transaction/add</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="493f8172-1390-4d91-a9ac-f26069a2fb58" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ad2f17d6-a168-47ca-a0de-8db6e0276f68" name="Validate non default response">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


String mob = context.expand('${#TestCase#mobilNuberFromCalledFunction}')
String tnxNumber = context.expand('${#TestCase#tnx_number}')

// Get customer point info before the tnx.


//get transaction details
String tnxID = json.response.transactions.transaction.id[0].toString();
String billNumber = json.response.transactions.transaction.number[0].toString();
String type = json.response.transactions.transaction.type[0].toString();

assert(billNumber == tnxNumber);
messageExchange.modelItem.testCase.setPropertyValue("non_default_tnxID",tnxID);
messageExchange.modelItem.testCase.setPropertyValue("non_default_tnx_number",billNumber);


//get customer details.

String user_id = json.response.transactions.transaction.customer[0].user_id.toString();
messageExchange.modelItem.testCase.setPropertyValue("non_default_tnx_user_id",user_id);
String mobile = json.response.transactions.transaction.customer[0].mobile.toString();
assert(mobile == mob);
messageExchange.modelItem.testCase.setPropertyValue("non_default_tnx_mobile",mobile);
String fname = json.response.transactions.transaction.customer[0].firstname.toString();
assert(fname == "fname_" + mob);
String lname = json.response.transactions.transaction.customer[0].lastname.toString();
assert(lname == "lname_" + mob);
String email = json.response.transactions.transaction.customer[0].email.toString();
assert(email == mob + "@gmail.com")

String lifetime_points = json.response.transactions.transaction.customer[0].lifetime_points.toString();
String totalPoints = json.response.transactions.transaction.customer[0].loyalty_points.toString();

messageExchange.modelItem.testCase.setPropertyValue("non_default_tnx_awarded_points_afterTnx",lifetime_points);

messageExchange.modelItem.testCase.setPropertyValue("non_default_tnx_totalPoints_afterTnx",totalPoints);



//Item status.
assert(json.response.transactions.transaction.item_status[0].success == "true")
assert(json.response.transactions.transaction.item_status[0].code == 600)
String msg = json.response.transactions.transaction.item_status[0].message;
if(msg.toLowerCase() == "transaction added successfully"){
	assert true;
}
else{
	assert false : "Getting message as - " + msg;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#TestCase#non_default_auth_username}</con:username>
              <con:password>${#TestCase#non_default_auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>mobilNuberFromCalledFunction</con:name>
          <con:value>919736268900</con:value>
        </con:property>
        <con:property>
          <con:name>non_default_auth_username</con:name>
          <con:value>alpha_endtoend_test</con:value>
        </con:property>
        <con:property>
          <con:name>non_default_auth_password</con:name>
          <con:value>202cb962ac59075b964b07152d234b70</con:value>
        </con:property>
        <con:property>
          <con:name>tnx_number</con:name>
          <con:value>1590736272947</con:value>
        </con:property>
        <con:property>
          <con:name>current_time</con:name>
          <con:value>2020-05-29 12:41:12</con:value>
        </con:property>
        <con:property>
          <con:name>tnxID</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>user_id</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>non_default_tnxID</con:name>
          <con:value>38260737</con:value>
        </con:property>
        <con:property>
          <con:name>non_default_tnx_user_id</con:name>
          <con:value>379076669</con:value>
        </con:property>
        <con:property>
          <con:name>non_default_tnx_mobile</con:name>
          <con:value>919736268900</con:value>
        </con:property>
        <con:property>
          <con:name>non_default_tnx_awarded_points_afterTnx</con:name>
          <con:value>880</con:value>
        </con:property>
        <con:property>
          <con:name>non_default_tnx_totalPoints_afterTnx</con:name>
          <con:value>880</con:value>
        </con:property>
        <con:property>
          <con:name>non_default_tnx_number</con:name>
          <con:value>1590736272947</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="23925634-f0eb-426a-a829-a89cf00cdd78" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="RegisterNewCustomer" searchProperties="true">
      <con:settings/>
      <con:properties/>
    </con:testCase>
    <con:testCase id="3cf1272c-75fe-4493-9076-2485a03c0d25" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="UpdateOrgConfig" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="UpdateOrgConfig" id="de758856-f321-460c-86a1-7e0bf3b010af"><con:settings/><con:config service="configUpdateV2" resourcePath="/v2/organization/configs" methodName="ConfigUpdateV2 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="UpdateOrgConfig" id="e3cefe23-84eb-48b5-831b-51768ec2fb4d" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "keyName": "${#TestCase#config_name}",
  "scope": "ORG",
  "value": "${#TestCase#config_value}"
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/organization/configs</con:originalUri><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/><con:parameterOrder/></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>config_name</con:name><con:value>MARK_BILLS_OUTLIER_STARTING_WITH</con:value></con:property><con:property><con:name>config_value</con:name><con:value>TEST</con:value></con:property></con:properties></con:testCase><con:testCase id="6e71980a-ee7a-45cb-8ad1-b70abf867847" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="AddNewProductAttribute" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="addProductAttribute" id="8d33aa81-e838-476b-9582-d8b088bcfb9d"><con:settings/><con:config service="addProductAttribute" resourcePath="/v1.1/product/attributes" methodName="AddProductAttribute 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="addProductAttribute" id="ff509996-e17f-4d67-b646-f33359fd8bbd" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "root": {
    "product": [
      {
        "attributes": {
          "attribute": {
            "default_attribute_value_name": "",
            "extraction_rule_data": "",
            "type": "String",
            "is_enum": "0",
            "label": "${#TestCase#attribute_lable}",
            "name": "${#TestCase#attribute_name}",
            "use_in_dump": "1",
            "extraction_rule_type": "POS",
            "is_soft_enum": "0"
          }
        }
      }
    ]
  }
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v1.1/product/attributes</con:originalUri><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="format" value="json" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>format</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>attribute_lable</con:name><con:value>color</con:value></con:property><con:property><con:name>attribute_name</con:name><con:value>color</con:value></con:property></con:properties></con:testCase><con:testCase id="58e007b6-6c23-43d4-9736-d38127b6d94e" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="AddProduct" searchProperties="true"><con:settings/><con:testStep type="restrequest" name="addProductWithoutAttribute" id="4d89b165-7c98-493d-a932-27f04c90a8d1"><con:settings/><con:config service="addProductV1,1" resourcePath="/v1.1/product/add?" methodName="AddProductWithoutAttribute" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="addProductWithoutAttribute" id="496f7dba-befe-4bf3-81ff-9fc42df683b8" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "root": {
    "product": [
      {
        "price": "1000",
        "description": "description_${#TestCase#sku}",
        "img_url": "",
        "sku": "${#TestCase#sku}",
        "ean":  "${#TestCase#sku}",
        "returnable" : true,
        "returnable_days" : "10"
      }
    ]
  }
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v1.1/product/add</con:originalUri><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="format" value="json" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>format</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>sku</con:name><con:value>sku_689948198</con:value></con:property></con:properties></con:testCase><con:properties>
      <con:property>
        <con:name>mobile</con:name>
        <con:value>8767496655</con:value>
      </con:property>
      <con:property>
        <con:name>current_time</con:name>
        <con:value>2020-06-08 17:43:16</con:value>
      </con:property>
    </con:properties>
  </con:testSuite>
  
  
  
  <con:testSuite id="d8888b94-0ad8-44f1-acb7-3706881c7c7e" name="V2.0_AddRegularTransaction"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="98ea33f6-f7da-405d-a03b-a0628aaf67f4" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Scenario : Verify adding a valid regular transaction with transaction v2.0 api" searchProperties="true"><con:settings/><con:testStep type="groovy" name="generaeVariables" id="3afd66a3-3705-459b-9986-96fbf87c3d5f"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","bill" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="restrequest" name="CustomerAddV1" id="3eee4c67-a974-44cf-aa6b-2fd7bc6d1d93"><con:settings/><con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="CustomerAddV1" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:assertion type="GroovyScriptAssertion" id="f2b95d6f-6d65-41b7-8cba-d71f02e9768d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.response.customers.customer[0].user_id
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="regularTransactionv2" id="28023b39-af24-4b5e-bef2-21a62c4980fa"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="regularTransactionv2" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
   },
  "customFields": {
    "paymentmode": "abc"
  },
  "lineItemsV2": [
    {
      "itemCode": "sku_1",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
assert json.sideEffects[0].rawAwardedPoints==20
assert json.sideEffects[0].awardedPoints==20
assert json.sideEffects[0].type=="points"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="transactionV2Get" id="814f1325-d7a4-4405-a7cb-253e8dc738c3"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="transactionV2Get" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 200;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields[0] == null

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "NORMAL"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 1

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == "sku_1";
	assert lineItems[i].details.qty == 1;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == -1;
	assert lineItems[i].details.attributes[0] == null ;
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0] == null;
	assert lineItems[i].outlierStatus == "NORMAL";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].addonDetails[0] == null
	assert lineItems[i].splitItemsDetails[0] == null
	assert lineItems[i].niReturn == false
	
	
	
	
	
}





log.info lineItems.size()</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147656385</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373610213</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919687332246</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill687332246</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-04-29T14:38:52+05:30</con:value></con:property></con:properties></con:testCase><con:testCase id="569bb6ea-faf3-4750-83d4-936961cf170b" failOnError="false" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="VerifyErrorMessageonDuplicateTransaction" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword=""><con:settings/><con:testStep type="groovy" name="generateVariables" id="26636266-63d3-4add-a74d-5afc9c53ee66"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","bill" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="groovy" name="UpdateConfig_CONF_LOYALTY_IS_BILL_NUMBER_UNIQUE_1" id="c5c722c7-e48c-4eb2-aa2e-a0df9194800a"><con:settings/><con:config><script>config_name = "CONF_LOYALTY_IS_BILL_NUMBER_UNIQUE";
confi_value = "1"
def suitRef=testRunner.testCase.testSuite.project.testSuites["Reusable API"];
def testcaseRef = suitRef.testCases["UpdateOrgConfig"];

//set UpdateOrgConfig test cases property 
testcaseRef.setPropertyValue("config_name",config_name);
testcaseRef.setPropertyValue("config_value",confi_value);

//run UpdateOrgConfig test cases property 
def resuableTestStep = testcaseRef.testSteps["UpdateOrgConfig"]


def runner = testcaseRef.run(null, true)
log.info ("runner status ....... : " + runner.getStatus())

</script></con:config></con:testStep><con:testStep type="restrequest" name="CustomerAddV1" id="84c48ad1-a899-4689-a04f-6c4e8e9a6d66"><con:settings/><con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="CustomerAddV1" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:assertion type="GroovyScriptAssertion" id="f2b95d6f-6d65-41b7-8cba-d71f02e9768d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.response.customers.customer[0].user_id
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="regularTransactionv2" id="fedcf3d9-6579-4b93-948a-1b372b7e09dc"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="regularTransactionv2" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
   },
  "customFields": {
    "paymentmode": "abc"
  },
  "lineItemsV2": [
    {
      "itemCode": "sku_1",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
assert json.sideEffects[0].rawAwardedPoints==20
assert json.sideEffects[0].awardedPoints==20
assert json.sideEffects[0].type=="points"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="transactionV2Get" id="f9c2b60e-a747-4a46-b52d-f0a8f6298513"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="transactionV2Get" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 200;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields[0] == null

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "NORMAL"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 1

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == "sku_1";
	assert lineItems[i].details.qty == 1;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == -1;
	assert lineItems[i].details.attributes[0] == null ;
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0] == null;
	assert lineItems[i].outlierStatus == "NORMAL";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].addonDetails[0] == null
	assert lineItems[i].splitItemsDetails[0] == null
	assert lineItems[i].niReturn == false
	
	
	
	
	
}





log.info lineItems.size()</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="AddRegularTransactionv2WithSameBillNumber" id="88b7bbe2-fdfb-4b2a-ac0d-05449a7b0670"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="AddRegularTransactionv2WithSameBillNumber" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestSuite#billnumber}",
  "billingDate": "${#TestSuite#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
   },
  "customFields": {
    "paymentmode": "abc"
  },
  "lineItemsV2": [
    {
      "itemCode": "sku_1",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


assert json.warnings[0] == null
assert json.errors[0].status==false
assert json.errors[0].code==604
assert json.errors[0].message=="Duplicate transaction number"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="UpdateConfig_CONF_LOYALTY_IS_BILL_NUMBER_UNIQUE_0" id="458218a9-3eb9-4d77-8501-a9d739c5f2e6"><con:settings/><con:config><script>config_name = "CONF_LOYALTY_IS_BILL_NUMBER_UNIQUE";
confi_value = "0"
def suitRef=testRunner.testCase.testSuite.project.testSuites["Reusable API"];
def testcaseRef = suitRef.testCases["UpdateOrgConfig"];

//set UpdateOrgConfig test cases property 
testcaseRef.setPropertyValue("config_name",config_name);
testcaseRef.setPropertyValue("config_value",confi_value);

//run UpdateOrgConfig test cases property 
def resuableTestStep = testcaseRef.testSteps["UpdateOrgConfig"]


def runner = testcaseRef.run(null, true)
log.info ("runner status ....... : " + runner.getStatus())

</script></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147654507</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373607219</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919618343944</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill618343944</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-04-28T19:29:03+05:30</con:value></con:property></con:properties></con:testCase><con:testCase id="a3d70f34-5f6a-499e-ba41-d6230b2ee444" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="AddAValidRegularTransactionWithWechatCustomer" searchProperties="true"><con:settings/><con:testStep type="groovy" name="generateVariables" id="36f002e0-6675-474e-af60-b16488d1cc42"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","bill" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="groovy" name="setPropertyVariable" id="222847e0-aa6d-412b-8b3a-1171a13d7af0"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("source","WECHAT");
testRunner.testCase.setPropertyValue("identifierName","mobile");
testRunner.testCase.setPropertyValue("identifierValue",'${#TestCase#mobile}');
</script></con:config></con:testStep><con:testStep type="restrequest" name="getAccountidForOrgSourceWechat" id="221dcd54-b532-4564-8002-a5052f5aa2c2"><con:settings/><con:config service="getOrgSourceV2" resourcePath="/v2/org/${#Project#orgId}/sources" methodName="GetOrgSourceV2 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="getAccountidForOrgSourceWechat" id="618dc494-e15e-4021-84c4-6c1df0be8d08" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Accept" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/org/50660/sources</con:originalUri><con:assertion type="GroovyScriptAssertion" id="489132e5-af12-48fc-87c7-1acee2187d58" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

accountId= json.data[0].sourceAccountIdentifier
log.info "Fetched AccountId for Source : "+accountId

messageExchange.modelItem.testCase.setPropertyValue("accountId",accountId);</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="details" value="true"/>
  <con:entry key="source_name" value="${#TestCase#source}"/>
</con:parameters><con:parameterOrder><con:entry>details</con:entry><con:entry>source_name</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="CustomerAddV2" id="d9b3e6d5-0ead-4ed9-b9c5-4f731e28cbf4"><con:settings/><con:config service="customerV2" resourcePath="/v2/customers" methodName="CustomerV2Add" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="CustomerAddV2" id="8758edb4-9fcb-467d-8a7b-16d3c4685745" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "profiles": [{
    "firstName": "Capillary",
    "lastName": "Customer",
    "identifiers": [{
      "type": "mobile",
      "value": "${#TestCase#mobile}"
    },
{
      "type": "email",
      "value": "${#TestCase#mobile}@email.com"
    },
{
      "type": "externalId",
      "value": "x${#TestCase#mobile}"
    },
{
      "type": "cuid",
      "value": "cuid_${#TestCase#mobile}"
    },
    {
      "type": "unionId",
      "value": "unionId_${#TestCase#mobile}"
    }
   ],
    "commChannels": [{
      "type": "mobile",
      "value": "${#TestCase#mobile}",
      "primary": true,
      "verified": true
    }, {
      "type": "email",
      "value": "${#TestCase#mobile}@mail.com",
      "primary": true,
      "verified": true
    }],
    "source": "WECHAT",
    "accountId": "WECHAT-APIAUTO"
  }],
  "loyaltyInfo": {
    "loyaltyType": "loyalty"
  },
  "referralCode": ""
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/customers</con:originalUri><con:assertion type="GroovyScriptAssertion" id="654e0e2a-b5ff-4dd2-9b90-56f2448a668d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.createdId
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="AddRegularTransaction" id="83fd61e8-6281-46b0-95c4-c1cb7d9b28ac"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="AddRegularTransaction" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
   },
  "customFields": {
    "paymentmode": "abc"
  },
  "lineItemsV2": [
    {
      "itemCode": "sku_1",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="ccfdc791-f143-4134-ac00-feac0715c544" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
assert json.sideEffects[0].rawAwardedPoints==20
assert json.sideEffects[0].awardedPoints==20
assert json.sideEffects[0].type=="points"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="${#TestCase#identifierName}"/>
  <con:entry key="accountId" value="${#TestCase#accountId}"/>
  <con:entry key="identifierValue" value="${#TestCase#identifierValue}"/>
  <con:entry key="source" value="${#TestCase#source}"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="transactionV2Get" id="a2fd436e-a33a-4154-8927-af70eea0a949"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="transactionV2Get" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 200;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields[0] == null

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "NORMAL"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 1

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == "sku_1";
	assert lineItems[i].details.qty == 1;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == -1;
	assert lineItems[i].details.attributes[0] == null ;
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0] == null;
	assert lineItems[i].outlierStatus == "NORMAL";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].addonDetails[0] == null
	assert lineItems[i].splitItemsDetails[0] == null
	assert lineItems[i].niReturn == false
	
	
	
	
	
}





log.info lineItems.size()</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147640561</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373583991</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919999471398</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill999471398</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-04-21T15:34:31+05:30</con:value></con:property><con:property><con:name>source</con:name><con:value>WECHAT</con:value></con:property><con:property><con:name>accountId</con:name><con:value>WECHAT-APIAUTO</con:value></con:property><con:property><con:name>identifierName</con:name><con:value>mobile</con:value></con:property><con:property><con:name>identifierValue</con:name><con:value>${#TestCase#mobile}</con:value></con:property></con:properties></con:testCase><con:testCase id="bfbf098c-42d9-4f4a-9869-49c400d93cab" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="AddValidRegularTransactionForWEB_ENGAGECustomer" searchProperties="true"><con:settings/><con:testStep type="groovy" name="generateVariables" id="3994d8ee-21d7-4e19-9f03-b26ad674ac40"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","bill" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="groovy" name="setPropertyVariable" id="7055547b-f527-4ebb-b224-9abcf3b65986"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("source","WEB_ENGAGE");
testRunner.testCase.setPropertyValue("identifierName","mobile");
testRunner.testCase.setPropertyValue("identifierValue",'${#TestCase#mobile}');
</script></con:config></con:testStep><con:testStep type="restrequest" name="getAccountidForOrgSourceWechat" id="2cd33cb3-e694-4801-8db0-75c8eef73fe3"><con:settings/><con:config service="getOrgSourceV2" resourcePath="/v2/org/${#Project#orgId}/sources" methodName="GetOrgSourceV2 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="getAccountidForOrgSourceWechat" id="618dc494-e15e-4021-84c4-6c1df0be8d08" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Accept" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/org/50660/sources</con:originalUri><con:assertion type="GroovyScriptAssertion" id="489132e5-af12-48fc-87c7-1acee2187d58" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

accountId= json.data[0].sourceAccountIdentifier
log.info "Fetched AccountId for Source : "+accountId

messageExchange.modelItem.testCase.setPropertyValue("accountId",accountId);</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="details" value="true"/>
  <con:entry key="source_name" value="${#TestCase#source}"/>
</con:parameters><con:parameterOrder><con:entry>details</con:entry><con:entry>source_name</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="CustomerAddV2" id="79f4de80-f32c-474b-82c9-b7e663a9b077"><con:settings/><con:config service="customerV2" resourcePath="/v2/customers" methodName="CustomerV2Add" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="CustomerAddV2" id="8758edb4-9fcb-467d-8a7b-16d3c4685745" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "profiles": [{
    "firstName": "Capillary",
    "lastName": "Customer",
    "identifiers": [{
      "type": "mobile",
      "value": "${#TestCase#mobile}"
    },
{
      "type": "email",
      "value": "${#TestCase#mobile}@email.com"
    },
{
      "type": "externalId",
      "value": "x${#TestCase#mobile}"
    },
{
      "type": "cuid",
      "value": "cuid_${#TestCase#mobile}"
    },
    {
      "type": "unionId",
      "value": "unionId_${#TestCase#mobile}"
    }
   ],
    "commChannels": [{
      "type": "mobile",
      "value": "${#TestCase#mobile}",
      "primary": true,
      "verified": true
    }, {
      "type": "email",
      "value": "${#TestCase#mobile}@mail.com",
      "primary": true,
      "verified": true
    }],
    "source": "${#TestCase#source}",
    "accountId": "${#TestCase#accountId}"
  }],
  "loyaltyInfo": {
    "loyaltyType": "loyalty"
  },
  "referralCode": ""
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/customers</con:originalUri><con:assertion type="GroovyScriptAssertion" id="654e0e2a-b5ff-4dd2-9b90-56f2448a668d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.createdId
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="AddRegularTransaction" id="00f6c597-2424-4bf5-81e6-5dfc8f55a3ee"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="AddRegularTransaction" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
   },
  "customFields": {
    "paymentmode": "abc"
  },
  "lineItemsV2": [
    {
      "itemCode": "sku_1",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="ccfdc791-f143-4134-ac00-feac0715c544" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
assert json.sideEffects[0].rawAwardedPoints==20
assert json.sideEffects[0].awardedPoints==20
assert json.sideEffects[0].type=="points"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="${#TestCase#identifierName}"/>
  <con:entry key="accountId" value="${#TestCase#accountId}"/>
  <con:entry key="identifierValue" value="${#TestCase#identifierValue}"/>
  <con:entry key="source" value="${#TestCase#source}"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="transactionV2Get" id="c08b899b-c5f4-430f-a70f-d6145c83aabd"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="transactionV2Get" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 200;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields[0] == null

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "NORMAL"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 1

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == "sku_1";
	assert lineItems[i].details.qty == 1;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == -1;
	assert lineItems[i].details.attributes[0] == null ;
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0] == null;
	assert lineItems[i].outlierStatus == "NORMAL";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].addonDetails[0] == null
	assert lineItems[i].splitItemsDetails[0] == null
	assert lineItems[i].niReturn == false
	
	
	
	
	
}





log.info lineItems.size()</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147640562</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373583992</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919999474904</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill999474904</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-04-21T15:34:34+05:30</con:value></con:property><con:property><con:name>source</con:name><con:value>WEB_ENGAGE</con:value></con:property><con:property><con:name>accountId</con:name><con:value>WEBENGAGE-APIAUTO</con:value></con:property><con:property><con:name>identifierName</con:name><con:value>mobile</con:value></con:property><con:property><con:name>identifierValue</con:name><con:value>${#TestCase#mobile}</con:value></con:property></con:properties></con:testCase><con:testCase id="10adc688-762e-4a8c-91ac-ea4ef9a9d4ae" failOnError="false" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="VerifyErrorMessageOnAddingRegularTransactionWithoutNotRegisterCustomer" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword=""><con:settings/><con:testStep type="groovy" name="generaeVariables" id="7aee199c-384a-42be-b851-e6e7c1303822"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","bill" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="restrequest" name="regularTransactionv2" id="74811024-0a78-47c2-8e20-cace0ae0e61d"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="regularTransactionv2" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
   },
  "customFields": {
    "paymentmode": "abc"
  },
  "lineItemsV2": [
    {
      "itemCode": "sku_1",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


assert json.warnings[0] == null
assert json.errors[0].status==false
assert json.errors[0].code==8015
assert json.errors[0].message=="Customer not found for the given identifiers"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>null</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373580930</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919999478366</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill999478366</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-04-21T15:34:38+05:30</con:value></con:property></con:properties></con:testCase><con:testCase id="0b7f9494-5623-4887-8ee7-80e36ad4f723" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="VerifyErrorMessageForTransactionWithInvalidType" searchProperties="true"><con:settings/><con:testStep type="groovy" name="generaeVariables" id="e12240c6-7892-4f56-a911-7fbc32db57fb"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","bill" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="restrequest" name="CustomerAddV1" id="2c8a6190-2d15-4fbd-acb9-74911a910249"><con:settings/><con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="CustomerAddV1" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:assertion type="GroovyScriptAssertion" id="f2b95d6f-6d65-41b7-8cba-d71f02e9768d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.response.customers.customer[0].user_id
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="regularTransactionv2" id="2a3b39af-dc26-4978-b2a6-e72958eba946"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="regularTransactionv2" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "INVALID",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
   },
  "customFields": {
    "paymentmode": "abc"
  },
  "lineItemsV2": [
    {
      "itemCode": "sku_1",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


assert json.warnings[0] == null
assert json.errors[0].status==false
assert json.errors[0].code==605
assert json.errors[0].message=="Invalid transaction type passed Only regular,return,not_interested and not_interested_return supported"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>null</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373583993</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919999478925</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill999478925</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-04-21T15:34:38+05:30</con:value></con:property></con:properties></con:testCase><con:testCase id="1d121adf-2791-408a-8da6-15bb979a0b44" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="VerifyAddRegularTransactionForINSTORECustomerWhichHasMultipleSourceAccounts" searchProperties="true"><con:description>1-Add Customer With INSTORE profile
2-Add same customer with WECHAT profile , so that both the source will get Merged
3-Add regularTansactionV2 for INSTORE profile
4-Verify Transsaction Addedd Succesfully</con:description><con:settings/><con:testStep type="groovy" name="generateVariables" id="50e10aae-865b-4e5c-8ad4-c7583c6232a6"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","bill" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="groovy" name="setPropertyVariable" id="4c0c2d7c-c5e9-4776-8917-46252f95f60d"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("source","WECHAT");
testRunner.testCase.setPropertyValue("identifierName","mobile");
testRunner.testCase.setPropertyValue("identifierValue",'${#TestCase#mobile}');
</script></con:config></con:testStep><con:testStep type="restrequest" name="getAccountidForOrgSourceWechat" id="7d521840-6d03-4189-8134-a994dfccfadf"><con:settings/><con:config service="getOrgSourceV2" resourcePath="/v2/org/${#Project#orgId}/sources" methodName="GetOrgSourceV2 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="getAccountidForOrgSourceWechat" id="618dc494-e15e-4021-84c4-6c1df0be8d08" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Accept" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/org/50660/sources</con:originalUri><con:assertion type="GroovyScriptAssertion" id="489132e5-af12-48fc-87c7-1acee2187d58" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

accountId= json.data[0].sourceAccountIdentifier
log.info "Fetched AccountId for Source : "+accountId

messageExchange.modelItem.testCase.setPropertyValue("accountId",accountId);</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="details" value="true"/>
  <con:entry key="source_name" value="${#TestCase#source}"/>
</con:parameters><con:parameterOrder><con:entry>details</con:entry><con:entry>source_name</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="addCustomerV1.1WithMobileNUmber" id="d3174af1-1e52-49b4-9f81-8571148c8556"><con:settings/><con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="addCustomerV1.1WithMobileNUmber" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:assertion type="GroovyScriptAssertion" id="2c031551-badc-47b2-8e22-ce19c3f12182" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.response.customers.customer[0].user_id
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="CustomerAddV2WithSameMobile" id="2425f5ef-013d-43ae-a5c8-f2eba8768e22"><con:settings/><con:config service="customerV2" resourcePath="/v2/customers" methodName="CustomerV2Add" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="CustomerAddV2WithSameMobile" id="8758edb4-9fcb-467d-8a7b-16d3c4685745" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "profiles": [{
    "firstName": "Capillary",
    "lastName": "Customer",
    "identifiers": [{
      "type": "mobile",
      "value": "${#TestCase#mobile}"
    },
{
      "type": "email",
      "value": "${#TestCase#mobile}@email.com"
    },
{
      "type": "externalId",
      "value": "x${#TestCase#mobile}"
    },
{
      "type": "cuid",
      "value": "cuid_${#TestCase#mobile}"
    },
    {
      "type": "unionId",
      "value": "unionId_${#TestCase#mobile}"
    }
   ],
    "commChannels": [{
      "type": "mobile",
      "value": "${#TestCase#mobile}",
      "primary": true,
      "verified": true
    }, {
      "type": "email",
      "value": "${#TestCase#mobile}@mail.com",
      "primary": true,
      "verified": true
    }],
    "source": "WECHAT",
    "accountId": "WECHAT-APIAUTO"
  }],
  "loyaltyInfo": {
    "loyaltyType": "loyalty"
  },
  "referralCode": ""
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/customers</con:originalUri><con:assertion type="GroovyScriptAssertion" id="654e0e2a-b5ff-4dd2-9b90-56f2448a668d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.createdId
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="AddRegularTransaction" id="ab82c508-de92-4f7f-a6f9-0d0c3bbc6219"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="AddRegularTransaction" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
   },
  "customFields": {
    "paymentmode": "abc"
  },
  "lineItemsV2": [
    {
      "itemCode": "sku_1",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="ccfdc791-f143-4134-ac00-feac0715c544" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
assert json.sideEffects[0].rawAwardedPoints==20
assert json.sideEffects[0].awardedPoints==20
assert json.sideEffects[0].type=="points"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="${#TestCase#identifierName}"/>
  <con:entry key="identifierValue" value="${#TestCase#identifierValue}"/>
  <con:entry key="source" value="INSTORE"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="transactionV2Get" id="22db52dd-6eff-4082-8da6-2bf94cd68a6b"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="transactionV2Get" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 200;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields[0] == null

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "NORMAL"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 1

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == "sku_1";
	assert lineItems[i].details.qty == 1;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == -1;
	assert lineItems[i].details.attributes[0] == null ;
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0] == null;
	assert lineItems[i].outlierStatus == "NORMAL";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].addonDetails[0] == null
	assert lineItems[i].splitItemsDetails[0] == null
	assert lineItems[i].niReturn == false
	
	
	
	
	
}





log.info lineItems.size()</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147640563</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373583994</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919999481028</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill999481028</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-04-21T15:34:41+05:30</con:value></con:property><con:property><con:name>source</con:name><con:value>WECHAT</con:value></con:property><con:property><con:name>accountId</con:name><con:value>WECHAT-APIAUTO</con:value></con:property><con:property><con:name>identifierName</con:name><con:value>mobile</con:value></con:property><con:property><con:name>identifierValue</con:name><con:value>${#TestCase#mobile}</con:value></con:property></con:properties></con:testCase><con:testCase id="364069e9-f3d2-45af-a525-13beddf87cc5" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="VerifyAddAValiadRegularTransactionWithExtendedFieldAndCustomField" searchProperties="true"><con:description>1-Add regular transaction with customfield and extendedfield
2-Verify transaction extended field and custom field in transactionget</con:description><con:settings/><con:testStep type="groovy" name="generaeVariables" id="be7900a7-3f6e-4ed0-aca6-447b2fad85f7"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","bill" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="restrequest" name="CustomerAddV1" id="f04999ed-39b2-48e8-8ef6-820530b02ae2"><con:settings/><con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="CustomerAddV1" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:assertion type="GroovyScriptAssertion" id="f2b95d6f-6d65-41b7-8cba-d71f02e9768d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.response.customers.customer[0].user_id
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="regularTransactionv2" id="59fd34fe-3e3b-4fbd-8021-8eaa4fc1dbde"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="regularTransactionv2" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
   },
  "customFields": {
    "tx_custom_field_one": "abc",
    "tx_custom_field_two": "xyz"
  },
  "lineItemsV2": [
    {
      "itemCode": "sku_1",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
assert json.sideEffects[0].rawAwardedPoints==20
assert json.sideEffects[0].awardedPoints==20
assert json.sideEffects[0].type=="points"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="transactionV2Get" id="25c30cc6-c41d-4fb5-92e8-a79e26f3270a"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="transactionV2Get" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 200;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields.tx_custom_field_one == "abc"
assert customFields.tx_custom_field_two == "xyz"

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "NORMAL"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 1

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == "sku_1";
	assert lineItems[i].details.qty == 1;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == -1;
	assert lineItems[i].details.attributes[0] == null ;
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0] == null;
	assert lineItems[i].outlierStatus == "NORMAL";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].addonDetails[0] == null
	assert lineItems[i].splitItemsDetails[0] == null
	assert lineItems[i].niReturn == false
	
	
	
	
	
}





log.info lineItems.size()</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147642601</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373587596</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919081565865</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill081565865</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-04-22T14:22:45+05:30</con:value></con:property></con:properties></con:testCase><con:testCase id="c83c2e4d-93ab-4e4d-b52d-6245d78d2c69" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="VerifyWarningMessageOnAddingAValiadRegularTransactionWithInvalidExtendedField" searchProperties="true"><con:description>1-Add regular transaction with invalid extendedfield
2-Verify transaction extended field and custom field in transactionget</con:description><con:settings/><con:testStep type="groovy" name="generaeVariables" id="9b31c703-d208-46e8-85fb-f4890092ab4d"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","bill" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="restrequest" name="CustomerAddV1" id="6ad4739f-a213-44b9-9eb6-0eee1733a002"><con:settings/><con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="CustomerAddV1" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:assertion type="GroovyScriptAssertion" id="f2b95d6f-6d65-41b7-8cba-d71f02e9768d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.response.customers.customer[0].user_id
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="regularTransactionv2" id="05c8549d-0667-4a61-bd72-e18125a9e888"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="regularTransactionv2" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer",
	"invalidExtended" :"invalidValue"
   },
  "customFields": {
    "tx_custom_field_one": "abc",
    "tx_custom_field_two": "xyz"
  },
  "lineItemsV2": [
    {
      "itemCode": "sku_1",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
assert json.sideEffects[0].rawAwardedPoints==20
assert json.sideEffects[0].awardedPoints==20
assert json.sideEffects[0].type=="points"

//assert invalid extended field warning message
assert json.warnings[0].status == false
assert json.warnings[0].code == 91016
assert json.warnings[0].message == "Extended field name invalidExtended is invalid."


</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="transactionV2Get" id="0ce867ad-be45-438b-8e9e-88602309bfc0"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="transactionV2Get" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 200;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields.tx_custom_field_one == "abc"
assert customFields.tx_custom_field_two == "xyz"

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "NORMAL"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 1

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == "sku_1";
	assert lineItems[i].details.qty == 1;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == -1;
	assert lineItems[i].details.attributes[0] == null ;
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0] == null;
	assert lineItems[i].outlierStatus == "NORMAL";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].addonDetails[0] == null
	assert lineItems[i].splitItemsDetails[0] == null
	assert lineItems[i].niReturn == false
	
	
	
	
	
}





log.info lineItems.size()</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147642603</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373587599</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919084053448</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill084053448</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-04-22T15:04:13+05:30</con:value></con:property></con:properties></con:testCase><con:testCase id="031a9497-0b23-45fd-a573-2c69d8d11134" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="VerifyAddAValiadRegularTransactionWithBlankDeliveryStatus" searchProperties="true"><con:description>1-Add regular transaction With blank delivery status
2-Verify transaction with transactionv2Get</con:description><con:settings/><con:testStep type="groovy" name="generaeVariables" id="b0e61ddb-608f-46f9-8a42-7134e1babade"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","bill" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="restrequest" name="CustomerAddV1" id="5c56fcb1-8832-425b-8118-d500bb11352a"><con:settings/><con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="CustomerAddV1" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:assertion type="GroovyScriptAssertion" id="f2b95d6f-6d65-41b7-8cba-d71f02e9768d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.response.customers.customer[0].user_id
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="regularTransactionv2" id="b1999b5e-fa3c-4120-8206-fbecbce63c24"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="regularTransactionv2" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
   },
  "customFields": {
    "tx_custom_field_one": "abc",
    "tx_custom_field_two": "xyz"
  },
  "lineItemsV2": [
    {
      "itemCode": "sku_1",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
assert json.sideEffects[0].rawAwardedPoints==20
assert json.sideEffects[0].awardedPoints==20
assert json.sideEffects[0].type=="points"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="transactionV2Get" id="61cd04cc-fd2b-42cb-8e80-94b6efea66de"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="transactionV2Get" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 200;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields.tx_custom_field_one == "abc"
assert customFields.tx_custom_field_two == "xyz"

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "NORMAL"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 1

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == "sku_1";
	assert lineItems[i].details.qty == 1;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == -1;
	assert lineItems[i].details.attributes[0] == null ;
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0] == null;
	assert lineItems[i].outlierStatus == "NORMAL";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].addonDetails[0] == null
	assert lineItems[i].splitItemsDetails[0] == null
	assert lineItems[i].niReturn == false
	
	
	
	
	
}





log.info lineItems.size()</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147642604</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373587600</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919084067174</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill084067174</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-04-22T15:04:27+05:30</con:value></con:property></con:properties></con:testCase><con:testCase id="f5bc8119-c25a-4996-90f1-c353287a4472" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="VerifyAddAValidRegularTransactionWithNewItemsNotPresentInTheSystem" searchProperties="true"><con:description>1-Add regular transaction with new skus which is not present in the system
2-Verify transaction details</con:description><con:settings/><con:testStep type="groovy" name="generaeVariables" id="4aa8d76a-d847-4d98-8ab7-b9fd23ffd934"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","bill" + mobile);
testRunner.testCase.setPropertyValue("sku1","sku_1_" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="restrequest" name="CustomerAddV1" id="b11e86cf-850f-492f-a8fd-2eca9e50f2ea"><con:settings/><con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="CustomerAddV1" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:assertion type="GroovyScriptAssertion" id="f2b95d6f-6d65-41b7-8cba-d71f02e9768d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.response.customers.customer[0].user_id
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="regularTransactionv2" id="4fcd49fb-270c-40af-a1ef-619b2124f757"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="regularTransactionv2" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
   },
  "customFields": {
    "tx_custom_field_one": "abc",
    "tx_custom_field_two": "xyz"
  },
  "lineItemsV2": [
    {
      "itemCode": "${#TestCase#sku1}",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
assert json.sideEffects[0].rawAwardedPoints==20
assert json.sideEffects[0].awardedPoints==20
assert json.sideEffects[0].type=="points"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="transactionV2Get" id="f38edc8c-fbf0-444d-bb56-e8fd40efe48a"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="transactionV2Get" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 200;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields.tx_custom_field_one == "abc"
assert customFields.tx_custom_field_two == "xyz"

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "NORMAL"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 1

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == context.expand('${#TestCase#sku1}');
	assert lineItems[i].details.qty == 1;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == -1;
	assert lineItems[i].details.attributes[0] == null ;
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0] == null;
	assert lineItems[i].outlierStatus == "NORMAL";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].addonDetails[0] == null
	assert lineItems[i].splitItemsDetails[0] == null
	assert lineItems[i].niReturn == false
	
	
	
	
	
}





log.info lineItems.size()</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147654447</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373607125</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919596602665</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill596602665</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-04-28T13:26:42+05:30</con:value></con:property><con:property><con:name>sku1</con:name><con:value>sku_1_596602665</con:value></con:property></con:properties></con:testCase><con:testCase id="099019c3-40a0-4938-ad42-a6f09bd9c4da" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="VerifyAddAValidRegularTransactionWithNewItemsWithAttribute" searchProperties="true"><con:description>1-Add regular transaction with new skus with attribute
2-Verify same in transactionget api</con:description><con:settings/><con:testStep type="groovy" name="generaeVariables" id="4670e5e7-c8d0-4837-847b-8895ab3abdf0"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","bill" + mobile);
testRunner.testCase.setPropertyValue("sku1","sku_1_" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="groovy" name="addProductAttribute_Size" id="f3f341bd-b6c1-45d6-a19c-432d7812238a"><con:settings/><con:config><script>attribute_lable = "size";
attribute_name = "size"
def suitRef=testRunner.testCase.testSuite.project.testSuites["Reusable API"];
def testcaseRef = suitRef.testCases["AddNewProductAttribute"];

//set AddNewProductAttribute test cases property 
testcaseRef.setPropertyValue("attribute_lable",attribute_lable);
testcaseRef.setPropertyValue("attribute_name",attribute_name);

//run AddNewProductAttribute test cases property 
def resuableTestStep = testcaseRef.testSteps["addProductAttribute"]
def runner = testcaseRef.run(null, true)
log.info ("runner status ....... : " + runner.getStatus())
</script></con:config></con:testStep><con:testStep type="groovy" name="addProductAttribute_color" id="76b8c22f-1249-4f3d-9537-20e71cdd0eea"><con:settings/><con:config><script>attribute_lable = "color";
attribute_name = "color"
def suitRef=testRunner.testCase.testSuite.project.testSuites["Reusable API"];
def testcaseRef = suitRef.testCases["AddNewProductAttribute"];

//set AddNewProductAttribute test cases property 
testcaseRef.setPropertyValue("attribute_lable",attribute_lable);
testcaseRef.setPropertyValue("attribute_name",attribute_name);

//run AddNewProductAttribute test cases property 
def resuableTestStep = testcaseRef.testSteps["addProductAttribute"]
def runner = testcaseRef.run(null, true)
log.info ("runner status ....... : " + runner.getStatus())
</script></con:config></con:testStep><con:testStep type="restrequest" name="CustomerAddV1" id="34e71645-85d1-4fb4-82af-0c18500c64f9"><con:settings/><con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="CustomerAddV1" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:assertion type="GroovyScriptAssertion" id="f2b95d6f-6d65-41b7-8cba-d71f02e9768d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.response.customers.customer[0].user_id
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="regularTransactionv2" id="662eb197-74b0-4aa7-8d35-afb5290cbad5"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="regularTransactionv2" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
  },
  "customFields": {
    "tx_custom_field_one": "abc",
    "tx_custom_field_two": "xyz"
  },
  "lineItemsV2": [
    {
      "itemCode": "${#TestCase#sku1}",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "attributes": {
        "size": "10",
        "color": "black"
      },
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
assert json.sideEffects[0].rawAwardedPoints==20
assert json.sideEffects[0].awardedPoints==20
assert json.sideEffects[0].type=="points"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="transactionV2Get" id="f8912636-5a41-43ba-b27b-903a8a7250a8"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="transactionV2Get" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 200;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields.tx_custom_field_one == "abc"
assert customFields.tx_custom_field_two == "xyz"

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "NORMAL"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 1

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == context.expand('${#TestCase#sku1}');
	assert lineItems[i].details.qty == 1;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == -1;
	assert lineItems[i].details.attributes.size == "10";
	assert lineItems[i].details.attributes.color == "black";
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0].size == "10";
	assert lineItems[i].details.attributesSet[1].color == "black";
	assert lineItems[i].outlierStatus == "NORMAL";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].addonDetails[0] == null
	assert lineItems[i].splitItemsDetails[0] == null
	assert lineItems[i].niReturn == false
	
	
	
	
	
}





log.info lineItems.size()</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147656420</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373610293</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919690145366</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill690145366</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-04-29T15:25:45+05:30</con:value></con:property><con:property><con:name>sku1</con:name><con:value>sku_1_690145366</con:value></con:property></con:properties></con:testCase><con:testCase id="e9e14f54-b321-4027-8ecc-0210e28cc544" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="VerifyAddAValidRegularTransactionWithOldProductWithNewAttributeValue" searchProperties="true"><con:description>Comment : move product/add to java
1-Add regular transaction with old skus with new attribute values
2-Verify same in transactionget api
</con:description><con:settings/><con:testStep type="groovy" name="generaeVariables" id="9bc5e0cf-c611-40f9-bd24-483d631df244"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","bill" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="groovy" name="addProductAttribute_Size" id="eb73e995-1d0c-40b9-8307-0e54039cd23f"><con:settings/><con:config><script>attribute_lable = "size";
attribute_name = "size"
def suitRef=testRunner.testCase.testSuite.project.testSuites["Reusable API"];
def testcaseRef = suitRef.testCases["AddNewProductAttribute"];

//set AddNewProductAttribute test cases property 
testcaseRef.setPropertyValue("attribute_lable",attribute_lable);
testcaseRef.setPropertyValue("attribute_name",attribute_name);

//run AddNewProductAttribute test cases property 
def resuableTestStep = testcaseRef.testSteps["addProductAttribute"]
def runner = testcaseRef.run(null, true)
log.info ("runner status ....... : " + runner.getStatus())
</script></con:config></con:testStep><con:testStep type="groovy" name="addProductAttribute_color" id="660295bf-e470-4248-aa61-c66315b0c91f"><con:settings/><con:config><script>attribute_lable = "color";
attribute_name = "color"
def suitRef=testRunner.testCase.testSuite.project.testSuites["Reusable API"];
def testcaseRef = suitRef.testCases["AddNewProductAttribute"];

//set AddNewProductAttribute test cases property 
testcaseRef.setPropertyValue("attribute_lable",attribute_lable);
testcaseRef.setPropertyValue("attribute_name",attribute_name);

//run AddNewProductAttribute test cases property 
def resuableTestStep = testcaseRef.testSteps["addProductAttribute"]
def runner = testcaseRef.run(null, true)
log.info ("runner status ....... : " + runner.getStatus())
</script></con:config></con:testStep><con:testStep type="groovy" name="addProduct_WithoutAnyAttribute" id="37083ceb-6cb9-4543-9d1e-d1bbce361a84"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String sku = "sku_"+timestamp.substring(4);

def suitRef=testRunner.testCase.testSuite.project.testSuites["Reusable API"];
def testcaseRef = suitRef.testCases["AddProduct"];

//set AddProduct test cases property 
testcaseRef.setPropertyValue("sku",sku);


//run AddProduct test cases property 
def resuableTestStep = testcaseRef.testSteps["addProductWithoutAttribute"]
def runner = testcaseRef.run(null, true)
log.info ("runner status ....... : " + runner.getStatus())
testRunner.testCase.setPropertyValue("sku",sku);
</script></con:config></con:testStep><con:testStep type="restrequest" name="CustomerAddV1" id="db195de8-2f14-4886-aec4-b708c56d3650"><con:settings/><con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="CustomerAddV1" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:assertion type="GroovyScriptAssertion" id="f2b95d6f-6d65-41b7-8cba-d71f02e9768d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.response.customers.customer[0].user_id
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="regularTransactionv2" id="2fb02591-d583-4caa-ab30-5db48c4e44fe"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="regularTransactionv2" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
  },
  "customFields": {
    "tx_custom_field_one": "abc",
    "tx_custom_field_two": "xyz"
  },
  "lineItemsV2": [
    {
      "itemCode": "${#TestCase#sku}",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "returnable" : true,
      "returnableDays" : "10",
      "attributes": {
        "size": "10",
        "color": "black"
      },
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
assert json.sideEffects[0].rawAwardedPoints==20
assert json.sideEffects[0].awardedPoints==20
assert json.sideEffects[0].type=="points"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="transactionV2Get" id="0f3d4304-af79-487f-aaa3-baac277ce63e"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="transactionV2Get" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 200;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields.tx_custom_field_one == "abc"
assert customFields.tx_custom_field_two == "xyz"

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "NORMAL"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 1

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == context.expand('${#TestCase#sku}');
	assert lineItems[i].details.qty == 1;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == -1;
	assert lineItems[i].details.attributes.size == "10";
	assert lineItems[i].details.attributes.color == "black";
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0].size == "10";
	assert lineItems[i].details.attributesSet[1].color == "black";
	assert lineItems[i].outlierStatus == "NORMAL";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].addonDetails[0] == null
	assert lineItems[i].splitItemsDetails[0] == null
	assert lineItems[i].niReturn == false
	
	
	
	
	
}





log.info lineItems.size()</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147656419</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373610292</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919689948187</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill689948187</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-04-29T15:22:28+05:30</con:value></con:property><con:property><con:name>sku1</con:name><con:value>sku_1_614025983</con:value></con:property><con:property><con:name>sku</con:name><con:value>sku_689948198</con:value></con:property></con:properties></con:testCase><con:testCase id="040b247d-75b2-4a57-b77f-6a96e1bdf1cf" failOnError="false" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="VerifySuccessMessageonDuplicateTransactionWhenCONF_LOYALTY_IS_BILL_NUMBER_UNIQUE is False" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword=""><con:description>1- CONF_LOYALTY_IS_BILL_NUMBER_UNIQUE = 0 
2- Add a regular transaction 
3- Verify same transaction
4- Add a regular transaction  with same transaction number
5- Verify same transaction</con:description><con:settings/><con:testStep type="groovy" name="generateVariables" id="22a71f15-a2dd-492f-9b65-eefcdb3615c2"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","bill" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="groovy" name="UpdateConfig_CONF_LOYALTY_IS_BILL_NUMBER_UNIQUE_1" id="d0412be7-bb3a-48be-9ec8-14da596a5370"><con:settings/><con:config><script>config_name = "CONF_LOYALTY_IS_BILL_NUMBER_UNIQUE";
confi_value = "0"
def suitRef=testRunner.testCase.testSuite.project.testSuites["Reusable API"];
def testcaseRef = suitRef.testCases["UpdateOrgConfig"];

//set UpdateOrgConfig test cases property 
testcaseRef.setPropertyValue("config_name",config_name);
testcaseRef.setPropertyValue("config_value",confi_value);

//run UpdateOrgConfig test cases property 
def resuableTestStep = testcaseRef.testSteps["UpdateOrgConfig"]


def runner = testcaseRef.run(null, true)
log.info ("runner status ....... : " + runner.getStatus())

</script></con:config></con:testStep><con:testStep type="restrequest" name="CustomerAddV1" id="b8ebe0ac-f974-4eb8-9e99-99d6c6b233a1"><con:settings/><con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="CustomerAddV1" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:assertion type="GroovyScriptAssertion" id="f2b95d6f-6d65-41b7-8cba-d71f02e9768d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.response.customers.customer[0].user_id
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="regularTransactionv2" id="4587483b-3639-4fbc-b221-213ead0bcd32"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="regularTransactionv2" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
   },
  "customFields": {
    "paymentmode": "abc"
  },
  "lineItemsV2": [
    {
      "itemCode": "sku_1",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
assert json.sideEffects[0].rawAwardedPoints==20
assert json.sideEffects[0].awardedPoints==20
assert json.sideEffects[0].type=="points"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="transactionV2Get" id="e7854969-278d-4faa-9551-93808221af82"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="transactionV2Get" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 200;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields[0] == null

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "NORMAL"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 1

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == "sku_1";
	assert lineItems[i].details.qty == 1;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == -1;
	assert lineItems[i].details.attributes[0] == null ;
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0] == null;
	assert lineItems[i].outlierStatus == "NORMAL";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].addonDetails[0] == null
	assert lineItems[i].splitItemsDetails[0] == null
	assert lineItems[i].niReturn == false
	
	
	
	
	
}





log.info lineItems.size()</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="AddRegularTransactionv2WithSameBillNumber" id="7289bfea-88d1-4b5d-b94d-c7195813ff87"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="AddRegularTransactionv2WithSameBillNumber" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestSuite#billnumber}",
  "billingDate": "${#TestSuite#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
   },
  "customFields": {
    "paymentmode": "abc"
  },
  "lineItemsV2": [
    {
      "itemCode": "sku_1",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId2",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
assert json.sideEffects[0].rawAwardedPoints==20
assert json.sideEffects[0].awardedPoints==20
assert json.sideEffects[0].type=="points"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="transactionV2GetWithTransactionId2" id="c0ff57eb-5ac6-4c53-8145-00e9167129a1"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="transactionV2GetWithTransactionId2" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 200;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields[0] == null

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "NORMAL"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 1

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == "sku_1";
	assert lineItems[i].details.qty == 1;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == -1;
	assert lineItems[i].details.attributes[0] == null ;
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0] == null;
	assert lineItems[i].outlierStatus == "NORMAL";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].addonDetails[0] == null
	assert lineItems[i].splitItemsDetails[0] == null
	assert lineItems[i].niReturn == false
	
	
	
	
	
}





log.info lineItems.size()</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="UpdateConfig_CONF_LOYALTY_IS_BILL_NUMBER_UNIQUE_0" id="0cde2376-6b44-4ddd-af31-958a49267f76"><con:settings/><con:config><script>config_name = "CONF_LOYALTY_IS_BILL_NUMBER_UNIQUE";
confi_value = "0"
def suitRef=testRunner.testCase.testSuite.project.testSuites["Reusable API"];
def testcaseRef = suitRef.testCases["UpdateOrgConfig"];

//set UpdateOrgConfig test cases property 
testcaseRef.setPropertyValue("config_name",config_name);
testcaseRef.setPropertyValue("config_value",confi_value);

//run UpdateOrgConfig test cases property 
def resuableTestStep = testcaseRef.testSteps["UpdateOrgConfig"]


def runner = testcaseRef.run(null, true)
log.info ("runner status ....... : " + runner.getStatus())

</script></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147654505</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373607218</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919618308717</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill618308717</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-04-28T19:28:28+05:30</con:value></con:property><con:property><con:name>transactionId2</con:name><con:value>2147654506</con:value></con:property></con:properties></con:testCase><con:testCase id="679f8e1e-0862-4596-b5ff-c420a45ae8e4" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="VerifyAddAValidRegularTransactionWithNewItemsWithAttributeAndReturnableData" searchProperties="true"><con:description>1-Add regular transaction with new skus with attribute
2-Pass Returnable and ReturnableDays in transactionAddV2
3-Verify same in transactionget api</con:description><con:settings/><con:testStep type="groovy" name="generaeVariables" id="4e9fbf2e-9b1c-4c9f-979a-2f9051535726"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","bill" + mobile);
testRunner.testCase.setPropertyValue("sku1","sku_1_" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="groovy" name="addProductAttribute_Size" id="ffb6f8b1-6df5-4757-9558-3af736643fe9"><con:settings/><con:config><script>attribute_lable = "size";
attribute_name = "size"
def suitRef=testRunner.testCase.testSuite.project.testSuites["Reusable API"];
def testcaseRef = suitRef.testCases["AddNewProductAttribute"];

//set AddNewProductAttribute test cases property 
testcaseRef.setPropertyValue("attribute_lable",attribute_lable);
testcaseRef.setPropertyValue("attribute_name",attribute_name);

//run AddNewProductAttribute test cases property 
def resuableTestStep = testcaseRef.testSteps["addProductAttribute"]
def runner = testcaseRef.run(null, true)
log.info ("runner status ....... : " + runner.getStatus())
</script></con:config></con:testStep><con:testStep type="groovy" name="addProductAttribute_color" id="5c82de07-1633-492f-a4e0-d9dfaa15edec"><con:settings/><con:config><script>attribute_lable = "color";
attribute_name = "color"
def suitRef=testRunner.testCase.testSuite.project.testSuites["Reusable API"];
def testcaseRef = suitRef.testCases["AddNewProductAttribute"];

//set AddNewProductAttribute test cases property 
testcaseRef.setPropertyValue("attribute_lable",attribute_lable);
testcaseRef.setPropertyValue("attribute_name",attribute_name);

//run AddNewProductAttribute test cases property 
def resuableTestStep = testcaseRef.testSteps["addProductAttribute"]
def runner = testcaseRef.run(null, true)
log.info ("runner status ....... : " + runner.getStatus())
</script></con:config></con:testStep><con:testStep type="restrequest" name="CustomerAddV1" id="2dd20a06-75ab-4744-aa70-4e73037b5725"><con:settings/><con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="CustomerAddV1" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:assertion type="GroovyScriptAssertion" id="f2b95d6f-6d65-41b7-8cba-d71f02e9768d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.response.customers.customer[0].user_id
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="regularTransactionv2" id="faebd2b4-81ec-416d-a605-42671adf86ab"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="regularTransactionv2" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
  },
  "customFields": {
    "tx_custom_field_one": "abc",
    "tx_custom_field_two": "xyz"
  },
  "lineItemsV2": [
    {
      "itemCode": "${#TestCase#sku1}",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "returnable" : true,
      "returnableDays" : "10",
      "attributes": {
        "size": "10",
        "color": "black"
      },
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
assert json.sideEffects[0].rawAwardedPoints==20
assert json.sideEffects[0].awardedPoints==20
assert json.sideEffects[0].type=="points"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="transactionV2Get" id="4e70e109-0c22-4ed0-bd4f-31ce172a41c5"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="transactionV2Get" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 200;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields.tx_custom_field_one == "abc"
assert customFields.tx_custom_field_two == "xyz"

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "NORMAL"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 1

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == context.expand('${#TestCase#sku1}');
	assert lineItems[i].details.qty == 1;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == 10;
	assert lineItems[i].details.attributes.size == "10";
	assert lineItems[i].details.attributes.color == "black";
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0].size == "10";
	assert lineItems[i].details.attributesSet[1].color == "black";
	assert lineItems[i].outlierStatus == "NORMAL";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].addonDetails[0] == null
	assert lineItems[i].splitItemsDetails[0] == null
	assert lineItems[i].niReturn == false
	
	
	
	
	
}





log.info lineItems.size()</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147656424</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373610297</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919690699709</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill690699709</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-04-29T15:34:59+05:30</con:value></con:property><con:property><con:name>sku1</con:name><con:value>sku_1_690699709</con:value></con:property></con:properties></con:testCase><con:testCase id="126f9b88-f83d-4edd-879f-145f91365055" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="VerifyAddAValidRegularTransactionWithComboDetails" searchProperties="true"><con:description>1-Add regular transaction with combo details
2-Verify transaction details
</con:description><con:settings/><con:testStep type="groovy" name="generaeVariables" id="a5c44e68-ac4f-40b8-83ce-40716add2ea3"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","bill" + mobile);
testRunner.testCase.setPropertyValue("sku1","sku_1_" + mobile);
testRunner.testCase.setPropertyValue("combosku","combo_sku_1_" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="restrequest" name="CustomerAddV1" id="17800a58-5c14-4277-842f-9782ed76b009"><con:settings/><con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="CustomerAddV1" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:assertion type="GroovyScriptAssertion" id="f2b95d6f-6d65-41b7-8cba-d71f02e9768d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.response.customers.customer[0].user_id
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="regularTransactionv2" id="7f49fceb-668e-42db-85dd-30234c24a8db"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="regularTransactionv2" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
   },
  "customFields": {
    "tx_custom_field_one": "abc",
    "tx_custom_field_two": "xyz"
  },
  "lineItemsV2": [
    {
      "itemCode": "${#TestCase#sku1}",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0, "comboDetails": [
        {
          "value": 200.5,
          "itemCode": "${#TestCase#combosku}",
          "description": "comboitem",
          "rate": 200.5,
          "comboType": "COMBO_ITEM",
          "quantity": 1.0
        }
      ],
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
assert json.sideEffects[0].rawAwardedPoints==20
assert json.sideEffects[0].awardedPoints==20
assert json.sideEffects[0].type=="points"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="transactionV2Get" id="14f33d3e-9f08-4a9c-9518-303e616f14fb"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="transactionV2Get" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

log.info "transactionv2Get verification Starts"
String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 200;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields.tx_custom_field_one == "abc"
assert customFields.tx_custom_field_two == "xyz"

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "NORMAL"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 1

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == context.expand('${#TestCase#sku1}');
	assert lineItems[i].details.qty == 1;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == -1;
	assert lineItems[i].details.attributes[0] == null ;
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0] == null;
	assert lineItems[i].outlierStatus == "NORMAL";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].addonDetails[0] == null
	assert lineItems[i].splitItemsDetails[0] == null
	assert lineItems[i].niReturn == false
	def comboDetails = lineItems[i].comboDetails
	for(int j=0;j&lt;comboDetails.size();j++)
	{
		comboDetails[j].details.amount==0;
		comboDetails[j].details.description == "comboitem";
		comboDetails[j].details.discount == 0;
		comboDetails[j].details.itemCode == context.expand('${#TestCase#combosku}')
		comboDetails[j].details.qty ==1
		comboDetails[j].details.rate == 200.5;
		comboDetails[j].details.serial == 0;
		comboDetails[j].details.value == 200.5;
		comboDetails[j].details.returnableDays ==-1;
		comboDetails[j].details.extendedFields[0] == null;
		comboDetails[j].outlierStatus == "NORMAL";
		comboDetails[j].returnDetails[0] == null ;
		comboDetails[j].valid ==true;
		comboDetails[j].returnLineItemsDtos[0]==null;
		comboDetails[j].niReturnLineItemsDtos[0] == null;
		comboDetails[j].comboDetails[0]==null;
		comboDetails[j].addonDetails[0] == null;
		comboDetails[j].splitItemsDetails[0] == null;
		comboDetails[j].niReturn == false
	}
}

log.info "transactionv2Get verification done"</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147658111</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373613244</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919765748453</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill765748453</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-04-30T12:25:48+05:30</con:value></con:property><con:property><con:name>sku1</con:name><con:value>sku_1_765748453</con:value></con:property><con:property><con:name>combosku</con:name><con:value>combo_sku_1_765748453</con:value></con:property></con:properties></con:testCase><con:testCase id="163b5bdf-4cff-4967-8b34-dc7744a5ef6d" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="VerifyAddAValidRegularTransactionWithAddOnDetails" searchProperties="true"><con:description>1-Add regular transaction with addon details
2-Verify transaction details</con:description><con:settings/><con:testStep type="groovy" name="generaeVariables" id="76d6101c-fbf7-4e74-b099-711f4e18f07e"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","bill" + mobile);
testRunner.testCase.setPropertyValue("sku1","sku_1_" + mobile);
testRunner.testCase.setPropertyValue("addonsku","addon_sku_1_" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="restrequest" name="CustomerAddV1" id="384acf97-9ff3-4166-9914-75fcb47f23ec"><con:settings/><con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="CustomerAddV1" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:assertion type="GroovyScriptAssertion" id="f2b95d6f-6d65-41b7-8cba-d71f02e9768d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.response.customers.customer[0].user_id
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="regularTransactionv2" id="54aca938-d74a-45d4-b11a-94affb560795"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="regularTransactionv2" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
  },
  "customFields": {
    "tx_custom_field_one": "abc",
    "tx_custom_field_two": "xyz"
  },
  "lineItemsV2": [
    {
      "itemCode": "${#TestCase#sku1}",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "splitDetails": [
        {
          "value": 200.5,
          "itemCode": "${#TestCase#splitsku}",
          "description": "splititem",
          "rate": 200.5,
          "comboType": "SPLIT",
          "quantity": 1.0
        }
      ],
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
assert json.sideEffects[0].rawAwardedPoints==20
assert json.sideEffects[0].awardedPoints==20
assert json.sideEffects[0].type=="points"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="transactionV2Get" id="37227a5d-7643-4b3c-b4e1-184cd11cecfd"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="transactionV2Get" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

log.info "transactionv2Get verification Starts"
String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 200;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields.tx_custom_field_one == "abc"
assert customFields.tx_custom_field_two == "xyz"

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "NORMAL"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 1

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == context.expand('${#TestCase#sku1}');
	assert lineItems[i].details.qty == 1;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == -1;
	assert lineItems[i].details.attributes[0] == null ;
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0] == null;
	assert lineItems[i].outlierStatus == "NORMAL";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].comboDetails[0] == null
	assert lineItems[i].splitItemsDetails[0] == null
	assert lineItems[i].niReturn == false
	def addonDetails = lineItems[i].addonDetails
	for(int j=0;j&lt;addonDetails.size();j++)
	{
		addonDetails[j].details.amount==0;
		addonDetails[j].details.description == "addonitem";
		addonDetails[j].details.discount == 0;
		addonDetails[j].details.itemCode == context.expand('${#TestCase#addonsku}')
		addonDetails[j].details.qty ==1
		addonDetails[j].details.rate == 200.5;
		addonDetails[j].details.serial == 0;
		addonDetails[j].details.value == 200.5;
		addonDetails[j].details.returnableDays ==-1;
		addonDetails[j].details.extendedFields[0] == null;
		addonDetails[j].outlierStatus == "NORMAL";
		addonDetails[j].returnDetails[0] == null ;
		addonDetails[j].valid ==true;
		addonDetails[j].returnLineItemsDtos[0]==null;
		addonDetails[j].niReturnLineItemsDtos[0] == null;
		addonDetails[j].comboDetails[0]==null;
		addonDetails[j].addonDetails[0] == null;
		addonDetails[j].splitItemsDetails[0] == null;
		addonDetails[j].niReturn == false
	}
}

log.info "transactionv2Get verification done"</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147658301</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373613377</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919769698431</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill769698431</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-04-30T13:31:38+05:30</con:value></con:property><con:property><con:name>sku1</con:name><con:value>sku_1_769698431</con:value></con:property><con:property><con:name>combosku</con:name><con:value>combo_sku_1_765748453</con:value></con:property><con:property><con:name>addonsku</con:name><con:value>addon_sku_1_769698431</con:value></con:property></con:properties></con:testCase><con:testCase id="43a35552-4272-47b1-a109-4b133d36e33a" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="VerifyAddAValidRegularTransactionWithSplitDetails" searchProperties="true"><con:description>1-Add regular transaction with Split details
2-Verify transaction details</con:description><con:settings/><con:testStep type="groovy" name="generaeVariables" id="3668b5dd-1d01-4ef5-bca5-f304e31fa19c"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","bill" + mobile);
testRunner.testCase.setPropertyValue("sku1","sku_1_" + mobile);
testRunner.testCase.setPropertyValue("splitsku","split_sku_1_" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="restrequest" name="CustomerAddV1" id="c8aa6b0d-c041-45a7-af9d-19a4f10c1e26"><con:settings/><con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="CustomerAddV1" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:assertion type="GroovyScriptAssertion" id="f2b95d6f-6d65-41b7-8cba-d71f02e9768d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.response.customers.customer[0].user_id
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="regularTransactionv2" id="eadd7e36-5f76-48cc-ae12-ef13a6ed8d3f"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="regularTransactionv2" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "200",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
  },
  "customFields": {
    "tx_custom_field_one": "abc",
    "tx_custom_field_two": "xyz"
  },
  "lineItemsV2": [
    {
      "itemCode": "${#TestCase#sku1}",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "splitDetails": [
        {
          "value": 200.5,
          "itemCode": "${#TestCase#splitsku}",
          "description": "splititem",
          "rate": 200.5,
          "comboType": "SPLIT",
          "quantity": 1.0
        }
      ],
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
assert json.sideEffects[0].rawAwardedPoints==20
assert json.sideEffects[0].awardedPoints==20
assert json.sideEffects[0].type=="points"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="transactionV2Get" id="24e5df55-478a-47c5-a2d4-c8f78d4a5d2d"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="transactionV2Get" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

log.info "transactionv2Get verification Starts"
String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 200;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields.tx_custom_field_one == "abc"
assert customFields.tx_custom_field_two == "xyz"

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "NORMAL"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 1

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == context.expand('${#TestCase#sku1}');
	assert lineItems[i].details.qty == 1;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == -1;
	assert lineItems[i].details.attributes[0] == null ;
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0] == null;
	assert lineItems[i].outlierStatus == "NORMAL";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].comboDetails[0] == null
	assert lineItems[i].addonDetails[0] == null
	assert lineItems[i].niReturn == false
	def splitItemsDetails = lineItems[i].splitItemsDetails
	for(int j=0;j&lt;splitItemsDetails.size();j++)
	{
		splitItemsDetails[j].details.amount==0;
		splitItemsDetails[j].details.description == "splititem";
		splitItemsDetails[j].details.discount == 0;
		splitItemsDetails[j].details.itemCode == context.expand('${#TestCase#splitsku}')
		splitItemsDetails[j].details.qty ==1
		splitItemsDetails[j].details.rate == 200.5;
		splitItemsDetails[j].details.serial == 0;
		splitItemsDetails[j].details.value == 200.5;
		splitItemsDetails[j].details.returnableDays ==-1;
		splitItemsDetails[j].details.extendedFields[0] == null;
		splitItemsDetails[j].outlierStatus == "NORMAL";
		splitItemsDetails[j].returnDetails[0] == null ;
		splitItemsDetails[j].valid ==true;
		splitItemsDetails[j].returnLineItemsDtos[0]==null;
		splitItemsDetails[j].niReturnLineItemsDtos[0] == null;
		splitItemsDetails[j].comboDetails[0]==null;
		splitItemsDetails[j].addonDetails[0] == null;
		splitItemsDetails[j].splitItemsDetails[0] == null;
		splitItemsDetails[j].niReturn == false
	}
}

log.info "transactionv2Get verification done"</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147658304</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373613380</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919770178998</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill770178998</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-04-30T13:39:38+05:30</con:value></con:property><con:property><con:name>sku1</con:name><con:value>sku_1_770178998</con:value></con:property><con:property><con:name>combosku</con:name><con:value>combo_sku_1_765748453</con:value></con:property><con:property><con:name>addonsku</con:name><con:value>addon_sku_1_769698431</con:value></con:property><con:property><con:name>splitsku</con:name><con:value>split_sku_1_770178998</con:value></con:property></con:properties></con:testCase><con:testCase id="b85ec5e6-d554-4518-8e6f-40905ffda7e1" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Scenario : Verify regular transaction OUTLIER status on exceeding MaxBillAmount" searchProperties="true"><con:description>1-Add regular transaction withamount greater that set in CONF_LOYALTY_MAX_BILL_AMOUNT
2-verify transaction status in transaction get api</con:description><con:settings/><con:testStep type="groovy" name="when config CONF_LOYALTY_MAX_BILL_AMOUNT set as 50000" id="8a10cdf3-76a0-41ff-bb1d-b589bddecdb9"><con:settings/><con:config><script>config_name = "CONF_LOYALTY_MAX_BILL_AMOUNT";
confi_value = "50000"
def suitRef=testRunner.testCase.testSuite.project.testSuites["Reusable API"];
def testcaseRef = suitRef.testCases["UpdateOrgConfig"];

//set UpdateOrgConfig test cases property 
testcaseRef.setPropertyValue("config_name",config_name);
testcaseRef.setPropertyValue("config_value",confi_value);


def runner = testcaseRef.run(null, true)
log.info ("runner status ....... : " + runner.getStatus())

</script></con:config></con:testStep><con:testStep type="groovy" name="given Variables set" id="a09417df-10f4-46c1-be7f-a1c275d7967f"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","bill" + mobile);
testRunner.testCase.setPropertyValue("sku1","sku_1_" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="restrequest" name="given customer register with instore profile" id="38b34472-452e-435a-b6f3-2878c2ad93e3"><con:settings/><con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="CustomerAddV1" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:assertion type="GroovyScriptAssertion" id="f2b95d6f-6d65-41b7-8cba-d71f02e9768d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.response.customers.customer[0].user_id
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="then validate succesful  regular transaction with v2 api" id="b09e1145-cbba-4cac-8319-3b37d0acd20e"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="regularTransactionv2" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "50001",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
  },
  "customFields": {
    "tx_custom_field_one": "abc",
    "tx_custom_field_two": "xyz"
  },
  "lineItemsV2": [
    {
      "itemCode": "${#TestCase#sku1}",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "returnable" : true,
      "returnableDays" : "10",
      "attributes": {
        "size": "10",
        "color": "black"
      },
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
//assert json.sideEffects[0].rawAwardedPoints==20
//assert json.sideEffects[0].awardedPoints==20
//assert json.sideEffects[0].type=="points"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="then validate trandsaction details with v2.0 transaction api" id="810b94f1-676e-4d28-b9f9-e78709ee93df"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="transactionV2Get" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 50001;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields.tx_custom_field_one == "abc"
assert customFields.tx_custom_field_two == "xyz"

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "OUTLIER"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 1

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == context.expand('${#TestCase#sku1}');
	assert lineItems[i].details.qty == 1;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == 10;
	assert lineItems[i].details.attributes.size == "10";
	assert lineItems[i].details.attributes.color == "black";
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0].size == "10";
	assert lineItems[i].details.attributesSet[1].color == "black";
	assert lineItems[i].outlierStatus == "OUTLIER";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].addonDetails[0] == null
	assert lineItems[i].splitItemsDetails[0] == null
	assert lineItems[i].niReturn == false
	
	
	
	
	
}





log.info lineItems.size()</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="finally reset config CONF_LOYALTY_MAX_BILL_AMOUNT to 50000" id="98229ab5-1044-4141-b08d-6c3ba8215661"><con:settings/><con:config><script>config_name = "BILL_OUTLIER_BASKET_SIZE_LIMIT";
confi_value = "-1"
def suitRef=testRunner.testCase.testSuite.project.testSuites["Reusable API"];
def testcaseRef = suitRef.testCases["UpdateOrgConfig"];

//set UpdateOrgConfig test cases property 
testcaseRef.setPropertyValue("config_name",config_name);
testcaseRef.setPropertyValue("config_value",confi_value);


def runner = testcaseRef.run(null, true)
log.info ("runner status ....... : " + runner.getStatus())

</script></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147665999</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373625617</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919135888843</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill135888843</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-05-04T19:14:48+05:30</con:value></con:property><con:property><con:name>sku1</con:name><con:value>sku_1_135888843</con:value></con:property></con:properties></con:testCase><con:testCase id="5ae82c15-8e7c-47ba-8bf2-ca6fe261d103" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Scenario : Verify regular transaction OUTLIER status when amount is lessthan minimum bill amount" searchProperties="true"><con:description>1-Add regular transaction with amount less  than set in CONF_LOYALTY_MIN_BILL_AMOUNT
2-verify transaction status in transaction get api</con:description><con:settings/><con:testStep type="groovy" name="when config CONF_LOYALTY_MIN_BILL_AMOUNT set as 5" id="e52e4e84-f0b3-48df-bc4c-78c7090216e8"><con:settings/><con:config><script>config_name = "CONF_LOYALTY_MIN_BILL_AMOUNT";
confi_value = "5"
def suitRef=testRunner.testCase.testSuite.project.testSuites["Reusable API"];
def testcaseRef = suitRef.testCases["UpdateOrgConfig"];

//set UpdateOrgConfig test cases property 
testcaseRef.setPropertyValue("config_name",config_name);
testcaseRef.setPropertyValue("config_value",confi_value);


def runner = testcaseRef.run(null, true)
log.info ("runner status ....... : " + runner.getStatus())

</script></con:config></con:testStep><con:testStep type="groovy" name="given Variables set" id="478dc820-00a8-44aa-9074-d8b15d0581bf"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","bill" + mobile);
testRunner.testCase.setPropertyValue("sku1","sku_1_" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="restrequest" name="given customer register with instore profile" id="f5b279ea-c8ae-49f5-865a-90cc5be00ee7"><con:settings/><con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="given customer register with instore profile" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:assertion type="GroovyScriptAssertion" id="f2b95d6f-6d65-41b7-8cba-d71f02e9768d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.response.customers.customer[0].user_id
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="then validate succesful  regular transaction with v2 api" id="de8d3161-573e-4b1d-b995-56c51211a409"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="then validate succesful  regular transaction with v2 api" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "3",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
  },
  "customFields": {
    "tx_custom_field_one": "abc",
    "tx_custom_field_two": "xyz"
  },
  "lineItemsV2": [
    {
      "itemCode": "${#TestCase#sku1}",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "returnable" : true,
      "returnableDays" : "10",
      "attributes": {
        "size": "10",
        "color": "black"
      },
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
//assert json.sideEffects[0].rawAwardedPoints==20
//assert json.sideEffects[0].awardedPoints==20
//assert json.sideEffects[0].type=="points"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="then validate trandsaction details with v2.0 transaction api" id="cfdf0f05-b812-459d-8875-e2a13e536f8f"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="then validate trandsaction details with v2.0 transaction api" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 3;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields.tx_custom_field_one == "abc"
assert customFields.tx_custom_field_two == "xyz"

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "OUTLIER"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 1

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == context.expand('${#TestCase#sku1}');
	assert lineItems[i].details.qty == 1;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == 10;
	assert lineItems[i].details.attributes.size == "10";
	assert lineItems[i].details.attributes.color == "black";
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0].size == "10";
	assert lineItems[i].details.attributesSet[1].color == "black";
	assert lineItems[i].outlierStatus == "OUTLIER";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].addonDetails[0] == null
	assert lineItems[i].splitItemsDetails[0] == null
	assert lineItems[i].niReturn == false
	
	
	
	
	
}





log.info lineItems.size()</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="finally reset config CONF_LOYALTY_MIN_BILL_AMOUNT to 5" id="592ca7a8-7754-45a0-94a3-33a1c3d9bc30"><con:settings/><con:config><script>config_name = "CONF_LOYALTY_MAX_BILL_AMOUNT";
confi_value = "5"
def suitRef=testRunner.testCase.testSuite.project.testSuites["Reusable API"];
def testcaseRef = suitRef.testCases["UpdateOrgConfig"];

//set UpdateOrgConfig test cases property 
testcaseRef.setPropertyValue("config_name",config_name);
testcaseRef.setPropertyValue("config_value",confi_value);


def runner = testcaseRef.run(null, true)
log.info ("runner status ....... : " + runner.getStatus())

</script></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147666001</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373625619</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919136655670</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill136655670</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-05-04T19:27:35+05:30</con:value></con:property><con:property><con:name>sku1</con:name><con:value>sku_1_136655670</con:value></con:property></con:properties></con:testCase><con:testCase id="a9f35a08-7f10-4faa-9da9-a4b0da55e14d" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Scenario : Verify regular transaction OUTLIER status when bill number starts with TEST" searchProperties="true"><con:description>1-Add regular transaction with bill number set as  MARK_BILLS_OUTLIER_STARTING_WITH
2-verify transaction status in transaction get api</con:description><con:settings/><con:testStep type="groovy" name="when config MARK_BILLS_OUTLIER_STARTING_WITH set as TEST" id="6dcd5235-dd3c-4f72-8e98-afb035ce305e"><con:settings/><con:config><script>config_name = "MARK_BILLS_OUTLIER_STARTING_WITH";
confi_value = "TEST"
def suitRef=testRunner.testCase.testSuite.project.testSuites["Reusable API"];
def testcaseRef = suitRef.testCases["UpdateOrgConfig"];

//set UpdateOrgConfig test cases property 
testcaseRef.setPropertyValue("config_name",config_name);
testcaseRef.setPropertyValue("config_value",confi_value);


def runner = testcaseRef.run(null, true)
log.info ("runner status ....... : " + runner.getStatus())

</script></con:config></con:testStep><con:testStep type="groovy" name="given Variables set" id="27afa8b8-8191-45a7-86b9-708d84907ff9"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","TEST-" + mobile);
testRunner.testCase.setPropertyValue("sku1","sku_1_" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="restrequest" name="given customer register with instore profile" id="ccd7ebe6-c2bc-45d5-a8ef-8af8393d36e5"><con:settings/><con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="given customer register with instore profile" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:assertion type="GroovyScriptAssertion" id="f2b95d6f-6d65-41b7-8cba-d71f02e9768d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.response.customers.customer[0].user_id
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="then validate succesful  regular transaction with v2 api" id="c8dc466c-856b-43f4-8aac-a48662aae129"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="then validate succesful  regular transaction with v2 api" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "300",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
  },
  "customFields": {
    "tx_custom_field_one": "abc",
    "tx_custom_field_two": "xyz"
  },
  "lineItemsV2": [
    {
      "itemCode": "${#TestCase#sku1}",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1.0,
      "returnable" : true,
      "returnableDays" : "10",
      "attributes": {
        "size": "10",
        "color": "black"
      },
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
//assert json.sideEffects[0].rawAwardedPoints==20
//assert json.sideEffects[0].awardedPoints==20
//assert json.sideEffects[0].type=="points"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="then validate trandsaction details with v2.0 transaction api" id="9e9c8e9e-3a7e-441a-a349-7f2c99fe8bf6"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="then validate trandsaction details with v2.0 transaction api" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 300;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields.tx_custom_field_one == "abc"
assert customFields.tx_custom_field_two == "xyz"

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "OUTLIER"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 1

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == context.expand('${#TestCase#sku1}');
	assert lineItems[i].details.qty == 1;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == 10;
	assert lineItems[i].details.attributes.size == "10";
	assert lineItems[i].details.attributes.color == "black";
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0].size == "10";
	assert lineItems[i].details.attributesSet[1].color == "black";
	assert lineItems[i].outlierStatus == "OUTLIER";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].addonDetails[0] == null
	assert lineItems[i].splitItemsDetails[0] == null
	assert lineItems[i].niReturn == false
	
	
	
	
	
}





log.info lineItems.size()</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="finally reset config MARK_BILLS_OUTLIER_STARTING_WITH to TEST" id="1aa451ec-2e7f-42b2-9b2d-f0060d761f04"><con:settings/><con:config><script>config_name = "MARK_BILLS_OUTLIER_STARTING_WITH";
confi_value = "TEST"
def suitRef=testRunner.testCase.testSuite.project.testSuites["Reusable API"];
def testcaseRef = suitRef.testCases["UpdateOrgConfig"];

//set UpdateOrgConfig test cases property 
testcaseRef.setPropertyValue("config_name",config_name);
testcaseRef.setPropertyValue("config_value",confi_value);


def runner = testcaseRef.run(null, true)
log.info ("runner status ....... : " + runner.getStatus())

</script></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147666002</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373625620</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919137146943</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>TEST-137146943</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-05-04T19:35:46+05:30</con:value></con:property><con:property><con:name>sku1</con:name><con:value>sku_1_137146943</con:value></con:property></con:properties></con:testCase><con:testCase id="aa6d2b17-e5c1-4f69-a58a-3a2285de0232" failOnError="false" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Scenario : Verify regular transaction OUTLIER status when basketsize is greater than max set in the config" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword=""><con:description>1-Add regular transaction with basket size greater than set in BILL_OUTLIER_BASKET_SIZE_LIMIT
2-verify transaction status in transaction get api</con:description><con:settings/><con:testStep type="groovy" name="when config BILL_OUTLIER_BASKET_SIZE_LIMIT set as 10" id="bbe46c3d-81eb-4f17-80c8-21db7252cccf"><con:settings/><con:config><script>config_name = "BILL_OUTLIER_BASKET_SIZE_LIMIT";
confi_value = "10"
def suitRef=testRunner.testCase.testSuite.project.testSuites["Reusable API"];
def testcaseRef = suitRef.testCases["UpdateOrgConfig"];

//set UpdateOrgConfig test cases property 
testcaseRef.setPropertyValue("config_name",config_name);
testcaseRef.setPropertyValue("config_value",confi_value);


def runner = testcaseRef.run(null, true)
log.info ("runner status ....... : " + runner.getStatus())

</script></con:config></con:testStep><con:testStep type="groovy" name="given Variables set" id="b0d8836d-1c54-4465-8b72-482652cbdf16"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","BILL-" + mobile);
testRunner.testCase.setPropertyValue("sku1","sku_1_" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="restrequest" name="given customer register with instore profile" id="ab9b6874-b78b-4566-876d-c7ada5323f5d"><con:settings/><con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="given customer register with instore profile" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:assertion type="GroovyScriptAssertion" id="f2b95d6f-6d65-41b7-8cba-d71f02e9768d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.response.customers.customer[0].user_id
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="then validate succesful  regular transaction with v2 api" id="55e1506f-7e25-4ef8-97da-2ace5a1c0934"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="then validate succesful  regular transaction with v2 api" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "300",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
  },
  "customFields": {
    "tx_custom_field_one": "abc",
    "tx_custom_field_two": "xyz"
  },
  "lineItemsV2": [
    {
      "itemCode": "${#TestCase#sku1}",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 11,
      "returnable" : true,
      "returnableDays" : "10",
      "attributes": {
        "size": "10",
        "color": "black"
      },
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);
//set transactionId
messageExchange.modelItem.testCase.setPropertyValue("transactionId",json.createdId+"");


def transactionId = json.createdId;
assert transactionId == json.createdId
//assert json.sideEffects[0].rawAwardedPoints==20
//assert json.sideEffects[0].awardedPoints==20
//assert json.sideEffects[0].type=="points"

</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="then validate trandsaction details with v2.0 transaction api" id="ddb2b84b-496d-4d5c-946b-d2a0f37645f9"><con:settings/><con:config service="transactionV2Get" resourcePath="/v2/transactions/${#TestCase#transactionId}/" methodName="RegularTransactionV2Get" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="then validate trandsaction details with v2.0 transaction api" id="2d8b932f-7dff-4d41-99f3-14a82607d9da" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request/><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions//</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5135a58b-4e42-4c9b-9f5a-293450308dcb" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="10e727e2-6d44-4303-bc58-ce96f9b1f2ac" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


transactionId =context.expand('${#TestCase#transactionId}');

def attribution = json.attribution;
def billDetails = json.billDetails;//Done
def customFields =json.customFields; //Done
def addWithLocalCurrency = json.addWithLocalCurrency;//Done
def async = json.async;//Done
def useV2 = json.useV2; //Done
def customerId = json.customerId; //Done
def id = json.id; //Done
def lineItems = json.lineItems;
def outlierStatus = json.outlierStatus; //Done
def type = json.type;//Done
def warnings = json.warnings //Done
def lifeTimePurchases = json.lifeTimePurchases//Done
def ignorePoints = json.ignorePoints //Done
def niReturnDetails = json.niReturnDetails //Done
def basketSize = json.basketSize //Done
def returnDetails = json.returnDetails //Done


assert id == Long.valueOf(transactionId)

//Assert attribute
assert billDetails.amount == 300;
assert billDetails.billNumber == context.expand('${#TestCase#billnumber}');
assert billDetails.discount == 10;
assert billDetails.grossAmount ==110;
assert billDetails.note == "this is test";
assert billDetails.returnDetails.canceled == false;
assert billDetails.niReturnDetails[0] == null 
assert billDetails.invalidBill == false;
assert billDetails.billingTime ==context.expand('${#TestCase#billingTime}')

//Assert customFields
assert customFields.tx_custom_field_one == "abc"
assert customFields.tx_custom_field_two == "xyz"

//Assert addWithLocalCurrency
assert addWithLocalCurrency == false

//Assert useV2
assert useV2 ==false

//Assert async
assert async ==false

//Assert customerId
assert customerId == Long.valueOf(context.expand('${#TestCase#customerId}'));

//Assert type
assert type == "REGULAR"

//Assert outlierStatus
assert outlierStatus == "OUTLIER"

//Assert warnings
assert warnings[0] == null  

//Assert lifeTimePurchases
assert lifeTimePurchases == 0

//Assert ignorePoints
assert ignorePoints == false

//Assert niReturnDetails'
assert niReturnDetails[0] == null

//Assert basketSize
assert basketSize == 11

//Assert returnDetails
assert returnDetails.canceled == false

//Assert  lineItems
assert  lineItems.size()==1
for(int i=0;i&lt;lineItems.size();i++)
{
	assert lineItems[i].details.amount ==100.5;
	assert lineItems[i].details.description =="";
	assert lineItems[i].details.discount == 0;
	assert lineItems[i].details.itemCode == context.expand('${#TestCase#sku1}');
	assert lineItems[i].details.qty == 11;
	assert lineItems[i].details.rate == 100.5 ;
	assert lineItems[i].details.serial == 0;
	assert lineItems[i].details.value == 0;
	assert lineItems[i].details.returnable == true
	assert lineItems[i].details.returnableDays == 10;
	assert lineItems[i].details.attributes.size == "10";
	assert lineItems[i].details.attributes.color == "black";
	assert lineItems[i].details.extendedFields.GrossWeight == 10.5;
	assert lineItems[i].details.extendedFields.MetalRate == 22.02;
	assert lineItems[i].details.attributesSet[0].size == "10";
	assert lineItems[i].details.attributesSet[1].color == "black";
	assert lineItems[i].outlierStatus == "OUTLIER";
	assert lineItems[i].returnDetails[0] == null
	assert lineItems[i].valid == true;
	assert lineItems[i].returnLineItemsDtos[0] == null; 
	assert lineItems[i].niReturnLineItemsDtos[0] == null;
	assert lineItems[i].addonDetails[0] == null
	assert lineItems[i].splitItemsDetails[0] == null
	assert lineItems[i].niReturn == false
	
	
	
	
	
}





log.info lineItems.size()</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="tender" value="true"/>
  <con:entry key="type" value="REGULAR"/>
</con:parameters><con:parameterOrder><con:entry>type</con:entry><con:entry>tender</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="finally reset config BILL_OUTLIER_BASKET_SIZE_LIMIT to -1" id="58500b78-00e3-41f8-8215-06a9f35d6bdd"><con:settings/><con:config><script>config_name = "MARK_BILLS_OUTLIER_STARTING_WITH";
confi_value = "TEST"
def suitRef=testRunner.testCase.testSuite.project.testSuites["Reusable API"];
def testcaseRef = suitRef.testCases["UpdateOrgConfig"];

//set UpdateOrgConfig test cases property 
testcaseRef.setPropertyValue("config_name",config_name);
testcaseRef.setPropertyValue("config_value",confi_value);


def runner = testcaseRef.run(null, true)
log.info ("runner status ....... : " + runner.getStatus())

</script></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147666004</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373625622</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919137553515</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>BILL-137553515</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-05-04T19:42:33+05:30</con:value></con:property><con:property><con:name>sku1</con:name><con:value>sku_1_137553515</con:value></con:property></con:properties></con:testCase><con:testCase id="027ca16d-daf8-42a9-afd9-0e2c308e56a2" failOnError="false" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Scenario : Verify regular transaction error message on  negative amount" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword=""><con:description>1-Add regular transaction with negative amount
2-verify error message in transaction add reponse</con:description><con:settings/><con:testStep type="groovy" name="given Variables set" id="403a40a8-b467-48ef-ab4c-14554f929f5f"><con:settings/><con:config><script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
def startDate = new Date()
testRunner.testCase.setPropertyValue("mobile","919" + mobile);
testRunner.testCase.setPropertyValue("billnumber","BILL-" + mobile);
testRunner.testCase.setPropertyValue("sku1","sku_1_" + mobile);
testRunner.testCase.setPropertyValue("billingTime",startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30"));
log.info startDate.format("yyyy-MM-dd'T'HH:mm:ss+05:30");</script></con:config></con:testStep><con:testStep type="restrequest" name="given customer register with instore profile" id="4cc2e92a-487c-4512-8bf3-5817d39f193d"><con:settings/><con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="given customer register with instore profile" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:assertion type="GroovyScriptAssertion" id="f2b95d6f-6d65-41b7-8cba-d71f02e9768d" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

customerId = json.response.customers.customer[0].user_id
log.info customerId
messageExchange.modelItem.testCase.setPropertyValue("customerId",customerId+"");

</scriptText></con:configuration></con:assertion><con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="then validate error message on adding regular transaction with negave amount with v2 api" id="028665d8-4346-4ebe-805f-8bf51030645c"><con:settings/><con:config service="transactionV2" resourcePath="/v2/transactions" methodName="RegularTransactionV2" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="then validate succesful  regular transaction with v2 api" id="d9e2f4c6-1064-4ce9-900a-7f2b4e6d83c9" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#application_endpoint}</con:endpoint><con:request>{
  "type": "REGULAR",
  "billNumber": "${#TestCase#billnumber}",
  "billingDate": "${#TestCase#billingTime}",
  "discount": "10",
  "billAmount": "-300",
  "note": "this is test",
  "grossAmount": "110",
  "deliveryStatus": "SHIPPED",
  "paymentModes": [
    {
      "notes": "notes_6555444",
      "mode": "Cash",
      "value": "500"
    }
  ],
  "extendedFields": {
    "ship_first_name": "capillary",
    "ship_last_name": "customer"
  },
  "customFields": {
    "tx_custom_field_one": "abc",
    "tx_custom_field_two": "xyz"
  },
  "lineItemsV2": [
    {
      "itemCode": "${#TestCase#sku1}",
      "amount": 100.5,
      "rate": 100.5,
      "qty": 1,
      "returnable" : true,
      "returnableDays" : "10",
      "attributes": {
        "size": "10",
        "color": "black"
      },
      "extendedFields": {
        "MetalRate": "22.02",
        "GrossWeight": "10.50"
      }
    }
  ]
}</con:request><con:originalUri>https://crm-nightly-new.cc.capillarytech.com/v2/transactions</con:originalUri><con:assertion type="GroovyScriptAssertion" id="9a5f20bb-8e70-4cb2-b45e-3b996d8511f2" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


assert json.warnings[0] == null
assert json.errors[0].status==false
assert json.errors[0].code==631
assert json.errors[0].message=="Transaction amount cannot be negative"
</scriptText></con:configuration></con:assertion><con:credentials><con:username>${#Project#auth_username}</con:username><con:password>${#Project#auth_password}</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="identifierName" value="mobile"/>
  <con:entry key="identifierValue" value="${#TestCase#mobile}"/>
  <con:entry key="source" value="instore"/>
</con:parameters><con:parameterOrder><con:entry>source</con:entry><con:entry>accountId</con:entry><con:entry>identifierName</con:entry><con:entry>identifierValue</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>transactionId</con:name><con:value>2147666004</con:value></con:property><con:property><con:name>customerId</con:name><con:value>373625624</con:value></con:property><con:property><con:name>mobile</con:name><con:value>919137973468</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>BILL-137973468</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-05-04T19:49:33+05:30</con:value></con:property><con:property><con:name>sku1</con:name><con:value>sku_1_137973468</con:value></con:property></con:properties></con:testCase><con:properties><con:property><con:name>mobile</con:name><con:value>919919991799</con:value></con:property><con:property><con:name>billnumber</con:name><con:value>bill919991799</con:value></con:property><con:property><con:name>billingTime</con:name><con:value>2021-04-20T17:29:51+05:30</con:value></con:property></con:properties></con:testSuite><con:properties>
    <con:property>
      <con:name>environment</con:name>
      <con:value>crm-nightly-new_50660</con:value>
    </con:property>
    <con:property>
      <con:name>execution_group</con:name>
      <con:value>sanity,regression</con:value>
    </con:property>
    <con:property>
      <con:name>auth_username</con:name>
      <con:value>api.auto1</con:value>
    </con:property>
    <con:property>
      <con:name>auth_password</con:name>
      <con:value>202cb962ac59075b964b07152d234b70</con:value>
    </con:property>
    <con:property>
      <con:name>application_endpoint</con:name>
      <con:value>crm-nightly-new.cc.capillarytech.com</con:value>
    </con:property>
    <con:property>
      <con:name>webhook_workspace</con:name>
      <con:value>enfmnlq9rj2i6m3.m.pipedream.net</con:value>
    </con:property>
    <con:property>
      <con:name>webhook_workspace_name</con:name>
      <con:value>apiauto_webhook</con:value>
    </con:property>
    <con:property>
      <con:name>custom_events_webhook</con:name>
      <con:value>vo4mrjpidb.execute-api.us-east-1.amazonaws.com/crm-nightly-new/webhooks/8b5ec968-6c9d-46cf-8d1b-30b5ffb2d925</con:value>
    </con:property>
    <con:property>
      <con:name>alphatill_username</con:name>
      <con:value>api.auto2</con:value>
    </con:property>
    <con:property>
      <con:name>alphatill_password</con:name>
      <con:value>202cb962ac59075b964b07152d234b70</con:value>
    </con:property>
    <con:property>
      <con:name>gammatill_username</con:name>
      <con:value>api.auto3</con:value>
    </con:property>
    <con:property>
      <con:name>gammatill_password</con:name>
      <con:value>202cb962ac59075b964b07152d234b70</con:value>
    </con:property>
    <con:property>
      <con:name>polling_time</con:name>
      <con:value>15000</con:value>
    </con:property>
  <con:property><con:name>orgId</con:name><con:value>50660</con:value></con:property></con:properties>
  <con:wssContainer/>
  <con:oAuth2ProfileContainer/>
  <con:oAuth1ProfileContainer/>
  <con:beforeRunScript>import groovy.json.JsonSlurper
import java.io.FileInputStream;

////////////////////// Functions /////////////////////////

def filterList(commaSperatedListContent){
	def list = commaSperatedListContent.split(",");
	def filteredList = [];
	list.each(){
	def entry = it.toLowerCase().replaceAll("^\\s+", "");
	entry = entry.trim();
	if(entry != ""){
	filteredList.add(entry);}	
	}
	return filteredList;
}

def customListCompare(list1,list2){
	//list1 is the list of tags that are given by user to execute.
	//list2 is the list of tags for specific test suite.
	boolean isRunnable = false;
	for(int l1 in 0 .. list1.size()-1)
	{
		def inputTag = list1.get(l1);		
		for(int l2 in 0 .. list2.size()-1){
			
			if(inputTag.toString() == list2.get(l2).toString()){
				isRunnable =  true;
				break;
			}
		}
		if(isRunnable){
			break;
		}
	}
	return isRunnable;
}
///////////////////// Function //////////////////////////////////////////////


// connect to json data file based on environment specified.
String environment = context.expand('${#Project#environment}');

String project_dir = context.expand('${projectDir}');
String filepath = project_dir + File.separator + "test_data" + File.separator + project.name + File.separator + environment + ".json";
log.info environment
try{
//File data_file = new File(filepath);
def reader = new BufferedReader(new InputStreamReader(new FileInputStream(filepath),"UTF-8"))
def json = new JsonSlurper().parse(reader);
String endpoint = json.endpoint;
String auth_username = json.authorization.username;
String auth_password = json.authorization.password;
log.info json.orgId
project.setPropertyValue("orgId",json.orgId);
project.setPropertyValue("auth_username",auth_username);
project.setPropertyValue("auth_password",auth_password);
project.setPropertyValue("alphatill_username",json.authorization.alphatill_username);
project.setPropertyValue("alphatill_password",json.authorization.alphatill_password);
project.setPropertyValue("gammatill_username",json.authorization.gammatill_username);
project.setPropertyValue("gammatill_password",json.authorization.gammatill_password);
project.setPropertyValue("application_endpoint",endpoint);
project.setPropertyValue("webhook_workspace",json.webhook_workspace);
project.setPropertyValue("webhook_workspace_name",json.webhook_workspace_name);
project.setPropertyValue("custom_events_webhook",json.custom_events_webhook);
}
catch(Exception e){
	log.info("Could not find the data file " + filepath + " Please check the data file. error == " + e.getMessage());
	assert(false)
}


// Selecting the test suites to run based on the group.

String executionGroups = project.getPropertyValue("execution_group")
def filteredTags = filterList(executionGroups) ;

def Conf_input = "";

log.info "Reading the Configuration file.....";

try{

Conf_input = new File(project_dir + "/test_data/" + project.getName() + "/TestData.xml");

def parser = new XmlParser(); //Get XML Parser.

def Configuration = parser.parse(Conf_input);//Point parser to configration file.

context.Configuration = Configuration;

}
catch(Exception e){
		assert false : "Error in reading configuration file -- " + e.getMessage();
}

def testSuiteListToExecute = [];

log.info "Fetching Test-Scenarios to execute....";

def testSuites = project.getTestSuiteList();

//Enable all TestSuites.
for(j in 0 .. testSuites.size()-1){
	//log.info testSuites.get(j).getName();
	testSuites.get(j).setDisabled(false); 
}
//Decide which test suites to execute and eventually disabled the non-relevant test suites.
		for(i in 0 .. testSuites.size()-1) {
   			def testSuiteName = testSuites.get(i).getName();
   			def tags = context.Configuration.TestSuite."${testSuiteName}".tags.text()
   			def testSuiteTags = filterList(tags);
   			   			
   			if(filteredTags == null || filteredTags.empty){
   				break;
   			}
   			else{
   				if(testSuiteTags == null || testSuiteTags.empty){
   					testSuites.get(i).setDisabled(true);
   				}
   				else{
   					def isRunnable = customListCompare(filteredTags,testSuiteTags);
   					log.info testSuiteName+":::"+isRunnable
   					if(!isRunnable){
   						testSuites.get(i).setDisabled(true);
   					}
   				}
   			}
   			
		}</con:beforeRunScript>
  <con:sensitiveInformation/>
</con:soapui-project>