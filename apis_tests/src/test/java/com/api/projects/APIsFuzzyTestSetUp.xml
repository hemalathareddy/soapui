<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project id="cb40d130-0486-4f5f-8093-9bd80b5e44b6" activeEnvironment="Default" name="APIsFuzzyTestSetUp" resourceRoot="" soapui-version="5.6.0" abortOnError="false" runType="SEQUENTIAL" defaultScriptLanguage="Groovy" xmlns:con="http://eviware.com/soapui/config">
  <con:settings>
    <con:setting id="com.eviware.soapui.impl.wsdl.actions.iface.tools.support.SecurityTestRunnerAction@values-local"><![CDATA[<xml-fragment xmlns:con="http://eviware.com/soapui/config">
  <con:entry key="Report Format(s)" value=""/>
  <con:entry key="Host:Port" value=""/>
  <con:entry key="Export JUnit Results" value="true"/>
  <con:entry key="Export All" value="true"/>
  <con:entry key="Save After" value="false"/>
  <con:entry key="Add Settings" value="false"/>
  <con:entry key="WSS Password Type" value=""/>
  <con:entry key="TestSuite" value="customer_add TestSuite"/>
  <con:entry key="Endpoint" value=""/>
  <con:entry key="Select Report Type" value=""/>
  <con:entry key="System Properties" value=""/>
  <con:entry key="Password" value=""/>
  <con:entry key="Print Report" value="true"/>
  <con:entry key="Open Report" value="false"/>
  <con:entry key="SecurityTest" value="SecurityTest"/>
  <con:entry key="Global Properties" value=""/>
  <con:entry key="Project Properties" value=""/>
  <con:entry key="SecurityTestRunner Path" value=""/>
  <con:entry key="Project Password" value=""/>
  <con:entry key="TestCase" value="addTestCase"/>
  <con:entry key="Username" value=""/>
  <con:entry key="user-settings.xml Password" value=""/>
  <con:entry key="Environment" value="Default"/>
  <con:entry key="Coverage Report" value="false"/>
  <con:entry key="Enable UI" value="false"/>
  <con:entry key="Root Folder" value=""/>
  <con:entry key="Ignore Errors" value="false"/>
  <con:entry key="Domain" value=""/>
  <con:entry key="Tool Args" value=""/>
  <con:entry key="Save Project" value="false"/>
</xml-fragment>]]></con:setting>
  </con:settings>
  <con:interface xsi:type="con:RestService" id="f83c5208-a573-4edc-b9ee-e1dbc68b757a" wadlVersion="http://wadl.dev.java.net/2009/02" name="customer_add" type="rest" definitionUrl="http" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    
    <con:definitionCache type="TEXT"/><con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
      <con:endpoint>https://nightly.capillary.in</con:endpoint>
    </con:endpoints>
    <con:resource name="add" path="/{version}/customer/add" id="962fdae1-7460-4dac-92cd-004cf38d476e">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>version</con:name>
          <con:value>version</con:value>
          <con:style>TEMPLATE</con:style>
          <con:default>version</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>{format}</con:value>
          <con:style>QUERY</con:style>
          <con:default>{format}</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="4b908cfb-b824-41e5-bec9-c1a7718b59d8" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "6706295457",
        "email": "6706295457@gmail.com",

        "firstname": "ng_test",
        "lastname": "g_test",
        "gender": "F",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			},
        "custom_fields": {
          "field": [
            {
              "name": "Hobbies",
              "value": "[“Fitness”]"
            },
            {
              "name": "a",
              "value": "[“b”]"
            }
          ]
        }

      }
    ]
  }
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="format" value="json"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="e04fff62-3e0e-4387-8dfd-0b7ac5b37a3c" wadlVersion="http://wadl.dev.java.net/2009/02" name="getEventLogs" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT" rootPart=""/>
    <con:endpoints>
      <con:endpoint>http://nightly.capillary.in</con:endpoint>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="{req_id}" path="/{version}/webHooks/eventLog/requestId/{request_id}" id="f75ff369-9710-4e54-b790-297750bfb3bd">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>version</con:name>
          <con:value>v3</con:value>
          <con:style>TEMPLATE</con:style>
          <con:default>v3</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>request_id</con:name>
          <con:value/>
          <con:style>TEMPLATE</con:style>
          <con:default/>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="f9db9900-9406-472a-8d8c-0eaf603590c1" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:representation type="FAULT">
          <con:mediaType>application/json;charset=ISO-8859-1</con:mediaType>
          <con:status>401</con:status>
          <con:params/>
          <con:element xmlns:d0b="https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa">d0b:Fault</con:element>
        </con:representation>
        <con:representation type="RESPONSE">
          <con:mediaType>application/json;charset=UTF-8</con:mediaType>
          <con:status>200</con:status>
          <con:params/>
          <con:element xmlns:d0b="https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa">d0b:Response</con:element>
        </con:representation>
        <con:representation type="FAULT">
          <con:mediaType>application/json</con:mediaType>
          <con:status>404</con:status>
          <con:params/>
          <con:element xmlns:d0b="https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa">d0b:Fault</con:element>
        </con:representation>
        <con:request name="Request 1" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request/>
          <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="version" value="v3"/>
            <con:entry key="request_id" value=""/>
          </con:parameters>
          <con:parameterOrder>
            <con:entry>version</con:entry>
            <con:entry>request_id</con:entry>
          </con:parameterOrder>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="356e75ca-0be2-4ebd-b5dd-fd47a09c8647" wadlVersion="http://wadl.dev.java.net/2009/02" name="webhook" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache/>
    <con:endpoints>
      <con:endpoint>http://${#Project#webhook_workspace}</con:endpoint>
      <con:endpoint>http://enqovte5kgmv6a1.m.pipedream.net/</con:endpoint>
    </con:endpoints>
    <con:resource name="events" path="/api/events" id="016d33c5-439b-45fa-a767-71ab5a57370b">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>request_id</con:name>
          <con:value>9f54fb7a-aa1d-430d-a1b3-d5dca350fd29</con:value>
          <con:style>QUERY</con:style>
          <con:default>9f54fb7a-aa1d-430d-a1b3-d5dca350fd29</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="74e87b38-4211-4367-8ebf-50a19028d74b" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="34ead1d1-1594-4ef4-9ce9-40c691346b9e" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"/>
  &lt;con:entry key="User-Agent" value="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36"/>
&lt;/xml-fragment></con:setting>
          </con:settings>
          <con:endpoint>http://${#Project#webhook_workspace}</con:endpoint>
          <con:request/>
          <con:originalUri>https://enlvdydwm08ks.x.pipedream.net/api/events</con:originalUri>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="3212de9c-e2cb-49ed-9b76-075cbc718ca7" wadlVersion="http://wadl.dev.java.net/2009/02" name="getWebhooks" type="rest" definitionUrl="http" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="webHooks" path="/{version}/webHooks" id="0e2aa914-1d7d-478d-a249-2ce7557bf37d">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>version</con:name>
          <con:value>version</con:value>
          <con:style>TEMPLATE</con:style>
          <con:default>version</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="c466a5b3-508f-4df5-9b1a-100b5435fc49" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="e34c812d-806e-498b-adbd-323081eda9a6" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request/>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="3d786918-f43a-4f2b-bc6e-f1345cc7752c" wadlVersion="http://wadl.dev.java.net/2009/02" name="getCustomerV2" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="{user_id}" path="/v2/customers/{user_id}" id="2e7ea798-f565-4a0e-956f-4f6b84ee913a">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>user_id</con:name>
          <con:value>user_id</con:value>
          <con:style>TEMPLATE</con:style>
          <con:default>user_id</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>source</con:name>
          <con:value>ALL</con:value>
          <con:style>QUERY</con:style>
          <con:default>ALL</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>accountId</con:name>
          <con:value/>
          <con:style>QUERY</con:style>
          <con:default/>
        </con:parameter>
        <con:parameter>
          <con:name>embed</con:name>
          <con:value>mlp</con:value>
          <con:style>QUERY</con:style>
          <con:default>mlp</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="8d8691dc-6a53-48c4-8c2c-bcaf4d7bf7ee" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="35a353eb-1756-4e37-83f8-d8c4a290f0aa" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request/>
          <con:originalUri>https://nightly.capillary.in/v2/customers/376790377</con:originalUri>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <entry key="user_id" value="376790377" xmlns="http://eviware.com/soapui/config"/>
          </con:parameters>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="0568445a-36d0-42b5-9933-89df50b53456" wadlVersion="http://wadl.dev.java.net/2009/02" name="addRegularTransaction" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="add" path="/v1.1/transaction/add" id="dee9310e-99b0-48cf-acb7-ec04400c84c4">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="7d818094-4183-4839-b179-0eab76edf758" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="30d7b033-bada-4cf6-abdf-781b858869dc" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
	"root": {
		"transaction": {
			"bill_client_id": "1121888",
			"type": "regular",
			"number": "BILL_6935391507",
			"notes": "2 lin1e items",
			"amount" : 50000,
			"gross_amount": "100",
			"discount": "10",
			"customer": {
				"mobile": "6935391507",
				"email": "6935391507@gmail.com",
				"external_id": "x6935391507",
				"firstname": "Nayan",
				"lastname": "Gaur"
			},
			"extended_fields": {
				"field": [{
						"name": "ship_first_name",
						"value": "Nayan"
					},
					{
						"name": "ship_last_name",
						"value": "Gaur"
					}
				]
			},
			"payment_details": {
				"payment": [{
						"mode": "CASH",
						"value": "100"
					},
					{
						"mode": [
							"CREDIT",
							"CHECKAPI"
						],
						"value": [
							"4000",
							"500"
						],
						"attributes": {
							"attribute": [{
									"name": "BankNameAPI",
									"value": "value_602656"
								},
								{
									"name": "branch_nameAPI",
									"value": "value_602656"
								}
							]
						},
						"notes": "notes_602656"
					}
				]
			},
			"custom_fields": {

				"field": [{
						"name": "bankdetails",
						"value": "SBI"
					},
					{
						"name": "bankdetails",
						"value": "SBI"
					}
				]

			},
			"line_items": {
				"line_item": [{
						"extended_fields": {
							"field": [{
									"name": "MetalRate",
									"value": 23
								},
								{
									"name": "service_tax_amount",
									"value": 100
								}
							]
						},
						"serial": "1",
						"amount": "500",
						"description": "soap",
						"item_code": "item-001",
						"qty": "50",
						"rate": "10",
						"value": "500",
						"attributes": {
							"attribute": {
								"name": "brand",
								"value": "Levis"
							}
						}
					},
					{
						"extended_fields": {
							"field": [{
									"name": "DesignCode",
									"value": "jmh6677"
								},
								{
									"name": "SupplierCode",
									"value": "hgjy111"
								}
							]
						},
						"serial": "2",
						"amount": "500",
						"description": "soap",
						"item_code": "item-001",
						"qty": "50",
						"rate": "10",
						"value": "500",
						"transaction_number": "niBill1",
						"attributes": {
							"attribute": {
								"name": "brand",
								"value": "Levis"
							}
						}
					},
					{
						"extended_fields": {
							"field": [{
									"name": "StoneCharge",
									"value": 22
								},
								{
									"name": "MakingCharge",
									"value": 11
								}
							]
						},
						"serial": "3",
						"item_code": "t122",
						"description": "afvdfvd",
						"qty": "3",
						"rate": "1000",
						"value": "3000",
						"discount_value": "100",
						"amount": "2900",
						"cashier_id": "cash1233",
						"type": "return",
						"return_type": "LINE_ITEM",
						"transaction_number": "previousBill1"
					}
				]
			},
			"associate_details": {
				"code": "hiraxdhara",
				"name": "Tom Sawyer"
			}
		}
	}
}</con:request>
          <con:originalUri>https://nightly.capillary.in/v1.1/transaction/add</con:originalUri>
          <con:credentials>
            <con:username>cm.1</con:username>
            <con:password>202cb962ac59075b964b07152d234b70</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="9188fa72-d4ca-4799-b0ec-81d98303a349" wadlVersion="http://wadl.dev.java.net/2009/02" name="isRedeemable" type="rest" definitionUrl="http" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="isredeemable" path="/{version}/points/isredeemable" id="fd2cf47e-cfde-48da-8593-244b9da11944">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>version</con:name>
          <con:value>version</con:value>
          <con:style>TEMPLATE</con:style>
          <con:default>version</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>points</con:name>
          <con:value>{points}</con:value>
          <con:style>QUERY</con:style>
          <con:default>{points}</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>skip_validation</con:name>
          <con:value>true</con:value>
          <con:style>QUERY</con:style>
          <con:default>true</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>mobile</con:name>
          <con:value>{mobile}</con:value>
          <con:style>QUERY</con:style>
          <con:default>{mobile}</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>program_id</con:name>
          <con:style>QUERY</con:style>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="d951de00-4eb0-48cb-b9c6-a53e5d8c10d2" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="7324ca5d-555c-46eb-892f-02a744545f27" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request/>
          <con:originalUri>https://nightly.capillary.in/version/points/isredeemable</con:originalUri>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="mobile" value="7456470100"/>
            <con:entry key="version" value="v1.1"/>
            <con:entry key="points" value="50"/>
          </con:parameters>
          <con:parameterOrder>
            <con:entry>version</con:entry>
            <con:entry>format</con:entry>
            <con:entry>points</con:entry>
            <con:entry>skip_validation</con:entry>
            <con:entry>mobile</con:entry>
            <con:entry>program_id</con:entry>
          </con:parameterOrder>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="01393347-1433-435e-8d4d-c02b4f1ad97c" wadlVersion="http://wadl.dev.java.net/2009/02" name="RedeemPoints" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="redeem" path="/{version}/points/redeem" id="8778912a-bb63-423f-abdb-89c51359fb8a">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>version</con:name>
          <con:value>version</con:value>
          <con:style>TEMPLATE</con:style>
          <con:default>version</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>program_id</con:name>
          <con:value>{program_id}</con:value>
          <con:style>QUERY</con:style>
          <con:default>{program_id}</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="68dcceb8-9b58-4693-aee2-f6c101bb4f24" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="0c6d7d87-8bdb-450b-b683-a4bcddcec72c" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "redeem": {
      "points_redeemed": "50",
      "transaction_number": "1234r743",
      "customer": { "mobile": "91712292522" },
      "notes": "Sample notes",
      "validation_code": "7S8VH7"
    }
  }
}</con:request>
          <con:credentials>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:entry key="program_id" value="1231"/>
            <con:entry key="version" value="v1.1"/>
          </con:parameters>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="1486e61e-cd35-4606-b74b-5c6406abb01d" wadlVersion="http://wadl.dev.java.net/2009/02" name="getCustomerV1" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="get" path="/v1.1/customer/get" id="5e983fb5-e4dc-456e-bead-4a470764829c">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>id</con:name>
          <con:value>{user_id}</con:value>
          <con:style>QUERY</con:style>
          <con:default>{user_id}</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>mlp</con:name>
          <con:value>true</con:value>
          <con:style>QUERY</con:style>
          <con:default>true</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="700e2ddf-a659-4042-8dd9-8df792a13bc5" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="fffb4960-10e1-4ff0-982b-f7255dbe25c3" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="X-CAP-CLIENT-COUNTRYCODE" value="1" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request/>
          <con:originalUri>https://nightly.capillary.in/v1.1/customer/get</con:originalUri>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <entry key="id" value="378087418" xmlns="http://eviware.com/soapui/config"/>
          </con:parameters>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="fcc704d4-06ce-4de6-a1d4-738180ea26c5" wadlVersion="http://wadl.dev.java.net/2009/02" name="issueCoupon" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="issue" path="/v1.1/coupon/issue" id="9f92e04a-5c5b-45d0-9712-e7ddabfa844a">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>user_id</con:name>
          <con:value>true</con:value>
          <con:style>QUERY</con:style>
          <con:default>true</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="e262157b-ca9f-474a-989a-793e74b49680" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="757eb83a-f2f8-4b87-82bf-8545223dbbc2" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
   "root":{
      "coupon":[
         {
            "series_id":87618,
            "customer":{
               "mobile":"919090080344",
               "external_id":null,
               "email":null
            }
         }
      ]
   }
}</con:request>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="f5fc346f-3e9a-4165-8448-f6ce2cb69fdc" wadlVersion="http://wadl.dev.java.net/2009/02" name="RedeemCoupon" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="redeem" path="/v1.1/coupon/redeem" id="3c7e403a-9272-4ba1-8b24-5b3368163cea">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="84d1ca8a-673f-4398-becf-64469fbc920f" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="ff5fa5db-d484-4866-bf48-2ed0a1b8e3c1" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "root": {
    "coupon": [{
      "code": "{{code}}",
      "redemption_time": "2017-09-17",
      "customer": {
        "mobile": "{{mobile1}}"
      },
      "custom_fields": {
        "field": {
          "name": "Sport",
          "value": "[“Soccer”]"
        }
      },
      "transaction": {
        "number":"{{billNumber}}",
        "amount": "1000"
      }
    }]
  }
}</con:request>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="7bd5e296-824e-4279-98ff-8dada1ff92fa" wadlVersion="http://wadl.dev.java.net/2009/02" name="isCouponRedeemable" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="isredeemable" path="/v1.1/coupon/isredeemable" id="de8547f9-9386-4efc-9c1b-dfd3166e43ed">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>details</con:name>
          <con:value>true</con:value>
          <con:style>QUERY</con:style>
          <con:default>true</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>code</con:name>
          <con:value>{coupon_code}</con:value>
          <con:style>QUERY</con:style>
          <con:default>{coupon_code}</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>mobile</con:name>
          <con:value>{mobile}</con:value>
          <con:style>QUERY</con:style>
          <con:default>{mobile}</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="b60256fa-2b15-4f09-b4ae-5879f86d7367" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="2065919b-04a9-42cd-b6be-b621d97e53d4" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request/>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="216dc5d8-4532-4e16-8aeb-831bca39e6a2" wadlVersion="http://wadl.dev.java.net/2009/02" name="getCouponSeries" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="series" path="/v1.1/coupon/series" id="e058e844-1c81-4c0a-a43e-9b09bc11e8b9">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="ace9d9a8-eb6f-4a05-93c9-aeab31251bb9" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="4f9fddd5-ff27-468f-9305-ddb2ae83c9ed" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request/>
          <con:originalUri>https://nightly.capillary.in/v1.1/coupon/series</con:originalUri>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="2f59ebc7-7862-4705-9aa4-5f205643a0a9" wadlVersion="http://wadl.dev.java.net/2009/02" name="getCustomerCoupons" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="coupons" path="/v1.1/customer/coupons" id="cc3aad53-0998-4733-8201-36512ac5b31d">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>mobile</con:name>
          <con:value>{mobile}</con:value>
          <con:style>QUERY</con:style>
          <con:default>{mobile}</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="d2677551-7e84-4275-919c-5a8d19151251" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="a83c3c0e-7af3-4d6d-b7d5-76c317dee5b5" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request/>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="1d167895-41a8-4013-9475-73ed873bd3c3" wadlVersion="http://wadl.dev.java.net/2009/02" name="getCouponDetails" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="get" path="/v1.1/coupon/get" id="d32d3221-3fbb-4a67-b286-63f03fe45387">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>code</con:name>
          <con:value>{code}</con:value>
          <con:style>QUERY</con:style>
          <con:default>{code}</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="52be3e16-8714-40c2-9998-1f35b6bdea81" method="GET">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="b20f21c7-d621-4e58-b18d-b146a4c66139" mediaType="application/json">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="content-type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request/>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="79c18da1-2f79-4030-afc0-ed75ca661831" wadlVersion="http://wadl.dev.java.net/2009/02" name="PointsTransfer" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="transfer" path="/v2/points/transfer" id="1b7a9c33-0ba0-4701-bc78-0a9dc67059f4">
      <con:settings/>
      <con:parameters/>
      <con:method name="Method 1" id="8289658d-5f36-41be-b41d-11faa4c89d19" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="66016c4b-99ca-4eff-8f1e-3c10187c0c22" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
  "transferredAtStoreCode": "string",
  "transferredAtStoreID": 0,
  "pointsTobeTransferred": 0,
  "fromCustomerIdentifier": {
    "type": "MOBILE",
    "value": "string"
  },
  "toCustomerIdentifier": {
    "type": "MOBILE",
    "value": "string"
  },
  "notes": "string",
  "code": "string",
  "groupProgramTransfer": false
}</con:request>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="5d90c9b2-daf9-4655-a09e-994747cdb1f8" wadlVersion="http://wadl.dev.java.net/2009/02" name="isPointsTransferable" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="isTransferrable" path="/v2/points/isTransferrable" id="3ca0226e-f428-4441-a805-a91854c831dd">
      <con:settings/>
      <con:parameters/>
      <con:method name="Method 1" id="dfeed04d-66e9-4cc3-9eb9-d4a7141b8e6e" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="0dcc0e21-afd7-4862-838c-ca8bcaeadc75" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
    "issueOtp": true,
    "pointsTobeTransferred": 1.1,
    "toCustomerIdentifier": {
        "type": "MOBILE",
        "value": "917709142209"
    },
    "fromCustomerIdentifier": {
        "type": "MOBILE",
        "value": "917332628259"
    }
}</con:request>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="f9e0c80e-598d-49ef-98ac-f19bbcb4f1fd" wadlVersion="http://wadl.dev.java.net/2009/02" name="returnRegularTransaction" type="rest" definitionUrl="htts" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="add" path="/v1.1/transaction/add" id="1121e52b-c3e8-463f-b2c2-471c7de88da4">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>json</con:value>
          <con:style>QUERY</con:style>
          <con:default>json</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="fb853c35-7bdf-448a-ab98-231c2b4a0fcf" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="77cded7f-7736-4732-bd83-29e42c30f628" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="content-type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
          <con:request>{
	"root": {
		"transaction": {
			"type": "return",
			"bill_client_id": "wd221123333",
			"customer": {
				"firstname": "Rati",
				"lastname": "Ranjan",
				"email": "{{mobile1}}@mil.com",
				"mobile": "{{mobile1}}",
				"external_id": "X{{mobile1}}"
			},
			"transaction_number": "7u78118",
			"amount": "1000",
			"notes": "bill with note",
			"line_items": {
				"line_item": {
					"extended_fields": {
						"field": [{
								"name": "MetalRate",
								"value": 23
							},
							{
								"name": "MetalWeight",
								"value": 200
							}
						]
					},
					"serial": "0",
					"item_code": "t122",
					"description": "afvdfvd",
					"qty": "3",
					"rate": "1000",
					"value": "3000",
					"discount_value": "100",
					"amount": "8888",
					"cashier_id": "cash1233"
				}
			},
			"extended_fields": {
				"field": [{
						"name": "CentralGST",
						"value": 6
					},
					{
						"name": "StateGST",
						"value": 6
					}
				]
			},
			"payment_details": {
				"payment": {
					"mode": "CASH",
					"value": "100"
				}
			},
			"custom_fields": {
				"field": {
					"-name": "paymentmode",
					"value": "现金"
				}
			},
			"associate_details": {
				"code": "223232",
				"name": "afdf4r3"
			},
			"referral_code": "efef34343",
			"return_type": "FULL"
		}
	}
}</con:request>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="a2f3d0d0-8309-4edf-a0bd-969e38e4bb55" wadlVersion="http://wadl.dev.java.net/2009/02" name="updateOrgConfig" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
    </con:endpoints>
    <con:resource name="configs" path="/{version}/organization/configs" id="72004983-e818-4dff-9903-7a8ef1da5c14">
      <con:settings/>
      <con:parameters>
        <con:parameter>
          <con:name>version</con:name>
          <con:value>version</con:value>
          <con:style>TEMPLATE</con:style>
          <con:default>version</con:default>
        </con:parameter>
        <con:parameter>
          <con:name>format</con:name>
          <con:value>xml</con:value>
          <con:style>QUERY</con:style>
          <con:default>xml</con:default>
        </con:parameter>
      </con:parameters>
      <con:method name="Method 1" id="3828eaaf-55d7-41c7-9c90-8277cd469974" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="9ae77cbf-a340-43f2-9a3b-e6cd9213c773" mediaType="application/xml" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>- no endpoint set -</con:endpoint>
          <con:request><![CDATA[<root>
     <organization>
             <configs>
                     <config>
                             <name>CONF_LOYALTY_POINTS_REDEMPTION_LIFETIME_PURCHASE_MIN</name>
                             <scope>ORG</scope>
                             <value>0</value>
                            <entity_id>null</entity_id>
                     </config>
             </configs>
     </organization>
</root>]]></con:request>
          <con:credentials>
            <con:username>${#Project#auth_username}</con:username>
            <con:password>${#Project#auth_password}</con:password>
            <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
            <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
            <con:authType>Global HTTP Settings</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <entry key="version" value="v1.1" xmlns="http://eviware.com/soapui/config"/>
          </con:parameters>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="58906dd6-573e-4ca1-97d8-6660624d4ecd" wadlVersion="http://wadl.dev.java.net/2009/02" name="triggerCustomEvent" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache type="TEXT"/>
    <con:endpoints>
      <con:endpoint>https://${#Project#custom_events_webhook}</con:endpoint>
    </con:endpoints>
    <con:resource name="1b35496e-4126-4242-be3e-20f624766b67" path="" id="298f4f66-d3fe-4f25-bbf4-b8bbcf2e3706">
      <con:settings/>
      <con:parameters/>
      <con:method name="Method 1" id="bc2ab0db-9295-4bdf-ae1e-788c2302c95b" method="POST">
        <con:settings/>
        <con:parameters/>
        <con:request name="Request 1" id="f773dd65-36e5-4368-91df-2c4c620e83d1" mediaType="application/json" postQueryString="false">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="content-type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
          </con:settings>
          <con:endpoint>https://${#Project#custom_events_webhook}</con:endpoint>
          <con:request>{"Mobile":"918733645468",
"Name":"stringxxx",
"Till":"alpha_endtoend_test",
"event_name":"AlphaEndToEnd"}</con:request>
          <con:originalUri>https://8mo7zxjtj0.execute-api.us-east-1.amazonaws.com/onenightly/webhooks/1b35496e-4126-4242-be3e-20f624766b67</con:originalUri>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:request>
      </con:method>
    </con:resource>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="a691791f-99a2-4ace-9f16-fb0574a1ef08" wadlVersion="http://wadl.dev.java.net/2009/02" name="rp" type="rest" definitionUrl="reportPortal" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <con:settings/>
    <con:definitionCache/>
    <con:endpoints/>
  </con:interface>
  <con:interface xsi:type="con:RestService" id="804e1d35-c0ce-40b6-9c5a-a0a6a7d7f735" wadlVersion="http://wadl.dev.java.net/2009/02" name="ReportPortal" type="rest" definitionUrl="https" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT"/><con:endpoints><con:endpoint>http://qareportportal.capillary.in</con:endpoint></con:endpoints><con:resource name="Start Launch" path="/api/v1/superadmin_personal/launch" id="7dfaecaf-f157-4518-a01a-659f76fc2b18"><con:settings/><con:parameters/><con:method name="Method 1" id="4c375672-2e69-4852-8fdc-c9f77f6e7052" method="POST"><con:settings/><con:parameters/><con:request name="Request 1" id="240e4a6f-472b-4bcb-8174-58f0c32192bc" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Authorization" value="Bearer 3c24e31f-e667-4ecd-8b80-91b42abccc8f"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://qareportportal.capillary.in</con:endpoint><con:request>{
   "name":"Demo_SecurityTestLaunch",
   "description":"My first launch for Security Tests",
   "startTime":"1613029316000",
   "mode":"DEFAULT",
   "attributes":[
      {
         "key":"env",
         "value":"nightly"
      },
      {
         "value":"test"
      }
   ]
}</con:request><con:originalUri>http://qareportportal.capillary.in/api/v1/superadmin_personal/launch</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method></con:resource><con:resource name="StartTestSuite" path="/api/v1/superadmin_personal/item" id="5b0813cd-0dde-4305-9221-74c4db6a9e8b"><con:settings/><con:parameters/><con:method name="Method 1" id="2ff59c6b-328b-488b-a023-fee0dfc26d3b" method="POST"><con:settings/><con:parameters/><con:request name="Request 1" id="3ee5b2d3-d2de-4b83-ad07-14aa3a57b2e6" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Authorization" value="Bearer 3c24e31f-e667-4ecd-8b80-91b42abccc8f"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>http://qareportportal.capillary.in</con:endpoint><con:request>{
   "name":"SecurityTestSuits",
   "startTime":"1613029822000",
   "type":"suite",
   "launchUuid":"831de321-d599-4758-9d92-ceac899bf0da",
   "description":"Security Test Suits"
}</con:request><con:originalUri>http://qareportportal.capillary.in/api/v1/superadmin_personal/item</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method></con:resource><con:resource name="startTestCase" path="/api/v1/superadmin_personal/item/{itemId}" id="78064d81-cae0-4d7b-8d31-3d57d3ef8692"><con:settings/><con:parameters><con:parameter><con:name>itemId</con:name><con:value>itemId</con:value><con:style>TEMPLATE</con:style><con:default>itemId</con:default></con:parameter></con:parameters><con:method name="Method 1" id="fa3ba7a9-bf74-4c0b-8862-e2e5c1d9c52e" method="POST"><con:settings/><con:parameters/><con:request name="Request 1" id="bf804461-2728-4247-b175-2cd2dcdbb747" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Bearer 3c24e31f-e667-4ecd-8b80-91b42abccc8f" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>http://qareportportal.capillary.in</con:endpoint><con:request>{
   "name":"CustomerAddSecurityTest",
   "startTime":"1613029822000",
   "type":"test",
   "launchUuid":"831de321-d599-4758-9d92-ceac899bf0da",
   "description":"CustomerAddSecurityTest"
}</con:request><con:originalUri>http://qareportportal.capillary.in/api/v1/superadmin_personal/item/auto%3Aeee9059fa62091ec6e87f2d2f8937ba0</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="itemId" value="fd25798b-974f-4b2d-b5c0-20311b7c1d1e" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:request></con:method></con:resource><con:resource name="startTestStep" path="/api/v1/superadmin_personal/item/{itemId}" id="78064d81-cae0-4d7b-8d31-3d57d3ef8692"><con:settings/><con:parameters><con:parameter><con:name>itemId</con:name><con:value>itemId</con:value><con:style>TEMPLATE</con:style><con:default>itemId</con:default></con:parameter></con:parameters><con:method name="Method 1" id="fa3ba7a9-bf74-4c0b-8862-e2e5c1d9c52e" method="POST"><con:settings/><con:parameters/><con:request name="Request 1" id="bf804461-2728-4247-b175-2cd2dcdbb747" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Bearer 3c24e31f-e667-4ecd-8b80-91b42abccc8f" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>http://qareportportal.capillary.in</con:endpoint><con:request>{
   "name":"CustomerAddFuzzyScan",
   "startTime":"1613029822000",
   "type":"step",
   "launchUuid":"831de321-d599-4758-9d92-ceac899bf0da",
   "description":"CustomerAddFuzzyScan"
}</con:request><con:originalUri>http://qareportportal.capillary.in/api/v1/superadmin_personal/item/auto%3Aeee9059fa62091ec6e87f2d2f8937ba0</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="itemId" value="62940bb8-23a6-4a38-997f-73f72e3893fd" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:request></con:method></con:resource><con:resource name="addLog" path="/api/v1/superadmin_personal/log" id="78064d81-cae0-4d7b-8d31-3d57d3ef8692"><con:settings/><con:parameters><con:parameter><con:name>itemId</con:name><con:value>itemId</con:value><con:style>TEMPLATE</con:style><con:default>itemId</con:default></con:parameter></con:parameters><con:method name="Method 1" id="fa3ba7a9-bf74-4c0b-8862-e2e5c1d9c52e" method="POST"><con:settings/><con:parameters/><con:request name="Request 1" id="bf804461-2728-4247-b175-2cd2dcdbb747" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Bearer 3c24e31f-e667-4ecd-8b80-91b42abccc8f" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>http://qareportportal.capillary.in</con:endpoint><con:request>{
   "launchUuid":"831de321-d599-4758-9d92-ceac899bf0da",
   "itemUuid":"8a2b667e-6ce2-4405-870e-db8713b377b5",
   "time":"1613029822000",
   "message":"",
   "level":"info"
}</con:request><con:originalUri>http://qareportportal.capillary.in/api/v1/superadmin_personal/item/auto%3Aeee9059fa62091ec6e87f2d2f8937ba0</con:originalUri><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="itemId" value="62940bb8-23a6-4a38-997f-73f72e3893fd" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:request></con:method></con:resource></con:interface><con:testSuite id="617b1441-f979-4855-baef-f5bc9610b80c" name="Reusable API" disabled="true">
    <con:settings>
      <con:setting id="com.eviware.soapui.impl.wsdl.panels.testcase.JTestRunLog$OptionsForm@max_rows">1000</con:setting>
      <con:setting id="com.eviware.soapui.impl.wsdl.panels.testcase.JTestRunLog$OptionsForm@errors_only">false</con:setting>
    </con:settings>
    <con:runType>PARALLELL</con:runType>
    <con:testCase id="a6919450-66f2-417f-9891-60d4219922a2" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TransactionAdd" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="get txn numer" id="ebafad87-9920-45df-a6d0-64a324a881a2">
        <con:settings/>
        <con:config>
          <script>String timestamp = System.currentTimeMillis().toString()
log.info timestamp
testRunner.testCase.setPropertyValue("tnx_number",timestamp);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="get current date and time" id="022d35e4-b48a-4ff3-afa8-fdccd2adeb35">
        <con:settings/>
        <con:config>
          <script>def getcurrent = Calendar.getInstance()
String current_time = getcurrent.format("yyyy-MM-dd HH:mm:ss");
testRunner.testCase.testSuite.setPropertyValue("current_time",current_time);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="get phone number" id="e2d7ab90-5188-4717-be44-f6c409db964c">
        <con:settings/>
        <con:config>
          <script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
testRunner.testCase.setPropertyValue("mobile","919" + mobile);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="addTransaction" id="dc6dd2e1-ece2-4167-9d0e-390ca93e8be6">
        <con:settings/>
        <con:config service="addRegularTransaction" resourcePath="/v1.1/transaction/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="addTransaction" id="30d7b033-bada-4cf6-abdf-781b858869dc" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "transaction": {
      "type": "regular",
      "number": "${#TestCase#tnx_number}",
      "amount": "1200",
      "billing_time": "${#TestSuite#current_time}",
      "gross_amount": "101",
      "redemptions": {
        "points_redemptions": {

        },
        "coupon_redemptions": {

        }
      },
      "customer": {
        "mobile": "${#TestCase#mobile}",
        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",
        "type": "loyalty"
      },
      "custom_fields": {
        "field": {
          "name": "testcustom",
          "value": "test"
        }
      },
      "extended_fields": {
        "field": {
          "name": "CentralGST",
          "value": "98"
        }
      },
      "line_items": {
        "line_item": [
          {
            "attributes": {
              "attribute": {
                "name": "jeans",
                "value": "jeans"
              }
            },
            "serial": "1",
            "amount": "500",
            "description": "White",
            "item_code": "Pearls",
            "qty": "20",
            "rate": "50",
            "value": "1000",
            "discount": "0",
            "notes": "Return type of a line item with full"
          },
          {
            "attributes": {
              "attribute": {
                "name": "jeans",
                "value": "jeans"
              }
            },
            "serial": "2",
            "amount": "500",
            "description": "Extra",
            "item_code": "Extra",
            "qty": "10",
            "rate": "50",
            "value": "500",
            "discount": "0",
            "notes": "Return type of a line item with full"
          },
          {
            "attributes": {
              "attribute": {
                "name": "jeans",
                "value": "jeans"
              }
            },
            "serial": "3",
            "amount": "700",
            "description": "Extra",
            "item_code": "Extra",
            "qty": "1",
            "rate": "700",
            "value": "700",
            "discount": "0",
            "notes": "Return type of a line item with full"
          }
        ]
      }
    }
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/transaction/add</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="e6f1b9ef-b7b8-4fc0-b402-4192ca816b85" name="Verfiy add transaction response">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


String mob = context.expand('${#TestCase#mobile}')
String tnxNumber = context.expand('${#TestCase#tnx_number}')

// Get customer point info before the tnx.


//get transaction details
String tnxID = json.response.transactions.transaction.id[0].toString();
String billNumber = json.response.transactions.transaction.number[0].toString();
String type = json.response.transactions.transaction.type[0].toString();

assert(billNumber == tnxNumber);
messageExchange.modelItem.testCase.setPropertyValue("tnxID",tnxID);


//get customer details.

String user_id = json.response.transactions.transaction.customer[0].user_id.toString();
messageExchange.modelItem.testCase.setPropertyValue("user_id",user_id);
String mobile = json.response.transactions.transaction.customer[0].mobile.toString();
assert(mobile == mob);
messageExchange.modelItem.testCase.setPropertyValue("tnx_mobile",mobile);
String fname = json.response.transactions.transaction.customer[0].firstname.toString();
assert(fname == "fname_" + mob);
String lname = json.response.transactions.transaction.customer[0].lastname.toString();
assert(lname == "lname_" + mob);
String email = json.response.transactions.transaction.customer[0].email.toString();
assert(email == mob + "@gmail.com")

String awarded_points = json.response.transactions.transaction.side_effects[0].effect.awarded_points[0].toString();
String totalPoints = json.response.transactions.transaction.side_effects[0].effect.total_points[0].toString();

messageExchange.modelItem.testCase.setPropertyValue("awarded_points_afterTnx",awarded_points);

messageExchange.modelItem.testCase.setPropertyValue("totalPoints_afterTnx",totalPoints);



//Item status.
assert(json.response.transactions.transaction.item_status[0].success == "true")
assert(json.response.transactions.transaction.item_status[0].code == 600)
String msg = json.response.transactions.transaction.item_status[0].message;
if(msg.toLowerCase() == "transaction added successfully"){
	assert true;
}
else{
	assert false : "Getting message as - " + msg;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Valid HTTP Status Codes" id="190ad7c6-4b58-4bce-a46d-8f3e1521b68c" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:preemptive>false</con:preemptive>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>tnx_number</con:name>
          <con:value>1591618396257</con:value>
        </con:property>
        <con:property>
          <con:name>tnxID</con:name>
          <con:value>38261500</con:value>
        </con:property>
        <con:property>
          <con:name>user_id</con:name>
          <con:value>379085721</con:value>
        </con:property>
        <con:property>
          <con:name>mobile</con:name>
          <con:value>919618396262</con:value>
        </con:property>
        <con:property>
          <con:name>awarded_points_afterTnx</con:name>
          <con:value>500</con:value>
        </con:property>
        <con:property>
          <con:name>totalPoints_afterTnx</con:name>
          <con:value>500</con:value>
        </con:property>
        <con:property>
          <con:name>pointBalance_afterTnx</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>tnx_mobile</con:name>
          <con:value>919618396262</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="e2f222e7-9e9d-4be0-926a-e697dbefc4f6" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="TransactionAddForNonDefaultProgram" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="get txn number" id="3256e6ff-bbd0-4566-bd53-e8f859eab140">
        <con:settings/>
        <con:config>
          <script>String timestamp = System.currentTimeMillis().toString()
testRunner.testCase.setPropertyValue("tnx_number",timestamp);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="get current date and time" id="a0053fb7-9bd0-42a4-96cc-bc04b2057922">
        <con:settings/>
        <con:config>
          <script>def getcurrent = Calendar.getInstance()
String current_time = getcurrent.format("yyyy-MM-dd HH:mm:ss");
testRunner.testCase.setPropertyValue("current_time",current_time);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="addTransactionFromNonDefaultTill" id="af3b04be-ed8e-4f6e-ad7c-d003098990cc">
        <con:settings/>
        <con:config service="addRegularTransaction" resourcePath="/v1.1/transaction/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="addTransactionFromNonDefaultTill" id="30d7b033-bada-4cf6-abdf-781b858869dc" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "transaction": {
      "type": "regular",
      "number": "${#TestCase#tnx_number}",
      "amount": "1200",
      "billing_time": "${#TestCase#current_time}",
      "gross_amount": "101",
      "redemptions": {
        "points_redemptions": {

        },
        "coupon_redemptions": {

        }
      },
      "customer": {
        "mobile": "${#TestCase#mobilNuberFromCalledFunction}",
        "firstname": "fname_${#TestCase#mobilNuberFromCalledFunction}",
        "lastname": "lname_${#TestCase#mobilNuberFromCalledFunction}",
        "email": "${#TestCase#mobilNuberFromCalledFunction}@gmail.com",
        "type": "loyalty"
      },
      "custom_fields": {
        "field": {
          "name": "testcustom",
          "value": "test"
        }
      },
      "extended_fields": {
        "field": {
          "name": "CentralGST",
          "value": "98"
        }
      },
      "line_items": {
        "line_item": [
          {
            "attributes": {
              "attribute": {
                "name": "jeans",
                "value": "jeans"
              }
            },
            "serial": "1",
            "amount": "500",
            "description": "White",
            "item_code": "Pearls",
            "qty": "20",
            "rate": "50",
            "value": "1000",
            "discount": "0",
            "notes": "Return type of a line item with full"
          },
          {
            "attributes": {
              "attribute": {
                "name": "jeans",
                "value": "jeans"
              }
            },
            "serial": "2",
            "amount": "500",
            "description": "Extra",
            "item_code": "Extra",
            "qty": "10",
            "rate": "50",
            "value": "500",
            "discount": "0",
            "notes": "Return type of a line item with full"
          },
          {
            "attributes": {
              "attribute": {
                "name": "jeans",
                "value": "jeans"
              }
            },
            "serial": "3",
            "amount": "700",
            "description": "Extra",
            "item_code": "Extra",
            "qty": "1",
            "rate": "700",
            "value": "700",
            "discount": "0",
            "notes": "Return type of a line item with full"
          }
        ]
      }
    }
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/transaction/add</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="493f8172-1390-4d91-a9ac-f26069a2fb58" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ad2f17d6-a168-47ca-a0de-8db6e0276f68" name="Validate non default response">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


String mob = context.expand('${#TestCase#mobilNuberFromCalledFunction}')
String tnxNumber = context.expand('${#TestCase#tnx_number}')

// Get customer point info before the tnx.


//get transaction details
String tnxID = json.response.transactions.transaction.id[0].toString();
String billNumber = json.response.transactions.transaction.number[0].toString();
String type = json.response.transactions.transaction.type[0].toString();

assert(billNumber == tnxNumber);
messageExchange.modelItem.testCase.setPropertyValue("non_default_tnxID",tnxID);
messageExchange.modelItem.testCase.setPropertyValue("non_default_tnx_number",billNumber);


//get customer details.

String user_id = json.response.transactions.transaction.customer[0].user_id.toString();
messageExchange.modelItem.testCase.setPropertyValue("non_default_tnx_user_id",user_id);
String mobile = json.response.transactions.transaction.customer[0].mobile.toString();
assert(mobile == mob);
messageExchange.modelItem.testCase.setPropertyValue("non_default_tnx_mobile",mobile);
String fname = json.response.transactions.transaction.customer[0].firstname.toString();
assert(fname == "fname_" + mob);
String lname = json.response.transactions.transaction.customer[0].lastname.toString();
assert(lname == "lname_" + mob);
String email = json.response.transactions.transaction.customer[0].email.toString();
assert(email == mob + "@gmail.com")

String lifetime_points = json.response.transactions.transaction.customer[0].lifetime_points.toString();
String totalPoints = json.response.transactions.transaction.customer[0].loyalty_points.toString();

messageExchange.modelItem.testCase.setPropertyValue("non_default_tnx_awarded_points_afterTnx",lifetime_points);

messageExchange.modelItem.testCase.setPropertyValue("non_default_tnx_totalPoints_afterTnx",totalPoints);



//Item status.
assert(json.response.transactions.transaction.item_status[0].success == "true")
assert(json.response.transactions.transaction.item_status[0].code == 600)
String msg = json.response.transactions.transaction.item_status[0].message;
if(msg.toLowerCase() == "transaction added successfully"){
	assert true;
}
else{
	assert false : "Getting message as - " + msg;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#TestCase#non_default_auth_username}</con:username>
              <con:password>${#TestCase#non_default_auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>mobilNuberFromCalledFunction</con:name>
          <con:value>919736268900</con:value>
        </con:property>
        <con:property>
          <con:name>non_default_auth_username</con:name>
          <con:value>alpha_endtoend_test</con:value>
        </con:property>
        <con:property>
          <con:name>non_default_auth_password</con:name>
          <con:value>202cb962ac59075b964b07152d234b70</con:value>
        </con:property>
        <con:property>
          <con:name>tnx_number</con:name>
          <con:value>1590736272947</con:value>
        </con:property>
        <con:property>
          <con:name>current_time</con:name>
          <con:value>2020-05-29 12:41:12</con:value>
        </con:property>
        <con:property>
          <con:name>tnxID</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>user_id</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>non_default_tnxID</con:name>
          <con:value>38260737</con:value>
        </con:property>
        <con:property>
          <con:name>non_default_tnx_user_id</con:name>
          <con:value>379076669</con:value>
        </con:property>
        <con:property>
          <con:name>non_default_tnx_mobile</con:name>
          <con:value>919736268900</con:value>
        </con:property>
        <con:property>
          <con:name>non_default_tnx_awarded_points_afterTnx</con:name>
          <con:value>880</con:value>
        </con:property>
        <con:property>
          <con:name>non_default_tnx_totalPoints_afterTnx</con:name>
          <con:value>880</con:value>
        </con:property>
        <con:property>
          <con:name>non_default_tnx_number</con:name>
          <con:value>1590736272947</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="23925634-f0eb-426a-a829-a89cf00cdd78" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="RegisterNewCustomer" searchProperties="true">
      <con:settings/>
      <con:properties/>
    </con:testCase>
    <con:properties>
      <con:property>
        <con:name>mobile</con:name>
        <con:value>8767496655</con:value>
      </con:property>
      <con:property>
        <con:name>current_time</con:name>
        <con:value>2020-06-08 17:43:16</con:value>
      </con:property>
    </con:properties>
  </con:testSuite>
  <con:testSuite id="08af953c-11b1-4045-afcf-a530baaaf3b1" name="ReportPortal"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="dadfd790-cd07-40e0-8a74-f7e9ffe0572a" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Start launch" searchProperties="true"><con:settings/><con:properties/></con:testCase><con:properties/></con:testSuite>
  <con:testSuite id="b7186296-ce49-40a4-8956-65b39421bc62" name="Events_pushing_fine_to_webhook">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase id="b4789551-1d5f-46bd-bdba-b8c0119d65a7" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Event_CustomerAdd" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" amfAuthorisation="false" amfEndpoint="" amfLogin="" amfPassword="">
      <con:description>Pre-Requisite :
1. Webhook created.
2. Loyalty program added with default program having strategy -
    a) On customer registration there would be a point allocation to cuatomer of any amount.
   b) There is a promotion point of any amount during cuatomer registration.</con:description>
      <con:settings/>
      <con:testStep type="groovy" name="Groovy Script" id="b10818fb-1123-4385-b87e-b99aeb2f7327" disabled="true">
        <con:settings/>
        <con:config>
          <script>def demoinstance = new Demo();
log.info("Greeting" + demoinstance.hello());</script>
        </con:config>
      </con:testStep>
      <con:testStep type="httprequest" name="reset my webhook workspace before moving ahead" id="0a237cc2-74b3-4cbc-af77-d8cffeec53c1">
        <con:settings/>
        <con:config method="GET" xsi:type="con:HttpRequest" id="32b3cc09-1f89-46c2-b490-b844cbf09632" name="reset my webhook workspace before moving ahead" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>http://${#Project#webhook_workspace}/api/events/reset</con:endpoint>
          <con:request/>
          <con:credentials>
            <con:username/>
            <con:password/>
            <con:domain/>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="get unique phone number and email to register" id="88e636c2-72fe-4ad6-8f0d-d09309c87ce0">
        <con:settings/>
        <con:config>
          <script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
testRunner.testCase.testSuite.setPropertyValue("mobile","919" + mobile);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="register a new customer" id="f282289d-1e50-45a7-972b-a56a2b148cfb">
        <con:settings/>
        <con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="register a new customer" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestSuite#mobile}",
        "email": "${#TestSuite#mobile}@gmail.com",

        "firstname": "fname_${#TestSuite#mobile}",
        "lastname": "lname_${#TestSuite#mobile}",
        "external_id": "x${#TestSuite#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="6561825e-a822-4b5a-8d71-764b779e304e" name="Status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="5b1e5a91-9733-4e79-a8df-37a1c6ca91ff" name="capture request id">
              <con:configuration>
                <scriptText>String req_id = messageExchange.responseHeaders["X-CAP-REQUEST-ID"][0].toString();
messageExchange.modelItem.testCase.setPropertyValue("request_id",req_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="358bd7c4-10af-4b97-9e52-6af837cb76b9" name="validate customer registration data">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


//assert success holder in response
assert(json.response.status.success == "true")
assert(json.response.status.code == 200)
assert(json.response.status.message == "Success")


//assert customer data.

assert(json.response.customers.customer.user_id.size() == 1);

String user_id = json.response.customers.customer.user_id[0];
String f_name = json.response.customers.customer.firstname[0];
String l_name = json.response.customers.customer.lastname[0];
String mobile = json.response.customers.customer.mobile[0];
String email = json.response.customers.customer.email[0];
String lifetime_points = json.response.customers.customer.lifetime_points[0];
String loyalty_points = json.response.customers.customer.loyalty_points[0];
String current_slab = json.response.customers.customer.current_slab[0];

String lifetime_purchases = json.response.customers.customer.lifetime_purchases[0];
String type = json.response.customers.customer.type[0];
String source = json.response.customers.customer.source[0];
String mobile_reg = context.expand('${#TestSuite#mobile}');







assert(lifetime_purchases == "0") // as this is new customer with no transactions.
assert(mobile == mobile_reg)
assert(json.response.customers.customer.subscriptions[0].subscription.size() == 4) // as we have configured 4 subscription while adding a customer.
assert(f_name == "fname_" + mobile_reg);
assert(l_name == "lname_" + mobile_reg);
assert(email == mobile_reg + "@gmail.com");
messageExchange.modelItem.testCase.setPropertyValue("user_id",user_id);
messageExchange.modelItem.testCase.testSuite.setPropertyValue("user_id",user_id);
messageExchange.modelItem.testCase.setPropertyValue("lifetime_points",lifetime_points.toString());
messageExchange.modelItem.testCase.setPropertyValue("loyalty_points",loyalty_points.toString());





//item status.

assert(json.response.customers.customer.item_status[0].success == "true")
assert(json.response.customers.customer.item_status[0].code == "1000")
if(json.response.customers.customer.item_status[0].message == "Customer registration successful"){
	assert true;
}
else{
	assert false : "customer registration not done! " + json.response.customers.customer.item_status[0].message
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="format" value="json"/>
              <con:entry key="version" value="v1.1"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="get webhooks and fetch webhook consumer id" id="7561891d-ae8a-487d-a216-0bb84b89b15b">
        <con:settings/>
        <con:config service="getWebhooks" resourcePath="/{version}/webHooks" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="get webhooks and fetch webhook consumer id" id="e34c812d-806e-498b-adbd-323081eda9a6" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="bd5d1a2f-529b-492a-bf27-f3681c66848c" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="b9a1562a-b14d-4245-a079-7407ffcc3c36" name="get webhook consumer id by webhook name">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def webhook_names = json.data.name;
def my_webhook = context.expand('${#Project#webhook_workspace_name}');
int index = 0;
String consumer_id = "";
for(name in webhook_names){
	if(name == my_webhook){
		consumer_id = json.data.consumerGroupId[index];
	}
	index++;
}

messageExchange.modelItem.testCase.testSuite.setPropertyValue("webhook_consumerID",consumer_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:preemptive>true</con:preemptive>
              <con:authType>Preemptive</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="version" value="v3" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Poll the status of event log" id="f6549071-9d0a-411d-be4f-0a690bbecb24">
        <con:settings/>
        <con:config>
          <script>import com.eviware.soapui.model.testsuite.TestStepResult
import com.eviware.soapui.model.testsuite.TestStepResult.TestStepStatus
import com.eviware.soapui.model.testsuite.TestStep

int maxRetries = 10;

int polling_time = Integer.parseInt(context.expand('${#Project#polling_time}'));

while(maxRetries > 0){
	TestStep teststep = testRunner.testCase.testSuite.testCases["Event_CustomerAdd"].testSteps["poll event log"]
	TestStepResult result = teststep.run(testRunner,context)
	TestStepStatus status = result.getStatus();
	log.info "Status -- " + status
	if(status == TestStepStatus.OK){
		maxRetries=0;
		break;
	}
	else{
		sleep(polling_time);
	}
	maxRetries--;
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="get loyalty program info for customer" id="6693a1cf-f93d-47c9-b393-df54e1346fce">
        <con:settings/>
        <con:config service="getCustomerV2" resourcePath="/v2/customers/{user_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="get loyalty program info for customer" id="35a353eb-1756-4e37-83f8-d8c4a290f0aa" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v2/customers/376790377</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="396dd36d-730e-404e-bac9-0e2754e38fa0" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="db44dbb0-61ac-473b-ac62-0e0c1d71ee5f" name="Script Assertion">
              <con:configuration>
                <scriptText><![CDATA[import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

messageExchange.modelItem.testCase.setPropertyValue("loyaltyType",json.loyaltyInfo.loyaltyType);
messageExchange.modelItem.testCase.setPropertyValue("source",json.loyaltyInfo.attributionV2.createdFromSource);
messageExchange.modelItem.testCase.setPropertyValue("till_code",json.loyaltyInfo.attributionV2.createdBy.code);
messageExchange.modelItem.testCase.setPropertyValue("till_name",json.loyaltyInfo.attributionV2.createdBy.name);





// Gets loyalty points info.
int count = json.loyaltyProgramDetails.loyaltyPoints.size();

ArrayList<Integer> lstLifeTimePoints = new ArrayList<>();
ArrayList<Integer> lstLoyaltyPoints = new ArrayList<>();
ArrayList<String> lstCurrentSlabs = new ArrayList<>();
ArrayList<Integer> lstProgramIds = new ArrayList<>();
ArrayList<String> lstProgramTitles = new ArrayList<>();

for(i = 0;i<count;i++){
	int loyaltypoints = json.loyaltyProgramDetails.loyaltyPoints[i];
	int lifetimepoints = json.loyaltyProgramDetails.lifetimePoints[i];
	if(loyaltypoints == 0){
		continue;
	}
	String currSlabs = json.loyaltyProgramDetails.currentSlab[i].toString()
	int programID = json.loyaltyProgramDetails.programId[i];
	String programTitle = json.loyaltyProgramDetails.programTitle[i].toString()
	lstLifeTimePoints.add(lifetimepoints);
	lstLoyaltyPoints.add(loyaltypoints);
	lstCurrentSlabs.add(currSlabs);
	lstProgramIds.add(programID)
	lstProgramTitles.add(programTitle);
	}

//Settign the details at test case level.
messageExchange.modelItem.testCase.setPropertyValue("lstLifeTimePoints_AfterTnx",lstLifeTimePoints.inspect());
messageExchange.modelItem.testCase.setPropertyValue("lstLoyaltyPoints_AfterTnx",lstLoyaltyPoints.inspect());
messageExchange.modelItem.testCase.setPropertyValue("lstCurrentSlabs_AfterTnx",lstCurrentSlabs.inspect());
messageExchange.modelItem.testCase.setPropertyValue("lstProgramIds_AfterTnx",lstProgramIds.inspect());
messageExchange.modelItem.testCase.setPropertyValue("lstProgramTitles_AfterTnx",lstProgramTitles.inspect());]]></scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="user_id" value="${#TestCase#user_id}" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="validate the event log in mongo via an API" id="bb22ebf6-3c43-48d6-900f-1093ae6a7bac">
        <con:settings/>
        <con:config service="getEventLogs" resourcePath="/{version}/webHooks/eventLog/requestId/{request_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="validate the event log in mongo via an API" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9a67073e-d145-4c5f-90bf-7b2955e84d93" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ac07e8a1-01a4-49a8-9e5d-6e28d324525f" name="Validate &quot;Customer Added&quot; events pushed">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def consumers = json.data.consumerGroupId;

int index = 0;
String my_consumer = context.expand('${#TestSuite#webhook_consumerID}');

ArrayList&lt;String> eventNames = new ArrayList();

ArrayList&lt;Integer> consumersStatus = new ArrayList();

for(consumer in consumers){
	if(consumer == my_consumer){
		String event_name = json.data.eventName[index];
		def consumerResponse = json.data.consumerResponse[index]
		assert(consumerResponse != null) : "Consumer response is NULL "
		int status = json.data.consumerResponse[index].webhookHttpStatus;
		eventNames.add(event_name);
		consumersStatus.add(status);
	}
	index++;
}

int eventCount = eventNames.size()
messageExchange.modelItem.testCase.setPropertyValue("events",eventNames.inspect())
messageExchange.modelItem.testCase.setPropertyValue("eventStatus",consumersStatus.inspect())

//all status should be 200
for(String status : consumersStatus){
	assert status == "200"
}
//customerAdded event should be pushed, as that is triggered as part of test case.
assert('customerAdded' in eventNames)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="version" value="v3"/>
              <con:entry key="request_id" value="${#TestCase#request_id}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>request_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="httprequest" name="validate response data in webhook" id="77328294-93fc-4c70-95f6-1b7b95f83c67">
        <con:settings/>
        <con:config method="GET" xsi:type="con:HttpRequest" id="a8d53e36-26fb-4c1a-8c27-d0cb991becfb" name="validate response data in webhook" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>http://${#Project#webhook_workspace}/api/events</con:endpoint>
          <con:request/>
          <con:assertion type="Valid HTTP Status Codes" id="6f4c5385-a53b-43e7-bbcb-3e084abfe072" name="status - 200">
            <con:configuration>
              <codes>200</codes>
            </con:configuration>
          </con:assertion>
          <con:assertion type="GroovyScriptAssertion" id="b125b22a-5024-494c-b2f4-26382b2aaa51" name="Script Assertion">
            <con:configuration>
              <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

int bodyCount = json.body.size();
def events = Eval.me(context.expand('${#TestCase#events}'))
def eventsInConsumer = json.body.eventName

messageExchange.modelItem.testCase.setPropertyValue('eventsReceived',eventsInConsumer.inspect())
assert(bodyCount == events.size())

assert('customerAdded' in eventsInConsumer)

for(int i = 0;i&lt;bodyCount;i++){
	String event_name = json.body[i].eventName;
	log.info event_name;
	if(event_name == "customerAdded"){
		def loyaltyType = json.body[i].data.loyaltyType;
		def source = json.body[i].data.source;
		def firstName = json.body[i].data.firstName;
		def lastName = json.body[i].data.lastName;
		def tillcode = json.body[i].data.enteredBy.till.code;
		def tillname = json.body[i].data.enteredBy.till.name;
		def storecode = json.body[i].data.enteredBy.store.code;
		def storename = json.body[i].data.enteredBy.store.name;
		def cust_id = json.body[i].data.customerIdentifiers.customerId.toString();
		def mobile = json.body[i].data.customerIdentifiers.instore.mobile;
		def email = json.body[i].data.customerIdentifiers.instore.email;

		def loyalty_type = context.expand('${#TestCase#loyaltyType}');
		def loyalty_source = context.expand('${#TestCase#source}');
		def f_name = "fname_" + context.expand('${#TestSuite#mobile}');
		def l_name = "lname_" + context.expand('${#TestSuite#mobile}');
		def till_code = context.expand('${#TestCase#till_code}');
		def till_name = context.expand('${#TestCase#till_name}');
		def user_id = context.expand('${#TestSuite#user_id}');
		def user_mobile = context.expand('${#TestSuite#mobile}');
		def user_email = context.expand('${#TestSuite#mobile}') + "@gmail.com";


	}

}</scriptText>
            </con:configuration>
          </con:assertion>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:parameter>
              <con:name>request_id</con:name>
              <con:value>${#TestCase#request_id}</con:value>
              <con:style>QUERY</con:style>
              <con:default/>
              <con:path xsi:nil="true"/>
              <con:description xsi:nil="true"/>
            </con:parameter>
          </con:parameters>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="poll event log" id="eda04b81-52aa-4668-95cc-b01572dc5fe1" disabled="true">
        <con:settings/>
        <con:config service="getEventLogs" resourcePath="/{version}/webHooks/eventLog/requestId/{request_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="poll event log" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9a67073e-d145-4c5f-90bf-7b2955e84d93" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ac07e8a1-01a4-49a8-9e5d-6e28d324525f" name="Validate &quot;Customer Added&quot; events pushed">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def consumers = json.data.consumerGroupId;

int index = 0;
String my_consumer = context.expand('${#TestSuite#webhook_consumerID}');
ArrayList&lt;String> cusumerResponse = new ArrayList&lt;>()

for(consumer in consumers){
	if(consumer == my_consumer){
		String event_name = json.data.eventName[index];
		def consumerResponse = json.data.consumerResponse[index]
		assert(consumerResponse != null)

	}
	index++;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="version" value="v3"/>
              <con:entry key="request_id" value="${#TestCase#request_id}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>request_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:setupScript/>
      <con:properties>
        <con:property>
          <con:name>request_id</con:name>
          <con:value>1aa492623965cc3abcd757f67525d525</con:value>
        </con:property>
        <con:property>
          <con:name>user_id</con:name>
          <con:value>371409770</con:value>
        </con:property>
        <con:property>
          <con:name>lifetime_points</con:name>
          <con:value>340</con:value>
        </con:property>
        <con:property>
          <con:name>loyalty_points</con:name>
          <con:value>323</con:value>
        </con:property>
        <con:property>
          <con:name>loyaltyType</con:name>
          <con:value>loyalty</con:value>
        </con:property>
        <con:property>
          <con:name>source</con:name>
          <con:value>instore</con:value>
        </con:property>
        <con:property>
          <con:name>till_code</con:name>
          <con:value>api.auto1</con:value>
        </con:property>
        <con:property>
          <con:name>till_name</con:name>
          <con:value>api.auto1</con:value>
        </con:property>
        <con:property>
          <con:name>lstLifeTimePoints_AfterTnx</con:name>
          <con:value>[140]</con:value>
        </con:property>
        <con:property>
          <con:name>lstLoyaltyPoints_AfterTnx</con:name>
          <con:value>[140]</con:value>
        </con:property>
        <con:property>
          <con:name>lstCurrentSlabs_AfterTnx</con:name>
          <con:value>['Silver']</con:value>
        </con:property>
        <con:property>
          <con:name>lstProgramIds_AfterTnx</con:name>
          <con:value>[1465]</con:value>
        </con:property>
        <con:property>
          <con:name>lstProgramTitles_AfterTnx</con:name>
          <con:value>['ApiAutomationOrgDefaultProgram']</con:value>
        </con:property>
        <con:property>
          <con:name>eventCount</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>events</con:name>
          <con:value>[]</con:value>
        </con:property>
        <con:property>
          <con:name>eventStatus</con:name>
          <con:value>[]</con:value>
        </con:property>
        <con:property>
          <con:name>eventsReceived</con:name>
          <con:value>[]</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="955e792e-1531-4a94-a652-34ff3ad3d8d1" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Event_RegularTransactionAdd" searchProperties="true">
      <con:description>Pre-Requisite :
1. Webhook created.
2. Loyalty program added with default program having strategy -
    a) On customer registration there would be a point allocation to cuatomer of any amount.
   b) There is a promotion point of any amount during cuatomer registration.</con:description>
      <con:settings/>
      <con:testStep type="httprequest" name="reset my webhook workspace before moving ahead" id="748aa764-7477-49a4-afd9-9bb87732723d" disabled="true">
        <con:settings/>
        <con:config method="GET" xsi:type="con:HttpRequest" id="32b3cc09-1f89-46c2-b490-b844cbf09632" name="reset my webhook workspace before moving ahead" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>http://${#Project#webhook_workspace}/api/events/reset</con:endpoint>
          <con:request/>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters/>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="get customer points info before tnx" id="cc8575db-d680-4343-8d05-7944db279f4a">
        <con:settings/>
        <con:config service="getCustomerV2" resourcePath="/v2/customers/{user_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="get customer points info before tnx" id="35a353eb-1756-4e37-83f8-d8c4a290f0aa" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v2/customers/376790377</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="396dd36d-730e-404e-bac9-0e2754e38fa0" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="db44dbb0-61ac-473b-ac62-0e0c1d71ee5f" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

messageExchange.modelItem.testCase.setPropertyValue("loyaltyType",json.loyaltyInfo.loyaltyType);
messageExchange.modelItem.testCase.setPropertyValue("source",json.loyaltyInfo.attributionV2.createdFromSource);
messageExchange.modelItem.testCase.setPropertyValue("till_code",json.loyaltyInfo.attributionV2.createdBy.code);
messageExchange.modelItem.testCase.setPropertyValue("till_name",json.loyaltyInfo.attributionV2.createdBy.name);



// setting everything as blank
messageExchange.modelItem.testCase.setPropertyValue("loyaltyPoints","");
	messageExchange.modelItem.testCase.setPropertyValue("lifetimepointsPoints","")
	messageExchange.modelItem.testCase.setPropertyValue("currentSlab","")
	messageExchange.modelItem.testCase.setPropertyValue("nextSlab","")
	messageExchange.modelItem.testCase.setPropertyValue("programID","")
	messageExchange.modelItem.testCase.setPropertyValue("programTitle","")

int count = json.loyaltyProgramDetails.loyaltyPoints.size();

for(i = 0;i&lt;count;i++){
	int loyaltypoints = json.loyaltyProgramDetails.loyaltyPoints[i];

	if(loyaltypoints == 0) continue;
	int lifetimepoints = json.loyaltyProgramDetails.lifetimePoints[i];
	messageExchange.modelItem.testCase.setPropertyValue("loyaltyPoints",loyaltypoints.toString());
	messageExchange.modelItem.testCase.setPropertyValue("lifetimepointsPoints",lifetimepoints.toString())
	messageExchange.modelItem.testCase.setPropertyValue("currentSlab",json.loyaltyProgramDetails.currentSlab[i].toString())
	messageExchange.modelItem.testCase.setPropertyValue("nextSlab",json.loyaltyProgramDetails.nextSlab[i].toString())
	messageExchange.modelItem.testCase.setPropertyValue("programID",json.loyaltyProgramDetails.programId[i].toString())
	messageExchange.modelItem.testCase.setPropertyValue("programTitle",json.loyaltyProgramDetails.programTitle[i].toString())
	messageExchange.modelItem.testCase.setPropertyValue("cumulativePurchases",json.loyaltyProgramDetails.cumulativePurchases[i].toString())
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="user_id" value="${#TestSuite#user_id}" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="get a unique tnx number" id="61c01556-6ee2-401e-b886-1ed223730489">
        <con:settings/>
        <con:config>
          <script>String timestamp = System.currentTimeMillis().toString()
testRunner.testCase.setPropertyValue("tnx_number",timestamp);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="add a regular transaction" id="fa32481f-1e2d-4bfb-a36d-5534d59f6a9c">
        <con:settings/>
        <con:config service="addRegularTransaction" resourcePath="/v1.1/transaction/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="add a regular transaction" id="30d7b033-bada-4cf6-abdf-781b858869dc" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
	"root": {
		"transaction": {
			"bill_client_id": "${#TestSuite#mobile}",
			"type": "regular",
			"number": "${#TestCase#tnx_number}",
			"notes": "2 lin1e items",
			"amount" : 2000,
			"gross_amount": "100",
			"discount": "10",
			"customer": {
				"mobile": "${#TestSuite#mobile}",
				"email": "${#TestSuite#mobile}@gmail.com",
				"external_id": "x${#TestSuite#mobile}",
				"firstname": "fname_${#TestSuite#mobile}",
				"lastname": "lname_${#TestSuite#mobile}"
			},
			"extended_fields": {
				"field": [{
						"name": "ship_first_name",
						"value": "fname_${#TestSuite#mobile}"
					},
					{
						"name": "ship_last_name",
						"value": "lname_${#TestSuite#mobile}"
					}
				]
			},
			"custom_fields": {

				"field": [{
						"name": "bankdetails",
						"value": "SBI"
					},
					{
						"name": "bankdetails",
						"value": "SBI"
					}
				]

			},
			"line_items": {
				"line_item": [{
						"extended_fields": {
							"field": [{
									"name": "MetalRate",
									"value": 23
								},
								{
									"name": "service_tax_amount",
									"value": 100
								}
							]
						},
						"serial": "1",
						"amount": "500",
						"description": "soap",
						"item_code": "item-001",
						"qty": "50",
						"rate": "10",
						"value": "500",
						"attributes": {
							"attribute": {
								"name": "brand",
								"value": "Levis"
							}
						}
					},
					{
						"extended_fields": {
							"field": [{
									"name": "DesignCode",
									"value": "jmh6677"
								},
								{
									"name": "SupplierCode",
									"value": "hgjy111"
								}
							]
						},
						"serial": "2",
						"amount": "500",
						"description": "soap",
						"item_code": "item-001",
						"qty": "50",
						"rate": "10",
						"value": "500",
						"transaction_number": "niBill1",
						"attributes": {
							"attribute": {
								"name": "brand",
								"value": "Levis"
							}
						}
					},
					{
						"extended_fields": {
							"field": [{
									"name": "StoneCharge",
									"value": 22
								},
								{
									"name": "MakingCharge",
									"value": 11
								}
							]
						},
						"serial": "3",
						"item_code": "t122",
						"description": "afvdfvd",
						"qty": "3",
						"rate": "1000",
						"value": "3000",
						"discount_value": "100",
						"amount": "2900",
						"cashier_id": "cash1233",
						"transaction_number": "previousBill1"
					}
				]
			},
			"associate_details": {
				"code": "hiraxdhara",
				"name": "Tom Sawyer"
			}
		}
	}
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/transaction/add</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="1e361c9e-3bde-431e-a3ca-af4c4199f182" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="7e1f7598-72ef-4e4d-bf6c-c718fff7750c" name="capture request ID">
              <con:configuration>
                <scriptText>String req_id = messageExchange.responseHeaders["X-CAP-REQUEST-ID"][0].toString();
messageExchange.modelItem.testCase.setPropertyValue("request_id",req_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="e7fac582-133e-4ed0-8c17-d64cda91eb65" name="verify transaction details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


String mob = context.expand('${#TestSuite#mobile}')
String tnxNumber = context.expand('${#TestCase#tnx_number}')
String cumulativePurchases = context.expand('${#TestCase#cumulativePurchases}');

//asserting status of response
assert(json.response.status.success == "true")
assert(json.response.status.code == 200)
assert(json.response.status.message == "Success")


// Get customer point info before the tnx.

String loyaltyPoints_beforetnx = context.expand('${#TestCase#loyaltyPoints}')


//get transaction details
String tnxID = json.response.transactions.transaction.id[0].toString();
String billNumber = json.response.transactions.transaction.number[0].toString();
String type = json.response.transactions.transaction.type[0].toString();

assert(billNumber == tnxNumber);
messageExchange.modelItem.testCase.setPropertyValue("tnxID",tnxID);


//get customer details.

String user_id = json.response.transactions.transaction.customer[0].user_id.toString();
String cust_id = context.expand('${#TestSuite#user_id}');
//assert(user_id == cust_id);
String mobile = json.response.transactions.transaction.customer[0].mobile.toString();
assert(mobile == mob);
String fname = json.response.transactions.transaction.customer[0].firstname.toString();
assert(fname == "fname_" + mob);
String lname = json.response.transactions.transaction.customer[0].lastname.toString();
assert(lname == "lname_" + mob);
String email = json.response.transactions.transaction.customer[0].email.toString();
assert(email == mob + "@gmail.com")
String externalID = json.response.transactions.transaction.customer[0].external_id.toString();
assert(externalID == "x" + mob);
String lifetimePoints = json.response.transactions.transaction.customer[0].lifetime_points.toString();
messageExchange.modelItem.testCase.setPropertyValue("lifetimePoints_afterTnx",lifetimePoints);
String loyaltyPoints = json.response.transactions.transaction.customer[0].loyalty_points.toString();
messageExchange.modelItem.testCase.setPropertyValue("loyaltyPoints_afterTnx",loyaltyPoints);
String currentSlab = json.response.transactions.transaction.customer[0].current_slab.toString();
messageExchange.modelItem.testCase.setPropertyValue("currentSlab_afterTnx",currentSlab);
String lifetime_purchases = json.response.transactions.transaction.customer[0].lifetime_purchases.toString();
messageExchange.modelItem.testCase.setPropertyValue("lifetime_puchases_afterTnx",lifetime_purchases);



String user_type = json.response.transactions.transaction.customer[0].type.toString();

String source = json.response.transactions.transaction.customer[0].source.toString();

//get side effects of transactions done.
String awarded_points = json.response.transactions.transaction.side_effects[0].effect.awarded_points[0].toString();

String totalPoints = json.response.transactions.transaction.side_effects[0].effect.total_points[0].toString();
String pointBalance = json.response.transactions.transaction.points_balance[0].toString();

messageExchange.modelItem.testCase.setPropertyValue("awarded_points_afterTnx",awarded_points);


messageExchange.modelItem.testCase.setPropertyValue("totalPoints_afterTnx",totalPoints);


//Item status.
assert(json.response.transactions.transaction.item_status[0].success == "true")
assert(json.response.transactions.transaction.item_status[0].code == 600)
String msg = json.response.transactions.transaction.item_status[0].message;
if(msg == "Transaction added successfully"){
	assert true;
}
else{
	assert false : "Status message mismatch - " + msg;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="get webhooks and fetch webhook consumer id" id="5b5f0860-bcdf-4493-8fde-951f37f4afd7">
        <con:settings/>
        <con:config service="getWebhooks" resourcePath="/{version}/webHooks" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="get webhooks and fetch webhook consumer id" id="e34c812d-806e-498b-adbd-323081eda9a6" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="bd5d1a2f-529b-492a-bf27-f3681c66848c" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="b9a1562a-b14d-4245-a079-7407ffcc3c36" name="fetch consumer id">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def webhook_names = json.data.name;
def my_webhook = context.expand('${#Project#webhook_workspace_name}');
int index = 0;
String consumer_id = "";
for(name in webhook_names){
	if(name == my_webhook){
		consumer_id = json.data.consumerGroupId[index];
	}
	index++;
}

messageExchange.modelItem.testCase.setPropertyValue("webhook_consumerID",consumer_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:preemptive>true</con:preemptive>
              <con:authType>Preemptive</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="version" value="v3" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Poll the status of event log" id="d46ab292-662e-4153-be9b-86d60989a2d8">
        <con:settings/>
        <con:config>
          <script>import com.eviware.soapui.model.testsuite.TestStepResult
import com.eviware.soapui.model.testsuite.TestStepResult.TestStepStatus
import com.eviware.soapui.model.testsuite.TestStep

int maxRetries = 10;

int polling_time = Integer.parseInt(context.expand('${#Project#polling_time}'));
while(maxRetries > 0){
	TestStep teststep = testRunner.testCase.testSuite.testCases["Event_RegularTransactionAdd"].testSteps["poll for event logs"]
	TestStepResult result = teststep.run(testRunner,context)
	TestStepStatus status = result.getStatus();
	log.info "Status -- " + status
	if(status == TestStepStatus.OK){
		maxRetries=0;
		break;
	}
	else{
		sleep(polling_time);
	}
	maxRetries--;
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="get loyalty program info for customer" id="06a2b06e-21db-4251-a953-5039c915f041">
        <con:settings/>
        <con:config service="getCustomerV2" resourcePath="/v2/customers/{user_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="get loyalty program info for customer" id="35a353eb-1756-4e37-83f8-d8c4a290f0aa" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v2/customers/376790377</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="396dd36d-730e-404e-bac9-0e2754e38fa0" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="db44dbb0-61ac-473b-ac62-0e0c1d71ee5f" name="Script Assertion">
              <con:configuration>
                <scriptText><![CDATA[import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

messageExchange.modelItem.testCase.setPropertyValue("loyaltyType",json.loyaltyInfo.loyaltyType);
messageExchange.modelItem.testCase.setPropertyValue("source",json.loyaltyInfo.attributionV2.createdFromSource);
messageExchange.modelItem.testCase.setPropertyValue("till_code",json.loyaltyInfo.attributionV2.createdBy.code);
messageExchange.modelItem.testCase.setPropertyValue("till_name",json.loyaltyInfo.attributionV2.createdBy.name);





// Gets loyalty points info.
int count = json.loyaltyProgramDetails.loyaltyPoints.size();

ArrayList<Integer> lstLifeTimePoints = new ArrayList<>();
ArrayList<Integer> lstLoyaltyPoints = new ArrayList<>();
ArrayList<String> lstCurrentSlabs = new ArrayList<>();
ArrayList<Integer> lstProgramIds = new ArrayList<>();
ArrayList<String> lstProgramTitles = new ArrayList<>();

for(i = 0;i<count;i++){
	int loyaltypoints = json.loyaltyProgramDetails.loyaltyPoints[i];
	int lifetimepoints = json.loyaltyProgramDetails.lifetimePoints[i];
	String currSlabs = json.loyaltyProgramDetails.currentSlab[i].toString()
	int programID = json.loyaltyProgramDetails.programId[i];
	String programTitle = json.loyaltyProgramDetails.programTitle[i].toString()
	lstLifeTimePoints.add(lifetimepoints);
	lstLoyaltyPoints.add(loyaltypoints);
	lstCurrentSlabs.add(currSlabs);
	lstProgramIds.add(programID)
	lstProgramTitles.add(programTitle);
	}

//Settign the details at test case level.
messageExchange.modelItem.testCase.setPropertyValue("lstLifeTimePoints_AfterTnx",lstLifeTimePoints.inspect());
messageExchange.modelItem.testCase.setPropertyValue("lstLoyaltyPoints_AfterTnx",lstLoyaltyPoints.inspect());
messageExchange.modelItem.testCase.setPropertyValue("lstCurrentSlabs_AfterTnx",lstCurrentSlabs.inspect());
messageExchange.modelItem.testCase.setPropertyValue("lstProgramIds_AfterTnx",lstProgramIds.inspect());
messageExchange.modelItem.testCase.setPropertyValue("lstProgramTitles_AfterTnx",lstProgramTitles.inspect());]]></scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="user_id" value="${#TestSuite#user_id}" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="validate the event log in mongo via an API" id="eeea1bad-eb9f-4f7d-b1a3-de0f14041d5b">
        <con:settings/>
        <con:config service="getEventLogs" resourcePath="/{version}/webHooks/eventLog/requestId/{request_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="validate the event log in mongo via an API" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9a67073e-d145-4c5f-90bf-7b2955e84d93" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ac07e8a1-01a4-49a8-9e5d-6e28d324525f" name="validate the events pushed status">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def consumers = json.data.consumerGroupId;
int index = 0;
String my_consumer = context.expand('${#TestCase#webhook_consumerID}');
ArrayList&lt;String> eventNames = new ArrayList();
ArrayList&lt;Integer> consumersStatus = new ArrayList();
for(consumer in consumers){
	if(consumer == my_consumer){
		String event_name = json.data.eventName[index];
		def consumerResponse = json.data.consumerResponse[index]
		assert(consumerResponse != null) : "Consumer response is NULL"
		int status = json.data.consumerResponse[index].webhookHttpStatus;
		eventNames.add(event_name);
		consumersStatus.add(status);
	}
	index++;
}

log.info eventNames

messageExchange.modelItem.testCase.setPropertyValue("events",eventNames.inspect())
messageExchange.modelItem.testCase.setPropertyValue("eventStatus",consumersStatus.inspect())

//all status should be 200
for(String status : consumersStatus){
	assert status == "200"
}
//transactionAdded event should be pushed, as that is triggered as part of test case.
assert('transactionAdded' in eventNames) : "transactionAdded event didn't get pushed";</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="version" value="v3"/>
              <con:entry key="request_id" value="${#TestCase#request_id}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>request_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="httprequest" name="validate response data in webhook" id="04494dd1-6a4e-45f6-bef1-4efc69f32c46">
        <con:settings/>
        <con:config method="GET" xsi:type="con:HttpRequest" id="a8d53e36-26fb-4c1a-8c27-d0cb991becfb" name="validate response data in webhook" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>http://${#Project#webhook_workspace}/api/events</con:endpoint>
          <con:request/>
          <con:assertion type="Valid HTTP Status Codes" id="6f4c5385-a53b-43e7-bbcb-3e084abfe072" name="status - 200">
            <con:configuration>
              <codes>200</codes>
            </con:configuration>
          </con:assertion>
          <con:assertion type="GroovyScriptAssertion" id="b125b22a-5024-494c-b2f4-26382b2aaa51" name="validate the payload data">
            <con:configuration>
              <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

int bodyCount = json.body.size();
String mobileNum = context.expand('${#TestSuite#mobile}')
def events = Eval.me(context.expand('${#TestCase#events}'))
def eventsInConsumer = json.body.eventName

messageExchange.modelItem.testCase.setPropertyValue('eventsReceived',eventsInConsumer.inspect())
assert(bodyCount == events.size()) : "All events in event forest didn't pushed to webhook";

assert('transactionAdded' in eventsInConsumer) : "transactionAdded is not pushed in event forest";

for(int i = 0;i&lt;bodyCount;i++){
	String event_name = json.body[i].eventName;
	log.info event_name;
	if(event_name == "transactionAdded"){
    def amount = json.body[i].data.amount;
    def billClientID = json.body[i].data.billClientId;
    def billNumber = json.body[i].data.billNumber;
    def transactionId = json.body[i].data.transactionId.toString();
    def lineItemCount = json.body[i].data.lineItemCount;
    def discount = json.body[i].data.discount;
    def grossAmount = json.body[i].data.grossAmount;
    def cust_id = json.body[i].data.customerIdentifiers.customerId.toString();

    //get tnx info
    def tnxNumber = context.expand('${#TestCase#tnx_number}');
    def tnxID = context.expand('${#TestCase#tnxID}');
    def userID = context.expand('${#TestSuite#user_id}')

    assert(amount == 2000) : "Amount has to be '2000' as we made a transaction of this amount";
    assert(billNumber == tnxNumber);
    assert(transactionId == tnxID);
    assert(billClientID == mobileNum);
    assert(lineItemCount == 3); // as while addign tnx , line item was 2.
    assert(discount == 10);
    assert(grossAmount == 100);
    assert(cust_id == userID);
}
}</scriptText>
            </con:configuration>
          </con:assertion>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:parameter>
              <con:name>request_id</con:name>
              <con:value>${#TestCase#request_id}</con:value>
              <con:style>QUERY</con:style>
              <con:default/>
              <con:path xsi:nil="true"/>
              <con:description xsi:nil="true"/>
            </con:parameter>
          </con:parameters>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="poll for event logs" id="8b0b01e4-1c3b-4e71-9427-d53ca5d23f30" disabled="true">
        <con:settings/>
        <con:config service="getEventLogs" resourcePath="/{version}/webHooks/eventLog/requestId/{request_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="poll for event logs" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9a67073e-d145-4c5f-90bf-7b2955e84d93" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ac07e8a1-01a4-49a8-9e5d-6e28d324525f" name="validate the events pushed status">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def consumers = json.data.consumerGroupId;
log.info consumers
int index = 0;
String my_consumer = context.expand('${#TestCase#webhook_consumerID}');
ArrayList&lt;String> eventNames = new ArrayList();
ArrayList&lt;Integer> consumersStatus = new ArrayList();
for(consumer in consumers){
	if(consumer == my_consumer){
		String event_name = json.data.eventName[index];
		def consumerResponse = json.data.consumerResponse[index]
		assert(consumerResponse != null)
	}
	index++;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="version" value="v3"/>
              <con:entry key="request_id" value="${#TestCase#request_id}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>request_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:setupScript/>
      <con:properties>
        <con:property>
          <con:name>tnx_number</con:name>
          <con:value>1606216622898</con:value>
        </con:property>
        <con:property>
          <con:name>request_id</con:name>
          <con:value>d0a04994602f77452d4e73e57ea1b451</con:value>
        </con:property>
        <con:property>
          <con:name>tnxID</con:name>
          <con:value>37216407</con:value>
        </con:property>
        <con:property>
          <con:name>lifetimePoints_afterTnx</con:name>
          <con:value>340</con:value>
        </con:property>
        <con:property>
          <con:name>loyaltyPoints_afterTnx</con:name>
          <con:value>340</con:value>
        </con:property>
        <con:property>
          <con:name>currentSlab_afterTnx</con:name>
          <con:value>Silver</con:value>
        </con:property>
        <con:property>
          <con:name>lifetime_puchases_afterTnx</con:name>
          <con:value>2000</con:value>
        </con:property>
        <con:property>
          <con:name>awarded_points_afterTnx</con:name>
          <con:value>200</con:value>
        </con:property>
        <con:property>
          <con:name>totalPoints_afterTnx</con:name>
          <con:value>340</con:value>
        </con:property>
        <con:property>
          <con:name>webhook_consumerID</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>loyaltyType</con:name>
          <con:value>loyalty</con:value>
        </con:property>
        <con:property>
          <con:name>source</con:name>
          <con:value>instore</con:value>
        </con:property>
        <con:property>
          <con:name>till_code</con:name>
          <con:value>api.auto1</con:value>
        </con:property>
        <con:property>
          <con:name>till_name</con:name>
          <con:value>api.auto1</con:value>
        </con:property>
        <con:property>
          <con:name>lstLifeTimePoints_AfterTnx</con:name>
          <con:value>[340]</con:value>
        </con:property>
        <con:property>
          <con:name>lstLoyaltyPoints_AfterTnx</con:name>
          <con:value>[340]</con:value>
        </con:property>
        <con:property>
          <con:name>lstCurrentSlabs_AfterTnx</con:name>
          <con:value>['Silver']</con:value>
        </con:property>
        <con:property>
          <con:name>lstProgramIds_AfterTnx</con:name>
          <con:value>[1465]</con:value>
        </con:property>
        <con:property>
          <con:name>lstProgramTitles_AfterTnx</con:name>
          <con:value>['ApiAutomationOrgDefaultProgram']</con:value>
        </con:property>
        <con:property>
          <con:name>loyaltyPoints</con:name>
          <con:value>140</con:value>
        </con:property>
        <con:property>
          <con:name>lifetimepointsPoints</con:name>
          <con:value>140</con:value>
        </con:property>
        <con:property>
          <con:name>currentSlab</con:name>
          <con:value>Silver</con:value>
        </con:property>
        <con:property>
          <con:name>nextSlab</con:name>
          <con:value>Gold</con:value>
        </con:property>
        <con:property>
          <con:name>programID</con:name>
          <con:value>1465</con:value>
        </con:property>
        <con:property>
          <con:name>programTitle</con:name>
          <con:value>ApiAutomationOrgDefaultProgram</con:value>
        </con:property>
        <con:property>
          <con:name>cumulativePurchases</con:name>
          <con:value>0</con:value>
        </con:property>
        <con:property>
          <con:name>eventsCount</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>events</con:name>
          <con:value>[]</con:value>
        </con:property>
        <con:property>
          <con:name>eventStatus</con:name>
          <con:value>[]</con:value>
        </con:property>
        <con:property>
          <con:name>eventsReceived</con:name>
          <con:value>[]</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="2a379719-45cc-4477-8829-0cd103a804d5" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Event_PointsRedeem" searchProperties="true">
      <con:settings/>
      <con:testStep type="restrequest" name="get customer points and program details" id="796ae79e-a638-4f28-a63a-dd507a4424d4">
        <con:settings/>
        <con:config service="getCustomerV1" resourcePath="/v1.1/customer/get" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="get customer points and program details" id="fffb4960-10e1-4ff0-982b-f7255dbe25c3" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="X-CAP-CLIENT-COUNTRYCODE" value="1" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v1.1/customer/get</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="02d2cebb-039a-4534-8e56-928705e1fb33" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="0d0632a8-44fc-4060-813d-6f01d3ba2e30" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

// assert status contents.

assert(json.response.status.success == "true")
assert(json.response.status.code == 200)
assert(json.response.status.message == "Success")

//get point summary details.

int numOfLinkedProgram = json.response.customers.customer.points_summaries[0].points_summary.programId.size()

for(int i = 0;i&lt;numOfLinkedProgram;i++){
	float loyaltyPoints = Float.parseFloat(json.response.customers.customer.points_summaries[0].points_summary.loyaltyPoints[i])
	if(loyaltyPoints == 0){
		continue;
	}
	String programID = json.response.customers.customer.points_summaries[0].points_summary.programId[i]

	int pointsToBeRedeemed = loyaltyPoints  * (0.05)

	messageExchange.modelItem.testCase.setPropertyValue("programID",programID)
	messageExchange.modelItem.testCase.setPropertyValue("loyaltyPoints",loyaltyPoints.toString())
	messageExchange.modelItem.testCase.setPropertyValue("pointsToBeRedeemed",pointsToBeRedeemed.toString())
	break;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="id" value="${#TestSuite#user_id}" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="check if point is redeemable against a program" id="f4f681f0-d175-41f4-8f7b-703c0b108442">
        <con:settings/>
        <con:config service="isRedeemable" resourcePath="/{version}/points/isredeemable" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="check if point is redeemable against a program" id="7324ca5d-555c-46eb-892f-02a744545f27" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/version/points/isredeemable</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="a80ef4a5-8fce-466f-8319-f3dc33227562" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="67346059-a930-44fc-b3af-1c326b88c74c" name="assert isRedeemable response contents">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


String mobile = context.expand('${#TestSuite#mobile}')
int points = Integer.parseInt(context.expand('${#TestCase#pointsToBeRedeemed}'))

//asssert the status.

assert(json.response.status.success == "true")
assert(json.response.status.code == 200)
assert(json.response.status.message == "Success")


//assert points redeemable info
assert(json.response.points.redeemable.is_redeemable == "true")

assert(json.response.points.redeemable.mobile == mobile)
assert(json.response.points.redeemable.email == mobile + "@gmail.com")
assert(json.response.points.redeemable.external_id == "x" + mobile)

assert(json.response.points.redeemable.points == points)
assert(json.response.points.redeemable.item_status.success == "true")
assert(json.response.points.redeemable.item_status.message == "Points can be redeemed")

//get redeemable value.
messageExchange.modelItem.testCase.setPropertyValue("pointsRedeemableValue",json.response.points.redeemable.points_redeem_value.toString())</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="program_id" value="${#TestCase#programID}"/>
              <con:entry key="mobile" value="${#TestSuite#mobile}"/>
              <con:entry key="version" value="v1.1"/>
              <con:entry key="points" value="${#TestCase#pointsToBeRedeemed}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>format</con:entry>
              <con:entry>points</con:entry>
              <con:entry>skip_validation</con:entry>
              <con:entry>mobile</con:entry>
              <con:entry>program_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="redeem the points against a program" id="8611ade5-d04d-4481-8a4b-42a6f3bee800">
        <con:settings/>
        <con:config service="RedeemPoints" resourcePath="/{version}/points/redeem" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="redeem the points against a program" id="0c6d7d87-8bdb-450b-b683-a4bcddcec72c" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="content-type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "redeem": {
      "points_redeemed": "${#TestCase#pointsToBeRedeemed}",
      "transaction_number": "bill_${#TestSuite#mobile}",
      "customer": { "mobile": "${#TestSuite#mobile}" },
      "notes": "Sample notes",
      "validation_code": "7S8VH7"
    }
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/points/redeem</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="40c1f224-0d3b-4f25-ab58-e2d1c015aeb5" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="452086b6-2fa3-4a9c-9180-bde153efda5a" name="validate the response contents">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


String mobile = context.expand('${#TestSuite#mobile}')
String points = (context.expand('${#TestCase#pointsToBeRedeemed}'))
String user_id = context.expand('${#TestSuite#user_id}')
String pointsRedeemableValue = context.expand('${#TestCase#pointsRedeemableValue}')
String loyaltyPoints = context.expand('${#TestCase#loyaltyPoints}')

//asssert the status.

assert(json.response.status.success == "true")
assert(json.response.status.code == 200)
assert(json.response.status.message == "Success")

// assert the points responses

assert(json.response.responses.points.mobile == mobile)
assert(json.response.responses.points.email == mobile + "@gmail.com")
assert(json.response.responses.points.external_id == "x" + mobile)
assert(json.response.responses.points.user_id == user_id)
assert(json.response.responses.points.points_redeemed == points)
assert(json.response.responses.points.redeemed_value.toString() == pointsRedeemableValue)

log.info json.response.responses.points.side_effects.effect.currency_value[0]
//assert side effects
assert(json.response.responses.points.side_effects.effect.num_points[0].toString() == points)
//assert(json.response.responses.points.side_effects.effect.currency_value[0].toString() == pointsRedeemableValue)
assert(json.response.responses.points.side_effects.effect.validation_code[0] == "7S8VH7") // same is passed oin request.
assert(json.response.responses.points.side_effects.effect.redeemed_on_bill_number[0] == "bill_" + mobile)
assert(json.response.responses.points.side_effects.effect.type[0] == "points")

//assert item status
assert(json.response.responses.points.item_status.success == "true")
assert(json.response.responses.points.item_status.message == "Points Redeemed")</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="0195406a-03c1-4a71-9f78-bc6989b0b710" name="capture request ID">
              <con:configuration>
                <scriptText>String req_id = messageExchange.responseHeaders["X-CAP-REQUEST-ID"][0].toString();
messageExchange.modelItem.testCase.setPropertyValue("request_id",req_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="program_id" value="${#TestCase#programID}"/>
              <con:entry key="version" value="v1.1"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="get webhooks and fetch webhook consumer id" id="f413474d-15bf-4540-8a08-92f526a17150">
        <con:settings/>
        <con:config service="getWebhooks" resourcePath="/{version}/webHooks" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="get webhooks and fetch webhook consumer id" id="e34c812d-806e-498b-adbd-323081eda9a6" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="bd5d1a2f-529b-492a-bf27-f3681c66848c" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="b9a1562a-b14d-4245-a079-7407ffcc3c36" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def webhook_names = json.data.name;
def my_webhook = context.expand('${#Project#webhook_workspace_name}');
int index = 0;
String consumer_id = "";
for(name in webhook_names){
	if(name == my_webhook){
		consumer_id = json.data.consumerGroupId[index];
	}
	index++;
}

messageExchange.modelItem.testCase.setPropertyValue("webhook_consumerID",consumer_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:preemptive>true</con:preemptive>
              <con:authType>Preemptive</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="version" value="v3" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Poll the status of event log" id="4ac93ca2-f22e-4553-a8de-56c64fcfd718">
        <con:settings/>
        <con:config>
          <script>import com.eviware.soapui.model.testsuite.TestStepResult
import com.eviware.soapui.model.testsuite.TestStepResult.TestStepStatus
import com.eviware.soapui.model.testsuite.TestStep

int maxRetries = 10;

int polling_time = Integer.parseInt(context.expand('${#Project#polling_time}'));
while(maxRetries > 0){
	TestStep teststep = testRunner.testCase.testSuite.testCases["Event_PointsRedeem"].testSteps["check event logs"]
	TestStepResult result = teststep.run(testRunner,context)
	TestStepStatus status = result.getStatus();
	log.info "Status -- " + status
	if(status == TestStepStatus.OK){
		maxRetries=0;
		break;
	}
	else{
		sleep(polling_time);
	}
	maxRetries--;
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="validate the event log in mongo via an API" id="0a25b23b-6c39-4362-83b8-8cd7239bf10a">
        <con:settings/>
        <con:config service="getEventLogs" resourcePath="/{version}/webHooks/eventLog/requestId/{request_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="validate the event log in mongo via an API" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9a67073e-d145-4c5f-90bf-7b2955e84d93" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ac07e8a1-01a4-49a8-9e5d-6e28d324525f" name="validate the events pushed status">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def consumers = json.data.consumerGroupId;
int index = 0;
String my_consumer = context.expand('${#TestCase#webhook_consumerID}');
ArrayList&lt;String> eventNames = new ArrayList();
ArrayList&lt;Integer> consumersStatus = new ArrayList();
for(consumer in consumers){
	if(consumer == my_consumer){
		String event_name = json.data.eventName[index];
		def consumerResponse = json.data.consumerResponse[index]
		assert(consumerResponse != null) : "Consumer response is NULL"
		int status = json.data.consumerResponse[index].webhookHttpStatus;
		eventNames.add(event_name);
		consumersStatus.add(status);
	}
	index++;
}

log.info eventNames

messageExchange.modelItem.testCase.setPropertyValue("events",eventNames.inspect())
messageExchange.modelItem.testCase.setPropertyValue("eventStatus",consumersStatus.inspect())

//all status should be 200
for(String status : consumersStatus){
	assert status == "200"
}
//transactionAdded event should be pushed, as that is triggered as part of test case.
assert('pointsRedeemed' in eventNames)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="version" value="v3"/>
              <con:entry key="request_id" value="${#TestCase#request_id}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>request_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="httprequest" name="validate response data in webhook" id="9182bab1-e4f2-4063-a920-379d99cd4026">
        <con:settings/>
        <con:config method="GET" xsi:type="con:HttpRequest" id="a8d53e36-26fb-4c1a-8c27-d0cb991becfb" name="validate response data in webhook" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>http://${#Project#webhook_workspace}/api/events</con:endpoint>
          <con:request/>
          <con:assertion type="Valid HTTP Status Codes" id="6f4c5385-a53b-43e7-bbcb-3e084abfe072" name="status - 200">
            <con:configuration>
              <codes>200</codes>
            </con:configuration>
          </con:assertion>
          <con:assertion type="GroovyScriptAssertion" id="b125b22a-5024-494c-b2f4-26382b2aaa51" name="validate the payload data">
            <con:configuration>
              <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def userID = context.expand('${#TestSuite#user_id}')
def pointsRedeemableValue = context.expand('${#TestCase#pointsRedeemableValue}')
def custMobile = context.expand('${#TestSuite#mobile}')

int bodyCount = json.body.size();
def events = Eval.me(context.expand('${#TestCase#events}'))
def eventsInConsumer = json.body.eventName

messageExchange.modelItem.testCase.setPropertyValue('eventsReceived',eventsInConsumer.inspect())
assert(bodyCount == events.size())

assert('pointsRedeemed' in eventsInConsumer)

for(int i = 0;i&lt;bodyCount;i++){
	String event_name = json.body[i].eventName;
	log.info event_name;
	if(event_name == "pointsRedeemed"){

		def totalPointsRedeemed = json.body[i].data.totalPointsRedeemed;
		def redeemedPointsCurrencyValue = json.body[i].data.redeemedPointsCurrencyValue
    assert(totalPointsRedeemed == Integer.parseInt(pointsRedeemableValue))
    assert(redeemedPointsCurrencyValue == Integer.parseInt(pointsRedeemableValue))
    assert(json.body[i].data.triggeringActivity.name == "PointsRedemption")
    def custID = json.body[i].data.customerIdentifiers.customerId.toString()
    assert(custID == userID)
    def mobile = json.body[i].data.customerIdentifiers.instore.mobile
    assert(mobile == custMobile)
    def email = json.body[i].data.customerIdentifiers.instore.email
    assert(email == custMobile + "@gmail.com")
	}

}</scriptText>
            </con:configuration>
          </con:assertion>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:parameter>
              <con:name>request_id</con:name>
              <con:value>${#TestCase#request_id}</con:value>
              <con:style>QUERY</con:style>
              <con:default/>
              <con:path xsi:nil="true"/>
              <con:description xsi:nil="true"/>
            </con:parameter>
          </con:parameters>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="check event logs" id="0746e00f-1bba-47d8-8c20-6dc48ec0ecb9" disabled="true">
        <con:settings/>
        <con:config service="getEventLogs" resourcePath="/{version}/webHooks/eventLog/requestId/{request_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="check event logs" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9a67073e-d145-4c5f-90bf-7b2955e84d93" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ac07e8a1-01a4-49a8-9e5d-6e28d324525f" name="validate the events pushed status">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def consumers = json.data.consumerGroupId;
log.info consumers
int index = 0;
String my_consumer = context.expand('${#TestCase#webhook_consumerID}');
ArrayList&lt;String> eventNames = new ArrayList();
ArrayList&lt;Integer> consumersStatus = new ArrayList();
for(consumer in consumers){
	if(consumer == my_consumer){
		String event_name = json.data.eventName[index];
		def consumerResponse = json.data.consumerResponse[index]
		assert(consumerResponse != null)
	}
	index++;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="version" value="v3"/>
              <con:entry key="request_id" value="${#TestCase#request_id}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>request_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:setupScript/>
      <con:properties>
        <con:property>
          <con:name>programID</con:name>
          <con:value>1465</con:value>
        </con:property>
        <con:property>
          <con:name>loyaltyPoints</con:name>
          <con:value>340.0</con:value>
        </con:property>
        <con:property>
          <con:name>pointsToBeRedeemed</con:name>
          <con:value>17</con:value>
        </con:property>
        <con:property>
          <con:name>pointsRedeemableValue</con:name>
          <con:value>17</con:value>
        </con:property>
        <con:property>
          <con:name>request_id</con:name>
          <con:value>94cbe24f15e932314607e55453542bb0</con:value>
        </con:property>
        <con:property>
          <con:name>webhook_consumerID</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>events</con:name>
          <con:value>[]</con:value>
        </con:property>
        <con:property>
          <con:name>eventStatus</con:name>
          <con:value>[]</con:value>
        </con:property>
        <con:property>
          <con:name>eventsReceived</con:name>
          <con:value>['pointsRedeemed']</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="6903a80b-ebb7-4c60-9542-a9d7c49352de" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Event_CouponRedeem" searchProperties="true">
      <con:settings/>
      <con:testStep type="restrequest" name="get available coupon series" id="b4ba82f5-4b39-45d4-908e-b65dad414c62">
        <con:settings/>
        <con:config service="getCouponSeries" resourcePath="/v1.1/coupon/series" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="get available coupon series" id="4f9fddd5-ff27-468f-9305-ddb2ae83c9ed" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v1.1/coupon/series</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="b0d2f436-53e8-4e27-b51b-0d421eb77084" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="b28b8532-434e-484c-bd5a-c7008dae554d" name="get coupon series details">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

// assert status contents.

assert(json.response.status.success == "true")
assert(json.response.status.code == 200)
assert(json.response.status.message == "Success")


//get series items details

int numOfSeries = json.response.series.items.item.id.size()
assert(numOfSeries != 0) : "No coupon series are available for the org "
int randomNumber = 0
if(numOfSeries > 1){
 randomNumber =Math.abs( new Random().nextInt() % ((numOfSeries-1) - 0) ) + 0
}
String couponID = json.response.series.items.item.id[randomNumber]
String couponDescription = json.response.series.items.item.description[randomNumber]
String couponSeriesCode = json.response.series.items.item.series_code[randomNumber]
String validTillDate = json.response.series.items.item.valid_till_date[randomNumber]
String discountCode = json.response.series.items.item.discount_code[randomNumber]
String discountType = json.response.series.items.item.discount_type[randomNumber]
String discountValue = json.response.series.items.item.discount_value[randomNumber]
String discountON = json.response.series.items.item.discount_on[randomNumber]
String info = json.response.series.items.item.info[randomNumber]

messageExchange.modelItem.testCase.setPropertyValue("couponID",couponID)
messageExchange.modelItem.testCase.setPropertyValue("couponDescription",couponDescription)
messageExchange.modelItem.testCase.setPropertyValue("couponSeriesCode",couponSeriesCode)
messageExchange.modelItem.testCase.setPropertyValue("validTillDate",validTillDate)
messageExchange.modelItem.testCase.setPropertyValue("discountCode",discountCode)
messageExchange.modelItem.testCase.setPropertyValue("discountType",discountType)
messageExchange.modelItem.testCase.setPropertyValue("discountValue",discountValue)
messageExchange.modelItem.testCase.setPropertyValue("discountON",discountON)
messageExchange.modelItem.testCase.setPropertyValue("info",info)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="issue a coupon to customer" id="59ed5b8d-8810-4686-9863-75ee98d28d30">
        <con:settings/>
        <con:config service="issueCoupon" resourcePath="/v1.1/coupon/issue" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="issue a coupon to customer" id="757eb83a-f2f8-4b87-82bf-8545223dbbc2" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
   "root":{
      "coupon":[
         {
            "series_id":${#TestCase#couponID},
            "customer":{
               "mobile":"${#TestSuite#mobile}",
               "external_id":null,
               "email":null
            }
         }
      ]
   }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/coupon/issue</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9256196d-a982-499e-8421-1147cbe2b80d" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="972e2e36-a5a1-49bd-8937-5f2298aa71be" name="assert response contents">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

// assert status contents.

assert(json.response.status.success == true)
assert(json.response.status.code == 200)
assert(json.response.status.message == "Success")

//assert coupon content
String couponCode = json.response.coupon.code
String seriesID = json.response.coupon.series_id
String description = json.response.coupon.description
String discountcode = json.response.coupon.discount_code
String validTill = json.response.coupon.valid_till
String discountType = json.response.coupon.discount_type
String discountValue = json.response.coupon.discount_value
String discountOn = json.response.coupon.discount_on
String detailedInfo = json.response.coupon.detailed_info

messageExchange.modelItem.testCase.setPropertyValue("couponCode",couponCode)
//assert(couponCode == context.expand('${#TestCase#couponSeriesCode}'))
assert(seriesID == context.expand('${#TestCase#couponID}'))
assert(description == context.expand('${#TestCase#couponDescription}'))
assert(validTill == context.expand('${#TestCase#validTillDate}'))
assert(discountType == context.expand('${#TestCase#discountType}'))
assert(discountValue == context.expand('${#TestCase#discountValue}'))
assert(discountOn == context.expand('${#TestCase#discountON}'))
assert(detailedInfo == context.expand('${#TestCase#info}'))




//assert item status

assert(json.response.coupon.item_status.success == true)
assert(json.response.coupon.item_status.message == "Coupon processing successful")</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="validate if coupon is redeemable" id="c7ff398a-1acb-42de-8974-0ec276e3cc47">
        <con:settings/>
        <con:config service="isCouponRedeemable" resourcePath="/v1.1/coupon/isredeemable" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="validate if coupon is redeemable" id="2065919b-04a9-42cd-b6be-b621d97e53d4" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v1.1/coupon/isredeemable</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="1cb40d93-a36c-42ef-a341-f3c6a90b6781" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="1aba48d3-c0c2-4cef-9527-a2b2eb62965a" name="assert isredeemable response content">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

// assert status contents.

assert(json.response.status.success == "true")
assert(json.response.status.code == 200)
assert(json.response.status.message == "Success")

//assert redeemable status

String mobile = json.response.coupons.redeemable.mobile
String code = json.response.coupons.redeemable.code

assert(mobile == context.expand('${#TestSuite#mobile}'))
assert(code == context.expand('${#TestCase#couponCode}'))
assert(json.response.coupons.redeemable.is_redeemable == "true")

//assert series info

String description = json.response.coupons.redeemable.series_info.description
String discountCode = json.response.coupons.redeemable.series_info.discount_code
String validTill = json.response.coupons.redeemable.series_info.valid_till
String discountType = json.response.coupons.redeemable.series_info.discount_type
String discountValue = json.response.coupons.redeemable.series_info.discount_value
String discountOn = json.response.coupons.redeemable.series_info.discount_on
String detailedInfo = json.response.coupons.redeemable.series_info.detailed_info

assert(description == context.expand('${#TestCase#couponDescription}'))
assert(discountCode == context.expand('${#TestCase#discountCode}'))
assert(validTill == context.expand('${#TestCase#validTillDate}'))
assert(discountType == context.expand('${#TestCase#discountType}'))
assert(discountValue == context.expand('${#TestCase#discountValue}'))
assert(discountOn == context.expand('${#TestCase#discountON}'))
assert(detailedInfo == context.expand('${#TestCase#info}'))

//assert customer details
assert(json.response.coupons.redeemable.customer.mobile == context.expand('${#TestSuite#mobile}'))
assert(json.response.coupons.redeemable.customer.email == context.expand('${#TestSuite#mobile}') + "@gmail.com")

//assert item status
assert(json.response.coupons.redeemable.item_status.success == "true")
assert(json.response.coupons.redeemable.item_status.status == "true")
assert(json.response.coupons.redeemable.item_status.message == "Coupon isRedeem successful")</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="code" value="${#TestCase#couponCode}"/>
              <con:entry key="mobile" value="${#TestSuite#mobile}"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="customer redeem a coupon against a transaction" id="b34effe1-2aae-47bb-b2e3-e8f6f24ed3ed">
        <con:settings/>
        <con:config service="RedeemCoupon" resourcePath="/v1.1/coupon/redeem" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="customer redeem a coupon against a transaction" id="ff5fa5db-d484-4866-bf48-2ed0a1b8e3c1" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "coupon": [{
      "code": "${#TestCase#couponCode}",
      "redemption_time": "${=new java.text.SimpleDateFormat('yyyy-MM-dd').format(new Date())}",
      "customer": {
        "mobile": "${#TestSuite#mobile}"
      },
      "custom_fields": {
        "field": {
          "name": "Sport",
          "value": "[“Soccer”]"
        }
      },
      "transaction": {
        "number":"${Event_RegularTransactionAdd#tnx_number}",
        "amount": "1000"
      }
    }]
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/coupon/redeem</con:originalUri>
            <con:assertion type="GroovyScriptAssertion" id="92bf951b-fc8d-45db-851c-d85662bbaa11" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

// assert status contents.

assert(json.response.status.success == "true")
assert(json.response.status.code == 200)
assert(json.response.status.message == "Success")

//assert customer info
assert(json.response.coupons.coupon.customer.mobile == context.expand('${#TestSuite#mobile}'))
assert(json.response.coupons.coupon.customer.email == context.expand('${#TestSuite#mobile}') + "@gmail.com")

//assert coupon information

String couponCode = json.response.coupons.coupon.code
String discountCode = json.response.coupons.coupon.discount_code
String seriesCode = json.response.coupons.coupon.series_code
String couponValue = json.response.coupons.coupon.coupon_value

assert(couponCode == context.expand('${#TestCase#couponCode}'))
assert(discountCode == context.expand('${#TestCase#discountCode}'))
assert(seriesCode == context.expand('${#TestCase#couponID}'))
assert(couponValue == context.expand('${#TestCase#discountValue}'))

//assert transaction info
assert(json.response.coupons.coupon.transaction.number == context.expand('${Event_RegularTransactionAdd#tnx_number}'))

//assert item status
assert(json.response.coupons.coupon.item_status.success == "true")
assert(json.response.coupons.coupon.item_status.message == "Coupon processing successful")</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Valid HTTP Status Codes" id="249be6ad-3cfa-47ce-9622-9847c1297eb3" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="74a6142c-10d9-41d1-8188-b654d8613e20" name="capture request ID">
              <con:configuration>
                <scriptText>String req_id = messageExchange.responseHeaders["X-CAP-REQUEST-ID"][0].toString();
messageExchange.modelItem.testCase.setPropertyValue("request_id",req_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="get customer coupon information" id="568b84e0-70ff-4b13-a953-90476af0f38a">
        <con:settings/>
        <con:config service="getCustomerCoupons" resourcePath="/v1.1/customer/coupons" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="get customer coupon information" id="a83c3c0e-7af3-4d6d-b7d5-76c317dee5b5" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v1.1/customer/coupons</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9fea8a10-7bb4-4ecc-8480-cd804ce7a6bb" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="7693549a-de2d-4dd2-8b23-84148fd05f12" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

// assert status contents.

assert(json.response.status.success == "true")
assert(json.response.status.code == 200)
assert(json.response.status.message == "Success")

//assert customer information

assert(json.response.customers.customer.mobile[0] == context.expand('${#TestSuite#mobile}'))
assert(json.response.customers.customer.email[0] == context.expand('${#TestSuite#mobile}') + "@gmail.com")
assert(json.response.customers.customer.id[0] == context.expand('${#TestSuite#user_id}'))
assert(json.response.customers.customer.mobile[0] == context.expand('${#TestSuite#mobile}'))

//assert coupons information

assert(json.response.customers.customer.coupons[0].coupon.series_id[0] == context.expand('${#TestCase#couponID}'))
assert(json.response.customers.customer.coupons[0].coupon.series_name[0] == context.expand('${#TestCase#couponDescription}'))
assert(json.response.customers.customer.coupons[0].coupon.code[0] == context.expand('${#TestCase#couponCode}'))

//assert redemption details

assert(json.response.customers.customer.coupons[0].coupon.redemptions[0].redemption.transaction_number[0] == context.expand('${Event_RegularTransactionAdd#tnx_number}'))

String store_code = json.response.customers.customer.coupons[0].coupon.redemptions[0].redemption.redeemed_at[0].code
String storename = json.response.customers.customer.coupons[0].coupon.redemptions[0].redemption.redeemed_at[0].name


//asssert the item status

assert(json.response.customers.customer.item_status[0].success == "true")
assert(json.response.customers.customer.item_status[0].message == "Coupons retrieved successfully")</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="mobile" value="${#TestSuite#mobile}" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="get webhooks and fetch webhook consumer id" id="c4acdf43-b8eb-4e36-8041-873e7af145c9" disabled="true">
        <con:settings/>
        <con:config service="getWebhooks" resourcePath="/{version}/webHooks" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="get webhooks and fetch webhook consumer id" id="e34c812d-806e-498b-adbd-323081eda9a6" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="bd5d1a2f-529b-492a-bf27-f3681c66848c" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="b9a1562a-b14d-4245-a079-7407ffcc3c36" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def webhook_names = json.data.name;
def my_webhook = context.expand('${#Project#webhook_workspace_name}');
int index = 0;
String consumer_id = "";
for(name in webhook_names){
	if(name == my_webhook){
		consumer_id = json.data.consumerGroupId[index];
	}
	index++;
}

messageExchange.modelItem.testCase.setPropertyValue("webhook_consumerID",consumer_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:preemptive>true</con:preemptive>
              <con:authType>Preemptive</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="version" value="v3" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Poll the status of event log" id="3953980f-feb2-4da2-ae55-611deee824ad" disabled="true">
        <con:settings/>
        <con:config>
          <script>import com.eviware.soapui.model.testsuite.TestStepResult
import com.eviware.soapui.model.testsuite.TestStepResult.TestStepStatus
import com.eviware.soapui.model.testsuite.TestStep

int maxRetries = 10;

int polling_time = Integer.parseInt(context.expand('${#Project#polling_time}'));
while(maxRetries > 0){
	TestStep teststep = testRunner.testCase.testSuite.testCases["Event_CouponRedeem"].testSteps["check event logs"]
	TestStepResult result = teststep.run(testRunner,context)
	TestStepStatus status = result.getStatus();
	log.info "Status -- " + status
	if(status == TestStepStatus.OK){
		maxRetries=0;
		break;
	}
	else{
		sleep(polling_time);
	}
	maxRetries--;
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="validate the event log in mongo via an API" id="bc5f9a38-a392-423e-83f1-0766949d1427" disabled="true">
        <con:settings/>
        <con:config service="getEventLogs" resourcePath="/{version}/webHooks/eventLog/requestId/{request_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="validate the event log in mongo via an API" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9a67073e-d145-4c5f-90bf-7b2955e84d93" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ac07e8a1-01a4-49a8-9e5d-6e28d324525f" name="validate the events pushed status">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def consumers = json.data.consumerGroupId;
int index = 0;
String my_consumer = context.expand('${#TestCase#webhook_consumerID}');
ArrayList&lt;String> eventNames = new ArrayList();
ArrayList&lt;Integer> consumersStatus = new ArrayList();
for(consumer in consumers){
	if(consumer == my_consumer){
		String event_name = json.data.eventName[index];
		def consumerResponse = json.data.consumerResponse[index]
		assert(consumerResponse != null) : "Consumer response is NULL"
		int status = json.data.consumerResponse[index].webhookHttpStatus;
		eventNames.add(event_name);
		consumersStatus.add(status);
	}
	index++;
}

log.info eventNames

messageExchange.modelItem.testCase.setPropertyValue("events",eventNames.inspect())
messageExchange.modelItem.testCase.setPropertyValue("eventStatus",consumersStatus.inspect())

//all status should be 200
for(String status : consumersStatus){
	assert status == "200"
}
//transactionAdded event should be pushed, as that is triggered as part of test case.
assert('pointsRedeemed' in eventNames)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="version" value="v3"/>
              <con:entry key="request_id" value="${#TestCase#request_id}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>request_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="httprequest" name="validate response data in webhook" id="cc134525-b1e0-4d82-a860-733f5b4833a8" disabled="true">
        <con:settings/>
        <con:config method="GET" xsi:type="con:HttpRequest" id="a8d53e36-26fb-4c1a-8c27-d0cb991becfb" name="validate response data in webhook" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>http://${#Project#webhook_workspace}/api/events</con:endpoint>
          <con:request/>
          <con:assertion type="Valid HTTP Status Codes" id="6f4c5385-a53b-43e7-bbcb-3e084abfe072" name="status - 200">
            <con:configuration>
              <codes>200</codes>
            </con:configuration>
          </con:assertion>
          <con:assertion type="GroovyScriptAssertion" id="b125b22a-5024-494c-b2f4-26382b2aaa51" name="validate the payload data">
            <con:configuration>
              <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def userID = context.expand('${#TestSuite#user_id}')
def pointsRedeemableValue = context.expand('${#TestCase#pointsRedeemableValue}')
def custMobile = context.expand('${#TestSuite#mobile}')

int bodyCount = json.body.size();
def events = Eval.me(context.expand('${#TestCase#events}'))
def eventsInConsumer = json.body.eventName

messageExchange.modelItem.testCase.setPropertyValue('eventsReceived',eventsInConsumer.inspect())
assert(bodyCount == events.size())

assert('pointsRedeemed' in eventsInConsumer)

for(int i = 0;i&lt;bodyCount;i++){
	String event_name = json.body[i].eventName;
	log.info event_name;
	if(event_name == "pointsRedeemed"){

		def totalPointsRedeemed = json.body[i].data.totalPointsRedeemed;
		def redeemedPointsCurrencyValue = json.body[i].data.redeemedPointsCurrencyValue
    assert(totalPointsRedeemed == Integer.parseInt(pointsRedeemableValue))
    assert(redeemedPointsCurrencyValue == Integer.parseInt(pointsRedeemableValue))
    assert(json.body[i].data.triggeringActivity.name == "PointsRedemption")
    def custID = json.body[i].data.customerIdentifiers.customerId.toString()
    assert(custID == userID)
    def mobile = json.body[i].data.customerIdentifiers.instore.mobile
    assert(mobile == custMobile)
    def email = json.body[i].data.customerIdentifiers.instore.email
    assert(email == custMobile + "@gmail.com")
	}

}</scriptText>
            </con:configuration>
          </con:assertion>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:parameter>
              <con:name>request_id</con:name>
              <con:value>${#TestCase#request_id}</con:value>
              <con:style>QUERY</con:style>
              <con:default/>
              <con:path xsi:nil="true"/>
              <con:description xsi:nil="true"/>
            </con:parameter>
          </con:parameters>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="check event logs" id="c32ff4da-1077-4780-904c-c3741808b7c2" disabled="true">
        <con:settings/>
        <con:config service="getEventLogs" resourcePath="/{version}/webHooks/eventLog/requestId/{request_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="check event logs" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9a67073e-d145-4c5f-90bf-7b2955e84d93" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ac07e8a1-01a4-49a8-9e5d-6e28d324525f" name="validate the events pushed status">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def consumers = json.data.consumerGroupId;
log.info consumers
int index = 0;
String my_consumer = context.expand('${#TestCase#webhook_consumerID}');
ArrayList&lt;String> eventNames = new ArrayList();
ArrayList&lt;Integer> consumersStatus = new ArrayList();
for(consumer in consumers){
	if(consumer == my_consumer){
		String event_name = json.data.eventName[index];
		def consumerResponse = json.data.consumerResponse[index]
		assert(consumerResponse != null)
	}
	index++;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="version" value="v3"/>
              <con:entry key="request_id" value="${#TestCase#request_id}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>request_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:setupScript/>
      <con:properties>
        <con:property>
          <con:name>couponID</con:name>
          <con:value>623241</con:value>
        </con:property>
        <con:property>
          <con:name>couponDescription</con:name>
          <con:value>EndtoEndTestCoupon</con:value>
        </con:property>
        <con:property>
          <con:name>couponSeriesCode</con:name>
          <con:value>HI1BLN1R</con:value>
        </con:property>
        <con:property>
          <con:name>validTillDate</con:name>
          <con:value>2064-12-31</con:value>
        </con:property>
        <con:property>
          <con:name>discountCode</con:name>
          <con:value>NO_VALUE</con:value>
        </con:property>
        <con:property>
          <con:name>discountType</con:name>
          <con:value>ABS</con:value>
        </con:property>
        <con:property>
          <con:name>discountValue</con:name>
          <con:value>200</con:value>
        </con:property>
        <con:property>
          <con:name>discountON</con:name>
          <con:value>BILL</con:value>
        </con:property>
        <con:property>
          <con:name>info</con:name>
          <con:value>EndtoEndTestCoupon</con:value>
        </con:property>
        <con:property>
          <con:name>couponCode</con:name>
          <con:value>ZTDRZWEN</con:value>
        </con:property>
        <con:property>
          <con:name>webhook_consumerID</con:name>
          <con:value>befe1b9f-7948-4540-8794-3c0a6fc073bb</con:value>
        </con:property>
        <con:property>
          <con:name>request_id</con:name>
          <con:value>6d53a5b1-1242-41f9-be8f-6203b57868a7</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="8136e2ea-77d0-4875-95ad-08c63f483b85" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Event_PointsTransfer" searchProperties="true">
      <con:settings/>
      <con:testStep type="restrequest" name="update CONF_LOYALTY_POINTS_REDEMPTION_LIFETIME_PURCHASE_MIN to 0" id="c38c7b23-4c59-4162-b716-88bb1b372006">
        <con:settings/>
        <con:config service="updateOrgConfig" resourcePath="/{version}/organization/configs" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="update CONF_LOYALTY_POINTS_REDEMPTION_LIFETIME_PURCHASE_MIN to 0" id="9ae77cbf-a340-43f2-9a3b-e6cd9213c773" mediaType="application/xml" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request><![CDATA[<root>
     <organization>
             <configs>
                     <config>
                             <name>CONF_LOYALTY_POINTS_REDEMPTION_LIFETIME_PURCHASE_MIN</name>
                             <scope>ORG</scope>
                             <value>0</value>
                            <entity_id>null</entity_id>
                     </config>
             </configs>
     </organization>
</root>]]></con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/organization/configs</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="db6beb72-0a54-41ce-a045-9d6bef8bc8f9" name="Valid HTTP Status Codes" disabled="true">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="version" value="v1.1" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="update CONF_DISABLE_OTP_POINTS_TRANSFER to 1" id="3e86f8ab-40a0-43a0-9e61-6eac87ebe97a">
        <con:settings/>
        <con:config service="updateOrgConfig" resourcePath="/{version}/organization/configs" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="update CONF_DISABLE_OTP_POINTS_TRANSFER to 1" id="9ae77cbf-a340-43f2-9a3b-e6cd9213c773" mediaType="application/xml" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request><![CDATA[<root>
     <organization>
             <configs>
                     <config>
                             <name>CONF_DISABLE_OTP_POINTS_TRANSFER</name>
                             <scope>ORG</scope>
                             <value>1</value>
                            <entity_id>1522</entity_id>
                     </config>
             </configs>
     </organization>
</root>]]></con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/organization/configs</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="db6beb72-0a54-41ce-a045-9d6bef8bc8f9" name="Valid HTTP Status Codes" disabled="true">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="version" value="v1.1" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="get unique mobile number to register" id="243a9275-ed64-4d7e-a306-cdb62f09d06a">
        <con:settings/>
        <con:config>
          <script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
testRunner.testCase.setPropertyValue("mobile1","919" + mobile);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="register a new customer" id="2c27433b-8dbd-4a04-a69a-6a8c88d159ef">
        <con:settings/>
        <con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="register a new customer" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile1}",
        "email": "${#TestCase#mobile1}@gmail.com",

        "firstname": "fname_${#TestCase#mobile1}",
        "lastname": "lname_${#TestCase#mobile1}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			},
        "custom_fields": {
          "field": [
            {
              "name": "Hobbies",
              "value": "[“Fitness”]"
            }
          ]
        }

      }
    ]
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="6561825e-a822-4b5a-8d71-764b779e304e" name="Status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="5b1e5a91-9733-4e79-a8df-37a1c6ca91ff" name="capture request id">
              <con:configuration>
                <scriptText>String req_id = messageExchange.responseHeaders["X-CAP-REQUEST-ID"][0].toString();
messageExchange.modelItem.testCase.setPropertyValue("request_id",req_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="358bd7c4-10af-4b97-9e52-6af837cb76b9" name="validate customer registration data">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


//assert success holder in response
assert(json.response.status.success == "true")
assert(json.response.status.code == 200)
assert(json.response.status.message == "Success")


//assert customer data.

assert(json.response.customers.customer.user_id.size() == 1);

String user_id = json.response.customers.customer.user_id[0];
String f_name = json.response.customers.customer.firstname[0];
String l_name = json.response.customers.customer.lastname[0];
String mobile = json.response.customers.customer.mobile[0];
String email = json.response.customers.customer.email[0];
String lifetime_points = json.response.customers.customer.lifetime_points[0];
String loyalty_points = json.response.customers.customer.loyalty_points[0];
String current_slab = json.response.customers.customer.current_slab[0];

String lifetime_purchases = json.response.customers.customer.lifetime_purchases[0];
String type = json.response.customers.customer.type[0];
String source = json.response.customers.customer.source[0];
String mobile_reg = context.expand('${#TestCase#mobile1}');







assert(lifetime_purchases == "0") // as this is new customer with no transactions.
assert(mobile == mobile_reg)
assert(json.response.customers.customer.subscriptions[0].subscription.size() == 4) // as we have configured 4 subscription while adding a customer.
assert(f_name == "fname_" + mobile_reg);
assert(l_name == "lname_" + mobile_reg);
assert(email == mobile_reg + "@gmail.com");
messageExchange.modelItem.testCase.setPropertyValue("user_id",user_id);
messageExchange.modelItem.testCase.testSuite.setPropertyValue("user_id",user_id);
messageExchange.modelItem.testCase.setPropertyValue("lifetime_points",lifetime_points.toString());
messageExchange.modelItem.testCase.setPropertyValue("loyalty_points",loyalty_points.toString());





//item status.

assert(json.response.customers.customer.item_status[0].success == "true")
assert(json.response.customers.customer.item_status[0].code == "1000")
if(json.response.customers.customer.item_status[0].message.toLowerCase().contains("customer registration successful")){
	assert true;
}
else{
	assert false : "customer registration not done! " + json.response.customers.customer.item_status[0].message
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="format" value="json"/>
              <con:entry key="version" value="v1.1"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="get another unique mobile number to register a second customer" id="b5334426-d538-421c-98fa-52831b4f4885">
        <con:settings/>
        <con:config>
          <script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
testRunner.testCase.setPropertyValue("mobile2","919" + mobile);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="register another new customer" id="771d83c0-5e81-435d-8e30-b3b9596c0d86">
        <con:settings/>
        <con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="register another new customer" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile2}",
        "email": "${#TestCase#mobile2}@gmail.com",

        "firstname": "fname_${#TestCase#mobile2}",
        "lastname": "lname_${#TestCase#mobile2}",
        "gender": "F",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "560068"
					}
				]
			},
        "custom_fields": {
          "field": [
            {
              "name": "Hobbies",
              "value": "[“Dance”]"
            }
          ]
        }

      }
    ]
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="6561825e-a822-4b5a-8d71-764b779e304e" name="Status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="5b1e5a91-9733-4e79-a8df-37a1c6ca91ff" name="capture request id">
              <con:configuration>
                <scriptText>String req_id = messageExchange.responseHeaders["X-CAP-REQUEST-ID"][0].toString();
messageExchange.modelItem.testCase.setPropertyValue("request_id_2",req_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="358bd7c4-10af-4b97-9e52-6af837cb76b9" name="validate customer registration data">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


//assert success holder in response
assert(json.response.status.success == "true")
assert(json.response.status.code == 200)
assert(json.response.status.message == "Success")


//assert customer data.

assert(json.response.customers.customer.user_id.size() == 1);

String user_id = json.response.customers.customer.user_id[0];
String f_name = json.response.customers.customer.firstname[0];
String l_name = json.response.customers.customer.lastname[0];
String mobile = json.response.customers.customer.mobile[0];
String email = json.response.customers.customer.email[0];
String lifetime_points = json.response.customers.customer.lifetime_points[0];
String loyalty_points = json.response.customers.customer.loyalty_points[0];
String current_slab = json.response.customers.customer.current_slab[0];

String lifetime_purchases = json.response.customers.customer.lifetime_purchases[0];
String type = json.response.customers.customer.type[0];
String source = json.response.customers.customer.source[0];
String mobile_reg = context.expand('${#TestCase#mobile2}');







assert(lifetime_purchases == "0") // as this is new customer with no transactions.
assert(mobile == mobile_reg)
assert(json.response.customers.customer.subscriptions[0].subscription.size() == 4) // as we have configured 4 subscription while adding a customer.
assert(f_name == "fname_" + mobile_reg);
assert(l_name == "lname_" + mobile_reg);
assert(email == mobile_reg + "@gmail.com");
messageExchange.modelItem.testCase.setPropertyValue("user_id_2",user_id);
messageExchange.modelItem.testCase.setPropertyValue("lifetime_points_2",lifetime_points.toString());
messageExchange.modelItem.testCase.setPropertyValue("loyalty_points_2",loyalty_points.toString());





//item status.

assert(json.response.customers.customer.item_status[0].success == "true")
assert(json.response.customers.customer.item_status[0].code == "1000")
if(json.response.customers.customer.item_status[0].message.toLowerCase().contains("customer registration successful")){
	assert true;
}
else{
	assert false : "customer registration not done! " + json.response.customers.customer.item_status[0].message
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="format" value="json"/>
              <con:entry key="version" value="v1.1"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="check if points are transferable" id="2ed5ab96-58ae-4bff-9be1-7933c636e20b">
        <con:settings/>
        <con:config service="isPointsTransferable" resourcePath="/v2/points/isTransferrable" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="check if points are transferable" id="0dcc0e21-afd7-4862-838c-ca8bcaeadc75" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
    "issueOtp": false,
    "pointsTobeTransferred": 2,
    "toCustomerIdentifier": {
        "type": "MOBILE",
        "value": "${#TestCase#mobile1}"
    },
    "fromCustomerIdentifier": {
        "type": "MOBILE",
        "value": "${#TestCase#mobile2}"
    }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v2/points/isTransferrable</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="d1ff46d4-48a9-4afd-a194-a61c1bb13eae" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="22cb04cf-382b-4a2b-aa1c-0d6abd9d041b" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

//assert isTransferrable status and points details
assert(json.data[0].pointsTobeTransferred == 2) //2 is passed in api input.
assert(json.data[0].transferrable == true)



//assert transfer from details.
String userIDTransferFrom = json.data[0].transferFrom.id.toString()
String firstNameTransferFrom = json.data[0].transferFrom.profiles[0].firstName
String lastNameTransferFrom = json.data[0].transferFrom.profiles[0].lastName
String userIdProfileTransferFrom = json.data[0].transferFrom.profiles[0].userId.toString()
String loyaltyTypeTranferFrom = json.data[0].transferFrom.loyaltyInfo.loyaltyType
int lifetimePurchasesTransferFrom = json.data[0].transferFrom.loyaltyInfo.lifetimePurchases
assert(userIDTransferFrom == context.expand('${#TestCase#user_id_2}'))
assert(firstNameTransferFrom  == "fname_" + context.expand('${#TestCase#mobile2}'))
assert(lastNameTransferFrom == "lname_" + context.expand('${#TestCase#mobile2}'))
assert(userIdProfileTransferFrom == context.expand('${#TestCase#user_id_2}'))
assert(loyaltyTypeTranferFrom == "loyalty")
assert(lifetimePurchasesTransferFrom == 0) //as this is a new customer.

//assert transfer to details.

String loyaltyTypeTransferTo = json.data[0].transferTo.loyaltyInfo.loyaltyType
String userIdTransferTo = json.data[0].transferTo.id.toString()
String userIDProfileTransferTo = json.data[0].transferTo.profiles[0].userId.toString()
String firstNameTransferTo = json.data[0].transferTo.profiles[0].firstName
String lastNameTransferTo = json.data[0].transferTo.profiles[0].lastName
int lifetimePurchasesTransferTo = json.data[0].transferTo.loyaltyInfo.lifetimePurchases

assert(userIdTransferTo == context.expand('${#TestCase#user_id}'))
assert(firstNameTransferTo == "fname_" + context.expand('${#TestCase#mobile1}'))
assert(lastNameTransferTo == "lname_" + context.expand('${#TestCase#mobile1}'))
assert(userIDProfileTransferTo == context.expand('${#TestCase#user_id}'))
assert(loyaltyTypeTransferTo == "loyalty")
assert(lifetimePurchasesTransferTo == 0) //as this is a new customer.</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="now do the points transfer" id="a16947b2-d8cc-4b4e-a6a0-64a1d95e3985">
        <con:settings/>
        <con:config service="PointsTransfer" resourcePath="/v2/points/transfer" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="now do the points transfer" id="66016c4b-99ca-4eff-8f1e-3c10187c0c22" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "pointsTobeTransferred": 2,
  "fromCustomerIdentifier": {
    "type": "MOBILE",
    "value": "${#TestCase#mobile2}"
  },
  "toCustomerIdentifier": {
    "type": "MOBILE",
    "value": "${#TestCase#mobile1}"
  },
  "notes": "doing transfer of 2 points",
  "code": ""
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v2/points/transfer</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="538c7310-6a05-4f96-a32c-d5671fa91665" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="f7481490-c1d2-4179-bb37-eabb63cadd2f" name="assert point transfer data contents">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def pointsTransferred = json.data.pointsTransferred[0]
String transferType = json.data.transferType[0]
String transferId = json.data.transferId[0]

int transferFromUserId = json.data.transferredFrom[0].userId
int transferToUserId = json.data.transferredTo[0].userId


int transferFromActual = Integer.parseInt(context.expand('${#TestCase#user_id_2}'))
int transferToActual = Integer.parseInt(context.expand('${#TestCase#user_id}'))

assert(transferFromUserId == transferFromActual)
assert(transferToUserId == transferToActual)


assert(transferType == "DEDUCTION")
assert(pointsTransferred == 2) // as 2 points are tranferred as input.</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="afaa8a9d-61b5-4681-8838-ac6362171b72" name="capture request id">
              <con:configuration>
                <scriptText>String req_id = messageExchange.responseHeaders["X-CAP-REQUEST-ID"][0].toString();
messageExchange.modelItem.testCase.setPropertyValue("request_id",req_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="get webhooks and fetch webhook consumer id" id="b9008626-dd28-406e-9de6-1fa940630921">
        <con:settings/>
        <con:config service="getWebhooks" resourcePath="/{version}/webHooks" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="get webhooks and fetch webhook consumer id" id="e34c812d-806e-498b-adbd-323081eda9a6" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="bd5d1a2f-529b-492a-bf27-f3681c66848c" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="b9a1562a-b14d-4245-a079-7407ffcc3c36" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def webhook_names = json.data.name;
def my_webhook = context.expand('${#Project#webhook_workspace_name}');
int index = 0;
String consumer_id = "";
for(name in webhook_names){
	if(name == my_webhook){
		consumer_id = json.data.consumerGroupId[index];
	}
	index++;
}

messageExchange.modelItem.testCase.setPropertyValue("webhook_consumerID",consumer_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:preemptive>true</con:preemptive>
              <con:authType>Preemptive</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="version" value="v3" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Poll the status of event log" id="3b279b1c-92b7-4323-8013-e399e3337686">
        <con:settings/>
        <con:config>
          <script>import com.eviware.soapui.model.testsuite.TestStepResult
import com.eviware.soapui.model.testsuite.TestStepResult.TestStepStatus
import com.eviware.soapui.model.testsuite.TestStep

int maxRetries = 10;
int polling_time = Integer.parseInt(context.expand('${#Project#polling_time}'));

while(maxRetries > 0){
	TestStep teststep = testRunner.testCase.testSuite.testCases["Event_PointsTransfer"].testSteps["check event logs"]
	TestStepResult result = teststep.run(testRunner,context)
	TestStepStatus status = result.getStatus();
	log.info "Status -- " + status
	if(status == TestStepStatus.OK){
		maxRetries=0;
		break;
	}
	else{
		sleep(polling_time);
	}
	maxRetries--;
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="validate the event log in mongo via an API" id="d2fa0509-06c1-4356-a922-8bd1c254a9b5">
        <con:settings/>
        <con:config service="getEventLogs" resourcePath="/{version}/webHooks/eventLog/requestId/{request_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="validate the event log in mongo via an API" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9a67073e-d145-4c5f-90bf-7b2955e84d93" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ac07e8a1-01a4-49a8-9e5d-6e28d324525f" name="validate the events pushed status">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def consumers = json.data.consumerGroupId;
int index = 0;
String my_consumer = context.expand('${#TestCase#webhook_consumerID}');
ArrayList&lt;String> eventNames = new ArrayList();
ArrayList&lt;Integer> consumersStatus = new ArrayList();
for(consumer in consumers){
	if(consumer == my_consumer){
		String event_name = json.data.eventName[index];
		def consumerResponse = json.data.consumerResponse[index]
		assert(consumerResponse != null) : "Consumer response is NULL"
		int status = json.data.consumerResponse[index].webhookHttpStatus;
		eventNames.add(event_name);
		consumersStatus.add(status);
	}
	index++;
}

log.info eventNames

messageExchange.modelItem.testCase.setPropertyValue("events",eventNames.inspect())
messageExchange.modelItem.testCase.setPropertyValue("eventStatus",consumersStatus.inspect())

//all status should be 200
for(String status : consumersStatus){
	assert status == "200"
}
//transactionAdded event should be pushed, as that is triggered as part of test case.
assert('pointsTransferredInitiated' in eventNames)
assert('pointsTransferredReceived' in eventNames)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="version" value="v3"/>
              <con:entry key="request_id" value="${#TestCase#request_id}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>request_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="httprequest" name="validate response data in webhook" id="dcf15768-7469-463b-8309-9b9d1f1980b3">
        <con:settings/>
        <con:config method="GET" xsi:type="con:HttpRequest" id="a8d53e36-26fb-4c1a-8c27-d0cb991becfb" name="validate response data in webhook" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>http://${#Project#webhook_workspace}/api/events</con:endpoint>
          <con:request/>
          <con:assertion type="Valid HTTP Status Codes" id="6f4c5385-a53b-43e7-bbcb-3e084abfe072" name="status - 200">
            <con:configuration>
              <codes>200</codes>
            </con:configuration>
          </con:assertion>
          <con:assertion type="GroovyScriptAssertion" id="b125b22a-5024-494c-b2f4-26382b2aaa51" name="validate the payload data">
            <con:configuration>
              <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

int bodyCount = json.body.size();
def events = Eval.me(context.expand('${#TestCase#events}'))
def eventsInConsumer = json.body.eventName

def mobile1 = context.expand('${#TestCase#mobile1}')
def mobile2 = context.expand('${#TestCase#mobile2}')
def userId1 = context.expand('${#TestCase#user_id}')
def userId2 = context.expand('${#TestCase#user_id_2}')

messageExchange.modelItem.testCase.setPropertyValue('eventsReceived',eventsInConsumer.inspect())
assert(bodyCount == events.size())
assert('pointsTransferredInitiated' in eventsInConsumer)
assert('pointsTransferredReceived' in eventsInConsumer)

for(int i = 0;i&lt;bodyCount;i++){
	String event_name = json.body[i].eventName;
	log.info event_name;
	if(event_name == "pointsTransferredInitiated"){
		def pointsTransferred = json.body[i].data.totalPointsTransferred
		log.info pointsTransferred
		def custID = json.body[i].data.customerIdentifiers.customerId.toString()
		def mobile = json.body[i].data.customerIdentifiers.instore.mobile.toString()
		def email = json.body[i].data.customerIdentifiers.instore.email.toString()
		def recCustID = json.body[i].data.transferReceivingCustomerIdentifiers.customerId.toString()
		def recMobile = json.body[i].data.transferReceivingCustomerIdentifiers.instore.mobile.toString()
		def recEmail = json.body[i].data.transferReceivingCustomerIdentifiers.instore.email.toString()

		def earningProgramPoints = json.body[i].data.redemptionFromEarningPrograms.pointsRedeemed[0]

		assert(pointsTransferred == 2) // we did points transfer of 2.
		assert(custID == userId2)
		assert(mobile == mobile2)
		assert(email == mobile2 + "@gmail.com")
		assert(recCustID == userId1)
		assert(recMobile == mobile1)
		assert(recEmail == mobile1 + "@gmail.com")
		assert(earningProgramPoints == 2)


	}
	else if(event_name == "pointsTransferredReceived"){
		def pointsTransferred = json.body[i].data.totalPointsTransferred
		def custID = json.body[i].data.customerIdentifiers.customerId.toString()
		def mobile = json.body[i].data.customerIdentifiers.instore.mobile.toString()
		def email = json.body[i].data.customerIdentifiers.instore.email.toString()
		def recCustID = json.body[i].data.transferInitiatingCustomerIdentifiers.customerId.toString()
		def recMobile = json.body[i].data.transferInitiatingCustomerIdentifiers.instore.mobile.toString()
		def recEmail = json.body[i].data.transferInitiatingCustomerIdentifiers.instore.email.toString()
		assert(pointsTransferred == 2) // we did points transfer of 2.
		assert(custID == userId1)
		assert(mobile == mobile1)
		assert(email == mobile1 + "@gmail.com")
		assert(recCustID == userId2)
		assert(recMobile == mobile2)
		assert(recEmail == mobile2 + "@gmail.com")
	}

}</scriptText>
            </con:configuration>
          </con:assertion>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:parameter>
              <con:name>request_id</con:name>
              <con:value>${#TestCase#request_id}</con:value>
              <con:style>QUERY</con:style>
              <con:default/>
              <con:path xsi:nil="true"/>
              <con:description xsi:nil="true"/>
            </con:parameter>
          </con:parameters>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="check event logs" id="b57238a1-9b04-42a4-bffe-60815e01c7b2" disabled="true">
        <con:settings/>
        <con:config service="getEventLogs" resourcePath="/{version}/webHooks/eventLog/requestId/{request_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="check event logs" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9a67073e-d145-4c5f-90bf-7b2955e84d93" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ac07e8a1-01a4-49a8-9e5d-6e28d324525f" name="validate the events pushed status">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def consumers = json.data.consumerGroupId;
log.info consumers
int index = 0;
String my_consumer = context.expand('${#TestCase#webhook_consumerID}');
ArrayList&lt;String> eventNames = new ArrayList();
ArrayList&lt;Integer> consumersStatus = new ArrayList();
for(consumer in consumers){
	if(consumer == my_consumer){
		String event_name = json.data.eventName[index];
		def consumerResponse = json.data.consumerResponse[index]
		assert(consumerResponse != null)
	}
	index++;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="version" value="v3"/>
              <con:entry key="request_id" value="${#TestCase#request_id}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>request_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:setupScript/>
      <con:properties>
        <con:property>
          <con:name>mobile1</con:name>
          <con:value>919216647723</con:value>
        </con:property>
        <con:property>
          <con:name>request_id</con:name>
          <con:value>4829c6ab94f0636b1d5f4f43a9843f8d</con:value>
        </con:property>
        <con:property>
          <con:name>user_id</con:name>
          <con:value>371409771</con:value>
        </con:property>
        <con:property>
          <con:name>lifetime_points</con:name>
          <con:value>140</con:value>
        </con:property>
        <con:property>
          <con:name>loyalty_points</con:name>
          <con:value>140</con:value>
        </con:property>
        <con:property>
          <con:name>mobile2</con:name>
          <con:value>919216649617</con:value>
        </con:property>
        <con:property>
          <con:name>request_id_2</con:name>
          <con:value>df87143e5322aba0f5676c02f5a32ad1</con:value>
        </con:property>
        <con:property>
          <con:name>user_id_2</con:name>
          <con:value>371409772</con:value>
        </con:property>
        <con:property>
          <con:name>lifetime_points_2</con:name>
          <con:value>140</con:value>
        </con:property>
        <con:property>
          <con:name>loyalty_points_2</con:name>
          <con:value>140</con:value>
        </con:property>
        <con:property>
          <con:name>events</con:name>
          <con:value>[]</con:value>
        </con:property>
        <con:property>
          <con:name>eventStatus</con:name>
          <con:value>[]</con:value>
        </con:property>
        <con:property>
          <con:name>webhook_consumerID</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>eventsReceived</con:name>
          <con:value>[]</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="a6d8f7bc-5a9b-45a5-8360-9c9b21ffa345" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Event_CustomerUpdate" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="get unique phone number and email to register" id="4206d3e0-e4dd-4c0f-a772-e1292a59407a">
        <con:settings/>
        <con:config>
          <script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(3);
testRunner.testCase.setPropertyValue("mobile",mobile);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="register a new customer" id="b58438f9-e00c-4e8f-8a9b-bcf0ef2ffffb">
        <con:settings/>
        <con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="register a new customer" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "gender": "F",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="6561825e-a822-4b5a-8d71-764b779e304e" name="Status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="5b1e5a91-9733-4e79-a8df-37a1c6ca91ff" name="capture request id">
              <con:configuration>
                <scriptText>String req_id = messageExchange.responseHeaders["X-CAP-REQUEST-ID"][0].toString();
messageExchange.modelItem.testCase.setPropertyValue("request_id",req_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="358bd7c4-10af-4b97-9e52-6af837cb76b9" name="validate customer registration data">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


//assert success holder in response
assert(json.response.status.success == "true")
assert(json.response.status.code == 200)
assert(json.response.status.message == "Success")


//assert customer data.

assert(json.response.customers.customer.user_id.size() == 1);

String user_id = json.response.customers.customer.user_id[0];
String f_name = json.response.customers.customer.firstname[0];
String l_name = json.response.customers.customer.lastname[0];
String mobile = json.response.customers.customer.mobile[0];
String email = json.response.customers.customer.email[0];
String lifetime_points = json.response.customers.customer.lifetime_points[0];
String loyalty_points = json.response.customers.customer.loyalty_points[0];
String current_slab = json.response.customers.customer.current_slab[0];

String lifetime_purchases = json.response.customers.customer.lifetime_purchases[0];
String type = json.response.customers.customer.type[0];
String source = json.response.customers.customer.source[0];
String mobile_reg = context.expand('${#TestCase#mobile}');







assert(lifetime_purchases == "0") // as this is new customer with no transactions.
assert(mobile == mobile_reg)
assert(json.response.customers.customer.subscriptions[0].subscription.size() == 4) // as we have configured 4 subscription while adding a customer.
assert(f_name == "fname_" + mobile_reg);
assert(l_name == "lname_" + mobile_reg);
assert(email == mobile_reg + "@gmail.com");
messageExchange.modelItem.testCase.setPropertyValue("user_id",user_id);
messageExchange.modelItem.testCase.setPropertyValue("lifetime_points",lifetime_points.toString());
messageExchange.modelItem.testCase.setPropertyValue("loyalty_points",loyalty_points.toString());





//item status.

assert(json.response.customers.customer.item_status[0].success == "true")
assert(json.response.customers.customer.item_status[0].code == "1000")
if(json.response.customers.customer.item_status[0].message.toLowerCase().contains("customer registration successful")){
	assert true;
}
else{
	assert false : "customer registration not done! " + json.response.customers.customer.item_status[0].message
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="format" value="json"/>
              <con:entry key="version" value="v1.1"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="update an existing customer details" id="2f7352f0-b6d1-4056-847a-80c87b87329f">
        <con:settings/>
        <con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="update an existing customer details" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}_changed",
        "lastname": "lname_${#TestCase#mobile}_changed",
        "gender": "F",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}
      }
    ]
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="6561825e-a822-4b5a-8d71-764b779e304e" name="Status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="5b1e5a91-9733-4e79-a8df-37a1c6ca91ff" name="capture request id">
              <con:configuration>
                <scriptText>String req_id = messageExchange.responseHeaders["X-CAP-REQUEST-ID"][0].toString();
messageExchange.modelItem.testCase.setPropertyValue("request_id",req_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="358bd7c4-10af-4b97-9e52-6af837cb76b9" name="validate customer updation data">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


//assert success holder in response
assert(json.response.status.success == "true")
assert(json.response.status.code == 200)
assert(json.response.status.message == "Success")


//assert customer data.

assert(json.response.customers.customer.user_id.size() == 1);

String user_id = json.response.customers.customer.user_id[0];
String f_name = json.response.customers.customer.firstname[0];
String l_name = json.response.customers.customer.lastname[0];
String mobile = json.response.customers.customer.mobile[0];
String email = json.response.customers.customer.email[0];
String lifetime_points = json.response.customers.customer.lifetime_points[0];
String loyalty_points = json.response.customers.customer.loyalty_points[0];
String current_slab = json.response.customers.customer.current_slab[0];

String lifetime_purchases = json.response.customers.customer.lifetime_purchases[0];
String type = json.response.customers.customer.type[0];
String source = json.response.customers.customer.source[0];
String mobile_reg = context.expand('${#TestCase#mobile}');







assert(lifetime_purchases == "0") // as this is new customer with no transactions.
assert(mobile == mobile_reg)
assert(json.response.customers.customer.subscriptions[0].subscription.size() == 4) // as we have configured 4 subscription while adding a customer.
assert(f_name == "fname_" + mobile_reg + "_changed");
assert(l_name == "lname_" + mobile_reg + "_changed");
assert(email == mobile_reg + "@gmail.com");
messageExchange.modelItem.testCase.setPropertyValue("user_id",user_id);
messageExchange.modelItem.testCase.setPropertyValue("lifetime_points",lifetime_points.toString());
messageExchange.modelItem.testCase.setPropertyValue("loyalty_points",loyalty_points.toString());





//item status.

String successFlag = json.response.customers.customer.item_status[0].success
String code = json.response.customers.customer.item_status[0].code
String message = json.response.customers.customer.item_status[0].message

assert(successFlag == "true")
assert(code == "1000")
assert(message == "Customer successfully updated")</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="format" value="json"/>
              <con:entry key="version" value="v1.1"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="get webhooks and fetch webhook consumer id" id="5c04837e-6b6e-4970-9e44-38a7456769d4">
        <con:settings/>
        <con:config service="getWebhooks" resourcePath="/{version}/webHooks" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="get webhooks and fetch webhook consumer id" id="e34c812d-806e-498b-adbd-323081eda9a6" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="bd5d1a2f-529b-492a-bf27-f3681c66848c" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="b9a1562a-b14d-4245-a079-7407ffcc3c36" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def webhook_names = json.data.name;
def my_webhook = context.expand('${#Project#webhook_workspace_name}');
int index = 0;
String consumer_id = "";
for(name in webhook_names){
	if(name == my_webhook){
		consumer_id = json.data.consumerGroupId[index];
	}
	index++;
}

messageExchange.modelItem.testCase.setPropertyValue("webhook_consumerID",consumer_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:preemptive>true</con:preemptive>
              <con:authType>Preemptive</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="version" value="v3" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Poll the status of event log" id="5f2a68d1-63d1-49c4-92aa-2066ab15399d">
        <con:settings/>
        <con:config>
          <script>import com.eviware.soapui.model.testsuite.TestStepResult
import com.eviware.soapui.model.testsuite.TestStepResult.TestStepStatus
import com.eviware.soapui.model.testsuite.TestStep

int maxRetries = 10;

int polling_time = Integer.parseInt(context.expand('${#Project#polling_time}'));
while(maxRetries > 0){
	TestStep teststep = testRunner.testCase.testSuite.testCases["Event_CustomerUpdate"].testSteps["check event logs"]
	TestStepResult result = teststep.run(testRunner,context)
	TestStepStatus status = result.getStatus();
	log.info "Status -- " + status
	if(status == TestStepStatus.OK){
		maxRetries=0;
		break;
	}
	else{
		sleep(polling_time);
	}
	maxRetries--;
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="check event logs" id="d762f890-15ad-47b6-bdf5-bf9d7512878b" disabled="true">
        <con:settings/>
        <con:config service="getEventLogs" resourcePath="/{version}/webHooks/eventLog/requestId/{request_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="check event logs" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9a67073e-d145-4c5f-90bf-7b2955e84d93" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ac07e8a1-01a4-49a8-9e5d-6e28d324525f" name="validate the events pushed status">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def consumers = json.data.consumerGroupId;
log.info consumers
int index = 0;
String my_consumer = context.expand('${#TestCase#webhook_consumerID}');
ArrayList&lt;String> eventNames = new ArrayList();
ArrayList&lt;Integer> consumersStatus = new ArrayList();
for(consumer in consumers){
	if(consumer == my_consumer){
		String event_name = json.data.eventName[index];
		def consumerResponse = json.data.consumerResponse[index]
		assert(consumerResponse != null)
	}
	index++;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="version" value="v3"/>
              <con:entry key="request_id" value="${#TestCase#request_id}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>request_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="validate the event log in mongo via an API" id="9ec51680-6844-4606-86c2-2dd23b9985a7">
        <con:settings/>
        <con:config service="getEventLogs" resourcePath="/{version}/webHooks/eventLog/requestId/{request_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="validate the event log in mongo via an API" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9a67073e-d145-4c5f-90bf-7b2955e84d93" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ac07e8a1-01a4-49a8-9e5d-6e28d324525f" name="validate the events pushed status">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def consumers = json.data.consumerGroupId;
int index = 0;
String my_consumer = context.expand('${#TestCase#webhook_consumerID}');
ArrayList&lt;String> eventNames = new ArrayList();
ArrayList&lt;Integer> consumersStatus = new ArrayList();
for(consumer in consumers){
	if(consumer == my_consumer){
		String event_name = json.data.eventName[index];
		def consumerResponse = json.data.consumerResponse[index]
		assert(consumerResponse != null) : "Consumer response is NULL"
		int status = json.data.consumerResponse[index].webhookHttpStatus;
		eventNames.add(event_name);
		consumersStatus.add(status);
	}
	index++;
}

log.info eventNames

messageExchange.modelItem.testCase.setPropertyValue("events",eventNames.inspect())
messageExchange.modelItem.testCase.setPropertyValue("eventStatus",consumersStatus.inspect())

//all status should be 200
for(String status : consumersStatus){
	assert status == "200"
}
//transactionAdded event should be pushed, as that is triggered as part of test case.
assert('customerUpdated' in eventNames)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="version" value="v3"/>
              <con:entry key="request_id" value="${#TestCase#request_id}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>request_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="httprequest" name="validate response data in webhook" id="fad5209f-505b-4dc8-ac0f-9f12454db065">
        <con:settings/>
        <con:config method="GET" xsi:type="con:HttpRequest" id="a8d53e36-26fb-4c1a-8c27-d0cb991becfb" name="validate response data in webhook" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>http://${#Project#webhook_workspace}/api/events</con:endpoint>
          <con:request/>
          <con:assertion type="Valid HTTP Status Codes" id="6f4c5385-a53b-43e7-bbcb-3e084abfe072" name="status - 200">
            <con:configuration>
              <codes>200</codes>
            </con:configuration>
          </con:assertion>
          <con:assertion type="GroovyScriptAssertion" id="b125b22a-5024-494c-b2f4-26382b2aaa51" name="validate the payload data">
            <con:configuration>
              <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

int bodyCount = json.body.size();
def events = Eval.me(context.expand('${#TestCase#events}'))
def eventsInConsumer = json.body.eventName


messageExchange.modelItem.testCase.setPropertyValue('eventsReceived',eventsInConsumer.inspect())
assert(bodyCount == events.size())
assert('customerUpdated' in eventsInConsumer)

for(int i = 0;i&lt;bodyCount;i++){
	String event_name = json.body[i].eventName;
	log.info event_name;
	if(event_name == "customerUpdated"){
		def loyaltyType = json.body[i].data.loyaltyType
		def source = json.body[i].data.source
		def firstName = json.body[i].data.firstName
		def lastName = json.body[i].data.lastName
		def custId = json.body[i].data.customerIdentifiers.customerId.toString()
		def mobile = json.body[i].data.customerIdentifiers.instore.mobile.toString()
		def email = json.body[i].data.customerIdentifiers.instore.email.toString()

		def userMobile = context.expand('${#TestCase#mobile}')
		def userID = context.expand('${#TestCase#user_id}')

		assert(loyaltyType == "LOYALTY")
		assert(source == "instore")
		assert(firstName == "fname_" + userMobile + "_changed")
		assert(lastName == "lname_" + userMobile + "_changed")
		assert(custId == userID)
		assert(mobile == userMobile)
		assert(email == userMobile + "@gmail.com")
	}
}</scriptText>
            </con:configuration>
          </con:assertion>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:parameter>
              <con:name>request_id</con:name>
              <con:value>${#TestCase#request_id}</con:value>
              <con:style>QUERY</con:style>
              <con:default/>
              <con:path xsi:nil="true"/>
              <con:description xsi:nil="true"/>
            </con:parameter>
          </con:parameters>
        </con:config>
      </con:testStep>
      <con:setupScript/>
      <con:properties>
        <con:property>
          <con:name>mobile</con:name>
          <con:value>6216655805</con:value>
        </con:property>
        <con:property>
          <con:name>request_id</con:name>
          <con:value>d361db5cd018b62bc41d35e1d573efb2</con:value>
        </con:property>
        <con:property>
          <con:name>user_id</con:name>
          <con:value>371409773</con:value>
        </con:property>
        <con:property>
          <con:name>lifetime_points</con:name>
          <con:value>140</con:value>
        </con:property>
        <con:property>
          <con:name>loyalty_points</con:name>
          <con:value>140</con:value>
        </con:property>
        <con:property>
          <con:name>webhook_consumerID</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>events</con:name>
          <con:value>[]</con:value>
        </con:property>
        <con:property>
          <con:name>eventStatus</con:name>
          <con:value>[]</con:value>
        </con:property>
        <con:property>
          <con:name>eventsReceived</con:name>
          <con:value>['customerUpdated']</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="b0d35e61-7947-4104-8d93-35451922592d" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Event_ReturnTransaction" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="get a unique tnx number to make a new transaction" id="962a71b7-7db4-4cfb-8951-fa9747f26cf0">
        <con:settings/>
        <con:config>
          <script>String timestamp = System.currentTimeMillis().toString()
testRunner.testCase.setPropertyValue("tnx_number",timestamp);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="get a unique mobile" id="7e9e4271-2a40-4c91-ab83-1e6a3b3db08a">
        <con:settings/>
        <con:config>
          <script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(3);
testRunner.testCase.setPropertyValue("mobile","91" + mobile);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Register a new customer" id="46825900-9329-4ab1-8da5-58db0d9a9311">
        <con:settings/>
        <con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Register a new customer" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			},
        "custom_fields": {
          "field": [
            {
              "name": "Hobbies",
              "value": "[“Fitness”]"
            }
          ]
        }

      }
    ]
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="6561825e-a822-4b5a-8d71-764b779e304e" name="Status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="5b1e5a91-9733-4e79-a8df-37a1c6ca91ff" name="capture request id">
              <con:configuration>
                <scriptText>String req_id = messageExchange.responseHeaders["X-CAP-REQUEST-ID"][0].toString();
messageExchange.modelItem.testCase.setPropertyValue("request_id",req_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="358bd7c4-10af-4b97-9e52-6af837cb76b9" name="validate customer registration data">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


//assert success holder in response
assert(json.response.status.success == "true")
assert(json.response.status.code == 200)
assert(json.response.status.message == "Success")


//assert customer data.

assert(json.response.customers.customer.user_id.size() == 1);

String user_id = json.response.customers.customer.user_id[0];
String f_name = json.response.customers.customer.firstname[0];
String l_name = json.response.customers.customer.lastname[0];
String mobile = json.response.customers.customer.mobile[0];
String email = json.response.customers.customer.email[0];
String lifetime_points = json.response.customers.customer.lifetime_points[0];
String loyalty_points = json.response.customers.customer.loyalty_points[0];
String current_slab = json.response.customers.customer.current_slab[0];

String lifetime_purchases = json.response.customers.customer.lifetime_purchases[0];
String type = json.response.customers.customer.type[0];
String source = json.response.customers.customer.source[0];
String mobile_reg = context.expand('${#TestCase#mobile}');







assert(lifetime_purchases == "0") // as this is new customer with no transactions.
assert(mobile == mobile_reg)
assert(json.response.customers.customer.subscriptions[0].subscription.size() == 4) // as we have configured 4 subscription while adding a customer.
assert(f_name == "fname_" + mobile_reg);
assert(l_name == "lname_" + mobile_reg);
assert(email == mobile_reg + "@gmail.com");
messageExchange.modelItem.testCase.setPropertyValue("user_id",user_id);
messageExchange.modelItem.testCase.testSuite.setPropertyValue("user_id",user_id);
messageExchange.modelItem.testCase.setPropertyValue("lifetime_points",lifetime_points.toString());
messageExchange.modelItem.testCase.setPropertyValue("loyalty_points",loyalty_points.toString());





//item status.

assert(json.response.customers.customer.item_status[0].success == "true")
assert(json.response.customers.customer.item_status[0].code == "1000")
if(json.response.customers.customer.item_status[0].message.toLowerCase().contains("customer registration successful")){
	assert true;
}
else{
	assert false : "customer registration not done! " + json.response.customers.customer.item_status[0].message
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="format" value="json"/>
              <con:entry key="version" value="v1.1"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="add a regular transaction" id="7ecf068b-358f-42f1-ae2c-6d3dc8cd7c65">
        <con:settings/>
        <con:config service="addRegularTransaction" resourcePath="/v1.1/transaction/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="add a regular transaction" id="30d7b033-bada-4cf6-abdf-781b858869dc" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
	"root": {
		"transaction": {
			"bill_client_id": "${#TestCase#mobile}",
			"type": "regular",
			"number": "${#TestCase#tnx_number}",
			"notes": "2 lin1e items",
			"amount" : 2000,
			"customer": {
				"mobile": "${#TestCase#mobile}",
				"email": "${#TestCase#mobile}@gmail.com",
				"external_id": "x${#TestCase#mobile}",
				"firstname": "fname_${#TestCase#mobile}",
				"lastname": "lname_${#TestCase#mobile}"
			},
			"extended_fields": {
				"field": [{
						"name": "ship_first_name",
						"value": "fname_${#TestCase#mobile}"
					},
					{
						"name": "ship_last_name",
						"value": "lname_${#TestCase#mobile}"
					}
				]
			},
			"custom_fields": {

				"field": [{
						"name": "bankdetails",
						"value": "SBI"
					},
					{
						"name": "bankdetails",
						"value": "SBI"
					}
				]

			},
			"line_items": {
				"line_item": [{
						"extended_fields": {
							"field": [{
									"name": "MetalRate",
									"value": 23
								},
								{
									"name": "service_tax_amount",
									"value": 100
								}
							]
						},
						"serial": "1",
						"amount": "500",
						"description": "soap",
						"item_code": "item-001",
						"qty": "50",
						"rate": "10",
						"value": "500",
						"attributes": {
							"attribute": {
								"name": "brand",
								"value": "Levis"
							}
						}
					},
					{
						"extended_fields": {
							"field": [{
									"name": "DesignCode",
									"value": "jmh6677"
								},
								{
									"name": "SupplierCode",
									"value": "hgjy111"
								}
							]
						},
						"serial": "2",
						"amount": "500",
						"description": "soap",
						"item_code": "item-001",
						"qty": "50",
						"rate": "10",
						"value": "500",
						"transaction_number": "niBill1",
						"attributes": {
							"attribute": {
								"name": "brand",
								"value": "Levis"
							}
						}
					},
					{
						"extended_fields": {
							"field": [{
									"name": "StoneCharge",
									"value": 22
								},
								{
									"name": "MakingCharge",
									"value": 11
								}
							]
						},
						"serial": "3",
						"item_code": "t122",
						"description": "afvdfvd",
						"qty": "3",
						"rate": "1000",
						"value": "3000",
						"discount_value": "100",
						"amount": "2900",
						"cashier_id": "cash1233",
						"transaction_number": "previousBill1"
					}
				]
			},
			"associate_details": {
				"code": "hiraxdhara",
				"name": "Tom Sawyer"
			}
		}
	}
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/transaction/add</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="1e361c9e-3bde-431e-a3ca-af4c4199f182" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="e7fac582-133e-4ed0-8c17-d64cda91eb65" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


String mob = context.expand('${#TestCase#mobile}')
String tnxNumber = context.expand('${#TestCase#tnx_number}')
String cumulativePurchases = context.expand('${#TestCase#cumulativePurchases}');
//asserting status of response
assert(json.response.status.success == "true")
assert(json.response.status.code == 200)
assert(json.response.status.message == "Success")

// Get customer point info before the tnx.

String loyaltyPoints_beforetnx = context.expand('${#TestCase#loyaltyPoints}')


//get transaction details
String tnxID = json.response.transactions.transaction.id[0].toString();
String billNumber = json.response.transactions.transaction.number[0].toString();
String type = json.response.transactions.transaction.type[0].toString();

assert(billNumber == tnxNumber);
messageExchange.modelItem.testCase.setPropertyValue("tnxID",tnxID);


//get customer details.

String user_id = json.response.transactions.transaction.customer[0].user_id.toString();
messageExchange.modelItem.testCase.setPropertyValue("user_id",user_id)
String mobile = json.response.transactions.transaction.customer[0].mobile.toString();
assert(mobile == mob);
String fname = json.response.transactions.transaction.customer[0].firstname.toString();
assert(fname == "fname_" + mob);
String lname = json.response.transactions.transaction.customer[0].lastname.toString();
assert(lname == "lname_" + mob);
String email = json.response.transactions.transaction.customer[0].email.toString();
assert(email == mob + "@gmail.com")
String externalID = json.response.transactions.transaction.customer[0].external_id.toString();
assert(externalID == "x" + mob);
String lifetimePoints = json.response.transactions.transaction.customer[0].lifetime_points.toString();
messageExchange.modelItem.testCase.setPropertyValue("lifetimePoints_afterTnx",lifetimePoints);
String loyaltyPoints = json.response.transactions.transaction.customer[0].loyalty_points.toString();
messageExchange.modelItem.testCase.setPropertyValue("loyaltyPoints_afterTnx",loyaltyPoints);
String currentSlab = json.response.transactions.transaction.customer[0].current_slab.toString();
messageExchange.modelItem.testCase.setPropertyValue("currentSlab_afterTnx",currentSlab);
String lifetime_purchases = json.response.transactions.transaction.customer[0].lifetime_purchases.toString();
messageExchange.modelItem.testCase.setPropertyValue("lifetime_puchases_afterTnx",lifetime_purchases);



String user_type = json.response.transactions.transaction.customer[0].type.toString();

String source = json.response.transactions.transaction.customer[0].source.toString();

//get side effects of transactions done.
String awarded_points = json.response.transactions.transaction.side_effects[0].effect.awarded_points[0].toString();

String totalPoints = json.response.transactions.transaction.side_effects[0].effect.total_points[0].toString();
String pointBalance = json.response.transactions.transaction.points_balance[0].toString();

messageExchange.modelItem.testCase.setPropertyValue("awarded_points_afterTnx",awarded_points);


messageExchange.modelItem.testCase.setPropertyValue("totalPoints_afterTnx",totalPoints);


//Item status.
assert(json.response.transactions.transaction.item_status[0].success == "true")
assert(json.response.transactions.transaction.item_status[0].code == 600)
String msg = json.response.transactions.transaction.item_status[0].message;
assert(msg == "Transaction added successfully")</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="now return the full transaction" id="d8b9af38-1428-48aa-bf43-743fe317a05b">
        <con:settings/>
        <con:config service="returnRegularTransaction" resourcePath="/v1.1/transaction/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="now return the full transaction" id="77cded7f-7736-4732-bd83-29e42c30f628" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="content-type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
	"root": {
		"transaction": {
			"bill_client_id": "${#TestCase#mobile}",
			"type": "return",
			"number": "${#TestCase#tnx_number}",
			"notes": "2 lin1e items",
			"amount" : 2000,
			"customer": {
				"mobile": "${#TestCase#mobile}",
				"email": "${#TestCase#mobile}@gmail.com",
				"external_id": "x${#TestCase#mobile}",
				"firstname": "fname_${#TestCase#mobile}",
				"lastname": "lname_${#TestCase#mobile}"
			},
			"extended_fields": {
				"field": [{
						"name": "ship_first_name",
						"value": "fname_${#TestCase#mobile}"
					},
					{
						"name": "ship_last_name",
						"value": "lname_${#TestCase#mobile}"
					}
				]
			},
			"custom_fields": {

				"field": [{
						"name": "bankdetails",
						"value": "SBI"
					},
					{
						"name": "bankdetails",
						"value": "SBI"
					}
				]

			},
			"line_items": {
				"line_item": [{
						"extended_fields": {
							"field": [{
									"name": "MetalRate",
									"value": 23
								},
								{
									"name": "service_tax_amount",
									"value": 100
								}
							]
						},
						"serial": "1",
						"amount": "500",
						"description": "soap",
						"item_code": "item-001",
						"qty": "50",
						"rate": "10",
						"value": "500",
						"attributes": {
							"attribute": {
								"name": "brand",
								"value": "Levis"
							}
						}
					},
					{
						"extended_fields": {
							"field": [{
									"name": "DesignCode",
									"value": "jmh6677"
								},
								{
									"name": "SupplierCode",
									"value": "hgjy111"
								}
							]
						},
						"serial": "2",
						"amount": "500",
						"description": "soap",
						"item_code": "item-001",
						"qty": "50",
						"rate": "10",
						"value": "500",
						"transaction_number": "niBill1",
						"attributes": {
							"attribute": {
								"name": "brand",
								"value": "Levis"
							}
						}
					},
					{
						"extended_fields": {
							"field": [{
									"name": "StoneCharge",
									"value": 22
								},
								{
									"name": "MakingCharge",
									"value": 11
								}
							]
						},
						"serial": "3",
						"item_code": "t122",
						"description": "afvdfvd",
						"qty": "3",
						"rate": "1000",
						"value": "3000",
						"discount_value": "100",
						"amount": "2900",
						"cashier_id": "cash1233",
						"type": "return",
						"return_type": "LINE_ITEM",
						"transaction_number": "previousBill1"
					}
				]
			},
      "associate_details": {
				"code": "hiraxdhara",
				"name": "Tom Sawyer"
			},
      "return_type": "FULL"
      }
	}
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/transaction/add</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="49b7a4cb-cbdf-4424-85d9-8d883e854d62" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="3be505cd-9acf-4e10-aed0-661a4c3b6346" name="Validate return transaction contents">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

//asserting status of response
assert(json.response.status.success == "true")
assert(json.response.status.code == 200)
assert(json.response.status.message == "Success")

//assert return transaction details

String ID = json.response.transactions.transaction[0].id
String transactionNumber = json.response.transactions.transaction[0].number
String billClientID = json.response.transactions.transaction[0].bill_client_id
String type = json.response.transactions.transaction[0].type
String dileveryStatus = json.response.transactions.transaction[0].delivery_status
int pointsDeducted = json.response.transactions.transaction[0].points_deducted
int points_balance = json.response.transactions.transaction[0].points_balance

assert(transactionNumber == context.expand('${#TestCase#tnx_number}'))
assert(billClientID == context.expand('${#TestCase#mobile}'))
assert(type == "RETURN")
assert(dileveryStatus == "DELIVERED")
assert(pointsDeducted.toString() == context.expand('${#TestCase#awarded_points_afterTnx}'))






//assert customer information
String userID = json.response.transactions.transaction[0].customer.user_id
String mobile = json.response.transactions.transaction[0].customer.mobile
String firstName = json.response.transactions.transaction[0].customer.firstname
String lastName = json.response.transactions.transaction[0].customer.lastname
String email = json.response.transactions.transaction[0].customer.email
String externalID = json.response.transactions.transaction[0].customer.external_id
String lifetimePoints = json.response.transactions.transaction[0].customer.lifetime_points
String loyaltyPoints = json.response.transactions.transaction[0].customer.loyalty_points
String lifetimePurchases = json.response.transactions.transaction[0].customer.lifetime_purchases
String userType = json.response.transactions.transaction[0].customer.type
String source = json.response.transactions.transaction[0].customer.source


//assert side effects
String awardedPoints = json.response.transactions.transaction[0].side_effects.effect[0].awarded_points
String totalPoints = json.response.transactions.transaction[0].side_effects.effect[0].total_points
String sideEffectType = json.response.transactions.transaction[0].side_effects.effect[0].type

String awarededPointsAfterTnx = context.expand('${#TestCase#awarded_points_afterTnx}');
String lifetimePointsAfterTnx = context.expand('${#TestCase#lifetime_points}')
assert(awardedPoints == "-" + awarededPointsAfterTnx) // as we have returned full transaction.
assert(totalPoints == lifetimePointsAfterTnx)


//assert item status

assert(json.response.transactions.transaction[0].item_status.success == "true")
assert(json.response.transactions.transaction[0].item_status.message == "Transaction added successfully")</scriptText>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="1c3f9ddb-878e-406f-b300-7bf381440b0a" name="capture request ID">
              <con:configuration>
                <scriptText>String req_id = messageExchange.responseHeaders["X-CAP-REQUEST-ID"][0].toString();
messageExchange.modelItem.testCase.setPropertyValue("request_id",req_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="get webhooks and fetch webhook consumer id" id="1676af48-3dd8-4562-a67b-68cb47dd07b5">
        <con:settings/>
        <con:config service="getWebhooks" resourcePath="/{version}/webHooks" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="get webhooks and fetch webhook consumer id" id="e34c812d-806e-498b-adbd-323081eda9a6" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="bd5d1a2f-529b-492a-bf27-f3681c66848c" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="b9a1562a-b14d-4245-a079-7407ffcc3c36" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def webhook_names = json.data.name;
def my_webhook = context.expand('${#Project#webhook_workspace_name}');
int index = 0;
String consumer_id = "";
for(name in webhook_names){
	if(name == my_webhook){
		consumer_id = json.data.consumerGroupId[index];
	}
	index++;
}

messageExchange.modelItem.testCase.setPropertyValue("webhook_consumerID",consumer_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:preemptive>true</con:preemptive>
              <con:authType>Preemptive</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="version" value="v3" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Poll the status of event log" id="89790204-5998-47f1-9193-d83061f37331">
        <con:settings/>
        <con:config>
          <script>import com.eviware.soapui.model.testsuite.TestStepResult
import com.eviware.soapui.model.testsuite.TestStepResult.TestStepStatus
import com.eviware.soapui.model.testsuite.TestStep

int maxRetries = 10;
int polling_time = Integer.parseInt(context.expand('${#Project#polling_time}'));

while(maxRetries > 0){
	TestStep teststep = testRunner.testCase.testSuite.testCases["Event_ReturnTransaction"].testSteps["check event logs"]
	TestStepResult result = teststep.run(testRunner,context)
	TestStepStatus status = result.getStatus();
	log.info "Status -- " + status
	if(status == TestStepStatus.OK){
		maxRetries=0;
		break;
	}
	else{
		sleep(polling_time);
	}
	maxRetries--;
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="validate the event log in mongo via an API" id="6bcfd998-49c2-4caa-84aa-65a40ef357fc">
        <con:settings/>
        <con:config service="getEventLogs" resourcePath="/{version}/webHooks/eventLog/requestId/{request_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="validate the event log in mongo via an API" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9a67073e-d145-4c5f-90bf-7b2955e84d93" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ac07e8a1-01a4-49a8-9e5d-6e28d324525f" name="validate the events pushed status">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def consumers = json.data.consumerGroupId;
int index = 0;
String my_consumer = context.expand('${#TestCase#webhook_consumerID}');
ArrayList&lt;String> eventNames = new ArrayList();
ArrayList&lt;Integer> consumersStatus = new ArrayList();
for(consumer in consumers){
	if(consumer == my_consumer){
		String event_name = json.data.eventName[index];
		def consumerResponse = json.data.consumerResponse[index]
		assert(consumerResponse != null) : "Consumer response is NULL"
		int status = json.data.consumerResponse[index].webhookHttpStatus;
		eventNames.add(event_name);
		consumersStatus.add(status);
	}
	index++;
}

log.info eventNames

messageExchange.modelItem.testCase.setPropertyValue("events",eventNames.inspect())
messageExchange.modelItem.testCase.setPropertyValue("eventStatus",consumersStatus.inspect())

//all status should be 200
for(String status : consumersStatus){
	assert status == "200"
}
//transactionAdded event should be pushed, as that is triggered as part of test case.
assert('transactionAdded' in eventNames)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="version" value="v3"/>
              <con:entry key="request_id" value="${#TestCase#request_id}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>request_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="httprequest" name="validate response data in webhook" id="3ad15404-7a43-45ae-85c7-359878b2a76e" disabled="true">
        <con:settings/>
        <con:config method="GET" xsi:type="con:HttpRequest" id="a8d53e36-26fb-4c1a-8c27-d0cb991becfb" name="validate response data in webhook" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>http://${#Project#webhook_workspace}/api/events</con:endpoint>
          <con:request/>
          <con:assertion type="Valid HTTP Status Codes" id="6f4c5385-a53b-43e7-bbcb-3e084abfe072" name="status - 200">
            <con:configuration>
              <codes>200</codes>
            </con:configuration>
          </con:assertion>
          <con:assertion type="GroovyScriptAssertion" id="b125b22a-5024-494c-b2f4-26382b2aaa51" name="validate the payload data">
            <con:configuration>
              <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

int bodyCount = json.body.size();
String mobileNum = context.expand('${#TestSuite#mobile}')
def events = Eval.me(context.expand('${#TestCase#events}'))
def eventsInConsumer = json.body.eventName

messageExchange.modelItem.testCase.setPropertyValue('eventsReceived',eventsInConsumer.inspect())
assert(bodyCount == events.size())

assert('transactionAdded' in eventsInConsumer)

for(int i = 0;i&lt;bodyCount;i++){
	String event_name = json.body[i].eventName;
	log.info event_name;
	if(event_name == "transactionAdded"){
    def amount = json.body[i].data.amount;
    def billClientID = json.body[i].data.billClientId;
    def billNumber = json.body[i].data.billNumber;
    def transactionId = json.body[i].data.transactionId.toString();
    def lineItemCount = json.body[i].data.lineItemCount;
    def discount = json.body[i].data.discount;
    def grossAmount = json.body[i].data.grossAmount;
    def cust_id = json.body[i].data.customerIdentifiers.customerId.toString();

    //get tnx info
    def tnxNumber = context.expand('${#TestCase#tnx_number}');
    def tnxID = context.expand('${#TestCase#tnxID}');
    def userID = context.expand('${#TestSuite#user_id}')

    assert(amount == 2000);
    assert(billNumber == tnxNumber);
    assert(transactionId == tnxID);
    assert(billClientID == mobileNum);
    assert(lineItemCount == 3); // as while addign tnx , line item was 2.
    assert(discount == 10);
    assert(grossAmount == 100);
    assert(cust_id == userID);
}
}</scriptText>
            </con:configuration>
          </con:assertion>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:parameter>
              <con:name>request_id</con:name>
              <con:value>${#TestCase#request_id}</con:value>
              <con:style>QUERY</con:style>
              <con:default/>
              <con:path xsi:nil="true"/>
              <con:description xsi:nil="true"/>
            </con:parameter>
          </con:parameters>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="check event logs" id="1e225697-4dbe-41d7-98f8-94d9c19e7adc" disabled="true">
        <con:settings/>
        <con:config service="getEventLogs" resourcePath="/{version}/webHooks/eventLog/requestId/{request_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="check event logs" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9a67073e-d145-4c5f-90bf-7b2955e84d93" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ac07e8a1-01a4-49a8-9e5d-6e28d324525f" name="validate the events pushed status">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def consumers = json.data.consumerGroupId;
log.info consumers
int index = 0;
String my_consumer = context.expand('${#TestCase#webhook_consumerID}');
ArrayList&lt;String> eventNames = new ArrayList();
ArrayList&lt;Integer> consumersStatus = new ArrayList();
for(consumer in consumers){
	if(consumer == my_consumer){
		String event_name = json.data.eventName[index];
		def consumerResponse = json.data.consumerResponse[index]
		assert(consumerResponse != null)
	}
	index++;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="version" value="v3"/>
              <con:entry key="request_id" value="${#TestCase#request_id}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>request_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:setupScript/>
      <con:properties>
        <con:property>
          <con:name>tnx_number</con:name>
          <con:value>1606216660548</con:value>
        </con:property>
        <con:property>
          <con:name>request_id</con:name>
          <con:value>eba9a6802fedd1f0863b396c31a5ab29</con:value>
        </con:property>
        <con:property>
          <con:name>tnxID</con:name>
          <con:value>37216408</con:value>
        </con:property>
        <con:property>
          <con:name>mobile</con:name>
          <con:value>916216660549</con:value>
        </con:property>
        <con:property>
          <con:name>user_id</con:name>
          <con:value>371409774</con:value>
        </con:property>
        <con:property>
          <con:name>lifetimePoints_afterTnx</con:name>
          <con:value>340</con:value>
        </con:property>
        <con:property>
          <con:name>loyaltyPoints_afterTnx</con:name>
          <con:value>340</con:value>
        </con:property>
        <con:property>
          <con:name>currentSlab_afterTnx</con:name>
          <con:value>Silver</con:value>
        </con:property>
        <con:property>
          <con:name>lifetime_puchases_afterTnx</con:name>
          <con:value>2000</con:value>
        </con:property>
        <con:property>
          <con:name>awarded_points_afterTnx</con:name>
          <con:value>200</con:value>
        </con:property>
        <con:property>
          <con:name>totalPoints_afterTnx</con:name>
          <con:value>340</con:value>
        </con:property>
        <con:property>
          <con:name>lifetime_points</con:name>
          <con:value>140</con:value>
        </con:property>
        <con:property>
          <con:name>loyalty_points</con:name>
          <con:value>140</con:value>
        </con:property>
        <con:property>
          <con:name>webhook_consumerID</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>events</con:name>
          <con:value>[]</con:value>
        </con:property>
        <con:property>
          <con:name>eventStatus</con:name>
          <con:value>[]</con:value>
        </con:property>
        <con:property>
          <con:name>eventsReceived</con:name>
          <con:value>[]</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:properties>
      <con:property>
        <con:name>mobile</con:name>
        <con:value>919216616203</con:value>
      </con:property>
      <con:property>
        <con:name>webhook_consumerID</con:name>
        <con:value/>
      </con:property>
      <con:property>
        <con:name>user_id</con:name>
        <con:value>371409770</con:value>
      </con:property>
    </con:properties>
  </con:testSuite>
  <con:testSuite id="38583330-b416-4a11-a304-90fa8d14eb9b" name="Point_Redemption">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase id="09dd370e-3ef6-4e5f-b954-65609ca078e7" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Full_Point_Redemption" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="get current date and time" id="b7e5507d-cc2c-4f11-bdc4-6bf6906b40dc">
        <con:settings/>
        <con:config>
          <script>def getcurrent = Calendar.getInstance()
String current_time = getcurrent.format("yyyy-MM-dd HH:mm:ss");
testRunner.testCase.testSuite.setPropertyValue("current_time",current_time);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="calltestcase" name="add a transaction" id="21bd6f70-3c8d-45d4-9fdf-cece1f441a81">
        <con:settings/>
        <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:targetTestCase>a6919450-66f2-417f-9891-60d4219922a2</con:targetTestCase>
          <con:properties>
            <con:property>
              <con:name>tnx_number</con:name>
              <con:value>1591618396257</con:value>
            </con:property>
            <con:property>
              <con:name>tnxID</con:name>
              <con:value>38261500</con:value>
            </con:property>
            <con:property>
              <con:name>user_id</con:name>
              <con:value>379085721</con:value>
            </con:property>
            <con:property>
              <con:name>mobile</con:name>
              <con:value>919618396262</con:value>
            </con:property>
            <con:property>
              <con:name>awarded_points_afterTnx</con:name>
              <con:value>500</con:value>
            </con:property>
            <con:property>
              <con:name>totalPoints_afterTnx</con:name>
              <con:value>500</con:value>
            </con:property>
            <con:property>
              <con:name>pointBalance_afterTnx</con:name>
              <con:value xsi:nil="true"/>
            </con:property>
            <con:property>
              <con:name>tnx_mobile</con:name>
              <con:value>919618396262</con:value>
            </con:property>
          </con:properties>
          <con:returnProperties>
            <con:entry>tnx_number</con:entry>
            <con:entry>tnxID</con:entry>
            <con:entry>user_id</con:entry>
            <con:entry>mobile</con:entry>
            <con:entry>awarded_points_afterTnx</con:entry>
            <con:entry>totalPoints_afterTnx</con:entry>
            <con:entry>pointBalance_afterTnx</con:entry>
            <con:entry>tnx_mobile</con:entry>
          </con:returnProperties>
          <con:runMode>SINGLETON_AND_WAIT</con:runMode>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="redeem full points awarded in transaction" id="1d17908d-5c78-4dd8-8486-7f8965c4beed">
        <con:settings/>
        <con:config service="RedeemPoints" resourcePath="/{version}/points/redeem" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="redeem full points awarded in transaction" id="589bdef3-8de7-4a35-bc91-bdb079b2b19f" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:encoding xsi:nil="true"/>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "redeem": {
      "points_redeemed": "${#awarded_points_afterTnx}",
      "customer":
				{
					"mobile": "${#tnx_mobile}"
				},
      "group_redemption": "false",
      "notes": "redeem",
      "redemption_time": "${#TestSuite#current_time}"
    }
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/points/redeem</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="e9f80710-bb53-4e19-949f-3b9a696ce7fd" name="status - 200 ">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="5f939d79-0c31-4ced-8f50-0ff758599ccd" name="Validate the points redeemed response">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

//assert status
String successFlag = json.response.status.success
int code = json.response.status.code
String message = json.response.status.message

assert(successFlag == "true")
assert(code == 200)
assert(message == "Success")

//get the customer and transaction details from transaction add and point redeem api response
String pointsToBeRedeem =  context.expand('${#awarded_points_afterTnx}')
String tnx_user_id = context.expand('${#user_id}')
String mob = context.expand('${#tnx_mobile}')
String user_id = json.response.responses.points.user_id.toString();
String mobile = json.response.responses.points.mobile.toString();
String num_points = json.response.responses.points.side_effects.effect[0].num_points.toString();
String currency_value = json.response.responses.points.side_effects.effect[0].currency_value.toString();
String redemption_id = json.response.responses.points.redemption_id.toString();
String redeemed_value = json.response.responses.points.redeemed_value.toString();


//Vaidating the actual and expected value from the response
assert(pointsToBeRedeem == redeemed_value)
assert(user_id == tnx_user_id)
assert(mobile == mob);
assert(num_points == pointsToBeRedeem)
assert(currency_value == pointsToBeRedeem)

//Exposing the redemption id for other api use
messageExchange.modelItem.testCase.setPropertyValue("redemption_id",redemption_id);
messageExchange.modelItem.testCase.setPropertyValue("redemption_mobile",mobile);


assert(json.response.responses.points.item_status.success == "true")
assert(json.response.responses.points.item_status.code == 800)
String msg = json.response.responses.points.item_status.message;
if(msg.toLowerCase() == "points redeemed"){
	assert true;
}
else{
	assert false : "Getting message as - " + msg;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="program_id" value=""/>
              <con:entry key="format" value="json"/>
              <con:entry key="version" value="v1.1"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>format</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="jdbc" name="JDBC Request" id="a3555cc3-db20-4364-b51d-daad5ccc5ed3" disabled="true">
        <con:settings/>
        <con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:driver>com.mysql.jdbc.Driver</con:driver>
          <con:connectionString>jdbc:mysql://127.0.0.1:8921/warehouse?user=capillaryro&amp;password=captech123</con:connectionString>
          <con:query>Select * from warehouse.points_awarded where org_id = 50613 and program_id = 1400 and customer_id =378950979</con:query>
          <con:properties/>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>redemption_id</con:name>
          <con:value>j4V7ET</con:value>
        </con:property>
        <con:property>
          <con:name>redemption_mobile</con:name>
          <con:value>919618396262</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="ff854ded-40a5-4d28-95be-c0654510fd29" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Partial_Point_Redemprion" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="get current date and time" id="a44585c7-5822-479f-b75a-b939035bc9b2">
        <con:settings/>
        <con:config>
          <script>def getcurrent = Calendar.getInstance()
String current_time = getcurrent.format("yyyy-MM-dd HH:mm:ss");
testRunner.testCase.testSuite.setPropertyValue("current_time",current_time);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="calltestcase" name="add a transaction" id="1814b005-910e-4fc3-bf00-9ce004862956">
        <con:settings/>
        <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:targetTestCase>a6919450-66f2-417f-9891-60d4219922a2</con:targetTestCase>
          <con:properties>
            <con:property>
              <con:name>tnx_number</con:name>
              <con:value>1590734620756</con:value>
            </con:property>
            <con:property>
              <con:name>tnxID</con:name>
              <con:value>38260719</con:value>
            </con:property>
            <con:property>
              <con:name>user_id</con:name>
              <con:value>379076657</con:value>
            </con:property>
            <con:property>
              <con:name>mobile</con:name>
              <con:value>919734620759</con:value>
            </con:property>
            <con:property>
              <con:name>awarded_points_afterTnx</con:name>
              <con:value>500</con:value>
            </con:property>
            <con:property>
              <con:name>totalPoints_afterTnx</con:name>
              <con:value>500</con:value>
            </con:property>
            <con:property>
              <con:name>pointBalance_afterTnx</con:name>
            </con:property>
            <con:property>
              <con:name>tnx_mobile</con:name>
              <con:value>919734620759</con:value>
            </con:property>
          </con:properties>
          <con:returnProperties>
            <con:entry>tnx_number</con:entry>
            <con:entry>tnxID</con:entry>
            <con:entry>user_id</con:entry>
            <con:entry>mobile</con:entry>
            <con:entry>awarded_points_afterTnx</con:entry>
            <con:entry>totalPoints_afterTnx</con:entry>
            <con:entry>tnx_mobile</con:entry>
          </con:returnProperties>
          <con:runMode>PARALLELL</con:runMode>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="redeem half of the points awarded" id="6b66b6de-8722-4e24-a19a-f5673ecdc093">
        <con:settings/>
        <con:config service="RedeemPoints" resourcePath="/{version}/points/redeem" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="redeem half of the points awarded" id="589bdef3-8de7-4a35-bc91-bdb079b2b19f" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:encoding xsi:nil="true"/>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "redeem": {
      "points_redeemed": "${=Math.round(${#awarded_points_afterTnx}/2)}",
      "customer":
				{
					"mobile": "${#tnx_mobile}"
				},
      "group_redemption": "false",
      "notes": "redeem",
      "redemption_time": "${#TestSuite#current_time}"
    }
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/points/redeem</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="c438e87e-0d8f-461e-ab56-18d73e8b58ba" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="28fbe66f-6d64-438c-b03f-c75b84aec1ec" name="Validate partial point redemption api response">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

//assert status
String successFlag = json.response.status.success
int code = json.response.status.code
String message = json.response.status.message

assert(successFlag == "true")
assert(code == 200)
assert(message == "Success")

//get the customer and transaction details from transaction add and point redeem api response
String pointsToBeRedeem =  context.expand('${=Math.round(${#awarded_points_afterTnx}/2)}') //dividing the awarded point and rounding off
String tnx_user_id = context.expand('${#user_id}')
String mob = context.expand('${#tnx_mobile}')
String user_id = json.response.responses.points.user_id.toString();
String mobile = json.response.responses.points.mobile.toString();
String num_points = json.response.responses.points.side_effects.effect[0].num_points.toString();
String currency_value = json.response.responses.points.side_effects.effect[0].currency_value.toString();
String redemption_id = json.response.responses.points.redemption_id.toString();
String redeemed_value = json.response.responses.points.redeemed_value.toString();


//Vaidating the actual and expected value from the response
assert(pointsToBeRedeem == redeemed_value)
assert(user_id == tnx_user_id)
assert(mobile == mob);
assert(num_points == pointsToBeRedeem)
assert(currency_value == pointsToBeRedeem)

//Exposing the redemption id for other api use
messageExchange.modelItem.testCase.setPropertyValue("redemption_id",redemption_id);


assert(json.response.responses.points.item_status.success == "true")
assert(json.response.responses.points.item_status.code == 800)
String msg = json.response.responses.points.item_status.message;
if(msg.toLowerCase() == "points redeemed"){
	assert true;
}
else{
	assert false : "Getting message as - " + msg;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="program_id" value=""/>
              <con:entry key="format" value="json"/>
              <con:entry key="version" value="v1.1"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>format</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>redemption_id</con:name>
          <con:value>E8q3Eg</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="310a2eb8-7984-477b-95a0-083d05c2b92e" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Full_Points_Redemption_Against_Tnx_Number" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="get current date and time" id="470d400d-2a45-4a04-84b1-3021542b96fc">
        <con:settings/>
        <con:config>
          <script>def getcurrent = Calendar.getInstance()
String current_time = getcurrent.format("yyyy-MM-dd HH:mm:ss");
testRunner.testCase.testSuite.setPropertyValue("current_time",current_time);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="calltestcase" name="add transaction with transaction number" id="ebe731fa-b082-4256-8278-277ff1f3b76f">
        <con:settings/>
        <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:targetTestCase>a6919450-66f2-417f-9891-60d4219922a2</con:targetTestCase>
          <con:properties>
            <con:property>
              <con:name>tnx_number</con:name>
              <con:value>1590734631341</con:value>
            </con:property>
            <con:property>
              <con:name>tnxID</con:name>
              <con:value>38260720</con:value>
            </con:property>
            <con:property>
              <con:name>user_id</con:name>
              <con:value>379076658</con:value>
            </con:property>
            <con:property>
              <con:name>mobile</con:name>
            </con:property>
            <con:property>
              <con:name>awarded_points_afterTnx</con:name>
              <con:value>500</con:value>
            </con:property>
            <con:property>
              <con:name>totalPoints_afterTnx</con:name>
              <con:value>500</con:value>
            </con:property>
            <con:property>
              <con:name>pointBalance_afterTnx</con:name>
              <con:value>null</con:value>
            </con:property>
            <con:property>
              <con:name>tnx_mobile</con:name>
              <con:value>919734631344</con:value>
            </con:property>
          </con:properties>
          <con:returnProperties>
            <con:entry>tnx_number</con:entry>
            <con:entry>tnxID</con:entry>
            <con:entry>user_id</con:entry>
            <con:entry>awarded_points_afterTnx</con:entry>
            <con:entry>totalPoints_afterTnx</con:entry>
            <con:entry>pointBalance_afterTnx</con:entry>
            <con:entry>tnx_mobile</con:entry>
          </con:returnProperties>
          <con:runMode>PARALLELL</con:runMode>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="redeem awarded points against transaction number" id="90cec6ee-cfcd-4bda-a9db-eb3c2b9ae755">
        <con:settings/>
        <con:config service="RedeemPoints" resourcePath="/{version}/points/redeem" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="redeem awarded points against transaction number" id="589bdef3-8de7-4a35-bc91-bdb079b2b19f" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:encoding xsi:nil="true"/>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "redeem": {
      "points_redeemed": "${#awarded_points_afterTnx}",
      "transaction_number": "${#tnx_number}",
      "customer":
				{
					"mobile": "${#tnx_mobile}"
				},
      "group_redemption": "false",
      "notes": "redeem",
      "redemption_time": "${#TestSuite#current_time}"
    }
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/points/redeem</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="6e2bd406-02a0-41df-9f8e-f7166f69ffd2" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="21523a64-f6d3-4913-9411-9ab4777cbec5" name="Script Assertion">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

//get the customer and transaction details from transaction add and point redeem api response
String pointsToBeRedeem =  context.expand('${#awarded_points_afterTnx}')
String tnx_user_id = context.expand('${#user_id}')
String mob = context.expand('${#tnx_mobile}')
String tnx_number = context.expand('${#tnx_number}')
String user_id = json.response.responses.points.user_id.toString();
String mobile = json.response.responses.points.mobile.toString();
String num_points = json.response.responses.points.side_effects.effect[0].num_points.toString();
String currency_value = json.response.responses.points.side_effects.effect[0].currency_value.toString();
String redemption_id = json.response.responses.points.redemption_id.toString();
String redeemed_value = json.response.responses.points.redeemed_value.toString();
String tnx_number_aftpointsredeem = json.response.responses.points.side_effects.effect[0].redeemed_on_bill_number.toString();

//Vaidating the actual and expected value from the response
assert(pointsToBeRedeem == redeemed_value)
assert(user_id == tnx_user_id)
assert(mobile == mob);
assert(num_points == pointsToBeRedeem)
assert(currency_value == pointsToBeRedeem)
assert(tnx_number_aftpointsredeem == tnx_number)

//Exposing the redemption id for other api use
messageExchange.modelItem.testCase.setPropertyValue("redemption_id",redemption_id);


assert(json.response.responses.points.item_status.success == "true")
assert(json.response.responses.points.item_status.code == 800)
String msg = json.response.responses.points.item_status.message;
if(msg.toLowerCase() == "points redeemed"){
	assert true;
}
else{
	assert false : "Getting message as - " + msg;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="program_id" value=""/>
              <con:entry key="format" value="json"/>
              <con:entry key="version" value="v1.1"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>format</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>redemption_id</con:name>
          <con:value>thch07</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="e45bd6ea-01ee-43dd-a1ac-b13564d41dac" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Partial_Points_Redemption_Against_Tnx_Number" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="call get current date and time script" id="1233e6fd-80b9-42f3-a107-5f72313e74e6">
        <con:settings/>
        <con:config>
          <script>def getcurrent = Calendar.getInstance()
String current_time = getcurrent.format("yyyy-MM-dd HH:mm:ss");
testRunner.testCase.testSuite.setPropertyValue("current_time",current_time);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="calltestcase" name="add a transaction with transaction number" id="a96964aa-036b-43a9-b2d7-f76798a6fcb0">
        <con:settings/>
        <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:targetTestCase>a6919450-66f2-417f-9891-60d4219922a2</con:targetTestCase>
          <con:properties>
            <con:property>
              <con:name>tnx_number</con:name>
              <con:value>1590734645770</con:value>
            </con:property>
            <con:property>
              <con:name>tnxID</con:name>
              <con:value>38260721</con:value>
            </con:property>
            <con:property>
              <con:name>user_id</con:name>
              <con:value>379076659</con:value>
            </con:property>
            <con:property>
              <con:name>mobile</con:name>
            </con:property>
            <con:property>
              <con:name>awarded_points_afterTnx</con:name>
              <con:value>500</con:value>
            </con:property>
            <con:property>
              <con:name>totalPoints_afterTnx</con:name>
              <con:value>500</con:value>
            </con:property>
            <con:property>
              <con:name>pointBalance_afterTnx</con:name>
              <con:value>null</con:value>
            </con:property>
            <con:property>
              <con:name>tnx_mobile</con:name>
              <con:value>919734645773</con:value>
            </con:property>
          </con:properties>
          <con:returnProperties>
            <con:entry>tnx_number</con:entry>
            <con:entry>tnxID</con:entry>
            <con:entry>user_id</con:entry>
            <con:entry>awarded_points_afterTnx</con:entry>
            <con:entry>totalPoints_afterTnx</con:entry>
            <con:entry>pointBalance_afterTnx</con:entry>
            <con:entry>tnx_mobile</con:entry>
          </con:returnProperties>
          <con:runMode>PARALLELL</con:runMode>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="redeem partial points against transaction number" id="20e83e7c-cc25-46d9-8383-04bc1c47a786">
        <con:settings/>
        <con:config service="RedeemPoints" resourcePath="/{version}/points/redeem" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="redeem partial points against transaction number" id="589bdef3-8de7-4a35-bc91-bdb079b2b19f" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:encoding xsi:nil="true"/>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "redeem": {
      "points_redeemed": "${=Math.round(${#awarded_points_afterTnx}/2)}",
      "transaction_number": "${#tnx_number}",
      "customer":
				{
					"mobile": "${#tnx_mobile}"
				},
      "group_redemption": "false",
      "notes": "redeem",
      "redemption_time": "${#TestSuite#current_time}"
    }
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/points/redeem</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="c438e87e-0d8f-461e-ab56-18d73e8b58ba" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="28fbe66f-6d64-438c-b03f-c75b84aec1ec" name="Validate partial point redemption api response">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

//get the customer and transaction details from transaction add and point redeem api response
String pointsToBeRedeem =  context.expand('${=Math.round(${#awarded_points_afterTnx}/2)}') //dividing the awarded point and rounding off
String tnx_user_id = context.expand('${#user_id}')
String mob = context.expand('${#tnx_mobile}')
String user_id = json.response.responses.points.user_id.toString();
String mobile = json.response.responses.points.mobile.toString();
String num_points = json.response.responses.points.side_effects.effect[0].num_points.toString();
String currency_value = json.response.responses.points.side_effects.effect[0].currency_value.toString();
String redemption_id = json.response.responses.points.redemption_id.toString();
String redeemed_value = json.response.responses.points.redeemed_value.toString();


//Vaidating the actual and expected value from the response
assert(pointsToBeRedeem == redeemed_value)
assert(user_id == tnx_user_id)
assert(mobile == mob);
assert(num_points == pointsToBeRedeem)
assert(currency_value == pointsToBeRedeem)

//Exposing the redemption id for other api use
messageExchange.modelItem.testCase.setPropertyValue("redemption_id",redemption_id);


assert(json.response.responses.points.item_status.success == "true")
assert(json.response.responses.points.item_status.code == 800)
String msg = json.response.responses.points.item_status.message;
if(msg.toLowerCase() == "points redeemed"){
	assert true;
}
else{
	assert false : "Getting message as - " + msg;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="program_id" value=""/>
              <con:entry key="format" value="json"/>
              <con:entry key="version" value="v1.1"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>format</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>redemption_id</con:name>
          <con:value>NI7wCe</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="8655a3f6-09ec-4cfd-8ab6-237d14e586f5" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Pass_Redemption_Id_In_Add_Transaction" searchProperties="true">
      <con:settings/>
      <con:testStep type="calltestcase" name="do full point redemption" id="18b9eafe-1794-4833-abbe-034527909b25">
        <con:settings/>
        <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:targetTestCase>09dd370e-3ef6-4e5f-b954-65609ca078e7</con:targetTestCase>
          <con:properties>
            <con:property>
              <con:name>redemption_id</con:name>
              <con:value>UluDpq</con:value>
            </con:property>
            <con:property>
              <con:name>redemption_mobile</con:name>
              <con:value>919734671451</con:value>
            </con:property>
          </con:properties>
          <con:returnProperties>
            <con:entry>redemption_id</con:entry>
            <con:entry>redemption_mobile</con:entry>
          </con:returnProperties>
          <con:runMode>PARALLELL</con:runMode>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="get current date and time" id="6bb7a7a9-38a7-486f-8b09-1dda614a2c93">
        <con:settings/>
        <con:config>
          <script>def getcurrent = Calendar.getInstance()
String current_time = getcurrent.format("yyyy-MM-dd HH:mm:ss");
testRunner.testCase.setPropertyValue("current_time",current_time);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="get unique transaction number" id="c778ef58-9ddc-4028-bb53-6f3234edd22b">
        <con:settings/>
        <con:config>
          <script>String timestamp = System.currentTimeMillis().toString()
log.info timestamp
testRunner.testCase.setPropertyValue("tnx_number",timestamp);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="add transaction through redemption id" id="49bee437-a59c-4f6d-98ff-49b146a15871">
        <con:settings/>
        <con:config service="addRegularTransaction" resourcePath="/v1.1/transaction/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="add transaction through redemption id" id="30d7b033-bada-4cf6-abdf-781b858869dc" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "transaction": {
      "type": "regular",
      "number": "${#TestCase#tnx_number}",
      "amount": "1200",
      "billing_time": "${#current_time}",
      "gross_amount": "101",
      "redemptions": {
        "points_redemptions": {
        	"id":[
        	"${#redemption_id}"
          ]
        },
        "coupon_redemptions": {

        }
      },
      "customer": {
        "mobile": "${#redemption_mobile}",
        "firstname": "fname_${#redemption_mobile}",
        "lastname": "lname_${#redemption_mobile}",
        "type": "loyalty"
      },
      "custom_fields": {
        "field": {
          "name": "testcustom",
          "value": "test"
        }
      },
      "extended_fields": {
        "field": {
          "name": "CentralGST",
          "value": "98"
        }
      },
      "line_items": {
        "line_item": [
          {
            "attributes": {
              "attribute": {
                "name": "jeans",
                "value": "jeans"
              }
            },
            "serial": "1",
            "amount": "500",
            "description": "White",
            "item_code": "Pearls",
            "qty": "20",
            "rate": "50",
            "value": "1000",
            "discount": "0",
            "notes": "Return type of a line item with full"
          },
          {
            "attributes": {
              "attribute": {
                "name": "jeans",
                "value": "jeans"
              }
            },
            "serial": "2",
            "amount": "500",
            "description": "Extra",
            "item_code": "Extra",
            "qty": "10",
            "rate": "50",
            "value": "500",
            "discount": "0",
            "notes": "Return type of a line item with full"
          },
          {
            "attributes": {
              "attribute": {
                "name": "jeans",
                "value": "jeans"
              }
            },
            "serial": "3",
            "amount": "700",
            "description": "Extra",
            "item_code": "Extra",
            "qty": "1",
            "rate": "700",
            "value": "700",
            "discount": "0",
            "notes": "Return type of a line item with full"
          }
        ]
      }
    }
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/transaction/add</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="2723f632-ee75-4973-b507-e099b334c281" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="38748da1-c4c1-4e5f-971e-c42a926b7a58" name="Verify add transaction point redemption response">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

//get redemption call details
String mob = context.expand('${#redemption_mobile}')
String tnxNumber = context.expand('${#TestCase#tnx_number}')


//get transaction details
String tnxID = json.response.transactions.transaction.id[0].toString();
String billNumber = json.response.transactions.transaction.number[0].toString();
String type = json.response.transactions.transaction.type[0].toString();
String user_id = json.response.transactions.transaction.customer[0].user_id.toString();
String redeemedValue = json.response.transactions.transaction.customer[0].points_summaries.points_summary[0].redeemed.toString();
String mobile = json.response.transactions.transaction.customer[0].mobile.toString();
String fname = json.response.transactions.transaction.customer[0].firstname.toString();
String lname = json.response.transactions.transaction.customer[0].lastname.toString();
String email = json.response.transactions.transaction.customer[0].email.toString();
String awarded_points = json.response.transactions.transaction.side_effects[0].effect.awarded_points[0].toString();
String totalPoints = json.response.transactions.transaction.side_effects[0].effect.total_points[0].toString();

//assert actual and expected value
assert(billNumber == tnxNumber);
assert(mobile == mob);
assert(fname == "fname_" + mob);
assert(lname == "lname_" + mob);
//assert(email == mob + "@gmail.com")


messageExchange.modelItem.testCase.setPropertyValue("awarded_points_afterTnx",awarded_points);
messageExchange.modelItem.testCase.setPropertyValue("totalPoints_afterTnx",totalPoints);
messageExchange.modelItem.testCase.setPropertyValue("tnx_mobile",mobile);
messageExchange.modelItem.testCase.setPropertyValue("tnxID",tnxID);
messageExchange.modelItem.testCase.setPropertyValue("user_id",user_id);


//Item status.
assert(json.response.transactions.transaction.item_status[0].success == "true")
assert(json.response.transactions.transaction.item_status[0].code == 600)
String msg = json.response.transactions.transaction.item_status[0].message;
if(msg.toLowerCase() == "transaction added successfully"){
	assert true;
}
else{
	assert false : "Getting message as - " + msg;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>current_time</con:name>
          <con:value>2020-05-29 12:14:37</con:value>
        </con:property>
        <con:property>
          <con:name>tnx_number</con:name>
          <con:value>1590734677233</con:value>
        </con:property>
        <con:property>
          <con:name>tnxID</con:name>
          <con:value>38260723</con:value>
        </con:property>
        <con:property>
          <con:name>user_id</con:name>
          <con:value>379076660</con:value>
        </con:property>
        <con:property>
          <con:name>tnx_mobile</con:name>
          <con:value>919734671451</con:value>
        </con:property>
        <con:property>
          <con:name>awarded_points_afterTnx</con:name>
          <con:value>320</con:value>
        </con:property>
        <con:property>
          <con:name>totalPoints_afterTnx</con:name>
          <con:value>320</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="16714417-cb99-4d33-bd91-3c51268f0581" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Full_Points_Group_Redemption" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="get current date and time" id="444d7dd2-6426-47a7-92b6-cad22ba481f0">
        <con:settings/>
        <con:config>
          <script>def getcurrent = Calendar.getInstance()
String current_time = getcurrent.format("yyyy-MM-dd HH:mm:ss");
testRunner.testCase.setPropertyValue("current_time",current_time);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="calltestcase" name="call_transaction_add_for_group_redemption" id="e14c2b83-6f56-4a34-8257-7ee9f84db948">
        <con:settings/>
        <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:targetTestCase>a6919450-66f2-417f-9891-60d4219922a2</con:targetTestCase>
          <con:properties>
            <con:property>
              <con:name>tnx_number</con:name>
              <con:value>1590736268897</con:value>
            </con:property>
            <con:property>
              <con:name>tnxID</con:name>
              <con:value>38260736</con:value>
            </con:property>
            <con:property>
              <con:name>user_id</con:name>
              <con:value>379076669</con:value>
            </con:property>
            <con:property>
              <con:name>mobile</con:name>
              <con:value>919736268900</con:value>
            </con:property>
            <con:property>
              <con:name>awarded_points_afterTnx</con:name>
              <con:value>500</con:value>
            </con:property>
            <con:property>
              <con:name>totalPoints_afterTnx</con:name>
              <con:value>500</con:value>
            </con:property>
            <con:property>
              <con:name>pointBalance_afterTnx</con:name>
              <con:value xsi:nil="true"/>
            </con:property>
            <con:property>
              <con:name>tnx_mobile</con:name>
              <con:value>919736268900</con:value>
            </con:property>
          </con:properties>
          <con:returnProperties>
            <con:entry>tnx_number</con:entry>
            <con:entry>tnxID</con:entry>
            <con:entry>user_id</con:entry>
            <con:entry>mobile</con:entry>
            <con:entry>awarded_points_afterTnx</con:entry>
            <con:entry>totalPoints_afterTnx</con:entry>
            <con:entry>pointBalance_afterTnx</con:entry>
            <con:entry>tnx_mobile</con:entry>
          </con:returnProperties>
          <con:runMode>PARALLELL</con:runMode>
        </con:config>
      </con:testStep>
      <con:testStep type="calltestcase" name="call_non_default_program_add_transaction_for_group_redemption" id="1d63b5f8-f37c-4b14-8cd0-8464c020ce16">
        <con:settings/>
        <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:targetTestCase>e2f222e7-9e9d-4be0-926a-e697dbefc4f6</con:targetTestCase>
          <con:properties>
            <con:property>
              <con:name>mobilNuberFromCalledFunction</con:name>
              <con:value>${call_transaction_add_for_group_redemption#tnx_mobile}</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_auth_username</con:name>
              <con:value>${#Project#alphatill_username}</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_auth_password</con:name>
              <con:value>${#Project#alphatill_password}</con:value>
            </con:property>
            <con:property>
              <con:name>tnx_number</con:name>
            </con:property>
            <con:property>
              <con:name>current_time</con:name>
            </con:property>
            <con:property>
              <con:name>tnxID</con:name>
            </con:property>
            <con:property>
              <con:name>user_id</con:name>
            </con:property>
            <con:property>
              <con:name>non_default_tnxID</con:name>
              <con:value>38260737</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_tnx_user_id</con:name>
              <con:value>379076669</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_tnx_mobile</con:name>
              <con:value>919736268900</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_tnx_awarded_points_afterTnx</con:name>
              <con:value>880</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_tnx_totalPoints_afterTnx</con:name>
              <con:value>880</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_tnx_number</con:name>
            </con:property>
          </con:properties>
          <con:returnProperties>
            <con:entry>non_default_tnxID</con:entry>
            <con:entry>non_default_tnx_user_id</con:entry>
            <con:entry>non_default_tnx_mobile</con:entry>
            <con:entry>non_default_tnx_awarded_points_afterTnx</con:entry>
            <con:entry>non_default_tnx_totalPoints_afterTnx</con:entry>
          </con:returnProperties>
          <con:runMode>SINGLETON_AND_WAIT</con:runMode>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="redeem_points_across_all_the_program" id="f6174d1c-3cc5-4481-a7e1-b465c940afe7">
        <con:settings/>
        <con:config service="RedeemPoints" resourcePath="/{version}/points/redeem" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="redeem_points_across_all_the_program" id="589bdef3-8de7-4a35-bc91-bdb079b2b19f" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:encoding xsi:nil="true"/>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "redeem": {
      "points_redeemed": "${#non_default_tnx_totalPoints_afterTnx} ",
      "customer":
				{
					"mobile": "${#non_default_tnx_mobile}"
				},
      "group_redemption": "true",
      "notes": "redeem",
      "redemption_time": "${#TestSuite#current_time}"
    }
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/points/redeem</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="e9f80710-bb53-4e19-949f-3b9a696ce7fd" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="5f939d79-0c31-4ced-8f50-0ff758599ccd" name="Validate the points redeemed response">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

//get the customer and transaction details from transaction add and point redeem api response
String pointsToBeRedeem =  context.expand('${#non_default_tnx_totalPoints_afterTnx}')
String tnx_user_id = context.expand('${#non_default_tnx_user_id}')
String mob = context.expand('${#non_default_tnx_mobile}')
String mobile = json.response.responses.points.mobile.toString();
String user_id = json.response.responses.points.user_id.toString();
String redemption_id = json.response.responses.points.redemption_id.toString();
String redeemed_value = json.response.responses.points.points_redeemed.toString();


//Vaidating the actual and expected value from the response
assert(pointsToBeRedeem == redeemed_value)
assert(user_id == tnx_user_id)
assert(mobile == mob);

//Exposing the redemption id for other api use
messageExchange.modelItem.testCase.setPropertyValue("group_redemption_id",redemption_id);
messageExchange.modelItem.testCase.setPropertyValue("group_redemption_mobile",mobile);
messageExchange.modelItem.testCase.setPropertyValue("group_redeemed_value",redeemed_value);


assert(json.response.responses.points.item_status.success == "true")
assert(json.response.responses.points.item_status.code == 800)
String msg = json.response.responses.points.item_status.message;
if(msg.toLowerCase() == "points redeemed"){
	assert true;
}
else{
	assert false : "Getting message as - " + msg;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="program_id" value=""/>
              <con:entry key="format" value="json"/>
              <con:entry key="version" value="v1.1"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>format</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>txn_number</con:name>
          <con:value xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
        </con:property>
        <con:property>
          <con:name>current_time</con:name>
          <con:value>2020-05-29 12:41:08</con:value>
        </con:property>
        <con:property>
          <con:name>group_redemption_id</con:name>
          <con:value>2tVWlD</con:value>
        </con:property>
        <con:property>
          <con:name>group_redemption_mobile</con:name>
          <con:value>919736268900</con:value>
        </con:property>
        <con:property>
          <con:name>group_redeemed_value</con:name>
          <con:value>880</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="53014972-4435-4b56-b53d-938e33ffc60b" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Partial_points_Group_Redemption" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="get current date and time" id="d61dc71e-6a91-4bef-96fb-5da8cdaefe88">
        <con:settings/>
        <con:config>
          <script>def getcurrent = Calendar.getInstance()
String current_time = getcurrent.format("yyyy-MM-dd HH:mm:ss");
testRunner.testCase.setPropertyValue("current_time",current_time);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="calltestcase" name="call_transaction_add_for_partial_group_redemption" id="21e5cc43-a2f1-4250-bc3b-794fcf0694ec">
        <con:settings/>
        <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:targetTestCase>a6919450-66f2-417f-9891-60d4219922a2</con:targetTestCase>
          <con:properties>
            <con:property>
              <con:name>tnx_number</con:name>
              <con:value>1590735447017</con:value>
            </con:property>
            <con:property>
              <con:name>tnxID</con:name>
              <con:value>38260730</con:value>
            </con:property>
            <con:property>
              <con:name>user_id</con:name>
              <con:value>379076666</con:value>
            </con:property>
            <con:property>
              <con:name>mobile</con:name>
              <con:value>919735447018</con:value>
            </con:property>
            <con:property>
              <con:name>awarded_points_afterTnx</con:name>
            </con:property>
            <con:property>
              <con:name>totalPoints_afterTnx</con:name>
            </con:property>
            <con:property>
              <con:name>pointBalance_afterTnx</con:name>
            </con:property>
            <con:property>
              <con:name>tnx_mobile</con:name>
            </con:property>
          </con:properties>
          <con:returnProperties>
            <con:entry>tnx_number</con:entry>
            <con:entry>tnxID</con:entry>
            <con:entry>user_id</con:entry>
            <con:entry>mobile</con:entry>
          </con:returnProperties>
          <con:runMode>SINGLETON_AND_WAIT</con:runMode>
        </con:config>
      </con:testStep>
      <con:testStep type="calltestcase" name="call_non_default_program_add_transaction_for_partial_group_redemption" id="619fe8dc-67d7-4675-9dc2-3abc0a56b911">
        <con:settings/>
        <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:targetTestCase>e2f222e7-9e9d-4be0-926a-e697dbefc4f6</con:targetTestCase>
          <con:properties>
            <con:property>
              <con:name>mobilNuberFromCalledFunction</con:name>
              <con:value>${call_transaction_add_for_partial_group_redemption#mobile}</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_auth_username</con:name>
              <con:value>${#Project#alphatill_username}</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_auth_password</con:name>
              <con:value>${#Project#alphatill_password}</con:value>
            </con:property>
            <con:property>
              <con:name>tnx_number</con:name>
            </con:property>
            <con:property>
              <con:name>current_time</con:name>
            </con:property>
            <con:property>
              <con:name>tnxID</con:name>
            </con:property>
            <con:property>
              <con:name>user_id</con:name>
            </con:property>
            <con:property>
              <con:name>non_default_tnxID</con:name>
              <con:value>38260731</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_tnx_user_id</con:name>
              <con:value>379076666</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_tnx_mobile</con:name>
              <con:value>919735447018</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_tnx_awarded_points_afterTnx</con:name>
              <con:value>880</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_tnx_totalPoints_afterTnx</con:name>
              <con:value>880</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_tnx_number</con:name>
            </con:property>
          </con:properties>
          <con:returnProperties>
            <con:entry>non_default_tnxID</con:entry>
            <con:entry>non_default_tnx_user_id</con:entry>
            <con:entry>non_default_tnx_mobile</con:entry>
            <con:entry>non_default_tnx_awarded_points_afterTnx</con:entry>
            <con:entry>non_default_tnx_totalPoints_afterTnx</con:entry>
          </con:returnProperties>
          <con:runMode>SINGLETON_AND_WAIT</con:runMode>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="redeem_partial_points_across_all_the_program" id="b5c2b422-06ad-4818-be92-5093c277a9a5">
        <con:settings/>
        <con:config service="RedeemPoints" resourcePath="/{version}/points/redeem" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="redeem_partial_points_across_all_the_program" id="589bdef3-8de7-4a35-bc91-bdb079b2b19f" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:encoding xsi:nil="true"/>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "redeem": {
      "points_redeemed": "${=Math.round(${#non_default_tnx_totalPoints_afterTnx}/2)}",
      "customer":
				{
					"mobile": "${#non_default_tnx_mobile}"
				},
      "group_redemption": "true",
      "notes": "redeem",
      "redemption_time": "${#TestSuite#current_time}"
    }
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/points/redeem</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="e9f80710-bb53-4e19-949f-3b9a696ce7fd" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="5f939d79-0c31-4ced-8f50-0ff758599ccd" name="Validate the partial points redeemed response">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

//get the customer and transaction details from transaction add and point redeem api response
String pointsToBeRedeem =  context.expand('${=Math.round(${#non_default_tnx_totalPoints_afterTnx}/2)}')//dividing the awarded point and rounding off
String tnx_user_id = context.expand('${#non_default_tnx_user_id}')
String mob = context.expand('${#non_default_tnx_mobile}')
String mobile = json.response.responses.points.mobile.toString();
String user_id = json.response.responses.points.user_id.toString();
String redemption_id = json.response.responses.points.redemption_id.toString();
String redeemed_value = json.response.responses.points.points_redeemed.toString();


//Vaidating the actual and expected value from the response
assert(pointsToBeRedeem == redeemed_value)
assert(user_id == tnx_user_id)
assert(mobile == mob);

//Exposing the redemption id for other api use
messageExchange.modelItem.testCase.setPropertyValue("partial_group_redemption_id",redemption_id);
messageExchange.modelItem.testCase.setPropertyValue("partial_group_redemption_mobile",mobile);


assert(json.response.responses.points.item_status.success == "true")
assert(json.response.responses.points.item_status.code == 800)
String msg = json.response.responses.points.item_status.message;
if(msg.toLowerCase() == "points redeemed"){
	assert true;
}
else{
	assert false : "Getting message as - " + msg;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="program_id" value=""/>
              <con:entry key="format" value="json"/>
              <con:entry key="version" value="v1.1"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>format</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>current_time</con:name>
          <con:value>2020-05-29 12:27:27</con:value>
        </con:property>
        <con:property>
          <con:name>group_redemption_id</con:name>
          <con:value>PUFITU</con:value>
        </con:property>
        <con:property>
          <con:name>group_redemption_mobile</con:name>
          <con:value>919473748328</con:value>
        </con:property>
        <con:property>
          <con:name>partial_group_redemption_id</con:name>
          <con:value>asEjEZ</con:value>
        </con:property>
        <con:property>
          <con:name>partial_group_redemption_mobile</con:name>
          <con:value>919735447018</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="7e23111b-773c-4979-b0b2-b9d50cb515d7" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Full_Points_Group_Redemption_Against_Tnx_Number" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="get current date and time" id="639cebe4-b19a-42c9-8f2c-2a6555f2531a">
        <con:settings/>
        <con:config>
          <script>def getcurrent = Calendar.getInstance()
String current_time = getcurrent.format("yyyy-MM-dd HH:mm:ss");
testRunner.testCase.setPropertyValue("current_time",current_time);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="calltestcase" name="call_transaction_add_for_full_group_redemption_against_tnx_number" id="16c26740-43a5-4b9a-a28d-91e2e545e58e">
        <con:settings/>
        <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:targetTestCase>a6919450-66f2-417f-9891-60d4219922a2</con:targetTestCase>
          <con:properties>
            <con:property>
              <con:name>tnx_number</con:name>
              <con:value>1590735567721</con:value>
            </con:property>
            <con:property>
              <con:name>tnxID</con:name>
              <con:value>38260732</con:value>
            </con:property>
            <con:property>
              <con:name>user_id</con:name>
              <con:value>379076667</con:value>
            </con:property>
            <con:property>
              <con:name>mobile</con:name>
              <con:value>919735567721</con:value>
            </con:property>
            <con:property>
              <con:name>awarded_points_afterTnx</con:name>
              <con:value>500</con:value>
            </con:property>
            <con:property>
              <con:name>totalPoints_afterTnx</con:name>
              <con:value>500</con:value>
            </con:property>
            <con:property>
              <con:name>pointBalance_afterTnx</con:name>
              <con:value xsi:nil="true"/>
            </con:property>
            <con:property>
              <con:name>tnx_mobile</con:name>
              <con:value>919735567721</con:value>
            </con:property>
          </con:properties>
          <con:returnProperties>
            <con:entry>tnx_number</con:entry>
            <con:entry>tnxID</con:entry>
            <con:entry>user_id</con:entry>
            <con:entry>mobile</con:entry>
            <con:entry>awarded_points_afterTnx</con:entry>
            <con:entry>totalPoints_afterTnx</con:entry>
            <con:entry>pointBalance_afterTnx</con:entry>
            <con:entry>tnx_mobile</con:entry>
          </con:returnProperties>
          <con:runMode>SINGLETON_AND_WAIT</con:runMode>
        </con:config>
      </con:testStep>
      <con:testStep type="calltestcase" name="call_non_default_program_add_transaction_for_full_group_redemption_against_tnx_number" id="bc700d3f-d893-4c1e-b655-7cdecd3fdb47">
        <con:settings/>
        <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:targetTestCase>e2f222e7-9e9d-4be0-926a-e697dbefc4f6</con:targetTestCase>
          <con:properties>
            <con:property>
              <con:name>mobilNuberFromCalledFunction</con:name>
              <con:value>${call_transaction_add_for_full_group_redemption_against_tnx_number#tnx_mobile}</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_auth_username</con:name>
              <con:value>${#Project#alphatill_username}</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_auth_password</con:name>
              <con:value>${#Project#alphatill_password}</con:value>
            </con:property>
            <con:property>
              <con:name>tnx_number</con:name>
            </con:property>
            <con:property>
              <con:name>current_time</con:name>
            </con:property>
            <con:property>
              <con:name>tnxID</con:name>
            </con:property>
            <con:property>
              <con:name>user_id</con:name>
            </con:property>
            <con:property>
              <con:name>non_default_tnxID</con:name>
              <con:value>38260733</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_tnx_user_id</con:name>
              <con:value>379076667</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_tnx_mobile</con:name>
              <con:value>919735567721</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_tnx_awarded_points_afterTnx</con:name>
              <con:value>880</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_tnx_totalPoints_afterTnx</con:name>
              <con:value>880</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_tnx_number</con:name>
              <con:value>1590735572921</con:value>
            </con:property>
          </con:properties>
          <con:returnProperties>
            <con:entry>non_default_tnxID</con:entry>
            <con:entry>non_default_tnx_user_id</con:entry>
            <con:entry>non_default_tnx_mobile</con:entry>
            <con:entry>non_default_tnx_awarded_points_afterTnx</con:entry>
            <con:entry>non_default_tnx_totalPoints_afterTnx</con:entry>
            <con:entry>non_default_tnx_number</con:entry>
          </con:returnProperties>
          <con:runMode>SINGLETON_AND_WAIT</con:runMode>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="redeem_points_across_all_the_program_against_tnx_nuber" id="31eb4f2b-060b-4b12-ac13-3851c2aaff11">
        <con:settings/>
        <con:config service="RedeemPoints" resourcePath="/{version}/points/redeem" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="redeem_points_across_all_the_program_against_tnx_nuber" id="589bdef3-8de7-4a35-bc91-bdb079b2b19f" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:encoding xsi:nil="true"/>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "redeem": {
      "points_redeemed": "${#non_default_tnx_totalPoints_afterTnx} ",
      "transaction_number": "${#non_default_tnx_number}",
      "customer":
				{
					"mobile": "${#non_default_tnx_mobile}"
				},
      "group_redemption": "true",
      "notes": "redeem",
      "redemption_time": "${#TestSuite#current_time}"
    }
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/points/redeem</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="e9f80710-bb53-4e19-949f-3b9a696ce7fd" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="5f939d79-0c31-4ced-8f50-0ff758599ccd" name="Validate the points redemption against transaction response">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

//get the customer and transaction details from transaction add and point redeem api response
String pointsToBeRedeem =  context.expand('${#non_default_tnx_totalPoints_afterTnx}')
String tnx_user_id = context.expand('${#non_default_tnx_user_id}')
String mob = context.expand('${#non_default_tnx_mobile}')
String mobile = json.response.responses.points.mobile.toString();
String user_id = json.response.responses.points.user_id.toString();
String redemption_id = json.response.responses.points.redemption_id.toString();
String redeemed_value = json.response.responses.points.points_redeemed.toString();


//Vaidating the actual and expected value from the response
assert(pointsToBeRedeem == redeemed_value)
assert(user_id == tnx_user_id)
assert(mobile == mob);

//Exposing the redemption id for other api use
messageExchange.modelItem.testCase.setPropertyValue("group_redemption_id",redemption_id);
messageExchange.modelItem.testCase.setPropertyValue("group_redemption_mobile",mobile);


assert(json.response.responses.points.item_status.success == "true")
assert(json.response.responses.points.item_status.code == 800)
String msg = json.response.responses.points.item_status.message;
if(msg.toLowerCase() == "points redeemed"){
	assert true;
}
else{
	assert false : "Getting message as - " + msg;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="program_id" value=""/>
              <con:entry key="format" value="json"/>
              <con:entry key="version" value="v1.1"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>format</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>current_time</con:name>
          <con:value>2020-05-29 12:29:27</con:value>
        </con:property>
        <con:property>
          <con:name>group_redemption_id</con:name>
          <con:value>Tfa9rC</con:value>
        </con:property>
        <con:property>
          <con:name>group_redemption_mobile</con:name>
          <con:value>919735567721</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="006aeb36-e6e2-4836-a425-5d34ed34d99a" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Partial_Points_Group_Redemption_Against_Tnx_number" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="get current date and time" id="346f623b-f643-4bf9-8fbd-0d50732d5f55">
        <con:settings/>
        <con:config>
          <script>def getcurrent = Calendar.getInstance()
String current_time = getcurrent.format("yyyy-MM-dd HH:mm:ss");
testRunner.testCase.setPropertyValue("current_time",current_time);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="calltestcase" name="call_transaction_add_for_partial_group_redemption_against_tnx_number" id="72966280-fa2a-43ac-ba3d-6e11529bd309">
        <con:settings/>
        <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:targetTestCase>a6919450-66f2-417f-9891-60d4219922a2</con:targetTestCase>
          <con:properties>
            <con:property>
              <con:name>tnx_number</con:name>
              <con:value>1590736233712</con:value>
            </con:property>
            <con:property>
              <con:name>tnxID</con:name>
              <con:value>38260734</con:value>
            </con:property>
            <con:property>
              <con:name>user_id</con:name>
              <con:value>379076668</con:value>
            </con:property>
            <con:property>
              <con:name>mobile</con:name>
              <con:value>919736233712</con:value>
            </con:property>
            <con:property>
              <con:name>awarded_points_afterTnx</con:name>
              <con:value>500</con:value>
            </con:property>
            <con:property>
              <con:name>totalPoints_afterTnx</con:name>
              <con:value>500</con:value>
            </con:property>
            <con:property>
              <con:name>pointBalance_afterTnx</con:name>
              <con:value xsi:nil="true"/>
            </con:property>
            <con:property>
              <con:name>tnx_mobile</con:name>
              <con:value>919736233712</con:value>
            </con:property>
          </con:properties>
          <con:returnProperties>
            <con:entry>tnx_number</con:entry>
            <con:entry>tnxID</con:entry>
            <con:entry>user_id</con:entry>
            <con:entry>mobile</con:entry>
            <con:entry>awarded_points_afterTnx</con:entry>
            <con:entry>totalPoints_afterTnx</con:entry>
            <con:entry>pointBalance_afterTnx</con:entry>
            <con:entry>tnx_mobile</con:entry>
          </con:returnProperties>
          <con:runMode>SINGLETON_AND_WAIT</con:runMode>
        </con:config>
      </con:testStep>
      <con:testStep type="calltestcase" name="call_non_default_program_add_transaction_for_partial_group_redemption_against_tnx_number" id="b55595e2-2d2f-41a0-83de-eefdcfcfbfc4">
        <con:settings/>
        <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:targetTestCase>e2f222e7-9e9d-4be0-926a-e697dbefc4f6</con:targetTestCase>
          <con:properties>
            <con:property>
              <con:name>mobilNuberFromCalledFunction</con:name>
              <con:value>${call_transaction_add_for_partial_group_redemption_against_tnx_number#tnx_mobile}</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_auth_username</con:name>
              <con:value>${#Project#alphatill_username}</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_auth_password</con:name>
              <con:value>${#Project#alphatill_password}</con:value>
            </con:property>
            <con:property>
              <con:name>tnx_number</con:name>
            </con:property>
            <con:property>
              <con:name>current_time</con:name>
            </con:property>
            <con:property>
              <con:name>tnxID</con:name>
            </con:property>
            <con:property>
              <con:name>user_id</con:name>
            </con:property>
            <con:property>
              <con:name>non_default_tnxID</con:name>
              <con:value>38260735</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_tnx_user_id</con:name>
              <con:value>379076668</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_tnx_mobile</con:name>
              <con:value>919736233712</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_tnx_awarded_points_afterTnx</con:name>
              <con:value>880</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_tnx_totalPoints_afterTnx</con:name>
              <con:value>880</con:value>
            </con:property>
            <con:property>
              <con:name>non_default_tnx_number</con:name>
              <con:value>1590736238731</con:value>
            </con:property>
          </con:properties>
          <con:returnProperties>
            <con:entry>non_default_tnxID</con:entry>
            <con:entry>non_default_tnx_user_id</con:entry>
            <con:entry>non_default_tnx_mobile</con:entry>
            <con:entry>non_default_tnx_awarded_points_afterTnx</con:entry>
            <con:entry>non_default_tnx_totalPoints_afterTnx</con:entry>
            <con:entry>non_default_tnx_number</con:entry>
          </con:returnProperties>
          <con:runMode>SINGLETON_AND_WAIT</con:runMode>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="redeem_partial_points_across_all_the_program_against_tnx_nuber" id="fad603fb-de6a-4cb3-9921-42e847eaf68e">
        <con:settings/>
        <con:config service="RedeemPoints" resourcePath="/{version}/points/redeem" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="redeem_partial_points_across_all_the_program_against_tnx_nuber" id="589bdef3-8de7-4a35-bc91-bdb079b2b19f" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:encoding xsi:nil="true"/>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "redeem": {
      "points_redeemed": "${=Math.round(${#non_default_tnx_totalPoints_afterTnx}/2)}",
      "transaction_number": "${#non_default_tnx_number}",
      "customer":
				{
					"mobile": "${#non_default_tnx_mobile}"
				},
      "group_redemption": "true",
      "notes": "redeem",
      "redemption_time": "${#TestSuite#current_time}"
    }
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/points/redeem</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="e9f80710-bb53-4e19-949f-3b9a696ce7fd" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="5f939d79-0c31-4ced-8f50-0ff758599ccd" name="Validate the parial group points redemption against transaction response">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

//get the customer and transaction details from transaction add and point redeem api response
String pointsToBeRedeem =  context.expand('${=Math.round(${#non_default_tnx_totalPoints_afterTnx}/2)}')
String tnx_user_id = context.expand('${#non_default_tnx_user_id}')
String mob = context.expand('${#non_default_tnx_mobile}')
String mobile = json.response.responses.points.mobile.toString();
String user_id = json.response.responses.points.user_id.toString();
String redemption_id = json.response.responses.points.redemption_id.toString();
String redeemed_value = json.response.responses.points.points_redeemed.toString();


//Vaidating the actual and expected value from the response
assert(pointsToBeRedeem == redeemed_value)
assert(user_id == tnx_user_id)
assert(mobile == mob);

//Exposing the redemption id for other api use
messageExchange.modelItem.testCase.setPropertyValue("group_redemption_id",redemption_id);
messageExchange.modelItem.testCase.setPropertyValue("group_redemption_mobile",mobile);


assert(json.response.responses.points.item_status.success == "true")
assert(json.response.responses.points.item_status.code == 800)
String msg = json.response.responses.points.item_status.message;
if(msg.toLowerCase() == "points redeemed"){
	assert true;
}
else{
	assert false : "Getting message as - " + msg;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="program_id" value=""/>
              <con:entry key="format" value="json"/>
              <con:entry key="version" value="v1.1"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>format</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>current_time</con:name>
          <con:value>2020-05-29 12:40:33</con:value>
        </con:property>
        <con:property>
          <con:name>group_redemption_id</con:name>
          <con:value>K7Ld7u</con:value>
        </con:property>
        <con:property>
          <con:name>group_redemption_mobile</con:name>
          <con:value>919736233712</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="2681e88b-d09e-451b-970b-7b0ae34b1253" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Pass_Redemption_Id_in_Add_Tnx_For_Group_Redemption" searchProperties="true">
      <con:settings/>
      <con:testStep type="calltestcase" name="call_full_points_group_redemption_to_get_redemption_id" id="792700a7-a5e9-4263-9ada-1dadea28c854">
        <con:settings/>
        <con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:targetTestCase>16714417-cb99-4d33-bd91-3c51268f0581</con:targetTestCase>
          <con:properties>
            <con:property>
              <con:name>txn_number</con:name>
            </con:property>
            <con:property>
              <con:name>current_time</con:name>
            </con:property>
            <con:property>
              <con:name>group_redemption_id</con:name>
              <con:value>2tVWlD</con:value>
            </con:property>
            <con:property>
              <con:name>group_redemption_mobile</con:name>
              <con:value>919736268900</con:value>
            </con:property>
            <con:property>
              <con:name>group_redeemed_value</con:name>
              <con:value>880</con:value>
            </con:property>
          </con:properties>
          <con:returnProperties>
            <con:entry>group_redemption_id</con:entry>
            <con:entry>group_redemption_mobile</con:entry>
            <con:entry>group_redeemed_value</con:entry>
          </con:returnProperties>
          <con:runMode>SINGLETON_AND_WAIT</con:runMode>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="get current date and time" id="06c7679c-5400-40b4-8b4e-170c24ae4d26">
        <con:settings/>
        <con:config>
          <script>def getcurrent = Calendar.getInstance()
String current_time = getcurrent.format("yyyy-MM-dd HH:mm:ss");
testRunner.testCase.setPropertyValue("current_time",current_time);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="call get tnx number" id="d7241904-0524-4177-a1bb-e3e07515ab30">
        <con:settings/>
        <con:config>
          <script>String timestamp = System.currentTimeMillis().toString()
log.info timestamp
testRunner.testCase.setPropertyValue("tnx_number",timestamp);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="add_transaction_by_passing_group_redemption_id" id="bd86103f-e717-44ee-bc42-ceb45abcf80c">
        <con:settings/>
        <con:config service="addRegularTransaction" resourcePath="/v1.1/transaction/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="add_transaction_by_passing_group_redemption_id" id="30d7b033-bada-4cf6-abdf-781b858869dc" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "transaction": {
      "type": "regular",
      "number": "${#TestCase#tnx_number}",
      "amount": "1200",
      "billing_time": "${#current_time}",
      "gross_amount": "101",
      "redemptions": {
        "points_redemptions": {
        	"id":[
        	"${#group_redemption_id}"
          ]
        },
        "coupon_redemptions": {

        }
      },
      "customer": {
        "mobile": "${#group_redemption_mobile}",
        "firstname": "fname_${#group_redemption_mobile}",
        "lastname": "lname_${#group_redemption_mobile}",
        "type": "loyalty"
      },
      "custom_fields": {
        "field": {
          "name": "testcustom",
          "value": "test"
        }
      },
      "extended_fields": {
        "field": {
          "name": "CentralGST",
          "value": "98"
        }
      },
      "line_items": {
        "line_item": [
          {
            "attributes": {
              "attribute": {
                "name": "jeans",
                "value": "jeans"
              }
            },
            "serial": "1",
            "amount": "500",
            "description": "White",
            "item_code": "Pearls",
            "qty": "20",
            "rate": "50",
            "value": "1000",
            "discount": "0",
            "notes": "Return type of a line item with full"
          },
          {
            "attributes": {
              "attribute": {
                "name": "jeans",
                "value": "jeans"
              }
            },
            "serial": "2",
            "amount": "500",
            "description": "Extra",
            "item_code": "Extra",
            "qty": "10",
            "rate": "50",
            "value": "500",
            "discount": "0",
            "notes": "Return type of a line item with full"
          },
          {
            "attributes": {
              "attribute": {
                "name": "jeans",
                "value": "jeans"
              }
            },
            "serial": "3",
            "amount": "700",
            "description": "Extra",
            "item_code": "Extra",
            "qty": "1",
            "rate": "700",
            "value": "700",
            "discount": "0",
            "notes": "Return type of a line item with full"
          }
        ]
      }
    }
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/transaction/add</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="2723f632-ee75-4973-b507-e099b334c281" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="38748da1-c4c1-4e5f-971e-c42a926b7a58" name="Verify add transaction by passing group redmption id response">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

//get redemption call details
String mob = context.expand('${#group_redemption_mobile}')
String tnxNumber = context.expand('${#TestCase#tnx_number}')
String group_redemption_value = context.expand('${#group_redeemed_value}')


//get transaction details
String tnxID = json.response.transactions.transaction.id[0].toString();
String billNumber = json.response.transactions.transaction.number[0].toString();
String type = json.response.transactions.transaction.type[0].toString();
String user_id = json.response.transactions.transaction.customer[0].user_id.toString();
String redeemedValue = json.response.transactions.transaction.customer[0].points_summaries.points_summary[0].redeemed.toString();
String mobile = json.response.transactions.transaction.customer[0].mobile.toString();
String fname = json.response.transactions.transaction.customer[0].firstname.toString();
String lname = json.response.transactions.transaction.customer[0].lastname.toString();
String email = json.response.transactions.transaction.customer[0].email.toString();
String awarded_points = json.response.transactions.transaction.side_effects[0].effect.awarded_points[0];
String totalPoints = json.response.transactions.transaction.side_effects[0].effect.total_points[0].toString();
String lifetiepoints = json.response.transactions.transaction.customer[0].lifetime_points.toString();
int expected_lifetime_points = Integer.parseInt(group_redemption_value) + Integer.parseInt(awarded_points);

//assert actual and expected value
assert(billNumber == tnxNumber);
assert(mobile == mob);
assert(fname == "fname_" + mob);
assert(lname == "lname_" + mob);
assert(email == mob + "@gmail.com");
assert(lifetiepoints == expected_lifetime_points.toString());


messageExchange.modelItem.testCase.setPropertyValue("awarded_points_afterTnx",awarded_points);
messageExchange.modelItem.testCase.setPropertyValue("totalPoints_afterTnx",totalPoints);
messageExchange.modelItem.testCase.setPropertyValue("tnx_mobile",mobile);
messageExchange.modelItem.testCase.setPropertyValue("tnxID",tnxID);
messageExchange.modelItem.testCase.setPropertyValue("user_id",user_id);


//Item status.
assert(json.response.transactions.transaction.item_status[0].success == "true")
assert(json.response.transactions.transaction.item_status[0].code == 600)
String msg = json.response.transactions.transaction.item_status[0].message;
if(msg.toLowerCase() == "transaction added successfully"){
	assert true;
}
else{
	assert false : "Getting message as - " + msg;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>current_time</con:name>
          <con:value>2020-05-29 12:41:19</con:value>
        </con:property>
        <con:property>
          <con:name>tnx_number</con:name>
          <con:value>1590736279320</con:value>
        </con:property>
        <con:property>
          <con:name>awarded_points_afterTnx</con:name>
          <con:value>320</con:value>
        </con:property>
        <con:property>
          <con:name>totalPoints_afterTnx</con:name>
          <con:value>320</con:value>
        </con:property>
        <con:property>
          <con:name>tnx_mobile</con:name>
          <con:value>919736268900</con:value>
        </con:property>
        <con:property>
          <con:name>tnxID</con:name>
          <con:value>38260738</con:value>
        </con:property>
        <con:property>
          <con:name>user_id</con:name>
          <con:value>379076669</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:properties>
      <con:property>
        <con:name>current_time</con:name>
        <con:value>2020-06-08 17:43:16</con:value>
      </con:property>
    </con:properties>
  </con:testSuite>
  <con:testSuite id="0c38c5f7-ee0f-4b71-9e88-733b992cd242" name="Behavioural_Events">
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase id="aa946f3b-1c01-4708-ae13-d7335cf6833a" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case1_event_triggered_through_default_till" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="get unique customer mobile number" id="4164433d-8055-4dce-8a66-54a69be2bab3">
        <con:settings/>
        <con:config>
          <script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
testRunner.testCase.setPropertyValue("mobile","919" + mobile);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="register a customer" id="b3c551f9-02ff-480f-b9a7-ff0cb9092cfb">
        <con:settings/>
        <con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="register a customer" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="6561825e-a822-4b5a-8d71-764b779e304e" name="Status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="358bd7c4-10af-4b97-9e52-6af837cb76b9" name="validate customer registration data">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


//assert success holder in response
assert(json.response.status.success == "true")
assert(json.response.status.code == 200)
assert(json.response.status.message == "Success")


//assert customer data.

assert(json.response.customers.customer.user_id.size() == 1);

String user_id = json.response.customers.customer.user_id[0];
String f_name = json.response.customers.customer.firstname[0];
String l_name = json.response.customers.customer.lastname[0];
String mobile = json.response.customers.customer.mobile[0];
String email = json.response.customers.customer.email[0];
String lifetime_points = json.response.customers.customer.lifetime_points[0];
String loyalty_points = json.response.customers.customer.loyalty_points[0];
String current_slab = json.response.customers.customer.current_slab[0];

String lifetime_purchases = json.response.customers.customer.lifetime_purchases[0];
String type = json.response.customers.customer.type[0];
String source = json.response.customers.customer.source[0];
String mobile_reg = context.expand('${#TestCase#mobile}');

messageExchange.modelItem.testCase.setPropertyValue("mobilev2",mobile);







assert(lifetime_purchases == "0") // as this is new customer with no transactions.
assert(mobile == mobile_reg)
assert(json.response.customers.customer.subscriptions[0].subscription.size() == 4) // as we have configured 4 subscription while adding a customer.
assert(f_name == "fname_" + mobile_reg);
assert(l_name == "lname_" + mobile_reg);
assert(email == mobile_reg + "@gmail.com");
messageExchange.modelItem.testCase.setPropertyValue("user_id",user_id);
messageExchange.modelItem.testCase.testSuite.setPropertyValue("user_id",user_id);
messageExchange.modelItem.testCase.setPropertyValue("lifetime_points",lifetime_points.toString());
messageExchange.modelItem.testCase.setPropertyValue("loyalty_points",loyalty_points.toString());





//item status.

String item_message = json.response.customers.customer.item_status[0].message
String item_status = json.response.customers.customer.item_status[0].success
String item_code = json.response.customers.customer.item_status[0].code
assert(item_status == "true")
assert(item_code == "1000")
assert(item_message== "Customer registration successful")</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="format" value="json"/>
              <con:entry key="version" value="v1.1"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="now trigger a custom event through default till" id="3ba26597-e13b-4c89-980e-942e5885a60c">
        <con:settings/>
        <con:config service="triggerCustomEvent" resourcePath="" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="now trigger a custom event through default till" id="f773dd65-36e5-4368-91df-2c4c620e83d1" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="content-type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#custom_events_webhook}</con:endpoint>
            <con:request>{"Mobile":"${#TestCase#mobilev2}",
"Name":"stringxxx",
"Till":"${#Project#auth_username}",
"event_name":"AlphaEndToEnd"}</con:request>
            <con:originalUri>https://8mo7zxjtj0.execute-api.us-east-1.amazonaws.com/onenightly/webhooks/1b35496e-4126-4242-be3e-20f624766b67</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="7f48372c-a1db-4aa8-b8b0-c1cde60f90c6" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="7b8ea09a-8dcb-4665-a95e-855e11551e8e" name="get the request ID">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

String request_id = json.requestId

messageExchange.modelItem.testCase.setPropertyValue("request_id",request_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="get webhook consumer ID" id="77178375-c319-4c0c-9ace-7f0183402e67">
        <con:settings/>
        <con:config service="getWebhooks" resourcePath="/{version}/webHooks" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="get webhook consumer ID" id="e34c812d-806e-498b-adbd-323081eda9a6" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="bd5d1a2f-529b-492a-bf27-f3681c66848c" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="b9a1562a-b14d-4245-a079-7407ffcc3c36" name="get webhook consumer id by webhook name">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def webhook_names = json.data.name;
def my_webhook = context.expand('${#Project#webhook_workspace_name}');
int index = 0;
String consumer_id = "";
for(String name in webhook_names){
	if(name == my_webhook){
		consumer_id = json.data.consumerGroupId[index];
	}
	index++;
}

messageExchange.modelItem.testCase.setPropertyValue("webhook_consumerID",consumer_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:preemptive>true</con:preemptive>
              <con:authType>Preemptive</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="version" value="v3" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Poll the status of event log" id="fe06802c-016f-42ff-a677-8f07da70b984">
        <con:settings/>
        <con:config>
          <script>import com.eviware.soapui.model.testsuite.TestStepResult
import com.eviware.soapui.model.testsuite.TestStepResult.TestStepStatus
import com.eviware.soapui.model.testsuite.TestStep

int maxRetries = 10;

int polling_time = Integer.parseInt(context.expand('${#Project#polling_time}'));
while(maxRetries > 0){
	TestStep teststep = testRunner.testCase.testSuite.testCases["Case1_event_triggered_through_default_till"].testSteps["check event logs"]
	TestStepResult result = teststep.run(testRunner,context)
	TestStepStatus status = result.getStatus();
	log.info "Status -- " + status
	if(status == TestStepStatus.OK){
		maxRetries=0;
		break;
	}
	else{
		sleep(polling_time);
	}
	maxRetries--;
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="get loyalty points info after events gets trigered" id="c0a13fa9-8785-4ff4-aed5-772c00c59e25">
        <con:settings/>
        <con:config service="getCustomerV2" resourcePath="/v2/customers/{user_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="get loyalty points info after events gets trigered" id="35a353eb-1756-4e37-83f8-d8c4a290f0aa" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v2/customers/376790377</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="396dd36d-730e-404e-bac9-0e2754e38fa0" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="db44dbb0-61ac-473b-ac62-0e0c1d71ee5f" name="validate if points allocated is correct">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


int loyaltyPointsAfterEvent = json.groupLoyaltyProgramDetails.loyaltyPoints[0]

int loyaltyPointsBeforeEvent = Integer.parseInt(context.expand('${#TestCase#loyalty_points}'))

// Program is configured to allocate 100 points from default program whenever
// event is triggered from default program.

int pointsAllocatedForCustomEvent = 100

assert(loyaltyPointsAfterEvent == loyaltyPointsBeforeEvent + pointsAllocatedForCustomEvent)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="user_id" value="${#TestCase#user_id}" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="validate the event log in mongo via an API" id="5fb75843-6e22-4599-a17f-e1e762fc7624">
        <con:settings/>
        <con:config service="getEventLogs" resourcePath="/{version}/webHooks/eventLog/requestId/{request_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="validate the event log in mongo via an API" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9a67073e-d145-4c5f-90bf-7b2955e84d93" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ac07e8a1-01a4-49a8-9e5d-6e28d324525f" name="Validate &quot;Customer Added&quot; events pushed">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def consumers = json.data.consumerGroupId;

int index = 0;
String my_consumer = context.expand('${#TestCase#webhook_consumerID}');

ArrayList&lt;String> eventNames = new ArrayList();

ArrayList&lt;Integer> consumersStatus = new ArrayList();

for(consumer in consumers){
	if(consumer == my_consumer){
		String event_name = json.data.eventName[index];
		def consumerResponse = json.data.consumerResponse[index]
		assert(consumerResponse != null) : "Consumer response is NULL "
		int status = json.data.consumerResponse[index].webhookHttpStatus;
		eventNames.add(event_name);
		consumersStatus.add(status);
	}
	index++;
}

int eventCount = eventNames.size()
messageExchange.modelItem.testCase.setPropertyValue("events",eventNames.inspect())
messageExchange.modelItem.testCase.setPropertyValue("eventStatus",consumersStatus.inspect())

//all status should be 200
for(String status : consumersStatus){
	assert status == "200"
}
//customerAdded event should be pushed, as that is triggered as part of test case.
assert('pointsIssued' in eventNames)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="version" value="v3"/>
              <con:entry key="request_id" value="${#TestCase#request_id}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>request_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="httprequest" name="validate response data of event pushed to webhook" id="45a13de7-9299-48e7-9827-127adf51d953">
        <con:settings/>
        <con:config method="GET" xsi:type="con:HttpRequest" id="a8d53e36-26fb-4c1a-8c27-d0cb991becfb" name="validate response data of event pushed to webhook" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>http://${#Project#webhook_workspace}/api/events</con:endpoint>
          <con:request/>
          <con:assertion type="Valid HTTP Status Codes" id="6f4c5385-a53b-43e7-bbcb-3e084abfe072" name="status - 200">
            <con:configuration>
              <codes>200</codes>
            </con:configuration>
          </con:assertion>
          <con:assertion type="GroovyScriptAssertion" id="b125b22a-5024-494c-b2f4-26382b2aaa51" name="Script Assertion">
            <con:configuration>
              <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

int bodyCount = json.body.size();
def events = Eval.me(context.expand('${#TestCase#events}'))
def eventsInConsumer = json.body.eventName

messageExchange.modelItem.testCase.setPropertyValue('eventsReceived',eventsInConsumer.inspect())
assert(bodyCount == events.size())

assert('pointsIssued' in eventsInConsumer)

for(int i = 0;i&lt;bodyCount;i++){
	String event_name = json.body[i].eventName;
	if(event_name == "pointsIssued"){

	int pointsIssued = json.body[i].data.totalPointsIssued;
	assert(pointsIssued == 100)

	}

}</scriptText>
            </con:configuration>
          </con:assertion>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:parameter>
              <con:name>request_id</con:name>
              <con:value>${#TestCase#request_id}</con:value>
              <con:style>QUERY</con:style>
              <con:default/>
              <con:path xsi:nil="true"/>
              <con:description xsi:nil="true"/>
            </con:parameter>
          </con:parameters>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="check event logs" id="a6437d56-55db-4919-9bff-ee73922981bb" disabled="true">
        <con:settings/>
        <con:config service="getEventLogs" resourcePath="/{version}/webHooks/eventLog/requestId/{request_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="check event logs" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9a67073e-d145-4c5f-90bf-7b2955e84d93" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ac07e8a1-01a4-49a8-9e5d-6e28d324525f" name="validate the events pushed status">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def consumers = json.data.consumerGroupId;
log.info consumers
int index = 0;
String my_consumer = context.expand('${#TestCase#webhook_consumerID}');
ArrayList&lt;String> eventNames = new ArrayList();
ArrayList&lt;Integer> consumersStatus = new ArrayList();
for(consumer in consumers){
	if(consumer == my_consumer){
		String event_name = json.data.eventName[index];
		def consumerResponse = json.data.consumerResponse[index]
		assert(consumerResponse != null)
	}
	index++;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="version" value="v3"/>
              <con:entry key="request_id" value="${#TestCase#request_id}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>request_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:setupScript/>
      <con:properties>
        <con:property>
          <con:name>mobile</con:name>
          <con:value>919393299038</con:value>
        </con:property>
        <con:property>
          <con:name>request_id</con:name>
          <con:value>747cca36-1976-41cf-a389-c04ff1b6bfa3</con:value>
        </con:property>
        <con:property>
          <con:name>user_id</con:name>
          <con:value>379107118</con:value>
        </con:property>
        <con:property>
          <con:name>lifetime_points</con:name>
          <con:value>180</con:value>
        </con:property>
        <con:property>
          <con:name>loyalty_points</con:name>
          <con:value>180</con:value>
        </con:property>
        <con:property>
          <con:name>loyaltyType</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>source</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>till_code</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>till_name</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>lstLifeTimePoints_AfterTnx</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>lstLoyaltyPoints_AfterTnx</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>lstCurrentSlabs_AfterTnx</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>lstProgramIds_AfterTnx</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>lstProgramTitles_AfterTnx</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>events</con:name>
          <con:value>['pointsIssued']</con:value>
        </con:property>
        <con:property>
          <con:name>eventStatus</con:name>
          <con:value>[200]</con:value>
        </con:property>
        <con:property>
          <con:name>eventsReceived</con:name>
          <con:value>['pointsIssued']</con:value>
        </con:property>
        <con:property>
          <con:name>webhook_consumerID</con:name>
          <con:value>befe1b9f-7948-4540-8794-3c0a6fc073bb</con:value>
        </con:property>
        <con:property>
          <con:name>mobilev2</con:name>
          <con:value>919393299038</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="07b6512e-72ac-4581-ba4a-95ce6e79639a" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case2_event_is_triggered_with_first_nonDefault_till" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="get unique customer mobile number" id="a2140f74-cbcc-4bbd-aa02-76722aff3b52">
        <con:settings/>
        <con:config>
          <script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
testRunner.testCase.setPropertyValue("mobile","919" + mobile);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="register a customer" id="9c76789c-c686-441d-9dc2-9047cf87f0a3">
        <con:settings/>
        <con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="register a customer" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="6561825e-a822-4b5a-8d71-764b779e304e" name="Status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="358bd7c4-10af-4b97-9e52-6af837cb76b9" name="validate customer registration data">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


//assert success holder in response
assert(json.response.status.success == "true")
assert(json.response.status.code == 200)
assert(json.response.status.message == "Success")


//assert customer data.

assert(json.response.customers.customer.user_id.size() == 1);

String user_id = json.response.customers.customer.user_id[0];
String f_name = json.response.customers.customer.firstname[0];
String l_name = json.response.customers.customer.lastname[0];
String mobile = json.response.customers.customer.mobile[0];
String email = json.response.customers.customer.email[0];
String lifetime_points = json.response.customers.customer.lifetime_points[0];
String loyalty_points = json.response.customers.customer.loyalty_points[0];
String current_slab = json.response.customers.customer.current_slab[0];

String lifetime_purchases = json.response.customers.customer.lifetime_purchases[0];
String type = json.response.customers.customer.type[0];
String source = json.response.customers.customer.source[0];
String mobile_reg = context.expand('${#TestCase#mobile}');







assert(lifetime_purchases == "0") // as this is new customer with no transactions.
assert(mobile == mobile_reg)
assert(json.response.customers.customer.subscriptions[0].subscription.size() == 4) // as we have configured 4 subscription while adding a customer.
assert(f_name == "fname_" + mobile_reg);
assert(l_name == "lname_" + mobile_reg);
assert(email == mobile_reg + "@gmail.com");
messageExchange.modelItem.testCase.setPropertyValue("user_id",user_id);
messageExchange.modelItem.testCase.testSuite.setPropertyValue("user_id",user_id);
messageExchange.modelItem.testCase.setPropertyValue("lifetime_points",lifetime_points.toString());
messageExchange.modelItem.testCase.setPropertyValue("loyalty_points",loyalty_points.toString());





//item status.

String item_message = json.response.customers.customer.item_status[0].message
String item_status = json.response.customers.customer.item_status[0].success
String item_code = json.response.customers.customer.item_status[0].code
assert(item_status == "true")
assert(item_code == "1000")
assert(item_message== "Customer registration successful")</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="format" value="json"/>
              <con:entry key="version" value="v1.1"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="now trigger a custom event through first nonDefault till" id="e114a7a9-1b37-49cc-81e8-64ef3daf9633">
        <con:settings/>
        <con:config service="triggerCustomEvent" resourcePath="" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="now trigger a custom event through first nonDefault till" id="f773dd65-36e5-4368-91df-2c4c620e83d1" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="content-type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#custom_events_webhook}</con:endpoint>
            <con:request>{"Mobile":"${#TestCase#mobile}",
"Name":"stringxxx",
"Till":"${#Project#alphatill_username}",
"event_name":"AlphaEndToEnd"}</con:request>
            <con:originalUri>https://8mo7zxjtj0.execute-api.us-east-1.amazonaws.com/onenightly/webhooks/1b35496e-4126-4242-be3e-20f624766b67</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="7f48372c-a1db-4aa8-b8b0-c1cde60f90c6" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="7b8ea09a-8dcb-4665-a95e-855e11551e8e" name="get the request ID">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

String request_id = json.requestId

messageExchange.modelItem.testCase.setPropertyValue("request_id",request_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="get webhook consumer ID" id="2a5a2d86-6c00-4b05-82a3-4ba076818da3">
        <con:settings/>
        <con:config service="getWebhooks" resourcePath="/{version}/webHooks" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="get webhook consumer ID" id="e34c812d-806e-498b-adbd-323081eda9a6" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="bd5d1a2f-529b-492a-bf27-f3681c66848c" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="b9a1562a-b14d-4245-a079-7407ffcc3c36" name="get webhook consumer id by webhook name">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def webhook_names = json.data.name;
def my_webhook = context.expand('${#Project#webhook_workspace_name}');
int index = 0;
String consumer_id = "";
for(String name in webhook_names){
	if(name == my_webhook){
		consumer_id = json.data.consumerGroupId[index];
	}
	index++;
}

messageExchange.modelItem.testCase.setPropertyValue("webhook_consumerID",consumer_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:preemptive>true</con:preemptive>
              <con:authType>Preemptive</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="version" value="v3" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Poll the status of event log" id="dfafa5d6-3fb7-4524-82d9-1cedf9743a84">
        <con:settings/>
        <con:config>
          <script>import com.eviware.soapui.model.testsuite.TestStepResult
import com.eviware.soapui.model.testsuite.TestStepResult.TestStepStatus
import com.eviware.soapui.model.testsuite.TestStep

int maxRetries = 10;


while(maxRetries > 0){
	TestStep teststep = testRunner.testCase.testSuite.testCases["Case2_event_is_triggered_with_first_nonDefault_till"].testSteps["check event logs"]
	TestStepResult result = teststep.run(testRunner,context)
	TestStepStatus status = result.getStatus();
	log.info "Status -- " + status
	if(status == TestStepStatus.OK){
		maxRetries=0;
		break;
	}
	else{
		sleep(10000);
	}
	maxRetries--;
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="get loyalty points info after events gets trigered" id="a6bed1b3-1927-417a-8db6-4cf0664f7d18">
        <con:settings/>
        <con:config service="getCustomerV2" resourcePath="/v2/customers/{user_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="get loyalty points info after events gets trigered" id="35a353eb-1756-4e37-83f8-d8c4a290f0aa" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v2/customers/376790377</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="396dd36d-730e-404e-bac9-0e2754e38fa0" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="db44dbb0-61ac-473b-ac62-0e0c1d71ee5f" name="validate if points allocated is correct">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


int loyaltyPointsAfterEvent = json.groupLoyaltyProgramDetails.loyaltyPoints[0]

int loyaltyPointsBeforeEvent = Integer.parseInt(context.expand('${#TestCase#loyalty_points}'))

// Program is configured to allocate 100 points from default program and 50 points
// from non-defualt aplpha program whenever
// event is triggered from aplha program.

int pointsAllocatedForCustomEvent = 150

assert(loyaltyPointsAfterEvent == loyaltyPointsBeforeEvent + pointsAllocatedForCustomEvent)

// also assert the points allocated per program.

int[] loyaltyPoints = json.loyaltyProgramDetails.loyaltyPoints
int pointsInDefaultProgramExpected = (loyaltyPointsBeforeEvent+100)

assert(pointsInDefaultProgramExpected in loyaltyPoints)
assert(50 in loyaltyPoints)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="user_id" value="${#TestCase#user_id}" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="validate the event log in mongo via an API" id="0efbaf04-fa21-45c2-9a8d-adad3bf55085">
        <con:settings/>
        <con:config service="getEventLogs" resourcePath="/{version}/webHooks/eventLog/requestId/{request_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="validate the event log in mongo via an API" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9a67073e-d145-4c5f-90bf-7b2955e84d93" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ac07e8a1-01a4-49a8-9e5d-6e28d324525f" name="Validate &quot;Customer Added&quot; events pushed">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def consumers = json.data.consumerGroupId;

int index = 0;
String my_consumer = context.expand('${#TestCase#webhook_consumerID}');

ArrayList&lt;String> eventNames = new ArrayList();

ArrayList&lt;Integer> consumersStatus = new ArrayList();

for(consumer in consumers){
	if(consumer == my_consumer){
		String event_name = json.data.eventName[index];
		def consumerResponse = json.data.consumerResponse[index]
		assert(consumerResponse != null) : "Consumer response is NULL "
		int status = json.data.consumerResponse[index].webhookHttpStatus;
		eventNames.add(event_name);
		consumersStatus.add(status);
	}
	index++;
}

int eventCount = eventNames.size()
messageExchange.modelItem.testCase.setPropertyValue("events",eventNames.inspect())
messageExchange.modelItem.testCase.setPropertyValue("eventStatus",consumersStatus.inspect())

//all status should be 200
for(String status : consumersStatus){
	assert status == "200"
}
//customerAdded event should be pushed, as that is triggered as part of test case.
assert('pointsIssued' in eventNames)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="version" value="v3"/>
              <con:entry key="request_id" value="${#TestCase#request_id}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>request_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="httprequest" name="validate response data of event pushed to webhook" id="894bdae0-12f5-466a-a6de-fb42a9393b47">
        <con:settings/>
        <con:config method="GET" xsi:type="con:HttpRequest" id="a8d53e36-26fb-4c1a-8c27-d0cb991becfb" name="validate response data of event pushed to webhook" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>http://${#Project#webhook_workspace}/api/events</con:endpoint>
          <con:request/>
          <con:assertion type="Valid HTTP Status Codes" id="6f4c5385-a53b-43e7-bbcb-3e084abfe072" name="status - 200">
            <con:configuration>
              <codes>200</codes>
            </con:configuration>
          </con:assertion>
          <con:assertion type="GroovyScriptAssertion" id="b125b22a-5024-494c-b2f4-26382b2aaa51" name="Script Assertion">
            <con:configuration>
              <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

int bodyCount = json.body.size();
def events = Eval.me(context.expand('${#TestCase#events}'))
def eventsInConsumer = json.body.eventName

messageExchange.modelItem.testCase.setPropertyValue('eventsReceived',eventsInConsumer.inspect())
assert(bodyCount == events.size())

for(def event in events){
	assert(event in eventsInConsumer)
}
ArrayList&lt;Integer> pointIssuedlst = new ArrayList&lt;>();

for(int i = 0;i&lt;bodyCount;i++){
	String event_name = json.body[i].eventName;
	if(event_name == "pointsIssued"){
		int pointsIssued = json.body[i].data.totalPointsIssued;
		pointIssuedlst.add(pointsIssued)
		//assert(pointsIssued == 100)

	}

}
assert(100 in pointIssuedlst)
assert(50 in pointIssuedlst)</scriptText>
            </con:configuration>
          </con:assertion>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:parameter>
              <con:name>request_id</con:name>
              <con:value>${#TestCase#request_id}</con:value>
              <con:style>QUERY</con:style>
              <con:default/>
              <con:path xsi:nil="true"/>
              <con:description xsi:nil="true"/>
            </con:parameter>
          </con:parameters>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="check event logs" id="a323e75a-fac0-4dea-8b4f-642fa6f3696f" disabled="true">
        <con:settings/>
        <con:config service="getEventLogs" resourcePath="/{version}/webHooks/eventLog/requestId/{request_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="check event logs" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9a67073e-d145-4c5f-90bf-7b2955e84d93" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ac07e8a1-01a4-49a8-9e5d-6e28d324525f" name="validate the events pushed status">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def consumers = json.data.consumerGroupId;
log.info consumers
int index = 0;
String my_consumer = context.expand('${#TestCase#webhook_consumerID}');
ArrayList&lt;String> eventNames = new ArrayList();
ArrayList&lt;Integer> consumersStatus = new ArrayList();
for(consumer in consumers){
	if(consumer == my_consumer){
		String event_name = json.data.eventName[index];
		def consumerResponse = json.data.consumerResponse[index]
		assert(consumerResponse != null)
	}
	index++;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="version" value="v3"/>
              <con:entry key="request_id" value="${#TestCase#request_id}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>request_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:setupScript/>
      <con:properties>
        <con:property>
          <con:name>mobile</con:name>
          <con:value>919395178822</con:value>
        </con:property>
        <con:property>
          <con:name>request_id</con:name>
          <con:value>fd5c037a-17d5-428c-a36a-88b9a5261da2</con:value>
        </con:property>
        <con:property>
          <con:name>user_id</con:name>
          <con:value>379107124</con:value>
        </con:property>
        <con:property>
          <con:name>lifetime_points</con:name>
          <con:value>180</con:value>
        </con:property>
        <con:property>
          <con:name>loyalty_points</con:name>
          <con:value>180</con:value>
        </con:property>
        <con:property>
          <con:name>loyaltyType</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>source</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>till_code</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>till_name</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>lstLifeTimePoints_AfterTnx</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>lstLoyaltyPoints_AfterTnx</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>lstCurrentSlabs_AfterTnx</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>lstProgramIds_AfterTnx</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>lstProgramTitles_AfterTnx</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>events</con:name>
          <con:value>['pointsIssued', 'pointsIssued']</con:value>
        </con:property>
        <con:property>
          <con:name>eventStatus</con:name>
          <con:value>[200, 200]</con:value>
        </con:property>
        <con:property>
          <con:name>eventsReceived</con:name>
          <con:value>['pointsIssued', 'pointsIssued']</con:value>
        </con:property>
        <con:property>
          <con:name>webhook_consumerID</con:name>
          <con:value>befe1b9f-7948-4540-8794-3c0a6fc073bb</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:testCase id="ea4a15e6-521c-4ac1-8861-fadb155cab4a" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Case3_event_is_triggered_with_second_nonDefault_till" searchProperties="true">
      <con:settings/>
      <con:testStep type="groovy" name="get unique customer mobile number" id="79804cc9-ff13-4075-be3c-df22078684e8">
        <con:settings/>
        <con:config>
          <script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
testRunner.testCase.setPropertyValue("mobile","919" + mobile);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="register a customer" id="4d2f9790-766e-4ea8-aa4b-8765f48c6b5e">
        <con:settings/>
        <con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="register a customer" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
  "root": {
    "customer": [
      {
        "mobile": "${#TestCase#mobile}",
        "email": "${#TestCase#mobile}@gmail.com",

        "firstname": "fname_${#TestCase#mobile}",
        "lastname": "lname_${#TestCase#mobile}",
        "external_id": "x${#TestCase#mobile}",
        "gender": "M",
        "subscriptions": {
          "subscription": [
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "email"
            },
            {
              "priority": "TRANS",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            },
            {
              "priority": "BULK",
              "scope": "all",
              "is_subscribed": "0",
              "channel": "sms"
            }
          ]
        },
        	"extended_fields": {
				"field": [{
						"name": "nationality",
						"value": "India"
					},
					{
						"name": "zip",
						"value": "122001"
					}
				]
			}

      }
    ]
  }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="6561825e-a822-4b5a-8d71-764b779e304e" name="Status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="358bd7c4-10af-4b97-9e52-6af837cb76b9" name="validate customer registration data">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


//assert success holder in response
assert(json.response.status.success == "true")
assert(json.response.status.code == 200)
assert(json.response.status.message == "Success")


//assert customer data.

assert(json.response.customers.customer.user_id.size() == 1);

String user_id = json.response.customers.customer.user_id[0];
String f_name = json.response.customers.customer.firstname[0];
String l_name = json.response.customers.customer.lastname[0];
String mobile = json.response.customers.customer.mobile[0];
String email = json.response.customers.customer.email[0];
String lifetime_points = json.response.customers.customer.lifetime_points[0];
String loyalty_points = json.response.customers.customer.loyalty_points[0];
String current_slab = json.response.customers.customer.current_slab[0];

String lifetime_purchases = json.response.customers.customer.lifetime_purchases[0];
String type = json.response.customers.customer.type[0];
String source = json.response.customers.customer.source[0];
String mobile_reg = context.expand('${#TestCase#mobile}');







assert(lifetime_purchases == "0") // as this is new customer with no transactions.
assert(mobile == mobile_reg)
assert(json.response.customers.customer.subscriptions[0].subscription.size() == 4) // as we have configured 4 subscription while adding a customer.
assert(f_name == "fname_" + mobile_reg);
assert(l_name == "lname_" + mobile_reg);
assert(email == mobile_reg + "@gmail.com");
messageExchange.modelItem.testCase.setPropertyValue("user_id",user_id);
messageExchange.modelItem.testCase.testSuite.setPropertyValue("user_id",user_id);
messageExchange.modelItem.testCase.setPropertyValue("lifetime_points",lifetime_points.toString());
messageExchange.modelItem.testCase.setPropertyValue("loyalty_points",loyalty_points.toString());





//item status.

String item_message = json.response.customers.customer.item_status[0].message
String item_status = json.response.customers.customer.item_status[0].success
String item_code = json.response.customers.customer.item_status[0].code
assert(item_status == "true")
assert(item_code == "1000")
assert(item_message== "Customer registration successful")</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="format" value="json"/>
              <con:entry key="version" value="v1.1"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="now trigger a custom event through second nonDefault till" id="8d884097-d2e7-44f3-9971-aab093c9f50e">
        <con:settings/>
        <con:config service="triggerCustomEvent" resourcePath="" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="now trigger a custom event through second nonDefault till" id="f773dd65-36e5-4368-91df-2c4c620e83d1" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="content-type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#custom_events_webhook}</con:endpoint>
            <con:request>{"Mobile":"${#TestCase#mobile}",
"Name":"stringxxx",
"Till":"${#Project#gammatill_username}",
"event_name":"AlphaEndToEnd"}</con:request>
            <con:originalUri>https://8mo7zxjtj0.execute-api.us-east-1.amazonaws.com/onenightly/webhooks/1b35496e-4126-4242-be3e-20f624766b67</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="7f48372c-a1db-4aa8-b8b0-c1cde60f90c6" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="7b8ea09a-8dcb-4665-a95e-855e11551e8e" name="get the request ID">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

String request_id = json.requestId

messageExchange.modelItem.testCase.setPropertyValue("request_id",request_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:authType>No Authorization</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters/>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="get webhook consumer ID" id="fe9e490a-01c4-4512-952f-9524b6d1780d">
        <con:settings/>
        <con:config service="getWebhooks" resourcePath="/{version}/webHooks" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="get webhook consumer ID" id="e34c812d-806e-498b-adbd-323081eda9a6" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="bd5d1a2f-529b-492a-bf27-f3681c66848c" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="b9a1562a-b14d-4245-a079-7407ffcc3c36" name="get webhook consumer id by webhook name">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def webhook_names = json.data.name;
def my_webhook = context.expand('${#Project#webhook_workspace_name}');
int index = 0;
String consumer_id = "";
for(String name in webhook_names){
	if(name == my_webhook){
		consumer_id = json.data.consumerGroupId[index];
	}
	index++;
}

messageExchange.modelItem.testCase.setPropertyValue("webhook_consumerID",consumer_id);</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:preemptive>true</con:preemptive>
              <con:authType>Preemptive</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="version" value="v3" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="groovy" name="Poll the status of event log" id="41ac0ca3-a552-4176-a79e-181b35d4ee71">
        <con:settings/>
        <con:config>
          <script>import com.eviware.soapui.model.testsuite.TestStepResult
import com.eviware.soapui.model.testsuite.TestStepResult.TestStepStatus
import com.eviware.soapui.model.testsuite.TestStep

int maxRetries = 10;


while(maxRetries > 0){
	TestStep teststep = testRunner.testCase.testSuite.testCases["Case3_event_is_triggered_with_second_nonDefault_till"].testSteps["check event logs"]
	TestStepResult result = teststep.run(testRunner,context)
	TestStepStatus status = result.getStatus();
	log.info "Status -- " + status
	if(status == TestStepStatus.OK){
		maxRetries=0;
		break;
	}
	else{
		sleep(10000);
	}
	maxRetries--;
}</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="get loyalty points info after events gets trigered" id="595a0dce-602c-4926-a45b-da4c414327f1">
        <con:settings/>
        <con:config service="getCustomerV2" resourcePath="/v2/customers/{user_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="get loyalty points info after events gets trigered" id="35a353eb-1756-4e37-83f8-d8c4a290f0aa" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Content-Type" value="application/json" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v2/customers/376790377</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="396dd36d-730e-404e-bac9-0e2754e38fa0" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="db44dbb0-61ac-473b-ac62-0e0c1d71ee5f" name="validate if points allocated is correct">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);


int loyaltyPointsAfterEvent = json.groupLoyaltyProgramDetails.loyaltyPoints[0]

int loyaltyPointsBeforeEvent = Integer.parseInt(context.expand('${#TestCase#loyalty_points}'))

// Program is configured to allocate 100 points from default program and 50 points
// from non-defualt aplpha program whenever
// event is triggered from aplha program.

int pointsAllocatedForCustomEvent = 140

assert(loyaltyPointsAfterEvent == loyaltyPointsBeforeEvent + pointsAllocatedForCustomEvent)

// also assert the points allocated per program.

int[] loyaltyPoints = json.loyaltyProgramDetails.loyaltyPoints
int pointsInDefaultProgramExpected = (loyaltyPointsBeforeEvent+100)

assert(pointsInDefaultProgramExpected in loyaltyPoints)
assert(40 in loyaltyPoints)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="user_id" value="${#TestCase#user_id}" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="validate the event log in mongo via an API" id="a47eae45-ddfd-4b4d-93e9-ac94459a210f">
        <con:settings/>
        <con:config service="getEventLogs" resourcePath="/{version}/webHooks/eventLog/requestId/{request_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="validate the event log in mongo via an API" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9a67073e-d145-4c5f-90bf-7b2955e84d93" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ac07e8a1-01a4-49a8-9e5d-6e28d324525f" name="Validate &quot;Customer Added&quot; events pushed">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def consumers = json.data.consumerGroupId;

int index = 0;
String my_consumer = context.expand('${#TestCase#webhook_consumerID}');

ArrayList&lt;String> eventNames = new ArrayList();

ArrayList&lt;Integer> consumersStatus = new ArrayList();

for(consumer in consumers){
	if(consumer == my_consumer){
		String event_name = json.data.eventName[index];
		def consumerResponse = json.data.consumerResponse[index]
		assert(consumerResponse != null) : "Consumer response is NULL "
		int status = json.data.consumerResponse[index].webhookHttpStatus;
		eventNames.add(event_name);
		consumersStatus.add(status);
	}
	index++;
}

int eventCount = eventNames.size()
messageExchange.modelItem.testCase.setPropertyValue("events",eventNames.inspect())
messageExchange.modelItem.testCase.setPropertyValue("eventStatus",consumersStatus.inspect())

//all status should be 200
for(String status : consumersStatus){
	assert status == "200"
}
//customerAdded event should be pushed, as that is triggered as part of test case.
assert('pointsIssued' in eventNames)</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="version" value="v3"/>
              <con:entry key="request_id" value="${#TestCase#request_id}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>request_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="httprequest" name="validate response data of event pushed to webhook" id="144638f7-db3b-41ba-9afa-bd9413a57345">
        <con:settings/>
        <con:config method="GET" xsi:type="con:HttpRequest" id="a8d53e36-26fb-4c1a-8c27-d0cb991becfb" name="validate response data of event pushed to webhook" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:settings>
            <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
          </con:settings>
          <con:endpoint>http://${#Project#webhook_workspace}/api/events</con:endpoint>
          <con:request/>
          <con:assertion type="Valid HTTP Status Codes" id="6f4c5385-a53b-43e7-bbcb-3e084abfe072" name="status - 200">
            <con:configuration>
              <codes>200</codes>
            </con:configuration>
          </con:assertion>
          <con:assertion type="GroovyScriptAssertion" id="b125b22a-5024-494c-b2f4-26382b2aaa51" name="Script Assertion">
            <con:configuration>
              <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

int bodyCount = json.body.size();
def events = Eval.me(context.expand('${#TestCase#events}'))
def eventsInConsumer = json.body.eventName

messageExchange.modelItem.testCase.setPropertyValue('eventsReceived',eventsInConsumer.inspect())
assert(bodyCount == events.size())

for(def event in events){
	assert(event in eventsInConsumer)
}

ArrayList&lt;Integer> lstPointIssued = new ArrayList&lt;>()
for(int i = 0;i&lt;bodyCount;i++){
	String event_name = json.body[i].eventName;
	if(event_name == "pointsIssued"){
		int pointsIssued = json.body[i].data.totalPointsIssued;
		lstPointIssued.add(pointsIssued)
	}

}

assert(40 in lstPointIssued)
assert(100 in lstPointIssued)</scriptText>
            </con:configuration>
          </con:assertion>
          <con:credentials>
            <con:authType>No Authorization</con:authType>
          </con:credentials>
          <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
          <con:jmsPropertyConfig/>
          <con:parameters>
            <con:parameter>
              <con:name>request_id</con:name>
              <con:value>${#TestCase#request_id}</con:value>
              <con:style>QUERY</con:style>
              <con:default/>
              <con:path xsi:nil="true"/>
              <con:description xsi:nil="true"/>
            </con:parameter>
          </con:parameters>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="check event logs" id="395f831d-c5bc-4cf8-8939-ccb42b56ad06" disabled="true">
        <con:settings/>
        <con:config service="getEventLogs" resourcePath="/{version}/webHooks/eventLog/requestId/{request_id}" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="check event logs" id="c3c5f177-ed07-4079-aa2d-e3b654c037ab" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="Authorization" value="Basic Y20uMToyMDJjYjk2MmFjNTkwNzViOTY0YjA3MTUyZDIzNGI3MA==" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v3/webHooks/eventLog/requestId/d0b07a50-3efb-4c16-b395-45b49fb37ffa</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="9a67073e-d145-4c5f-90bf-7b2955e84d93" name="status - 200">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ac07e8a1-01a4-49a8-9e5d-6e28d324525f" name="validate the events pushed status">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def consumers = json.data.consumerGroupId;
log.info consumers
int index = 0;
String my_consumer = context.expand('${#TestCase#webhook_consumerID}');
ArrayList&lt;String> eventNames = new ArrayList();
ArrayList&lt;Integer> consumersStatus = new ArrayList();
for(consumer in consumers){
	if(consumer == my_consumer){
		String event_name = json.data.eventName[index];
		def consumerResponse = json.data.consumerResponse[index]
		assert(consumerResponse != null)
	}
	index++;
}</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="version" value="v3"/>
              <con:entry key="request_id" value="${#TestCase#request_id}"/>
            </con:parameters>
            <con:parameterOrder>
              <con:entry>version</con:entry>
              <con:entry>request_id</con:entry>
            </con:parameterOrder>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:setupScript/>
      <con:properties>
        <con:property>
          <con:name>mobile</con:name>
          <con:value>919938643177</con:value>
        </con:property>
        <con:property>
          <con:name>request_id</con:name>
          <con:value>797a13ee-9116-4cd2-b134-b8dd360aa68e</con:value>
        </con:property>
        <con:property>
          <con:name>user_id</con:name>
          <con:value>379094270</con:value>
        </con:property>
        <con:property>
          <con:name>lifetime_points</con:name>
          <con:value>180</con:value>
        </con:property>
        <con:property>
          <con:name>loyalty_points</con:name>
          <con:value>180</con:value>
        </con:property>
        <con:property>
          <con:name>loyaltyType</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>source</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>till_code</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>till_name</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>lstLifeTimePoints_AfterTnx</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>lstLoyaltyPoints_AfterTnx</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>lstCurrentSlabs_AfterTnx</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>lstProgramIds_AfterTnx</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>lstProgramTitles_AfterTnx</con:name>
          <con:value/>
        </con:property>
        <con:property>
          <con:name>events</con:name>
          <con:value>['pointsIssued', 'pointsIssued']</con:value>
        </con:property>
        <con:property>
          <con:name>eventStatus</con:name>
          <con:value>[200, 200]</con:value>
        </con:property>
        <con:property>
          <con:name>eventsReceived</con:name>
          <con:value>['pointsIssued', 'pointsIssued']</con:value>
        </con:property>
        <con:property>
          <con:name>webhook_consumerID</con:name>
          <con:value>befe1b9f-7948-4540-8794-3c0a6fc073bb</con:value>
        </con:property>
      </con:properties>
    </con:testCase>
    <con:properties>
      <con:property>
        <con:name>user_id</con:name>
        <con:value>379107124</con:value>
      </con:property>
      <con:property>
        <con:name>webhook_consumerID</con:name>
        <con:value/>
      </con:property>
    </con:properties>
  </con:testSuite>
  <con:testSuite id="0f730890-7b19-4b62-b602-c57ed6cb7994" name="v1.1/customer_SecurityTestSuite">
    <con:description>TestSuite generated for REST Service [customer_add]</con:description>
    <con:settings/>
    <con:runType>SEQUENTIAL</con:runType>
    <con:testCase id="fdafc387-ca70-497b-9861-efcd76196219" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="v1.1/customer_SecurityTestCase" searchProperties="true">
      <con:description>TestCase generated for REST Resource [add] located at [/{version}/customer/add]</con:description>
      <con:settings/>
      <con:testStep type="groovy" name="getMobile" id="2d635a15-e83d-4cc8-92ad-5bd821d3bddd" disabled="true">
        <con:settings/>
        <con:config>
          <script>String timestamp = System.currentTimeMillis().toString()
String mobile = timestamp.substring(4);
testRunner.testCase.setPropertyValue("mobile","919" + mobile);</script>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="customerAdd" id="1ac6515e-6bb7-4d0b-8d0c-7813c59e5202">
        <con:settings/>
        <con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="customerAdd" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{
   "root":{
      "customer":[
         {
            "mobile":"9765764354",
            "email":"9765764354@gmail.com",
            "firstname":"firstname_9765764354",
            "lastname":"lastname_9765764354",
            "gender":"M",
            "subscriptions":{
               "subscription":[
                  {
                     "priority":"TRANS",
                     "scope":"all",
                     "is_subscribed":"0",
                     "channel":"email"
                  },
                  {
                     "priority":"BULK",
                     "scope":"all",
                     "is_subscribed":"0",
                     "channel":"email"
                  },
                  {
                     "priority":"TRANS",
                     "scope":"all",
                     "is_subscribed":"0",
                     "channel":"sms"
                  },
                  {
                     "priority":"BULK",
                     "scope":"all",
                     "is_subscribed":"0",
                     "channel":"sms"
                  }
               ]
            },
            "extended_fields":{
               "field":[
                  {
                     "name":"nationality",
                     "value":"India"
                  },
                  {
                     "name":"zip",
                     "value":"122001"
                  }
               ]
            },
            "custom_fields":{
               "field":[
                  {
                     "name":"Hobbies",
                     "value":"[“Fitness”]"
                  },
                  {
                     "name":"a",
                     "value":"[“b”]"
                  }
               ]
            }
         }
      ]
   }
}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="6cb8c8e5-1744-4b70-8753-687c12f2c671" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="7d3bafc4-aa3e-437d-a60a-90f967241801" name="get the user id">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def user_id = json.response.customers.customer[0].user_id
messageExchange.modelItem.testCase.setPropertyValue('customerId', user_id.toString())</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="format" value="json"/>
              <con:entry key="version" value="v1.1"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="customerGet" id="c580c34b-159b-4b10-8d97-4dfd21f576d7">
        <con:settings/>
        <con:config service="getCustomerV1" resourcePath="/v1.1/customer/get" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="customerGet" id="fffb4960-10e1-4ff0-982b-f7255dbe25c3" mediaType="application/json">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="X-CAP-CLIENT-COUNTRYCODE" value="1" xmlns="http://eviware.com/soapui/config"/></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request/>
            <con:originalUri>https://nightly.capillary.in/v1.1/customer/get</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="7729bcc6-9338-4f0b-b0ed-ef67aa99c1af" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="Simple Contains" id="ad6adc78-e27d-4dbe-ba14-9d7a04123433" name="Contains valid message">
              <con:configuration>
                <token>Customer successfully retrieved</token>
                <ignoreCase>false</ignoreCase>
                <useRegEx>false</useRegEx>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <entry key="id" value="${#TestCase#customerId}" xmlns="http://eviware.com/soapui/config"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:testStep type="restrequest" name="Copy of customerAdd" id="8970add0-7aa0-4f69-a970-101bc8de292d" disabled="true">
        <con:settings/>
        <con:config service="customer_add" resourcePath="/{version}/customer/add" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
          <con:restRequest name="Copy of customerAdd" id="6b3f46be-1a90-4d61-9862-329d83eba9bd" mediaType="application/json" postQueryString="false">
            <con:settings>
              <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="X-CAP-CLIENT-COUNTRYCODE" value="1"/>
  &lt;con:entry key="Content-Type" value="application/json"/>
&lt;/xml-fragment></con:setting>
            </con:settings>
            <con:endpoint>https://${#Project#application_endpoint}</con:endpoint>
            <con:request>{"1":"0"}</con:request>
            <con:originalUri>https://nightly.capillary.in/v1.1/customer/add</con:originalUri>
            <con:assertion type="Valid HTTP Status Codes" id="6cb8c8e5-1744-4b70-8753-687c12f2c671" name="Valid HTTP Status Codes">
              <con:configuration>
                <codes>200</codes>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="7d3bafc4-aa3e-437d-a60a-90f967241801" name="get the user id">
              <con:configuration>
                <scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json = new JsonSlurper().parseText(response);

def user_id = json.response.customers.customer[0].user_id
messageExchange.modelItem.testCase.setPropertyValue('customerId', user_id.toString())</scriptText>
              </con:configuration>
            </con:assertion>
            <con:credentials>
              <con:username>${#Project#auth_username}</con:username>
              <con:password>${#Project#auth_password}</con:password>
              <con:selectedAuthProfile>Basic</con:selectedAuthProfile>
              <con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes>
              <con:authType>Global HTTP Settings</con:authType>
            </con:credentials>
            <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
            <con:jmsPropertyConfig/>
            <con:parameters>
              <con:entry key="format" value="json"/>
              <con:entry key="version" value="v1.1"/>
            </con:parameters>
          </con:restRequest>
        </con:config>
      </con:testStep>
      <con:properties>
        <con:property>
          <con:name>customerId</con:name>
          <con:value>373278342</con:value>
        </con:property>
        <con:property>
          <con:name>mobile</con:name>
          <con:value>919957559156</con:value>
        </con:property>
      </con:properties>
      <con:securityTest id="0c7c2962-0084-4a35-b827-0499e098583c" name="v1.1/customer_SecurityTest" failOnError="false" failSecurityTestOnScanErrors="true">
        <con:settings/>
        <con:setupScript>def jsonData = [
]
def newJson = []
context.jsonData = jsonData;
context.newJson = newJson;

String project_dir = context.expand('${projectDir}');
fuzzDBLocation = project_dir + File.separator + "test_data" + File.separator + "fuzzdb";

//Get data from JSON Fuzzing.
def lstOfJsons = []
def lstOfInvalidEmails = []

log.info("Reading JSON_fuzzing......")

new File(fuzzDBLocation + File.separator + "JSON_fuzzing.txt").withReader('UTF-8') { reader ->
def line
    while ((line = reader.readLine()) != null) {
        lstOfJsons.add(line)
    }
}
log.info("Reading Emails data.......")

new File(fuzzDBLocation + File.separator + "invalid-email-addresses.txt").withReader('UTF-8') { reader ->
def line
    while ((line = reader.readLine()) != null) {
        lstOfInvalidEmails.add(line)
    }
}


//set to context.
context.lstOfJsons = lstOfJsons
context.lstOfInvalidEmails = lstOfInvalidEmails
log.info("Context set!")</con:setupScript>
        <con:tearDownScript>import groovy.json.JsonOutput;
import com.eviware.soapui.security.*;
String project_dir = context.expand('${projectDir}');

def result = context.getProperty('SecurityScanRequestResult')
log.info ("Result Type: " + result.getResultType())
log.info("status: " + result.getStatus())
log.info("Messages: " + result.getMessages())
log.info("Actions: "+ result.getActions())

def newJsonStr = JsonOutput.toJson(context.newJson)
def newPrettyJson = JsonOutput.prettyPrint(newJsonStr)
def jsonStr = JsonOutput.toJson(context.jsonData)
def prettyJson = JsonOutput.prettyPrint(jsonStr)
//log.info("jsonObj -- " + prettyJson);

File reportFile = new File(project_dir + File.separator + "details.json");
File reportFileNew = new File(project_dir + File.separator + "newReport.json");

saveToFile(reportFile, prettyJson)
saveToFile(reportFileNew, newPrettyJson)

//Save the contents to a file
def saveToFile(file, content) {
    if (!file.parentFile.exists()) {
         file.parentFile.mkdirs()
         log.info "Directory did not exist, created"
    }
    file.write(content)
    assert file.exists(), "${file.name} not created"
}</con:tearDownScript>
        <con:testStepSecurityTest>
          <con:testStepId>1ac6515e-6bb7-4d0b-8d0c-7813c59e5202</con:testStepId>
          <con:testStepSecurityScan type="FuzzingScan" name="Fuzzing Scan" id="ee919c71-f498-41f8-832e-81fa5b7f6db4" applyForFailedStep="false" disabled="false" runOnlyOnce="true">
            <con:settings/>
            <con:config xsi:type="con:FuzzerScan" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:minimal>5</con:minimal>
              <con:maximal>10</con:maximal>
              <con:numberOfRequest>10</con:numberOfRequest>
            </con:config>
            <con:assertion type="Sensitive Information Exposure" id="879610ca-d462-417d-bcd7-3b6e2ba9f405" name="Sensitive Information Exposure">
              <con:configuration>
                <IncludeProjectSpecific>true</IncludeProjectSpecific>
                <IncludeGlobal>true</IncludeGlobal>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="ecb6b0b7-fea2-41dd-9013-d9e255f7e7c9" name="capture req/resp data">
              <con:configuration><scriptText>String response = messageExchange.getResponseContent();
String reqBody = messageExchange.getRequestContent();
String endPoint = messageExchange.getEndpoint()
HashMap&lt;String,String> properties = messageExchange.getProperties()
def parameterJson = [:]
properties.each{ key,value ->
  parameterJson[(key)] = value;
  //log.info ("Property - " + key + "::" + value);
  }
parameterString = parameterJson.toMapString()
//log.info("params -- " + parameterString);
//String changedParams = messageExchange.getProperty("SecurityChangedParameters");
def timeTaken = messageExchange.getTimeTaken();
def testStepName = context.testCase.getTestStepAt(context.getCurrentStepIndex()).getLabel();
def securityTestName = context.getCurrentScan().getParent().getName();
def scan = context.getCurrentScan().getName();

KEY = securityTestName + "_" + testStepName + "_" + scan + "_" + System.currentTimeMillis().toString();



context.jsonData &lt;&lt; [(KEY):["request": reqBody, "response": response, "timeTaken": timeTaken.toString(), "parameters": parameterString]];</scriptText></con:configuration>
            </con:assertion>
            <con:testStep xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
            <con:checkedParameters xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:parameters label="Username" parameterName="Username" xpath="" checked="true"/>
              <con:parameters label="Password" parameterName="Password" xpath="" checked="true"/>
              <con:parameters label="API version" parameterName="version" xpath="" checked="false"/>
            </con:checkedParameters>
            <con:executionStrategy xsi:nil="true" immutable="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:strategy>ALL_AT_ONCE</con:strategy>
              <con:delay>100</con:delay>
            </con:executionStrategy>
          </con:testStepSecurityScan>
          <con:testStepSecurityScan type="GroovySecurityScan" name="Custom Script" id="657af876-e19a-4339-880c-84aff4391c85" applyForFailedStep="false" disabled="true" runOnlyOnce="false">
            <con:settings/>
            <con:config xsi:type="con:GroovySecurityScan" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:executeScript>import groovy.json.JsonSlurper;
import groovy.json.JsonBuilder;
def req = testStep.getPropertyValue("Request")
def requestJson = new JsonSlurper().parseText(req);
def jsonFuzzMaxIndex = context.lstOfJsons.size -1;

def invalidEmailsMaxIndex = context.lstOfInvalidEmails.size -1;

if(context.jsonFuzzIndex == null){
	context.jsonFuzzIndex = 0
}
if(context.invalidEmailFuzzIndex == null){
	context.invalidEmailFuzzIndex = 0
}

JsonBuilder builder = new JsonBuilder(requestJson)

if(context.jsonFuzzIndex &lt;= jsonFuzzMaxIndex){
	log.info("Content at index - " + context.jsonFuzzIndex + "==> " + context.lstOfJsons.get(context.jsonFuzzIndex))
	builder.content = context.lstOfJsons.get(context.jsonFuzzIndex)
	parameters.payload = builder.toString();
	log.info("Payload set -- " + parameters.payload)
	context.jsonFuzzIndex++
	return true
}
else if(context.invalidEmailFuzzIndex &lt;= invalidEmailsMaxIndex){
	log.info("Content at index - " + context.invalidEmailFuzzIndex + "==> " + context.lstOfInvalidEmails.get(context.invalidEmailFuzzIndex))
	builder.content.root.customer[0].email = context.lstOfInvalidEmails.get(context.invalidEmailFuzzIndex)
	parameters.payload = builder.toString()
	log.info("Payload set -- " + parameters.payload)
	context.invalidEmailFuzzIndex++
	return true
}
else{
	return false
}</con:executeScript>
            </con:config>
            <con:assertion type="Sensitive Information Exposure" id="83009db4-a61f-4971-b8ef-074088a9d8b8" name="Sensitive Information Exposure">
              <con:configuration>
                <IncludeProjectSpecific>true</IncludeProjectSpecific>
                <IncludeGlobal>true</IncludeGlobal>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="1b8b77a1-a682-440d-94b6-b8dd95549b0b" name="capture request response">
              <con:configuration>
                <scriptText>String response = messageExchange.getResponseContent();
String reqBody = messageExchange.getRequestContent();
String endPoint = messageExchange.getEndpoint()
HashMap&lt;String,String> properties = messageExchange.getProperties()
def parameterJson = [:]
properties.each{ key,value ->
  parameterJson[(key)] = value;
  //log.info ("Property - " + key + "::" + value);
  }
parameterString = parameterJson.toMapString()
//log.info("params -- " + parameterString);
//String changedParams = messageExchange.getProperty("SecurityChangedParameters");
def timeTaken = messageExchange.getTimeTaken();
def testStepName = context.testCase.getTestStepAt(context.getCurrentStepIndex()).getLabel();
def securityTestName = context.getCurrentScan().getParent().getName();
def scan = context.getCurrentScan().getName();

KEY = securityTestName + "_" + testStepName + "_" + scan + "_" + System.currentTimeMillis().toString();



context.jsonData &lt;&lt; [(KEY):["request": reqBody, "response": response, "timeTaken": timeTaken.toString(), "parameters": parameterString]];</scriptText>
              </con:configuration>
            </con:assertion>
            <con:testStep xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
            <con:checkedParameters xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:parameters label="payload" parameterName="Request" xpath="" checked="true"/>
            </con:checkedParameters>
            <con:executionStrategy xsi:nil="true" immutable="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:strategy>ONE_BY_ONE</con:strategy>
              <con:delay>100</con:delay>
            </con:executionStrategy>
          </con:testStepSecurityScan>
          <con:testStepSecurityScan type="InvalidTypesSecurityScan" name="Invalid Types" id="49b64523-9131-482e-90f0-e949277da80c" applyForFailedStep="false" disabled="true" runOnlyOnce="true">
            <con:settings/>
            <con:config xsi:type="con:InvalidSecurityScan" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:typesList>
                <con:type>3</con:type>
                <con:value>true</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>4</con:type>
                <con:value>GpM7</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>5</con:type>
                <con:value>0FB7</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>9</con:type>
                <con:value>-1E4f</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>10</con:type>
                <con:value>12.45E+12</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>11</con:type>
                <con:value>-1.23</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>12</con:type>
                <con:value>SoapUI is	 the
 best</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>13</con:type>
                <con:value>P1Y2M3DT10H30M12.3S</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>14</con:type>
                <con:value>1999-05-31T13:20:00.000-05:00</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>16</con:type>
                <con:value>1999-05-31</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>22</con:type>
                <con:value>-1267896799</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>23</con:type>
                <con:value>-882223334991111111</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>24</con:type>
                <con:value>-2147483647</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>25</con:type>
                <con:value>-32768</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>26</con:type>
                <con:value>127</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>27</con:type>
                <con:value>0</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>28</con:type>
                <con:value>-1</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>29</con:type>
                <con:value>1</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>30</con:type>
                <con:value>1267896799</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>31</con:type>
                <con:value>882223334991111111</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>32</con:type>
                <con:value>294967295</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>33</con:type>
                <con:value>65535</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>34</con:type>
                <con:value>255</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>35</con:type>
                <con:value>SoapUI is the best</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>36</con:type>
                <con:value>SoapUI is the best</con:value>
              </con:typesList>
            </con:config>
            <con:assertion type="Sensitive Information Exposure" id="420a430f-4afe-4096-bc50-0e06d479679d" name="Sensitive Information Exposure">
              <con:configuration>
                <IncludeProjectSpecific>true</IncludeProjectSpecific>
                <IncludeGlobal>true</IncludeGlobal>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="48bcd880-2d2a-48f2-8105-141e4f62ea93" name="capture req/resp data">
              <con:configuration>
                <scriptText>String response = messageExchange.getResponseContent();
String reqBody = messageExchange.getRequestContent();
String endPoint = messageExchange.getEndpoint()
HashMap&lt;String,String> properties = messageExchange.getProperties()
def parameterJson = [:]
properties.each{ key,value ->
  parameterJson[(key)] = value;
  //log.info ("Property - " + key + "::" + value);
  }
parameterString = parameterJson.toMapString()
//log.info("params -- " + parameterString);
//String changedParams = messageExchange.getProperty("SecurityChangedParameters");
def timeTaken = messageExchange.getTimeTaken();
def testStepName = context.testCase.getTestStepAt(context.getCurrentStepIndex()).getLabel();
def securityTestName = context.getCurrentScan().getParent().getName();
def scan = context.getCurrentScan().getName();

KEY = securityTestName + "_" + testStepName + "_" + scan + "_" + System.currentTimeMillis().toString();



context.jsonData &lt;&lt; [(KEY):["request": reqBody, "response": response, "timeTaken": timeTaken.toString(), "parameters": parameterString]];</scriptText>
              </con:configuration>
            </con:assertion>
            <con:testStep xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
            <con:checkedParameters xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:parameters label="Username" parameterName="Username" xpath="" checked="false"/>
              <con:parameters label="Password" parameterName="Password" xpath="" checked="false"/>
              <con:parameters label="format" parameterName="format" xpath="" checked="false"/>
              <con:parameters label="version" parameterName="version" xpath="" checked="false"/>
              <con:parameters label="payload" parameterName="Request" xpath="" checked="true"/>
            </con:checkedParameters>
            <con:executionStrategy xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:strategy>ALL_AT_ONCE</con:strategy>
              <con:delay>100</con:delay>
            </con:executionStrategy>
          </con:testStepSecurityScan>
          <con:testStepSecurityScan type="BoundaryScan" name="Boundary Scan" id="82e7d7d2-1bf1-40e4-97f7-a91deb7c8538" applyForFailedStep="false" disabled="true" runOnlyOnce="true">
            <con:settings/>
            <con:config xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
            <con:assertion type="Sensitive Information Exposure" id="55c99a50-de49-41ae-8bcb-dc3b930be39b" name="Sensitive Information Exposure">
              <con:configuration>
                <IncludeProjectSpecific>true</IncludeProjectSpecific>
                <IncludeGlobal>true</IncludeGlobal>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="0a6af70b-a10b-462b-9edc-b1097600330a" name="Script Assertion">
              <con:configuration>
                <scriptText>String response = messageExchange.getResponseContent();
String request = messageExchange.getRequestContent();
def timeTaken = messageExchange.getTimeTaken();
def testStepName = context.testCase.getTestStepAt(context.getCurrentStepIndex()).getLabel();
def securityTestName = context.getCurrentScan().getParent().getName();
def scan = context.getCurrentScan().getName();

KEY = securityTestName + "_" + testStepName + "_" + scan + "_" + System.currentTimeMillis().toString();



context.jsonData &lt;&lt; [(KEY):["request": request, "response": response, "timeTaken": timeTaken.toString()]];</scriptText>
              </con:configuration>
            </con:assertion>
            <con:testStep xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
            <con:checkedParameters xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:parameters label="payload" parameterName="Request" xpath="" checked="true"/>
            </con:checkedParameters>
            <con:executionStrategy xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:strategy>ALL_AT_ONCE</con:strategy>
              <con:delay>100</con:delay>
            </con:executionStrategy>
          </con:testStepSecurityScan>
        </con:testStepSecurityTest>
        <con:testStepSecurityTest>
          <con:testStepId>c580c34b-159b-4b10-8d97-4dfd21f576d7</con:testStepId>
          <con:testStepSecurityScan type="FuzzingScan" name="Fuzzing Scan" id="20f10a7e-f5b1-4d04-b01a-1b43e8dd5a2f" applyForFailedStep="false" disabled="true" runOnlyOnce="true">
            <con:settings/>
            <con:config xsi:type="con:FuzzerScan" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:minimal>5</con:minimal>
              <con:maximal>15</con:maximal>
              <con:numberOfRequest>20</con:numberOfRequest>
            </con:config>
            <con:assertion type="Sensitive Information Exposure" id="1dd47175-578d-4d4f-a152-18a7e97bd088" name="Sensitive Information Exposure">
              <con:configuration>
                <IncludeProjectSpecific>true</IncludeProjectSpecific>
                <IncludeGlobal>true</IncludeGlobal>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="b25ceb36-8b12-4692-9183-7c6c466d1448" name="capture req/resp data">
              <con:configuration>
                <scriptText>String response = messageExchange.getResponseContent();
String reqBody = messageExchange.getRequestContent();
String endPoint = messageExchange.getEndpoint()
HashMap&lt;String,String> properties = messageExchange.getProperties()
def parameterJson = [:]
properties.each{ key,value ->
  parameterJson[(key)] = value;
  //log.info ("Property - " + key + "::" + value);
  }
parameterString = parameterJson.toMapString()
//log.info("params -- " + parameterString);
//String changedParams = messageExchange.getProperty("SecurityChangedParameters");
def timeTaken = messageExchange.getTimeTaken();
def testStepName = context.testCase.getTestStepAt(context.getCurrentStepIndex()).getLabel();
def securityTestName = context.getCurrentScan().getParent().getName();
def scan = context.getCurrentScan().getName();

KEY = securityTestName + "_" + testStepName + "_" + scan + "_" + System.currentTimeMillis().toString();



context.jsonData &lt;&lt; [(KEY):["request": reqBody, "response": response, "timeTaken": timeTaken.toString(), "parameters": parameterString]];</scriptText>
              </con:configuration>
            </con:assertion>
            <con:testStep xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
            <con:checkedParameters xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:parameters label="username" parameterName="Username" xpath="" checked="true"/>
              <con:parameters label="password" parameterName="Password" xpath="" checked="true"/>
              <con:parameters label="mlp" parameterName="mlp" xpath="" checked="true"/>
              <con:parameters label="format" parameterName="format" xpath="" checked="true"/>
              <con:parameters label="userId" parameterName="id" xpath="" checked="true"/>
            </con:checkedParameters>
            <con:executionStrategy xsi:nil="true" immutable="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:strategy>ALL_AT_ONCE</con:strategy>
              <con:delay>100</con:delay>
            </con:executionStrategy>
          </con:testStepSecurityScan>
          <con:testStepSecurityScan type="InvalidTypesSecurityScan" name="Invalid Types" id="95528999-6042-4762-ab3a-30d34fa699ef" applyForFailedStep="false" disabled="true" runOnlyOnce="true">
            <con:settings/>
            <con:config xsi:type="con:InvalidSecurityScan" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:typesList>
                <con:type>3</con:type>
                <con:value>true</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>4</con:type>
                <con:value>GpM7</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>5</con:type>
                <con:value>0FB7</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>9</con:type>
                <con:value>-1E4f</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>10</con:type>
                <con:value>12.45E+12</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>11</con:type>
                <con:value>-1.23</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>12</con:type>
                <con:value>SoapUI is	 the
 best</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>13</con:type>
                <con:value>P1Y2M3DT10H30M12.3S</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>14</con:type>
                <con:value>1999-05-31T13:20:00.000-05:00</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>16</con:type>
                <con:value>1999-05-31</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>22</con:type>
                <con:value>-1267896799</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>23</con:type>
                <con:value>-882223334991111111</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>24</con:type>
                <con:value>-2147483647</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>25</con:type>
                <con:value>-32768</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>26</con:type>
                <con:value>127</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>27</con:type>
                <con:value>0</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>28</con:type>
                <con:value>-1</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>29</con:type>
                <con:value>1</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>30</con:type>
                <con:value>1267896799</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>31</con:type>
                <con:value>882223334991111111</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>32</con:type>
                <con:value>294967295</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>33</con:type>
                <con:value>65535</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>34</con:type>
                <con:value>255</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>35</con:type>
                <con:value>SoapUI is the best</con:value>
              </con:typesList>
              <con:typesList>
                <con:type>36</con:type>
                <con:value>SoapUI is the best</con:value>
              </con:typesList>
            </con:config>
            <con:assertion type="Sensitive Information Exposure" id="c22e4cff-9b0e-49e9-9398-cf100800440a" name="Sensitive Information Exposure">
              <con:configuration>
                <IncludeProjectSpecific>true</IncludeProjectSpecific>
                <IncludeGlobal>true</IncludeGlobal>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="c3c9fe27-d081-4593-ad89-850d16bcd3a7" name="capture req/resp data">
              <con:configuration>
                <scriptText>String response = messageExchange.getResponseContent();
String reqBody = messageExchange.getRequestContent();
String endPoint = messageExchange.getEndpoint()
HashMap&lt;String,String> properties = messageExchange.getProperties()
def parameterJson = [:]
properties.each{ key,value ->
  parameterJson[(key)] = value;
  //log.info ("Property - " + key + "::" + value);
  }
parameterString = parameterJson.toMapString()
//log.info("params -- " + parameterString);
//String changedParams = messageExchange.getProperty("SecurityChangedParameters");
def timeTaken = messageExchange.getTimeTaken();
def testStepName = context.testCase.getTestStepAt(context.getCurrentStepIndex()).getLabel();
def securityTestName = context.getCurrentScan().getParent().getName();
def scan = context.getCurrentScan().getName();

KEY = securityTestName + "_" + testStepName + "_" + scan + "_" + System.currentTimeMillis().toString();



context.jsonData &lt;&lt; [(KEY):["request": reqBody, "response": response, "timeTaken": timeTaken.toString(), "parameters": parameterString]];</scriptText>
              </con:configuration>
            </con:assertion>
            <con:testStep xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
            <con:checkedParameters xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:parameters label="mlp" parameterName="mlp" xpath="" checked="true"/>
              <con:parameters label="username" parameterName="Username" xpath="" checked="false"/>
              <con:parameters label="format" parameterName="format" xpath="" checked="false"/>
              <con:parameters label="userId" parameterName="id" xpath="" checked="true"/>
              <con:parameters label="password" parameterName="Password" xpath="" checked="false"/>
            </con:checkedParameters>
            <con:executionStrategy xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:strategy>ALL_AT_ONCE</con:strategy>
              <con:delay>100</con:delay>
            </con:executionStrategy>
          </con:testStepSecurityScan>
          <con:testStepSecurityScan type="BoundaryScan" name="Boundary Scan" id="165c66d2-b948-4a70-846f-b159522aa4ad" applyForFailedStep="false" disabled="true" runOnlyOnce="true">
            <con:settings/>
            <con:config xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
            <con:assertion type="Sensitive Information Exposure" id="53acb4c1-81db-4a7d-96fd-493a3a5e6040" name="Sensitive Information Exposure">
              <con:configuration>
                <IncludeProjectSpecific>true</IncludeProjectSpecific>
                <IncludeGlobal>true</IncludeGlobal>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="df959ad3-a93b-4197-b27e-12e0c33451fd" name="capture req/resp data">
              <con:configuration>
                <scriptText>String response = messageExchange.getResponseContent();
String reqBody = messageExchange.getRequestContent();
String endPoint = messageExchange.getEndpoint()
HashMap&lt;String,String> properties = messageExchange.getProperties()
def parameterJson = [:]
properties.each{ key,value ->
  parameterJson[(key)] = value;
  //log.info ("Property - " + key + "::" + value);
  }
parameterString = parameterJson.toMapString()
//log.info("params -- " + parameterString);
//String changedParams = messageExchange.getProperty("SecurityChangedParameters");
def timeTaken = messageExchange.getTimeTaken();
def testStepName = context.testCase.getTestStepAt(context.getCurrentStepIndex()).getLabel();
def securityTestName = context.getCurrentScan().getParent().getName();
def scan = context.getCurrentScan().getName();

KEY = securityTestName + "_" + testStepName + "_" + scan + "_" + System.currentTimeMillis().toString();



context.jsonData &lt;&lt; [(KEY):["request": reqBody, "response": response, "timeTaken": timeTaken.toString(), "parameters": parameterString]];</scriptText>
              </con:configuration>
            </con:assertion>
            <con:testStep xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
            <con:checkedParameters xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:parameters label="userId" parameterName="id" xpath="" checked="true"/>
            </con:checkedParameters>
            <con:executionStrategy xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:strategy>ALL_AT_ONCE</con:strategy>
              <con:delay>100</con:delay>
            </con:executionStrategy>
          </con:testStepSecurityScan>
          <con:testStepSecurityScan type="CrossSiteScriptingScan" name="Cross Site Scripting" id="365b3f75-bc33-4389-8b09-2c07fa3f4420" applyForFailedStep="false" disabled="true" runOnlyOnce="true">
            <con:settings/>
            <con:config xsi:type="con:CrossSiteScriptingScan" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:parameterExposureStrings>&lt;PLAINTEXT></con:parameterExposureStrings>
              <con:parameterExposureStrings>';alert(String.fromCharCode(88,83,83))//\';alert(String.fromCharCode(88,83,83))//";alert(String.fromCharCode(88,83,83))//\";alert(String.fromCharCode(88,83,83))//-->&lt;/SCRIPT>">'>&lt;SCRIPT>alert(String.fromCharCode(88,83,83))&lt;/SCRIPT></con:parameterExposureStrings>
              <con:parameterExposureStrings>'';!--"&lt;XSS>=&amp;{()}</con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;SCRIPT SRC=http://soapui.org/xss.js>&lt;/SCRIPT></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IMG SRC="javascript:alert('XSS');"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IMG SRC=javascript:alert('XSS')></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IMG SRC=JaVaScRiPt:alert('XSS')></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IMG SRC=javascript:alert(&amp;quot;XSS&amp;quot;)></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IMG SRC=`javascript:alert("RSnake says, 'XSS'")`></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IMG """>&lt;SCRIPT>alert("XSS")&lt;/SCRIPT>"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IMG SRC=javascript:alert(String.fromCharCode(88,83,83))></con:parameterExposureStrings>
              <con:parameterExposureStrings><![CDATA[<IMG SRC=&#106;&#97;&#118;&#97;&#115;&#99;&#114;&#105;&#112;&#116;&#58;&#97;&#108;&#101;&#114;&#116;&#40;&#39;&#88;&#83;&#83;&#39;&#41;>]]></con:parameterExposureStrings>
              <con:parameterExposureStrings><![CDATA[<IMG SRC=&#0000106&#0000097&#0000118&#0000097&#0000115&#0000099&#0000114&#0000105&#0000112&#0000116&#0000058&#0000097&#0000108&#0000101&#0000114&#0000116&#0000040&#0000039&#0000088&#0000083&#0000083&#0000039&#0000041>]]></con:parameterExposureStrings>
              <con:parameterExposureStrings><![CDATA[<IMG SRC=&#x6A&#x61&#x76&#x61&#x73&#x63&#x72&#x69&#x70&#x74&#x3A&#x61&#x6C&#x65&#x72&#x74&#x28&#x27&#x58&#x53&#x53&#x27&#x29>]]></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IMG SRC="jav	ascript:alert('XSS');"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IMG SRC="jav&amp;#x09;ascript:alert('XSS');"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IMG SRC="jav&amp;#x0A;ascript:alert('XSS');"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IMG SRC="jav&amp;#x0D;ascript:alert('XSS');"></con:parameterExposureStrings>
              <con:parameterExposureStrings>perl -e 'print "&lt;IMG SRC=java\0script:alert(\"XSS\")>";' > out</con:parameterExposureStrings>
              <con:parameterExposureStrings>perl -e 'print "&lt;SCR\0IPT>alert(\"XSS\")&lt;/SCR\0IPT>";' > out</con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IMG SRC=" &amp;#14;  javascript:alert('XSS');"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;SCRIPT/XSS SRC="http://soapui.org/xss.js">&lt;/SCRIPT></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;BODY onload!#$%&amp;()*~+-_.,:;?@[/|\]^`=alert("XSS")></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;SCRIPT/SRC="http://soapui.org/xss.js">&lt;/SCRIPT></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;&lt;SCRIPT>alert("XSS");//&lt;&lt;/SCRIPT></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;SCRIPT SRC=http://soapui.org/xss.js?&lt;B></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;SCRIPT SRC=//ha.ckers.org/.j></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IMG SRC="javascript:alert('XSS')"</con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;iframe src=http://soapui.org/scriptlet.html &lt;</con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;SCRIPT>a=/XSS/alert(a.source)&lt;/SCRIPT></con:parameterExposureStrings>
              <con:parameterExposureStrings>\";alert('XSS');//</con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;/TITLE>&lt;SCRIPT>alert("XSS");&lt;/SCRIPT></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;INPUT TYPE="IMAGE" SRC="javascript:alert('XSS');"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;BODY BACKGROUND="javascript:alert('XSS')"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;BODY ONLOAD=alert('XSS')></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IMG DYNSRC="javascript:alert('XSS')"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IMG LOWSRC="javascript:alert('XSS')"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;BGSOUND SRC="javascript:alert('XSS');"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;BR SIZE="&amp;{alert('XSS')}"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;LAYER SRC="http://soapui.org/scriptlet.html">&lt;/LAYER></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;LINK REL="stylesheet" HREF="javascript:alert('XSS');"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;LINK REL="stylesheet" HREF="http://soapui.org/xss.css"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;STYLE>@import'http://soapui.org/xss.css';&lt;/STYLE></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;META HTTP-EQUIV="Link" Content="&lt;http://soapui.org/xss.css>; REL=stylesheet"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;STYLE>BODY{-moz-binding:url("http://soapui.org/xssmoz.xml#xss")}&lt;/STYLE></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;XSS STYLE="behavior: url(xss.htc);"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;STYLE>li {list-style-image: url("javascript:alert('XSS')");}&lt;/STYLE>&lt;UL>&lt;LI>XSS</con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IMG SRC='vbscript:msgbox("XSS")'></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IMG SRC="mocha:[code]"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IMG SRC="livescript:[code]"></con:parameterExposureStrings>
              <con:parameterExposureStrings>�script�alert(�XSS�)�/script�</con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;META HTTP-EQUIV="refresh" CONTENT="0;url=javascript:alert('XSS');"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;META HTTP-EQUIV="refresh" CONTENT="0;url=data:text/html;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4K"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;META HTTP-EQUIV="refresh" CONTENT="0; URL=http://;URL=javascript:alert('XSS');"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IFRAME SRC="javascript:alert('XSS');">&lt;/IFRAME></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;FRAMESET>&lt;FRAME SRC="javascript:alert('XSS');">&lt;/FRAMESET></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;TABLE BACKGROUND="javascript:alert('XSS')"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;TABLE>&lt;TD BACKGROUND="javascript:alert('XSS')"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;DIV STYLE="background-image: url(javascript:alert('XSS'))"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;DIV STYLE="background-image:\0075\0072\006C\0028'\006a\0061\0076\0061\0073\0063\0072\0069\0070\0074\003a\0061\006c\0065\0072\0074\0028.1027\0058.1053\0053\0027\0029'\0029"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;DIV STYLE="background-image: url(&amp;#1;javascript:alert('XSS'))"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;DIV STYLE="width: expression(alert('XSS'));"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;STYLE>@im\port'\ja\vasc\ript:alert("XSS")';&lt;/STYLE></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IMG STYLE="xss:expr/*XSS*/ession(alert('XSS'))"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;XSS STYLE="xss:expression(alert('XSS'))"></con:parameterExposureStrings>
              <con:parameterExposureStrings>exp/*&lt;A STYLE='no\xss:noxss("*//*");xss:&amp;#101;x&amp;#x2F;*XSS*//*/*/pression(alert("XSS"))'></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;STYLE TYPE="text/javascript">alert('XSS');&lt;/STYLE></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;STYLE>.XSS{background-image:url("javascript:alert('XSS')");}&lt;/STYLE>&lt;A CLASS=XSS>&lt;/A></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;STYLE type="text/css">BODY{background:url("javascript:alert('XSS')")}&lt;/STYLE></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;!--[if gte IE 4]>&lt;SCRIPT>alert('XSS');&lt;/SCRIPT>&lt;![endif]--></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;BASE HREF="javascript:alert('XSS');//"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;OBJECT TYPE="text/x-scriptlet" DATA="http://soapui.org/scriptlet.html">&lt;/OBJECT></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;OBJECT classid=clsid:ae24fdae-03c6-11d1-8b76-0080c744f389>&lt;param name=url value=javascript:alert('XSS')>&lt;/OBJECT></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;EMBED SRC="http://soapui.org/xss.swf" AllowScriptAccess="always">&lt;/EMBED></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;EMBED SRC="data:image/svg+xml;base64,PHN2ZyB4bWxuczpzdmc9Imh0dH A6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcv MjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hs aW5rIiB2ZXJzaW9uPSIxLjAiIHg9IjAiIHk9IjAiIHdpZHRoPSIxOTQiIGhlaWdodD0iMjAw IiBpZD0ieHNzIj48c2NyaXB0IHR5cGU9InRleHQvZWNtYXNjcmlwdCI+YWxlcnQoIlh TUyIpOzwvc2NyaXB0Pjwvc3ZnPg==" type="image/svg+xml" AllowScriptAccess="always">&lt;/EMBED></con:parameterExposureStrings>
              <con:parameterExposureStrings>a="get";b="URL(\"";c="javascript:";d="alert('XSS');\")";eval(a+b+c+d);</con:parameterExposureStrings>
              <con:parameterExposureStrings><![CDATA[<XML ID=I><X><C><![CDATA[<IMG SRC="javas]]]]>><![CDATA[<![CDATA[cript:alert('XSS');">]]]]>><![CDATA[</C></X></xml><SPAN DATASRC=#I DATAFLD=C DATAFORMATAS=HTML></SPAN>]]></con:parameterExposureStrings>
              <con:parameterExposureStrings><![CDATA[<XML ID="xss"><I><B>&lt;IMG SRC="javas<!-- -->cript:alert('XSS')"&gt;</B></I></XML><SPAN DATASRC="#xss" DATAFLD="B" DATAFORMATAS="HTML"></SPAN>]]></con:parameterExposureStrings>
              <con:parameterExposureStrings><![CDATA[<HTML><BODY><?xml:namespace prefix="t" ns="urn:schemas-microsoft-com:time"><?import namespace="t" implementation="#default#time2"><t:set attributeName="innerHTML" to="XSS&lt;SCRIPT DEFER&gt;alert(&quot;XSS&quot;)&lt;/SCRIPT&gt;"></BODY></HTML>]]></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;SCRIPT SRC="http://soapui.org/xss.jpg">&lt;/SCRIPT></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;? echo('&lt;SCR)';echo('IPT>alert("XSS")&lt;/SCRIPT>'); ?></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;IMG SRC="http://soapui.org/somecommand.php?somevariables=maliciouscode"></con:parameterExposureStrings>
              <con:parameterExposureStrings>Redirect 302 /a.jpg http://soapui.org/admin.asp&amp;deleteuser</con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;META HTTP-EQUIV="Set-Cookie" Content="USERID=&amp;lt;SCRIPT&amp;gt;alert('XSS')&amp;lt;/SCRIPT&amp;gt;"></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;HEAD>&lt;META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=UTF-7"> &lt;/HEAD>+ADw-SCRIPT+AD4-alert('XSS');+ADw-/SCRIPT+AD4-</con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;SCRIPT a=">" SRC="http://soapui.org/xss.js">&lt;/SCRIPT></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;SCRIPT =">" SRC="http://soapui.org/xss.js">&lt;/SCRIPT></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;SCRIPT a=">" '' SRC="http://soapui.org/xss.js">&lt;/SCRIPT></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;SCRIPT "a='>'" SRC="http://soapui.org/xss.js">&lt;/SCRIPT></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;SCRIPT a=`>` SRC="http://soapui.org/xss.js">&lt;/SCRIPT></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;SCRIPT a=">'>" SRC="http://soapui.org/xss.js">&lt;/SCRIPT></con:parameterExposureStrings>
              <con:parameterExposureStrings>&lt;SCRIPT>document.write("&lt;SCRI");&lt;/SCRIPT>PT SRC="http://soapui.org/xss.js">&lt;/SCRIPT></con:parameterExposureStrings>
            </con:config>
            <con:assertion type="CrosSiteScript" id="09b7830e-ded3-4e15-ad56-9379a62ee5f5" name="Cross Site Scripting Detection">
              <con:configuration/>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="6e9e956c-aa7c-49a7-b6d3-3eb345fd7abb" name="Script Assertion">
              <con:configuration>
                <scriptText>String response = messageExchange.getResponseContent();
String reqBody = messageExchange.getRequestContent();
String endPoint = messageExchange.getEndpoint()
HashMap&lt;String,String> properties = messageExchange.getProperties()
def parameterJson = [:]
properties.each{ key,value ->
  parameterJson[(key)] = value;
  //log.info ("Property - " + key + "::" + value);
  }
parameterString = parameterJson.toMapString()
//log.info("params -- " + parameterString);
//String changedParams = messageExchange.getProperty("SecurityChangedParameters");
def timeTaken = messageExchange.getTimeTaken();
def testStepName = context.testCase.getTestStepAt(context.getCurrentStepIndex()).getLabel();
def securityTestName = context.getCurrentScan().getParent().getName();
def scan = context.getCurrentScan().getName();

KEY = securityTestName + "_" + testStepName + "_" + scan + "_" + System.currentTimeMillis().toString();



context.jsonData &lt;&lt; [(KEY):["request": reqBody, "response": response, "timeTaken": timeTaken.toString(), "parameters": parameterString]];</scriptText>
              </con:configuration>
            </con:assertion>
            <con:testStep xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
            <con:checkedParameters xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:parameters label="userId" parameterName="id" xpath="" checked="true"/>
              <con:parameters label="mlp" parameterName="mlp" xpath="" checked="true"/>
            </con:checkedParameters>
            <con:executionStrategy xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:strategy>ALL_AT_ONCE</con:strategy>
              <con:delay>100</con:delay>
            </con:executionStrategy>
          </con:testStepSecurityScan>
          <con:testStepSecurityScan type="SQLInjectionScan" name="SQL Injection" id="aba1ae8b-06b9-48b4-bce4-bc4e9f43cc63" applyForFailedStep="false" disabled="true" runOnlyOnce="true">
            <con:settings/>
            <con:config xsi:type="con:SQLInjectionScan" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:sqlInjectionStrings>' or '1'='1</con:sqlInjectionStrings>
              <con:sqlInjectionStrings>'--</con:sqlInjectionStrings>
              <con:sqlInjectionStrings>1'</con:sqlInjectionStrings>
              <con:sqlInjectionStrings>admin'--</con:sqlInjectionStrings>
              <con:sqlInjectionStrings>/*!10000%201/0%20*/</con:sqlInjectionStrings>
              <con:sqlInjectionStrings>/*!10000 1/0 */</con:sqlInjectionStrings>
              <con:sqlInjectionStrings>1/0</con:sqlInjectionStrings>
              <con:sqlInjectionStrings>'%20o/**/r%201/0%20--</con:sqlInjectionStrings>
              <con:sqlInjectionStrings>' o/**/r 1/0 --</con:sqlInjectionStrings>
              <con:sqlInjectionStrings>;</con:sqlInjectionStrings>
              <con:sqlInjectionStrings>'%20and%201=2%20--</con:sqlInjectionStrings>
              <con:sqlInjectionStrings>' and 1=2 --</con:sqlInjectionStrings>
              <con:sqlInjectionStrings>test�%20UNION%20select%201,%20@@version,%201,%201;�</con:sqlInjectionStrings>
              <con:sqlInjectionStrings>test� UNION select 1, @@version, 1, 1;�</con:sqlInjectionStrings>
            </con:config>
            <con:assertion type="Sensitive Information Exposure" id="439666c8-c9bd-4b33-a57b-8a948e573a53" name="Sensitive Information Exposure">
              <con:configuration>
                <IncludeProjectSpecific>true</IncludeProjectSpecific>
                <IncludeGlobal>true</IncludeGlobal>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="7bf76a8a-43d7-4cc4-8a87-c89124fc4c7e" name="Script Assertion">
              <con:configuration>
                <scriptText>String response = messageExchange.getResponseContent();
String reqBody = messageExchange.getRequestContent();
String endPoint = messageExchange.getEndpoint()
HashMap&lt;String,String> properties = messageExchange.getProperties()
def parameterJson = [:]
properties.each{ key,value ->
  parameterJson[(key)] = value;
  //log.info ("Property - " + key + "::" + value);
  }
parameterString = parameterJson.toMapString()
//log.info("params -- " + parameterString);
//String changedParams = messageExchange.getProperty("SecurityChangedParameters");
def timeTaken = messageExchange.getTimeTaken();
def testStepName = context.testCase.getTestStepAt(context.getCurrentStepIndex()).getLabel();
def securityTestName = context.getCurrentScan().getParent().getName();
def scan = context.getCurrentScan().getName();

KEY = securityTestName + "_" + testStepName + "_" + scan + "_" + System.currentTimeMillis().toString();



context.jsonData &lt;&lt; [(KEY):["request": reqBody, "response": response, "timeTaken": timeTaken.toString(), "parameters": parameterString]];</scriptText>
              </con:configuration>
            </con:assertion>
            <con:testStep xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
            <con:checkedParameters xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:parameters label="mlp" parameterName="mlp" xpath="" checked="true"/>
              <con:parameters label="userId" parameterName="id" xpath="" checked="true"/>
            </con:checkedParameters>
            <con:executionStrategy xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:strategy>ALL_AT_ONCE</con:strategy>
              <con:delay>100</con:delay>
            </con:executionStrategy>
          </con:testStepSecurityScan>
          <con:testStepSecurityScan type="XPathInjectionSecurityScan" name="XPath Injection" id="baf0f67e-815d-4561-a1b9-c92020cdf7f9" applyForFailedStep="false" disabled="true" runOnlyOnce="true">
            <con:settings/>
            <con:config xsi:type="con:XPathInjection" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:xpathList>or name(//users/LoginID[1]) = 'LoginID' or 'a'='b</con:xpathList>
              <con:xpathList>' or '1'='1</con:xpathList>
              <con:xpathList>1/0</con:xpathList>
              <con:xpathList>'%20o/**/r%201/0%20--</con:xpathList>
              <con:xpathList>' o/**/r 1/0 --</con:xpathList>
              <con:xpathList>;</con:xpathList>
              <con:xpathList>'%20and%201=2%20--</con:xpathList>
              <con:xpathList>' and 1=2 --</con:xpathList>
              <con:xpathList>test�%20UNION%20select%201,%20@@version,%201,%201;�</con:xpathList>
              <con:xpathList>test� UNION select 1, @@version, 1, 1;�</con:xpathList>
            </con:config>
            <con:assertion type="Sensitive Information Exposure" id="2a14818b-57a4-43dd-ac70-b49ddb29339d" name="Sensitive Information Exposure">
              <con:configuration>
                <IncludeProjectSpecific>true</IncludeProjectSpecific>
                <IncludeGlobal>true</IncludeGlobal>
              </con:configuration>
            </con:assertion>
            <con:assertion type="GroovyScriptAssertion" id="86c3887b-726f-4565-ac6f-b100422b751f" name="Script Assertion">
              <con:configuration>
                <scriptText>String response = messageExchange.getResponseContent();
String reqBody = messageExchange.getRequestContent();
String endPoint = messageExchange.getEndpoint()
HashMap&lt;String,String> properties = messageExchange.getProperties()
def parameterJson = [:]
properties.each{ key,value ->
  parameterJson[(key)] = value;
  //log.info ("Property - " + key + "::" + value);
  }
parameterString = parameterJson.toMapString()
//log.info("params -- " + parameterString);
//String changedParams = messageExchange.getProperty("SecurityChangedParameters");
def timeTaken = messageExchange.getTimeTaken();
def testStepName = context.testCase.getTestStepAt(context.getCurrentStepIndex()).getLabel();
def securityTestName = context.getCurrentScan().getParent().getName();
def scan = context.getCurrentScan().getName();

KEY = securityTestName + "_" + testStepName + "_" + scan + "_" + System.currentTimeMillis().toString();



context.jsonData &lt;&lt; [(KEY):["request": reqBody, "response": response, "timeTaken": timeTaken.toString(), "parameters": parameterString]];</scriptText>
              </con:configuration>
            </con:assertion>
            <con:testStep xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>
            <con:checkedParameters xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:parameters label="mlp" parameterName="mlp" xpath="" checked="true"/>
              <con:parameters label="userId" parameterName="id" xpath="" checked="true"/>
            </con:checkedParameters>
            <con:executionStrategy xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
              <con:strategy>ALL_AT_ONCE</con:strategy>
              <con:delay>100</con:delay>
            </con:executionStrategy>
          </con:testStepSecurityScan>
        </con:testStepSecurityTest>
        <con:properties/>
      </con:securityTest>
    </con:testCase>
    <con:properties/>
  </con:testSuite><con:properties>
    <con:property>
      <con:name>environment</con:name>
      <con:value>nightly</con:value>
    </con:property>
    <con:property>
      <con:name>execution_group</con:name>
      <con:value>sanity,regression</con:value>
    </con:property>
    <con:property>
      <con:name>auth_username</con:name>
      <con:value>api.auto1</con:value>
    </con:property>
    <con:property>
      <con:name>auth_password</con:name>
      <con:value>202cb962ac59075b964b07152d234b70</con:value>
    </con:property>
    <con:property>
      <con:name>application_endpoint</con:name>
      <con:value>crm-nightly-new.cc.capillarytech.com</con:value>
    </con:property>
    <con:property>
      <con:name>webhook_workspace</con:name>
      <con:value>enqovte5kgmv6a1.m.pipedream.net</con:value>
    </con:property>
    <con:property>
      <con:name>webhook_workspace_name</con:name>
      <con:value>endtoend_hook_ng</con:value>
    </con:property>
    <con:property>
      <con:name>custom_events_webhook</con:name>
      <con:value>vo4mrjpidb.execute-api.us-east-1.amazonaws.com/crm-nightly-new/webhooks/8b5ec968-6c9d-46cf-8d1b-30b5ffb2d925</con:value>
    </con:property>
    <con:property>
      <con:name>alphatill_username</con:name>
      <con:value>api.auto2</con:value>
    </con:property>
    <con:property>
      <con:name>alphatill_password</con:name>
      <con:value>202cb962ac59075b964b07152d234b70</con:value>
    </con:property>
    <con:property>
      <con:name>gammatill_username</con:name>
      <con:value>api.auto3</con:value>
    </con:property>
    <con:property>
      <con:name>gammatill_password</con:name>
      <con:value>202cb962ac59075b964b07152d234b70</con:value>
    </con:property>
    <con:property>
      <con:name>polling_time</con:name>
      <con:value>15000</con:value>
    </con:property>
  </con:properties>
  <con:wssContainer/>
  <con:oAuth2ProfileContainer/>
  <con:oAuth1ProfileContainer/>
  <con:beforeRunScript>import groovy.json.JsonSlurper
import java.io.FileInputStream;

////////////////////// Functions /////////////////////////

def filterList(commaSperatedListContent){
	def list = commaSperatedListContent.split(",");
	def filteredList = [];
	list.each(){
	def entry = it.toLowerCase().replaceAll("^\\s+", "");
	entry = entry.trim();
	if(entry != ""){
	filteredList.add(entry);}
	}
	return filteredList;
}

def customListCompare(list1,list2){
	//list1 is the list of tags that are given by user to execute.
	//list2 is the list of tags for specific test suite.
	boolean isRunnable = false;
	for(int l1 in 0 .. list1.size()-1)
	{
		def inputTag = list1.get(l1);
		for(int l2 in 0 .. list2.size()-1){

			if(inputTag.toString() == list2.get(l2).toString()){
				isRunnable =  true;
				break;
			}
		}
		if(isRunnable){
			break;
		}
	}
	return isRunnable;
}
///////////////////// Function //////////////////////////////////////////////


// connect to json data file based on environment specified.
String environment = context.expand('${#Project#environment}');

String project_dir = context.expand('${projectDir}');
String filepath = project_dir + File.separator + "test_data" + File.separator + project.name + File.separator + environment + ".json";
log.info environment
try{
//File data_file = new File(filepath);
def reader = new BufferedReader(new InputStreamReader(new FileInputStream(filepath),"UTF-8"))
def json = new JsonSlurper().parse(reader);
String endpoint = json.endpoint;
String auth_username = json.authorization.username;
String auth_password = json.authorization.password;
project.setPropertyValue("auth_username",auth_username);
project.setPropertyValue("auth_password",auth_password);
project.setPropertyValue("alphatill_username",json.authorization.alphatill_username);
project.setPropertyValue("alphatill_password",json.authorization.alphatill_password);
project.setPropertyValue("gammatill_username",json.authorization.gammatill_username);
project.setPropertyValue("gammatill_password",json.authorization.gammatill_password);
project.setPropertyValue("application_endpoint",endpoint);
project.setPropertyValue("webhook_workspace",json.webhook_workspace);
project.setPropertyValue("webhook_workspace_name",json.webhook_workspace_name);
project.setPropertyValue("custom_events_webhook",json.custom_events_webhook);
}
catch(Exception e){
	log.info("Could not find the data file " + filepath + " Please check the data file. error == " + e.getMessage());
	assert(false)
}


// Selecting the test suites to run based on the group.

String executionGroups = project.getPropertyValue("execution_group")
def filteredTags = filterList(executionGroups) ;

def Conf_input = "";

log.info "Reading the Configuration file.....";

try{

Conf_input = new File(project_dir + "/test_data/" + project.getName() + "/TestData.xml");

def parser = new XmlParser(); //Get XML Parser.

def Configuration = parser.parse(Conf_input);//Point parser to configration file.

context.Configuration = Configuration;

}
catch(Exception e){
		assert false : "Error in reading configuration file -- " + e.getMessage();
}

def testSuiteListToExecute = [];

log.info "Fetching Test-Scenarios to execute....";

def testSuites = project.getTestSuiteList();

//Enable all TestSuites.
for(j in 0 .. testSuites.size()-1){
	//log.info testSuites.get(j).getName();
	testSuites.get(j).setDisabled(false);
}
//Decide which test suites to execute and eventually disabled the non-relevant test suites.
		for(i in 0 .. testSuites.size()-1) {
   			def testSuiteName = testSuites.get(i).getName();
   			def tags = context.Configuration.TestSuite."${testSuiteName}".tags.text()
   			def testSuiteTags = filterList(tags);

   			if(filteredTags == null || filteredTags.empty){
   				break;
   			}
   			else{
   				if(testSuiteTags == null || testSuiteTags.empty){
   					testSuites.get(i).setDisabled(true);
   				}
   				else{
   					def isRunnable = customListCompare(filteredTags,testSuiteTags);
   					log.info testSuiteName+":::"+isRunnable
   					if(!isRunnable){
   						testSuites.get(i).setDisabled(true);
   					}
   				}
   			}

		}</con:beforeRunScript>
  <con:sensitiveInformation/>
</con:soapui-project>